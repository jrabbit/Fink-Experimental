Package: avahi
Version: 0.6.20
Revision: 1

Source: http://www.avahi.org/download/avahi-%v.tar.gz
Source-MD5: 6acdff79afa2631f765f3bbbc3e25a74

BuildDepends: <<
	autoconf (>= 2.60),
	automake1.9,
	dbus-dev (>= 1.0-1),
	expat1,
	gdbm3,
	gettext-bin,
	gettext-tools,
	glib2-dev (>= 2.12.0-1),
	libdaemon (>= 0.11-1),
	libgettext3-dev,
	libiconv-dev,
	libpcap,
	libtool14,
	pkgconfig
<<
Depends: <<
	libavahi1-shlibs (= %v-%r),
	dbus-shlibs (>= 1.0-1),
	gdbm3-shlibs
<<

Patch: %n.patch
PatchScript: find . -name Makefile.am | xargs perl -pi -e 's/AM_CFLAGS(\s*\+?=)/AM_CPPFLAGS\1/'

ConfigureParams: <<
	--disable-python --disable-python-dbus \
	--disable-mono --disable-monodoc \
	--disable-qt3 --disable-qt4 \
	--disable-gtk \
	--disable-xmltoman \
	--disable-libdaemon \
	--disable-autoipd \
	--libdir=%p/lib/libavahi1 \
	--mandir=%p/share/man --disable-dependency-tracking
<<

CompileScript: <<
	autoreconf -f -i
	ac_cv_have_decl_CMSG_SPACE=yes ./configure %c
	make
<<

InstallScript: <<
	make install DESTDIR=%d
	rmdir %d/System/Library/LaunchDaemons
	rmdir %d/System/Library
	rmdir %d/System
<<
DocFiles: LICENSE docs/*

SplitOff: <<
	Package: libavahi1-shlibs
	Depends: <<
		dbus-shlibs (>= 1.0-1),
		glib2-shlibs (>= 2.12.0-1),
		libgettext3-shlibs,
		libiconv
	<<
	Files: <<
		lib/libavahi1/libavahi-client.3*.dylib
		lib/libavahi1/libavahi-common.3*.dylib
		lib/libavahi1/libavahi-core.5*.dylib
		lib/libavahi1/libavahi-glib.1*.dylib
	<<
	DocFiles: LICENSE docs/*
	Shlibs: <<
		%p/lib/libavahi1/libavahi-client.3.dylib 6.0.0 %n (>= 0.6.20-1)
		%p/lib/libavahi1/libavahi-common.3.dylib 8.0.0 %n (>= 0.6.20-1)
		%p/lib/libavahi1/libavahi-core.5.dylib 6.0.0 %n (>= 0.6.20-1)
		%p/lib/libavahi1/libavahi-glib.1.dylib 2.0.0 %n (>= 0.6.20-1)
	<<
<<
SplitOff2: <<
	Package: libavahi1-dev
	Depends: libavahi1-shlibs (= %v-%r)
	BuildDependsOnly: true
	Files: <<
		include
	<<
	InstallScript: <<
		mkdir -p %i/lib
		mv %I/lib/libavahi1 %i/lib
		mv %i/lib/libavahi1/pkgconfig %i/lib
		cd %i/lib && ln -s libavahi1/lib* .
	<<
	DocFiles: LICENSE docs/*
<<

DescPackaging: <<
	Disable many bindings, daemons, and utility programs that have
	large dependency chains and other packaging messes. If these
	are desired, package them separately.

	There are several libraries with different major-versions, so
	we'll consider this a monolithic suite with a made-up sequence
	number and store the runtime libs in a subdir. If any lib
	major-version changes, increase suite number (libdir name and
	-dev and -shlibs package-names). Headers, .pc, and linker libs
	in the usual libdir (not private dirs) in the -dev so
	consumers don't need any special settings (all major
	libversion -dev mutually exclusive as usual) and will get
	linked to the suite's own subdir install_name (-shlibs all
	coexist).

	Be overly explicit about some shell commands in order to make
	sure expected things actually got built and non-expected ones
	didn't. Also, harder-than-necessary because Files happens
	*after* InstallScript
<<
DescPort: <<
	_XOPEN_SOURCE breaks /usr/include/getopt.h

	Darwin support is poor, clone some bsd parts. No route()
	message-type AFM_IFANNOUNCE so just nuke what uses it.

	automake automatically adds -I$(top_srcdir) early in compiler
	calls, no need to pass it explicitly and not correct to pass
	it in a way that comes after global -I flags; swap into a
	variable that comes earlier...easier to put it somewhere
	harmless than to remove it.

	Chain installation of daemon starter-scripts and daemon
	manpages to same conditionals that control installation of the
	daemons themselves.
<<
DescDetail: <<
Avahi is a system which facilitates service discovery on a local
network. This means that you can plug your laptop or computer into a
network and instantly be able to view other people who you can chat
with, find printers to print to or find files being shared. This kind
of technology is already found in Apple MacOS X (branded Rendezvous,
Bonjour and sometimes Zeroconf) and is very convenient.

Porchdog has discontinued the "howl" library and recommends Avahi as
its replacement.

The core libraries are in "libavahi1-shlibs" and "libavahi1-dev".
The command-line tools are in "avahi".
The other controlers, daemons, and other bindings are not here.
<<
Description: Network service discovery library
Homepage: http://www.avahi.org/
License: LGPL
Maintainer: The Gnome Core Team <fink-gnome-core@lists.sourceforge.net>
