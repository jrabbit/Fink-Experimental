Package: system-apache1-php4
Version: 4.1.2
Revision: 1
Type: nosource
Maintainer: Daniel Macks <dmacks@netspace.org>
Description: Enables PHP support for system Apache server
DescDetail: <<
This package patches the Apache config file to load the php module and
enable support for .php and .phps file suffixes.
<<
License: BSD
Depends: system-apache1
CompileScript: echo "Nothing to compile"
InstallScript: <<
    install -d -m0755 %i/share/%n
    ( echo "# The following line added by Fink %n" ; echo "Include %p/share/system-apache1-php4/httpd.conf.include" ) > %i/share/%n/httpd.conf.fragment
    ( echo "LoadModule php4_module libexec/httpd/libphp4.so" ; echo "AddModule mod_php4.c" ; echo "AddType application/x-httpd-php .php" ; echo "AddType application/x-httpd-php-source .phps" ; echo "<IfModule mod_dir.c>" ; echo "DirectoryIndex index.php" ; echo "</IfModule>" ) > %i/share/%n/httpd.conf.include
<<
PreInstScript: <<
  if [ ! -f /usr/libexec/httpd/libphp4.so ]; then
    echo "Could not find the Apache PHP4 module!"
    exit 1
  fi
  if [ ! -d /System/Library/PHP ]; then
    echo "Could not find the PHP4 libraries!"
    exit 1
  fi
<<
PostInstScript: <<
  cat %p/share/%n/httpd.conf.fragment >> /etc/httpd/httpd.conf
  echo "When your Apache daemon is next (re)started, PHP4 support will be enabled."
  echo "Apache can be controlled via the System Preferences...Sharing panel"
  echo "or using the 'apachectl' command"
<<
PreRmScript: <<
  conffile=/etc/httpd/httpd.conf
  confback=$conffile.fink-old
  cp $conffile $confback
  grep -v -f %p/share/%n/httpd.conf.fragment $confback > $conffile
  echo "When your Apache daemon is next (re)started, PHP4 support will be disabled,"
  echo "unless you have manually modified your config files to enable it."
  echo "Apache can be controlled via the System Preferences...Sharing panel"
  echo "or using the 'apachectl' command"
<<
