diff -Nurd -x'*~' gpsdrive-2.0pre9.orig/configure.ac gpsdrive-2.0pre9/configure.ac
--- gpsdrive-2.0pre9.orig/configure.ac	2003-07-06 18:41:51.000000000 -0400
+++ gpsdrive-2.0pre9/configure.ac	2003-07-06 19:54:14.000000000 -0400
@@ -6,15 +6,15 @@
 
 AC_CONFIG_SRCDIR(src/gpsdrive.c)
 AC_CONFIG_HEADER(config.h)
-dnl AM_INIT_AUTOMAKE(gpsdrive,2.0pre1)
+dnl AM_INIT_AUTOMAKE(gpsdrive,2.0pre9)
 dnl PACKAGE=gpsdrive
-dnl VERSION=2.0pre1
+dnl VERSION=2.0pre9
 dnl AC_SUBST(PACKAGE)
 dnl AC_SUBST(VERSION)
 dnl AC_DEFINE_UNQUOTED(PACKAGE, "$PACKAGE")
 dnl AC_DEFINE_UNQUOTED(VERSION, "$VERSION")
 
-
+#CFLAGS="$CFLAGS -Ddlsym=dlsym_prepend_underscore"
 
 ALL_LINGUAS="de es fr it da nl tr de_AT hu sk sv no pt_BR gr ja"
 
@@ -64,10 +64,10 @@
 			else
 				MARCH=""
 			fi
-			CFLAGS="-O3 $MARCH -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations -falign-functions -falign-loops"
+			OPT_CFLAGS="-O3 $MARCH -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations -falign-functions -falign-loops"
 		elif $CC -dumpversion|egrep -q "^3\.0.*"; then
 # gcc-3.0
-			CFLAGS="-O3 -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations -falign-functions -falign-loops"
+			OPT_CFLAGS="-O3 -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations -falign-functions -falign-loops"
 		elif $CC -dumpversion | egrep -q "^2\.95.*" ; then
 # gcc-2.95
 			if echo $UNAMEP|egrep -q "(Pentium III|Pentium II|Pentium\(R\) 4|Athlon)"; then
@@ -79,19 +79,19 @@
 			else 
 				MARCH=""
 			fi
-			CFLAGS="$MARCH -O3 -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations"
+			OPT_CFLAGS="$MARCH -O3 -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations"
 		else
 			echo "warning: compiler is not known: not optimizing!"
 		fi
-		echo "using $CC $CFLAGS"
+		echo "compiler optimizing flags: $OPT_CFLAGS"
 )
 
 AC_ARG_ENABLE(gcc3-optimization, 
 		AC_HELP_STRING([--enable-gcc3-optimization=type],
 				[gcc3 can optimize for: i386, i486, pentium, pentium-mmx, pentiumpro, pentium2, pentium3, pentium4, k6, k6-2, k6-3, athlon, athlon-tbird, athlon-4, athlon-xp, athlon-mp, winchip-c6, winchip2, c3]),
 		if $CC -dumpversion|egrep -q "^3\..*"; then
-			CFLAGS="-O3 -march=$enableval -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations -falign-functions -falign-loops"
-			echo "using $CC $CFLAGS"
+			OPT_CFLAGS="-O3 -march=$enableval -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations -falign-functions -falign-loops"
+			echo "compiler optimizing flags: $OPT_CFLAGS"
 		else
 			echo "warning: compiler is not gcc3: not optimizing!"
 		fi
@@ -101,8 +101,8 @@
 		AC_HELP_STRING([--enable-gcc2-optimization=type],
 				[gcc2 can optimize for: i386, i486, pentium, pentiumpro, k6]),
 		if $CC -dumpversion | egrep -q "^2\..*" ; then
-			CFLAGS="-O3 -march=$enableval -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations"
-			echo "using $CC $CFLAGS"
+			OPT_CFLAGS="-O3 -march=$enableval -fomit-frame-pointer -fno-exceptions -fno-rtti -pipe -s -ffast-math -fexpensive-optimizations"
+			echo "compiler optimizing flags: $OPT_CFLAGS"
 		else 
 			echo "warning: compiler is not gcc2: not optimizing!"
 		fi
@@ -122,20 +122,9 @@
 dnl Checks for librarries
 dnl ************************
 
-AC_PATH_PROG(PKG_CONFIG, pkg-config, no)
-if test "x$PKG_CONFIG" = "xno" ; then
-	AC_MSG_ERROR(pkg-config not found please install pkg-config)
-fi
-
-echo -n "checking for gtk+-2.0... "
-if pkg-config --exists gtk+-2.0 ; then
-	LIBS="$LIBS `pkg-config --libs gtk+-2.0`"
-	CFLAGS="$CFLAGS `pkg-config --cflags gtk+-2.0`"
-	echo "yes"
-else
-	echo "no"
-	AC_MSG_ERROR(libgtk2.0-dev missing, please install libgtk2.0-dev)
-fi
+PKG_CHECK_MODULES(PKGCONFIG, gtk+-2.0 >= 2.1)
+LIBS="$LIBS $PKGCONFIG_LIBS"
+CFLAGS="$CFLAGS $PKGCONFIG_CFLAGS"
 
 AC_PATH_PROG(PCRE_CONFIG, pcre-config, no)
 if test "x$PCRE_CONFIG" = "xno" ; then
@@ -152,7 +141,7 @@
 dnl ************************
 dnl Checks for header files.
 dnl ************************
-AC_CHECK_HEADERS(sys/types.h sys/termios.h termio.h termios.h sys/stat.h fcntl.h stdio.h unistd.h  netdb.h X11/X.h)
+AC_CHECK_HEADERS(sys/types.h sys/termios.h termio.h termios.h sys/stat.h fcntl.h stdio.h unistd.h  netdb.h X11/X.h linux/inet.h sys/ioctl.h)
 
 
 dnl Checks select argument types
@@ -218,16 +207,41 @@
 	esac
 ])
 AM_CONDITIONAL(DISABLEPLUGINS, test x$disableplugins = xtrue)
+
 AC_ARG_WITH(debug,
-[  --with-debug       compiles with -g],[
-        CFLAGS="-g -Wall -ffast-math"
-        CXXFLAGS="$CFLAGS"
-        echo "Using $CC $CFLAGS"
+[  --with-debug            compiles with -g],[
+        OPT_CFLAGS="-g -Wall -ffast-math"
+	echo "Ignoring optimizing flags; using debugging flags: $OPT_CFLAGS"
 ])
 
+dnl ************************
+dnl crypt.h and libcrypt
+dnl ************************
+AC_CHECK_HEADERS(crypt.h)
+AC_CHECK_LIB(crypt,crypt)
+
+dnl ************************
+dnl GNU getopt
+dnl ************************
+AC_CHECK_DECLS(getopt)
+
+dnl ************************
+dnl check dynamic loading flags
+dnl ************************
+AC_LTDL_DLLIB
+AC_LTDL_DLSYM_USCORE
+# putting this here gets the option enabled, but program segfaults
+# putting a non-conditional CFLAGS="$CFLAGS -Ddlsym..." early in
+# configure.ac works correctly, but putting the two AC_ and the
+# conditional CFLAGS= does not.
+#if test x"$libltdl_cv_need_uscore" = xyes; then
+#    AC_SUBST(DLSYM_CFLAGS,'-Ddlsym=dlsym_prepend_underscore') 
+#fi
 
 CFLAGS="$CFLAGS -Imysql"
 
+CFLAGS="$CFLAGS $OPT_CFLAGS"
+CXXFLAGS="$CXXFLAGS $OPT_CFLAGS"
 
 AC_CONFIG_FILES(Makefile src/Makefile  man/Makefile man/de/Makefile man/es/Makefile po/Makefile.in)
 AC_OUTPUT
diff -Nurd -x'*~' gpsdrive-2.0pre9.orig/src/Makefile.am gpsdrive-2.0pre9/src/Makefile.am
--- gpsdrive-2.0pre9.orig/src/Makefile.am	2003-07-06 18:41:52.000000000 -0400
+++ gpsdrive-2.0pre9/src/Makefile.am	2003-07-06 18:41:50.000000000 -0400
@@ -1,5 +1,5 @@
 
-DEFS=@DEFS@ -I. -I$(srcdir) -I.. -DLOCALEDIR=\"${localedir}\" -DDATADIR=\"${datadir}\" -DLIBDIR=\"${mylibdir}\" -DFRIENDSSERVERVERSION=\"${FRIENDSSERVERVERSION}\" ${NOGARMIN} ${NOPLUGINS}
+DEFS=@DEFS@ -I. -I$(srcdir) -I.. -DLOCALEDIR=\"${localedir}\" -DDATADIR=\"${datadir}\" -DLIBDIR=\"${libdir}\" -DFRIENDSSERVERVERSION=\"${FRIENDSSERVERVERSION}\" ${NOGARMIN} ${NOPLUGINS}
 
 includedir = mysql
 
@@ -12,17 +12,20 @@
 LIBS=
 
 # gpsdrive_LDADD= $(GLIB_LIBS) $(GTK_LIBS) $(PIXLIBS)
-gpsdrive_LDADD=@LIBS@ -lcrypt
+gpsdrive_LDADD=@LIBS@ $(LIBADD_DL)
 #gpsdrive_LDADD= @XLIBS@
 # gpsdrive_CFLAGS=@CFLAGS@
 # libgpsd_a_CFLAGS=@CFLAGS@
 # CFLAGS=
 noinst_LIBRARIES = libgpsd.a
+if DISABLEPLUGINS
+else
 lib_LTLIBRARIES =libfly.la libnautic.la
 libfly_la_SOURCES=fly.c
 libfly_la_LDFLAGS = -version-info 2:0:0
 libnautic_la_SOURCES=nautic.c
 libnautic_la_LDFLAGS = -version-info 2:0:0
+endif
 libgpsd_a_SOURCES=netlib.c nmea_parse.c serial.c  tm.c em.c  \
 	gps.h version.h 
 gpsd_SOURCES= gpsd.c  gpsd.h nmea.h version.h
@@ -52,7 +55,7 @@
 gpsdrive_DATA = gpsdrivesplash.png friendsicon.png map_GPSWORLD.jpg
 
 server_SOURCES=server.c
-server_LDADD = $(LDADD) $(LIBINTL) -lcrypt
+server_LDADD = $(LDADD) $(LIBINTL)
 
 client_SOURCES=client.c
-client_LDADD = $(LDADD) $(LIBINTL) -lcrypt
+client_LDADD = $(LDADD) $(LIBINTL)
diff -Nurd -x'*~' gpsdrive-2.0pre9.orig/src/client.c gpsdrive-2.0pre9/src/client.c
--- gpsdrive-2.0pre9.orig/src/client.c	2003-07-06 18:41:52.000000000 -0400
+++ gpsdrive-2.0pre9/src/client.c	2003-07-06 18:41:49.000000000 -0400
@@ -50,10 +50,14 @@
 #include <stdlib.h>
 #include <string.h>
 #include <unistd.h>
+#ifdef HAVE_CRYPT_H
 #include <crypt.h>
+#endif
 #include <sys/stat.h>
 #include <fcntl.h>
+#ifdef HAVE_LINUX_INET_H
 #include "linux/inet.h"
+#endif
 #include <unistd.h>
 #include <time.h>
 
diff -Nurd -x'*~' gpsdrive-2.0pre9.orig/src/friends.c gpsdrive-2.0pre9/src/friends.c
--- gpsdrive-2.0pre9.orig/src/friends.c	2003-07-06 18:41:52.000000000 -0400
+++ gpsdrive-2.0pre9/src/friends.c	2003-07-06 18:41:49.000000000 -0400
@@ -57,10 +57,14 @@
 #include <stdlib.h>
 #include <string.h>
 #include <unistd.h>
+#ifdef HAVE_CRYPT_H
 #include <crypt.h>
+#endif
 #include <sys/stat.h>
 #include <fcntl.h>
+#ifdef HAVE_LINUX_INET_H
 #include "linux/inet.h"
+#endif
 #include <unistd.h>
 #include <time.h>
 #include <gpsdrive.h>
diff -Nurd -x'*~' gpsdrive-2.0pre9.orig/src/friendsd.c gpsdrive-2.0pre9/src/friendsd.c
--- gpsdrive-2.0pre9.orig/src/friendsd.c	2003-07-06 18:41:52.000000000 -0400
+++ gpsdrive-2.0pre9/src/friendsd.c	2003-07-06 18:41:49.000000000 -0400
@@ -60,7 +60,9 @@
 #include <stdlib.h>
 #include <string.h>
 #include <signal.h>
+#ifdef HAVE_LINUX_INET_H
 #include "linux/inet.h"
+#endif
 #include <fcntl.h>
 #include <netdb.h>
 #include <gpsdrive.h>
diff -Nurd -x'*~' gpsdrive-2.0pre9.orig/src/gpsdrive.c gpsdrive-2.0pre9/src/gpsdrive.c
--- gpsdrive-2.0pre9.orig/src/gpsdrive.c	2003-07-06 18:41:52.000000000 -0400
+++ gpsdrive-2.0pre9/src/gpsdrive.c	2003-07-06 18:45:39.000000000 -0400
@@ -1922,7 +1922,7 @@
     }
   if ((j != 11) && (j != 12))
     {
-      g_print ("\nGPRMC: wrong number of fields (%d)", j);
+      g_print ("\nGPRMC: wrong number of fields (%ld)", j);
       return;
     }
 
@@ -1933,7 +1933,7 @@
     {
       g_print ("\nRMC Fields:\n");
       for (i = 0; i < j; i++)
-	g_print ("\n%d:%s", i, field[i]);
+	g_print ("\n%ld:%s", i, field[i]);
     }
   sprintf (b, "%c%c:%c%c.%c%c ", field[1][0], field[1][1], field[1][2],
 	   field[1][3], field[1][4], field[1][5]);
@@ -8734,9 +8734,11 @@
   /*** Mod by Arms */
   GtkRequisition requ, *reqptr;
   GtkWidget *mainnotebook;
+#ifndef NOPLUGINS
   GModule *mod1;
   void (*modulefunction) ();
   gchar *modpath;
+#endif
   time_t now = time (NULL);
   struct tm *st = localtime (&now);
   void *handle;
@@ -8829,7 +8831,7 @@
 
   if (usesql)
     {
-      handle = dlopen ("libmysqlclient.so", RTLD_LAZY);
+      handle = dlopen ("@PREFIX@/lib/mysql/libmysqlclient.10.dylib", RTLD_LAZY);
       if (!handle)
 	handle = dlopen ("libmysqlclient.so.10", RTLD_LAZY);
       if (!handle)
@@ -9304,6 +9306,7 @@
   setupfunction[mod_setupcounter] = &(friendssetup);
   friendsplace = mod_setupcounter;
 
+#ifndef NOPLUGINS
   if (useplugins)
     {
 /*  fly module */
@@ -9343,6 +9346,7 @@
 	  setupfunction[mod_setupcounter] = modulefunction;
 	}
     }
+#endif
 
 
   mainwindow = gtk_window_new (GTK_WINDOW_TOPLEVEL);
diff -Nurd -x'*~' gpsdrive-2.0pre9.orig/src/serial.c gpsdrive-2.0pre9/src/serial.c
--- gpsdrive-2.0pre9.orig/src/serial.c	2003-07-06 18:41:53.000000000 -0400
+++ gpsdrive-2.0pre9/src/serial.c	2003-07-06 18:41:50.000000000 -0400
@@ -29,6 +29,10 @@
 #define tcflag_t	ushort
 #endif
 
+#ifdef HAVE_SYS_IOCTL_H
+#include <sys/ioctl.h>
+#endif
+
 #include "gpsd.h"
 
 #define DEFAULTPORT "2947"
diff -Nurd -x'*~' gpsdrive-2.0pre9.orig/src/server.c gpsdrive-2.0pre9/src/server.c
--- gpsdrive-2.0pre9.orig/src/server.c	2003-07-06 18:41:53.000000000 -0400
+++ gpsdrive-2.0pre9/src/server.c	2003-07-06 18:41:50.000000000 -0400
@@ -53,7 +53,9 @@
 #include <stdlib.h>
 #include <string.h>
 #include <signal.h>
+#ifdef HAVE_LINUX_INET_H
 #include "linux/inet.h"
+#endif
 #include <fcntl.h>
 #include <netdb.h>
 #include <gpsdrive.h>
