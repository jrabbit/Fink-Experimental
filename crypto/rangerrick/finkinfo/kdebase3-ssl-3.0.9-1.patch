Index: admin/Makefile.common
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/Makefile.common,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
Index: admin/acinclude.m4.in
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/acinclude.m4.in,v
retrieving revision 1.1.1.5
retrieving revision 1.18
diff -u -u -r1.1.1.5 -r1.18
--- admin/acinclude.m4.in	29 Oct 2002 02:27:18 -0000	1.1.1.5
+++ admin/acinclude.m4.in	29 Oct 2002 02:29:54 -0000	1.18
@@ -704,13 +704,10 @@
      AC_CHECK_LIB(ipc, shmat, X_EXTRA_LIBS="$X_EXTRA_LIBS -lipc"))
    
    # darwin needs this to initialize the environment
-   AC_CHECK_HEADERS(crt_externs.h)
+   AC_CHECK_HEADERS([crt_externs.h sys/types.h])
    AC_CHECK_FUNC(_NSGetEnviron, [AC_DEFINE(HAVE_NSGETENVIRON, 1, [Define if your system needs _NSGetEnviron to set up the environment])])
  
-   # more headers that need to be explicitly included on darwin
-   AC_CHECK_HEADERS(sys/types.h stdint.h)
-
-   # darwin requires a poll emulation library
+   # darwin requires a poll.h emulation library
    AC_CHECK_LIB(poll, poll, LIB_POLL="-lpoll")
 
    # CoreAudio framework
@@ -719,11 +716,36 @@
      FRAMEWORK_COREAUDIO="-framework CoreAudio"
    ])
 
+   # CoreServices framework
+   AC_CHECK_HEADER(CoreServices/CoreServices.h, [
+     AC_DEFINE(HAVE_CORESERVICES, 1, [Define if you have the CoreServices API])
+     FRAMEWORK_CORESERVICES="-framework CoreServices"
+   ])
+
+   # Solaris 2.6 and others need -lresolv for res_init
+   AC_CHECK_FUNCS(res_init, , [
+     kde_libs_safe="$LIBS"
+     LIBS="$LIBS $X_EXTRA_LIBS -lresolv"
+     AC_TRY_LINK(
+[
+#include <resolv.h>
+],
+[ 
+res_init(); 
+],
+        LIBRESOLV="-lresolv"
+        X_EXTRA_LIBS="$X_EXTRA_LIBS $LIBRESOLV"
+        AC_DEFINE(HAVE_RES_INIT, 1, [Define if you have the res_init function])
+     )
+     LIBS=$kde_libs_safe
+   ])
+
    AC_CHECK_RES_INIT
-   AC_SUBST(LIB_POLL)
    AC_SUBST(FRAMEWORK_COREAUDIO)
    LIBSOCKET="$X_EXTRA_LIBS"
    AC_SUBST(LIBSOCKET)
+   AC_SUBST(FRAMEWORK_CORESERVICES)
+   AC_SUBST(LIB_POLL)
    AC_SUBST(LIBRESOLV)
    AC_SUBST(X_EXTRA_LIBS)
    AC_CHECK_LIB(ucb, killpg, [LIBUCB="-lucb"]) dnl for Solaris2.4
@@ -932,7 +954,7 @@
 kde_ldflags_safe="$LDFLAGS"
 kde_libs_safe="$LIBS"
 
-LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS"
+LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS"
 LIBS="-lXext -lX11 $LIBSOCKET"
 
 AC_TRY_LINK([
@@ -974,9 +996,9 @@
 kde_save_LDFLAGS="$LDFLAGS"
 kde_save_CFLAGS="$CFLAGS"
 kde_save_LIBS="$LIBS"
-LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS"
+LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS"
 CFLAGS="$CFLAGS -I$x_includes"
-LIBS="-lXinerama -lXext"
+LIBS="-lXinerama -lXext -lX11"
 
 if test "x$no_xinerama" = "xno"; then
 
@@ -1907,15 +1929,29 @@
    AC_REQUIRE([K_PATH_X])
 
 if test $kde_qtver = 3; then
+   AC_SUBST(LIB_ARTSKDE, "-lartskde")
+   AC_SUBST(LIB_DCOP, "-lDCOP")
+   AC_SUBST(LIB_KAB, "-lkab")
+   AC_SUBST(LIB_KABC, "-lkabc")
    AC_SUBST(LIB_KDECORE, "-lkdecore")
+   AC_SUBST(LIB_KDED, "@PREFIX@/lib/kded.la")
+   AC_SUBST(LIB_KDEFX, "-lkdefx")
+   AC_SUBST(LIB_KDEPRINT, "-lkdeprint")
+   AC_SUBST(LIB_KDESASL, "-lkdesasl")
+   AC_SUBST(LIB_KDESU, "-lkdesu")
    AC_SUBST(LIB_KDEUI, "-lkdeui")
-   AC_SUBST(LIB_KIO, "-lkio")
-   AC_SUBST(LIB_SMB, "-lsmb")
-   AC_SUBST(LIB_KAB, "-lkab")
    AC_SUBST(LIB_KHTML, "-lkhtml")
-   AC_SUBST(LIB_KSPELL, "-lkspell")
+   AC_SUBST(LIB_KIO, "-lkio")
    AC_SUBST(LIB_KPARTS, "-lkparts")
-   AC_SUBST(LIB_KDEPRINT, "-lkdeprint")
+   AC_SUBST(LIB_KJAVA, "-lkjava")
+   AC_SUBST(LIB_KJS, "-lkjs")
+   AC_SUBST(LIB_KMID, "-lkmid")
+   AC_SUBST(LIB_KSCRIPT, "-lkscript")
+   AC_SUBST(LIB_KSPELL, "-lkspell")
+   AC_SUBST(LIB_KTEXTEDITOR, "-lktexteditor")
+   AC_SUBST(LIB_SHELLSCRIPT, "-lshellscript")
+   AC_SUBST(LIB_SMB, "-lsmb")
+   AC_SUBST(LIB_VCARD, "-lvcard")
 # these are for backward compatibility
    AC_SUBST(LIB_KSYCOCA, "-lkio")
    AC_SUBST(LIB_KFILE, "-lkio")
@@ -2646,10 +2682,10 @@
       if test $kde_use_debug_code = "full"; then
         CFLAGS="-g3 $CFLAGS"
       else
-        CFLAGS="-g -O2 $CFLAGS"
+        CFLAGS="-g -O $CFLAGS"
       fi
     else
-      CFLAGS="-O2 $CFLAGS"
+      CFLAGS="-Os -frename-registers -mmultiple -mcpu=750 -mtune=750 $CFLAGS"
     fi
   fi
 
@@ -2679,7 +2715,7 @@
         if test "$kde_use_debug_code" = "full"; then
           CXXFLAGS="-g3 $CXXFLAGS"
         else
-          CXXFLAGS="-g -O2 $CXXFLAGS"
+          CXXFLAGS="-g -O $CXXFLAGS"
         fi
       fi
       KDE_CHECK_COMPILER_FLAG(fno-builtin,[CXXFLAGS="-fno-builtin $CXXFLAGS"])
@@ -2691,7 +2727,7 @@
       if test "$CXX" = "KCC"; then
         CXXFLAGS="+K3 $CXXFLAGS"
       else
-        CXXFLAGS="-O2 $CXXFLAGS"
+        CXXFLAGS="-Os -frename-registers -mmultiple -mcpu=750 -mtune=750 $CXXFLAGS"
       fi  
     fi
   fi
@@ -3188,9 +3224,9 @@
     ac_save_ldflags="$LDFLAGS"
     ac_save_cflags="$CFLAGS"
     if test "x$kde_use_qt_emb" != "xyes"; then
-      LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm -lX11 -lXext $LIBZ $LIBSOCKET"
+      LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm -lX11 -lXext $LIBZ $LIBSOCKET"
     else
-      LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm $LIBZ $LIBSOCKET"
+      LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm $LIBZ $LIBSOCKET"
     fi
     CFLAGS="$CFLAGS $X_INCLUDES $USER_INCLUDES"
     test -n "$XPM_INCLUDE" && CFLAGS="-I$XPM_INCLUDE $CFLAGS"
@@ -4625,6 +4661,83 @@
 	done
 ])
 
+AC_DEFUN(KDE_CHECK_LDAP,
+[
+  AC_MSG_CHECKING([for LDAP])
+
+  if test -n "$1"; then
+    ldap_extra_dirs="$1"
+  fi
+
+  ldap_incdirs="$ldap_extra_dirs/include /usr/include /usr/local/include/ $kde_extra_includes"
+  AC_FIND_FILE(ldap.h, $ldap_incdirs, ldap_incdir)
+  if test ! -r $ldap_incdir/ldap.h; then
+    ldap_incdir=no
+  fi
+
+  ldap_libdirs="$ldap_extra_dirs/lib /usr/lib /usr/local /usr/lib $kde_extra_libs"
+  for ext in la so sl dylib a; do
+    AC_FIND_FILE(libldap.$ext, $ldap_libdirs, ldap_libdir_test)
+    if test -r $ldap_libdir_test/libldap.$ext; then
+      ldap_libdir=$ldap_libdir_test
+      break
+    fi
+  done
+  if test -z "$ldap_libdir"; then
+    ldap_libdir=no
+  fi
+  if test x$ldap_libdir != xno && test x$ldap_incdir != xno; then
+    LDAP_INCS=-I$ldap_incdir
+    LDAP_LIBS=-L$ldap_libdir
+    # on MacOSX, we link against the framework instead of
+    # directly to the libraries, for forward-compatibility
+    if test -d "/System/Library/Frameworks/LDAP.framework"; then
+      LIBLDAP="-framework LDAP"
+    else
+      LIBLDAP="-lldap -llber -lresolv"
+    fi
+    if test "$USE_RPATH" = "yes"; then
+      LDAP_RPATH="-R $LDAPLIBDIR/lib"
+    fi
+
+    kde_safe_LIBS="$LIBS"
+    kde_safe_CFLAGS="$CFLAGS"
+    LIBS="$LIBS $all_libraries $LDAP_LIBS $LIBLDAP $KERBEROS_LIBS $X_EXTRA_LIBS"
+    CFLAGS="$CFLAGS $all_includes $LDAP_INCS $KERBEROS_INCS"
+    AC_LANG_SAVE
+    AC_LANG_C
+    AC_TRY_LINK(
+      [#include <lber.h>
+#include <ldap.h>
+#if LDAP_VENDOR_VERSION < 20000
+#error OpenLDAP version too old, please upgrade to version 2 or higher
+#endif
+],
+      [ LDAP *ldap; ],
+      [ ldap_old=no ],
+      [ ldap_old=yes ]
+    )
+    LIBS="$kde_safe_LIBS"
+    CFLAGS="$kde_safe_CFLAGS"
+
+    if test x$ldap_old = xno; then
+      AC_SUBST(LDAP_INCS)
+      AC_SUBST(LDAP_LIBS)
+      AC_SUBST(LDAP_RPATH)
+      AC_SUBST(LIBLDAP)
+      AC_DEFINE_UNQUOTED(HAVE_LIBLDAP,1,[Define if you have LDAP libraries])
+    else
+      LDAP_INCS=
+      LDAP_LIBS=
+      LDAP_RPATH=
+      LIBLDAP=
+    fi
+    AC_MSG_RESULT([libraries $ldap_libdir, headers $ldap_incdir])
+  else
+    AC_MSG_RESULT([not found])
+  fi
+])
+
 dnl KDE_CHEC_JAVA_DIR(onlyjre)
 AC_DEFUN(KDE_CHECK_JAVA_DIR,
 [
@@ -4659,6 +4772,7 @@
       KDE_JAVA_PREFIX(/usr/lib/IBMJava2*)
       KDE_JAVA_PREFIX(/usr/lib/IBMJava*)
       KDE_JAVA_PREFIX(/opt/java*)
+      KDE_JAVA_PREFIX(/Library/Java/Home)
     
       kde_cv_path="NONE"
       kde_save_IFS=$IFS
@@ -4710,10 +4824,20 @@
 dnl At this point kde_java_bindir and kde_java_includedir are either set or "no"
 if test "x$kde_java_bindir" != "xno"; then
 
+  case $host_os in
+    darwin*)
+      dnl Look for libjvm.dylib
+      kde_java_libjvmdir=`find $kde_java_bindir/.. -name libjvm.dylib | sed 's,libjvm.dylib,,'|head -n 1`
+      kd_java_libhpidir=''
+      dnl Darwin doesn't have libhpi
+      ;;
+    *)
   dnl Look for libjvm.so
   kde_java_libjvmdir=`find $kde_java_bindir/.. -name libjvm.so | sed 's,libjvm.so,,'|head -n 1`
   dnl Look for libhpi.so and avoid green threads
-  kde_java_libhpidir=`find $kde_java_bindir/.. -name libhpi.so | grep -v green | sed 's,libhpi.so,,' | head -n 1`
+  kde_java_libhpidir=`find $kde_java_bindir/.. -name libhpi.so | grep -v green | sed 's,libhpi.so,,' | tail -n 1`
+      ;;
+  esac
 
   dnl Now check everything's fine under there
   dnl the include dir is our flag for having the JDK
@@ -4742,17 +4866,29 @@
     JAVAC=
     jni_includes=
   fi
-
+  case $host_os in
+    darwin*)
+      if test ! -r "$kde_java_libjvmdir/libjvm.dylib"; then
+        AC_MSG_ERROR([libjvm.dylib not found under $kde_java_libjvmdir. Use --without-java.])
+      fi
+      dnl Darwin doesn't have libhpi, but it's not fatal
+      LIB_JVM="-framework JavaVM"
+      LIB_HPI=""
+      ;;
+    *)
   if test ! -r "$kde_java_libjvmdir/libjvm.so"; then
      AC_MSG_ERROR([libjvm.so not found under $kde_java_libjvmdir. Use --without-java.])
   fi 
+      LIB_JVM="-L$kde_java_libjvmdir -ljvm"
+      if test ! -r "$kde_java_libhpidir/libhpi.so"; then
+        AC_MSG_ERROR([libhpi.so not found under $kde_java_libhpidir. Use --without-java.])
+      fi
+      LIB_HPI="-L$kde_java_libhpidir -lhpi"
+      ;;
+  esac
 
   if test ! -x "$kde_java_bindir/java"; then
       AC_MSG_ERROR([java not found under $kde_java_bindir. javac was found though! Use --with-java or --without-java.])
-  fi
-
-  if test ! -r "$kde_java_libhpidir/libhpi.so"; then
-    AC_MSG_ERROR([libhpi.so not found under $kde_java_libhpidir. Use --without-java.])
   fi
 
   if test -n "$jni_includes"; then
Index: admin/detect-autoconf.sh
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/detect-autoconf.sh,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- admin/detect-autoconf.sh	29 Oct 2002 02:27:20 -0000	1.1.1.2
+++ admin/detect-autoconf.sh	29 Oct 2002 02:29:54 -0000	1.3
@@ -42,12 +42,12 @@
 checkAutomakeAclocal ()
 {
   if test -z "$UNSERMAKE"; then
-    if test -x "`$WHICH automake-1.5`" ; then
-      AUTOMAKE="`$WHICH automake-1.5`"
-      ACLOCAL="`$WHICH aclocal-1.5`"
-    elif test -x "`$WHICH automake-1.6`" ; then
+    if test -x "`$WHICH automake-1.6`" ; then
       AUTOMAKE="`$WHICH automake-1.6`"
       ACLOCAL="`$WHICH aclocal-1.6`"
+    elif test -x "`$WHICH automake-1.5`" ; then
+      AUTOMAKE="`$WHICH automake-1.5`"
+      ACLOCAL="`$WHICH aclocal-1.5`"
     fi
   else
      AUTOMAKE="$UNSERMAKE"
Index: admin/libtool.m4.in
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/libtool.m4.in,v
retrieving revision 1.1.1.3
retrieving revision 1.7
diff -u -u -r1.1.1.3 -r1.7
--- admin/libtool.m4.in	14 Aug 2002 13:18:45 -0000	1.1.1.3
+++ admin/libtool.m4.in	16 Sep 2002 14:31:34 -0000	1.7
@@ -609,6 +609,12 @@
     lt_cv_sys_max_cmd_len=-1;
     ;;
 
+  darwin*)
+    # this should be enough... the length test freaks out some versions
+    # of OSX's `expr`
+    lt_cv_sys_max_cmd_len=16384;
+    ;;
+
   *)
     # If test is not a shell built-in, we'll probably end up computing a
     # maximum length that is only half of the actual maximum length, but
@@ -1132,7 +1138,7 @@
 darwin* | rhapsody*)
   dynamic_linker="$host_os dyld"
   version_type=darwin
-  need_lib_prefix=no
+  need_lib_prefix=yes
   need_version=no
   # FIXME: Relying on posixy $() will cause problems for
   #        cross-compilation, but unfortunately the echo tests do not
@@ -1901,16 +1907,7 @@
   ;;
 
 darwin* | rhapsody*)
-  lt_cv_deplibs_check_method='file_magic Mach-O dynamically linked shared library'
-  lt_cv_file_magic_cmd='/usr/bin/file -L'
-  case "$host_os" in
-  rhapsody* | darwin1.[[012]])
-    lt_cv_file_magic_test_file=`/System/Library/Frameworks/System.framework/System`
-    ;;
-  *) # Darwin 1.3 on
-    lt_cv_file_magic_test_file='/usr/lib/libSystem.dylib'
-    ;;
-  esac
+  lt_cv_deplibs_check_method='pass_all'
   ;;
 
 freebsd*)
@@ -2560,6 +2557,11 @@
 	;;
     esac
     ;;
+  darwin*)
+    shared_flag='-dynamiclib'
+    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs && $CC -dynamiclib -install_name $rpath/$soname $predep_objects ${lib}-master.o $deplibs $postdep_objects $compiler_flags -o $lib'
+    output_verbose_link_cmd='$CC -dynamiclib $CFLAGS -v conftest.$objext 2>&1 | egrep "\-L"'
+    ;;
   dgux*)
     case $cc_basename in
       ec++)
@@ -4750,7 +4752,9 @@
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
 	;;
       *) # Darwin 1.3 on
-	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+	#_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+        # testing with twolevel namespaces
+	_LT_AC_TAGVAR(allow_undefined_flag, $1)=unsupported
 	;;
       esac
 
@@ -4758,7 +4762,7 @@
       #        cross-compilation, but unfortunately the echo tests do not
       #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
       #	       `"' quotes if we put them in here... so don't!
-      _LT_AC_TAGVAR(archive_cmds, $1)='$CC $(test .$module = .yes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib $libobjs $deplibs$linker_flags -install_name $rpath/$soname $verstring'
+      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs && $CC $(test .$module = .yes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $linker_flags $(test x$module != xyes && echo -install_name $rpath/$soname $verstring)'
       # We need to add '_' to the symbols in $export_symbols first
       #_LT_AC_TAGVAR(archive_expsym_cmds, $1)="$_LT_AC_TAGVAR(archive_cmds, $1)"' && strip -s $export_symbols'
       _LT_AC_TAGVAR(hardcode_direct, $1)=yes
Index: admin/ltmain.sh
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/ltmain.sh,v
retrieving revision 1.1.1.2
retrieving revision 1.4
diff -u -u -r1.1.1.2 -r1.4
--- admin/ltmain.sh	10 Jul 2002 02:47:39 -0000	1.1.1.2
+++ admin/ltmain.sh	13 Jul 2002 04:33:25 -0000	1.4
@@ -3321,7 +3321,23 @@
 	if test -n "$export_symbols" && test -n "$archive_expsym_cmds"; then
 	  eval cmds=\"$archive_expsym_cmds\"
 	else
+          if test "x$verstring" = "x0.0"; then
+                tmp_verstring=
+          else
+                tmp_verstring="$verstring"
+          fi
+ 	  save_deplibs="$deplibs"
+ 	  for conv in $convenience; do
+            tmp_deplibs=
+            for test_deplib in $deplibs; do
+              if test "$test_deplib" != "$conv"; then
+                tmp_deplibs="$tmp_deplibs $test_deplib"
+              fi
+            done
+            deplibs="$tmp_deplibs"
+ 	  done
 	  eval cmds=\"$archive_cmds\"
+ 	  deplibs="$save_deplibs"
 	fi
 
 	if len=`expr "X$cmds" : ".*"` &&
@@ -3419,7 +3435,12 @@
 	  if test -n "$export_symbols" && test -n "$archive_expsym_cmds"; then
 	    eval cmds=\"$archive_expsym_cmds\"
 	  else
-	    eval cmds=\"$archive_cmds\"
+            save_deplibs="$deplibs"
+            for conv in $convenience; do
+              deplibs="${deplibs%$conv*} ${deplibs#*$conv}"
+            done
+            eval cmds=\"$archive_cmds\"
+            deplibs="$save_deplibs"
 	  fi
 
 	  # Append the command to remove the reloadable object files
@@ -3632,6 +3653,14 @@
 	compile_deplibs=`$echo "X $compile_deplibs" | $Xsed -e 's/ -lc / -framework System /'`
 	finalize_deplibs=`$echo "X $finalize_deplibs" | $Xsed -e 's/ -lc / -framework System /'`
 	;;
+      esac
+
+      case $host in
+      *darwin*)
+        # Don't allow lazy linking, it breaks C++ global constructors
+        compile_command="$compile_command ${wl}-bind_at_load"
+        finalize_command="$finalize_command ${wl}-bind_at_load"
+        ;;
       esac
 
       compile_command="$compile_command $compile_deplibs"
Index: admin/missing
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/missing,v
retrieving revision 1.1.1.3
retrieving revision 1.5
diff -u -u -r1.1.1.3 -r1.5
Index: startkde
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/startkde,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- startkde	1 Oct 2002 02:32:40 -0000	1.1.1.4
+++ startkde	1 Oct 2002 03:01:44 -0000	1.5
@@ -30,6 +30,9 @@
 # people's heads. We use colours from the standard KDE palette for those with
 # palettised displays.
 
+# we have to unset this for Darwin since it will screw up KDE's dynamic-loading
+unset DYLD_FORCE_FLAT_NAMESPACE
+
 test "$XDM_MANAGED" || bkg="-solid #C0C0C0"
 xsetroot -cursor_name left_ptr $bkg
 
@@ -134,7 +137,11 @@
 fi
 
 # the splashscreen and progress indicator
-ksplash
+if [ -x "@PREFIX@/bin/ksplashml" ]; then
+	ksplashml
+else
+	ksplash
+fi
 
 # We set LD_BIND_NOW to increase the efficiency of kdeinit.
 # kdeinit unsets this variable before loading applications.
Index: debian/konsole.links
===================================================================
RCS file: debian/konsole.links
diff -N debian/konsole.links
Index: doc/kaddressbook/index.cache.bz2
===================================================================
RCS file: doc/kaddressbook/index.cache.bz2
diff -N doc/kaddressbook/index.cache.bz2
Binary files /dev/null and /tmp/cvs006946 differ
Index: kate/app/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kate/app/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.6
diff -u -u -r1.1.1.3 -r1.6
--- kate/app/Makefile.am	14 Aug 2002 14:26:29 -0000	1.1.1.3
+++ kate/app/Makefile.am	15 Aug 2002 15:26:45 -0000	1.6
@@ -7,17 +7,18 @@
 	kateviewmanager.cpp kateviewspace.cpp katemain.cpp \
 	kateIface.skel kategrepdialog.cpp katefiledialog.cpp katemailfilesdialog.cpp \
         kbookmarkhandler.cpp kactionselector.cpp katedockcontainer.cpp
-
-libkateinterfaces_la_LIBADD   = ../interfaces/libkateinterfacesprivate.la -lkscript ../lib/libkmultitabbar.la
+libkateinterfaces_la_LIBADD   = $(top_builddir)/kate/interfaces/libkateinterfacesprivate.la -lkscript $(top_builddir)/kate/lib/libkmultitabbar.la
 libkateinterfaces_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
 
 kate_la_SOURCES = dummy_kate_la.cpp
-kate_la_LIBADD = libkateinterfaces.la
-kate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version 
+kate_la_LIBADD   = libkateinterfaces.la -lkscript $(LIB_DCOP) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) \
+	$(LIB_KPARTS) $(LIB_KIO) $(top_builddir)/kate/lib/libkmultitabbar.la
+kate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version $(QT_LDFLAGS)
 
 kwrite_la_SOURCES = kwritemain.cpp katefiledialog.cpp kwritedialogs.cpp
-kwrite_la_LIBADD   = -lktexteditor
-kwrite_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+kwrite_la_LIBADD  = libkateinterfaces.la $(LIB_DCOP) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) \
+	$(LIB_KPARTS) $(LIB_KIO) -lktexteditor
+kwrite_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version $(QT_LDFLAGS)
 
 kate_SOURCES = dummy_kate.cpp
 kate_LDADD = kate.la
Index: kate/interfaces/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kate/interfaces/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.5
diff -u -u -r1.1.1.3 -r1.5
--- kate/interfaces/Makefile.am	14 Aug 2002 14:26:30 -0000	1.1.1.3
+++ kate/interfaces/Makefile.am	14 Aug 2002 15:35:40 -0000	1.5
@@ -2,11 +2,12 @@
 
 noinst_LTLIBRARIES = libkateinterfacesprivate.la
 
-libkateinterfacesprivate_la_SOURCES = application.cpp mainwindow.cpp documentmanager.cpp viewmanager.cpp toolviewmanager.cpp \
-                                                           pluginmanager.cpp plugin.cpp \
-                                                           pluginconfiginterface.cpp pluginconfiginterfaceextension.cpp
-libkateinterfacesprivate_la_LIBADD   = -lkatepartinterfaces
-libkateinterfacesprivate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+libkateinterfacesprivate_la_SOURCES = application.cpp mainwindow.cpp documentmanager.cpp viewmanager.cpp \
+	toolviewmanager.cpp pluginmanager.cpp plugin.cpp pluginconfiginterface.cpp \
+	pluginconfiginterfaceextension.cpp
+libkateinterfacesprivate_la_LIBADD   = -lkatepartinterfaces $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_QT) $(LIB_DCOP) $(LIB_KPARTS)
+
+libkateinterfacesprivate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(QT_LDFLAGS)
 
 kateinclude_HEADERS = application.h documentmanager.h mainwindow.h plugin.h viewmanager.h pluginconfiginterface.h pluginconfiginterfaceextension.h toolviewmanager.h pluginmanager.h
 kateincludedir = $(includedir)/kate
Index: kcontrol/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/Makefile.am,v
retrieving revision 1.1.1.5
retrieving revision 1.6
diff -u -u -r1.1.1.5 -r1.6
Index: kcontrol/access/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/access/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/access/Makefile.am	1 Oct 2002 02:33:58 -0000	1.1.1.3
+++ kcontrol/access/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -12,12 +12,12 @@
 lib_LTLIBRARIES = kaccess.la
 
 kaccess_la_SOURCES = kaccess.cpp main.cpp
-kaccess_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kaccess_la_LIBADD = $(LIB_KDEUI)
+kaccess_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+kaccess_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 
 kcm_access_la_SOURCES = kcmaccess.cpp 
-kcm_access_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_access_la_LIBADD = $(LIB_KIO)
+kcm_access_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_access_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 noinst_HEADERS = kcmaccess.h
 
Index: kcontrol/arts/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/arts/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/arts/Makefile.am	1 Oct 2002 02:33:59 -0000	1.1.1.3
+++ kcontrol/arts/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -2,8 +2,8 @@
 
 kcm_arts_la_SOURCES = arts.cpp midi.cpp arts_general.ui arts_soundio.ui
 
-kcm_arts_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_arts_la_LIBADD = -lkio -lkmid
+kcm_arts_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_arts_la_LIBADD = -lkio -lkmid $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES = -I$(kde_includes)/arts  $(all_includes)
 
Index: kcontrol/background/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/background/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
Index: kcontrol/bell/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/bell/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/bell/Makefile.am	25 Jun 2002 02:03:44 -0000	1.1.1.1
+++ kcontrol/bell/Makefile.am	25 Jun 2002 02:06:13 -0000	1.2
@@ -3,7 +3,7 @@
 kcm_bell_la_SOURCES = bell.cpp
 
 kcm_bell_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_bell_la_LIBADD = -lkdeui
+kcm_bell_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/clock/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/clock/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/clock/Makefile.am	25 Jun 2002 02:03:44 -0000	1.1.1.1
+++ kcontrol/clock/Makefile.am	25 Jun 2002 02:06:13 -0000	1.2
@@ -2,8 +2,8 @@
 
 kcm_clock_la_SOURCES = dtime.cpp tzone.cpp main.cpp 
 
-kcm_clock_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_clock_la_LIBADD = -lkdeui
+kcm_clock_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_clock_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 
 INCLUDES= $(all_includes)
  
Index: kcontrol/colors/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/colors/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/colors/Makefile.am	14 Aug 2002 14:29:16 -0000	1.1.1.2
+++ kcontrol/colors/Makefile.am	14 Aug 2002 15:35:41 -0000	1.3
@@ -5,8 +5,9 @@
 kde_module_LTLIBRARIES = kcm_colors.la
 
 kcm_colors_la_SOURCES = colorscm.cpp widgetcanvas.cpp 
-kcm_colors_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined
-kcm_colors_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(top_builddir)/kcontrol/krdb/libkrdb.la
+kcm_colors_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_colors_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kcontrol/krdb/libkrdb.la $(LIB_X11) $(LIB_QT) \
+	$(LIB_KDECORE) $(LIB_KDEFX) $(LIB_KIO)
 kcm_colors_la_METASOURCES = colorscm.moc widgetcanvas.moc
 
 noinst_HEADERS = colorscm.h widgetcanvas.h
Index: kcontrol/crypto/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/crypto/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/crypto/Makefile.am	1 Oct 2002 02:34:03 -0000	1.1.1.3
+++ kcontrol/crypto/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -3,8 +3,8 @@
 
 kcm_crypto_la_SOURCES = crypto.cpp certexport.cpp kdatetimedlg.cpp
 
-kcm_crypto_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) $(SSL_LDFLAGS) -module -avoid-version -no-undefined
-kcm_crypto_la_LIBADD = -lkdeui $(LIB_KIO) $(LIBSSL)
+kcm_crypto_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) $(SSL_LDFLAGS) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_crypto_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBSSL) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 kcm_crypto_la_METASOURCES = AUTO
 
Index: kcontrol/css/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/css/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/css/Makefile.am	1 Oct 2002 02:34:03 -0000	1.1.1.3
+++ kcontrol/css/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -5,8 +5,8 @@
 
 kde_module_LTLIBRARIES = kcm_css.la
 kcm_css_la_SOURCES = template.cpp cssconfig.ui kcmcss.cpp preview.ui
-kcm_css_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_css_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_css_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_css_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 kcm_css_la_METASOURCES = AUTO
  
Index: kcontrol/ebrowsing/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/ebrowsing/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/ebrowsing/Makefile.am	29 Oct 2002 03:02:56 -0000	1.1.1.3
+++ kcontrol/ebrowsing/Makefile.am	29 Oct 2002 03:39:29 -0000	1.4
@@ -8,8 +8,8 @@
 kde_module_LTLIBRARIES = kcm_kurifilt.la
 kcm_kurifilt_la_SOURCES = filteropts.cpp main.cpp
 
-kcm_kurifilt_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kurifilt_la_LIBADD = $(LIB_KSYCOCA)
+kcm_kurifilt_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_kurifilt_la_LIBADD = $(LIB_KSYCOCA) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 # Don't link this lib to the plugins. They are dlopened and linking to them
 # results in crashes when closing kcmshell.
 # plugins/ikws/libkuriikwsfilter.la plugins/shorturi/libkshorturifilter.la
Index: kcontrol/ebrowsing/plugins/ikws/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/ebrowsing/plugins/ikws/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/ebrowsing/plugins/ikws/Makefile.am	10 Jul 2002 03:17:39 -0000	1.1.1.2
+++ kcontrol/ebrowsing/plugins/ikws/Makefile.am	10 Jul 2002 03:42:56 -0000	1.3
@@ -7,10 +7,10 @@
 kde_module_LTLIBRARIES = libkuriikwsfilter.la libkurisearchfilter.la
 
 libkuriikwsfilter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-libkuriikwsfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkuriikwsfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 libkurisearchfilter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-libkurisearchfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkurisearchfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 libkuriikwsfilter_la_SOURCES = kuriikwsfiltereng.cpp kuriikwsfilter.skel kuriikwsfilter.cpp searchprovider.cpp
 libkurisearchfilter_la_SOURCES = kurisearchfilter.cpp kurisearchfilter.skel kuriikwsfiltereng.cpp ikwsopts.cpp searchproviderdlg.cpp searchprovider.cpp
Index: kcontrol/ebrowsing/plugins/shorturi/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/ebrowsing/plugins/shorturi/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/ebrowsing/plugins/shorturi/Makefile.am	25 Jun 2002 02:03:44 -0000	1.1.1.1
+++ kcontrol/ebrowsing/plugins/shorturi/Makefile.am	25 Jun 2002 02:06:13 -0000	1.2
@@ -7,8 +7,8 @@
 
 kde_module_LTLIBRARIES = libkshorturifilter.la
 
-libkshorturifilter_la_LDFLAGS = -module $(KDE_PLUGIN)
-libkshorturifilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkshorturifilter_la_LDFLAGS = -module $(KDE_PLUGIN) $(QT_LDFLAGS)
+libkshorturifilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 libkshorturifilter_la_SOURCES = kshorturifilter.cpp kshorturifilter.skel
 
Index: kcontrol/email/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/email/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/email/Makefile.am	1 Oct 2002 02:34:05 -0000	1.1.1.3
+++ kcontrol/email/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -3,8 +3,8 @@
 kde_module_LTLIBRARIES = kcm_email.la
 
 kcm_email_la_SOURCES = emailbase.ui email.cpp
-kcm_email_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_email_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_email_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_email_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 INCLUDES= $(all_includes) 
 
 kcm_email_la_METASOURCES = AUTO
Index: kcontrol/energy/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/energy/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/energy/Makefile.am	1 Oct 2002 02:34:05 -0000	1.1.1.4
+++ kcontrol/energy/Makefile.am	1 Oct 2002 03:01:45 -0000	1.5
@@ -7,8 +7,8 @@
 kde_module_LTLIBRARIES = kcm_energy.la
 
 kcm_energy_la_SOURCES = energy.cpp
-kcm_energy_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_energy_la_LIBADD = $(DPMSLIB) $(LIB_KDEUI) $(LIB_KIO)
+kcm_energy_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_energy_la_LIBADD = $(DPMSLIB) $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 kcm_energy_la_METASOURCES = energy.moc
 
 noinst_HEADERS = energy.h
Index: kcontrol/filetypes/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/filetypes/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/filetypes/Makefile.am	1 Oct 2002 02:34:06 -0000	1.1.1.3
+++ kcontrol/filetypes/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -1,7 +1,7 @@
 INCLUDES= $(all_includes)
 
-kcm_filetypes_la_LIBADD	= libfiletypes.la $(LIB_KIO)
-kcm_filetypes_la_LDFLAGS = -module -avoid-version -no-undefined $(all_libraries)
+kcm_filetypes_la_LIBADD	= libfiletypes.la $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
+kcm_filetypes_la_LDFLAGS = -module -avoid-version -no-undefined $(all_libraries) $(QT_LDFLAGS)
 kcm_filetypes_la_METASOURCES = AUTO
 
 kde_module_LTLIBRARIES = kcm_filetypes.la
Index: kcontrol/fonts/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/fonts/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/fonts/Makefile.am	1 Oct 2002 02:34:06 -0000	1.1.1.3
+++ kcontrol/fonts/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -5,8 +5,8 @@
 kde_module_LTLIBRARIES = kcm_fonts.la
 
 kcm_fonts_la_SOURCES = fonts.cpp kxftconfig.cpp
-kcm_fonts_la_LDFLAGS = $(KDE_RPATH) $(LIBFONTCONFIG_RPATH) -module -avoid-version $(all_libraries) -no-undefined
-kcm_fonts_la_LIBADD = $(LIB_KDEUI) $(LIBFONTCONFIG_LIBS)
+kcm_fonts_la_LDFLAGS = $(KDE_RPATH) $(LIBFONTCONFIG_RPATH) -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_fonts_la_LIBADD = $(LIB_KDEUI) $(LIBFONTCONFIG_LIBS) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 kcm_fonts_la_METASOURCES = fonts.moc
 
 noinst_HEADERS = fonts.h kxftconfig.h
Index: kcontrol/icons/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/icons/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/icons/Makefile.am	14 Aug 2002 14:28:29 -0000	1.1.1.3
+++ kcontrol/icons/Makefile.am	14 Aug 2002 15:35:41 -0000	1.4
@@ -5,8 +5,8 @@
 kde_module_LTLIBRARIES = kcm_icons.la
 
 kcm_icons_la_SOURCES = iconthemes.cpp icons.cpp main.cpp
-kcm_icons_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_icons_la_LIBADD = $(LIB_KIO)
+kcm_icons_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_icons_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 kcm_icons_la_METASOURCES = icons.moc iconthemes.moc main.moc
 
 
Index: kcontrol/info/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/info/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/info/Makefile.am	25 Jun 2002 02:03:45 -0000	1.1.1.1
+++ kcontrol/info/Makefile.am	25 Jun 2002 02:06:13 -0000	1.2
@@ -2,8 +2,8 @@
 
 kcm_info_la_SOURCES = main.cpp memory.cpp
 
-kcm_info_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_info_la_LIBADD = $(LIBALIB) $(LIB_KDEUI) $(LIB_TRU64_MACH) $(LIBCFG) $(LIBODM) $(LIBKSTAT) $(LIBDEVINFO)
+kcm_info_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS) $(FRAMEWORK_COREAUDIO)
+kcm_info_la_LIBADD = $(LIBALIB) $(LIB_KDEUI) $(LIB_TRU64_MACH) $(LIBCFG) $(LIBODM) $(LIBKSTAT) $(LIBDEVINFO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
  
Index: kcontrol/info/info.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/info/info.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/info/info.cpp	29 Oct 2002 03:03:00 -0000	1.1.1.3
+++ kcontrol/info/info.cpp	29 Oct 2002 03:39:29 -0000	1.4
@@ -471,6 +471,8 @@
 #include "info_svr4.cpp"
 #elif _AIX
 #include "info_aix.cpp"
+#elif defined(__APPLE__)
+#include "info_osx.cpp"
 #else
 #include "info_generic.cpp"	/* Default for unsupportet systems.... */
 #endif
Index: kcontrol/info/info_osx.cpp
===================================================================
RCS file: kcontrol/info/info_osx.cpp
diff -N kcontrol/info/info_osx.cpp
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ kcontrol/info/info_osx.cpp	25 Jun 2002 02:06:13 -0000	1.1
@@ -0,0 +1,163 @@
+/*
+ * kdebase3-3.0.1-3.patch,v 1.2 2002/06/24 01:48:12 ranger Exp
+ *
+ * info_fbsd.cpp is part of the KDE program kcminfo.  This displays
+ * various information about the system (hopefully a FreeBSD system)
+ * it's running on.
+ */
+
+#define INFO_CPU_AVAILABLE
+//#define INFO_IRQ_AVAILABLE
+//#define INFO_DMA_AVAILABLE
+//#define INFO_PCI_AVAILABLE
+//#define INFO_IOPORTS_AVAILABLE
+#define INFO_SOUND_AVAILABLE
+#define INFO_DEVICES_AVAILABLE
+#define INFO_SCSI_AVAILABLE
+#define INFO_PARTITIONS_AVAILABLE
+#define INFO_XSERVER_AVAILABLE
+
+/*
+ * all following functions should return TRUE, when the Information
+ * was filled into the lBox-Widget. Returning FALSE indicates that
+ * information was not available.
+ */
+
+#include <sys/types.h>
+#include <sys/sysctl.h>
+
+#include <fstab.h>
+#include <stdio.h>
+#include <stdlib.h>
+
+#include <iostream.h>
+
+#include <qdict.h>
+#include <qfile.h>
+#include <qfontmetrics.h>
+#include <qptrlist.h>
+#include <qstring.h>
+#include <qtextstream.h>
+
+#include <kdebug.h>
+
+#include <mach/mach.h>
+#include <mach-o/arch.h>
+
+#ifdef HAVE_COREAUDIO
+#include <CoreAudio/CoreAudio.h>
+#endif
+
+#include <machine/limits.h>
+
+bool GetInfo_CPU (QListView *lBox)
+{
+
+	QString cpustring;
+
+        kern_return_t ret;
+        struct host_basic_info basic_info;
+        unsigned int count=HOST_BASIC_INFO_COUNT;
+
+        ret=host_info(mach_host_self(), HOST_BASIC_INFO, 
+                (host_info_t)&basic_info, &count);
+        if (ret != KERN_SUCCESS) {
+		kdDebug() << "unable to get host information from mach" << endl;
+		return false;
+        } else {
+		kdDebug() << "got Host Info: (" << basic_info.avail_cpus << ") CPUs available" << endl;
+        	const NXArchInfo *archinfo;
+        	archinfo=NXGetArchInfoFromCpuType(basic_info.cpu_type, basic_info.cpu_subtype);
+		new QListViewItem(lBox, i18n("Kernel is configured for %1 CPUs").arg(basic_info.max_cpus));
+		for (int i = 1; i <= basic_info.avail_cpus; i++) {
+			cpustring = i18n("CPU %1: %2").arg(i).arg(archinfo->description);
+			new QListViewItem(lBox, cpustring);
+		}
+		return true;
+	}
+	return false;
+}
+
+bool GetInfo_IRQ (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_DMA (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_PCI (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_IO_Ports (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_Sound (QListView *lBox)
+{
+#ifdef HAVE_COREAUDIO
+#define kMaxStringSize 1024
+	OSStatus status;
+	AudioDeviceID gOutputDeviceID;
+	unsigned long propertySize;
+	char deviceName[kMaxStringSize];
+	char manufacturer[kMaxStringSize];
+	propertySize = sizeof(gOutputDeviceID);
+	status = AudioHardwareGetProperty(kAudioHardwarePropertyDefaultOutputDevice, &propertySize, &gOutputDeviceID);
+	if (status) {
+		kdDebug() << "get default output device failed, status = " << (int)status << endl;
+		return false;
+	}
+
+	if (gOutputDeviceID != kAudioDeviceUnknown) {
+
+		propertySize = kMaxStringSize;
+
+		/* Device Name */
+		status = AudioDeviceGetProperty(gOutputDeviceID, 1, 0, kAudioDevicePropertyDeviceName, &propertySize, deviceName);
+		if (status) {
+			kdDebug() << "get device name failed, status = " << (int)status << endl;
+			return false;
+		}
+		new QListViewItem(lBox, i18n("Device Name: %1").arg(deviceName));
+
+		/* Manufacturer */
+		status = AudioDeviceGetProperty(gOutputDeviceID, 1, 0, kAudioDevicePropertyDeviceManufacturer, &propertySize, manufacturer);
+		if (status) {
+			kdDebug() << "get manufacturer failed, status = " << (int)status << endl;
+			return false;
+		}
+		new QListViewItem(lBox, i18n("Manufacturer: %1").arg(manufacturer));
+		return true;
+	} else {
+		return false;
+	}
+#else
+	return false;
+#endif
+}
+
+bool GetInfo_SCSI (QListView *lbox)
+{
+	return false;
+}
+
+bool GetInfo_Partitions (QListView *lbox)
+{
+	return false;
+}
+
+bool GetInfo_XServer_and_Video (QListView *lBox)
+{
+	return GetInfo_XServer_Generic( lBox );
+}
+
+bool GetInfo_Devices (QListView *lbox)
+{
+	return false;
+}
Index: kcontrol/info/memory.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/info/memory.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/info/memory.cpp	1 Oct 2002 02:34:08 -0000	1.1.1.4
+++ kcontrol/info/memory.cpp	1 Oct 2002 03:01:46 -0000	1.5
@@ -431,6 +431,8 @@
 
 #ifdef __linux__
 #include "memory_linux.cpp"
+#elif defined(__APPLE__)
+#include "memory_osx.cpp"
 #elif sgi
 #include "memory_sgi.cpp"
 #elif defined(__svr4__) && defined(sun)
Index: kcontrol/info/memory_osx.cpp
===================================================================
RCS file: kcontrol/info/memory_osx.cpp
diff -N kcontrol/info/memory_osx.cpp
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ kcontrol/info/memory_osx.cpp	25 Jun 2002 02:06:13 -0000	1.1
@@ -0,0 +1,72 @@
+#include <unistd.h>
+#include <stdlib.h>
+#include <qfile.h>
+#include <mach/mach_init.h>
+#include <mach/mach_host.h>
+#include <mach/host_info.h>
+#include <sys/stat.h>
+#include <dirent.h>
+#include <kdebug.h>
+
+void KMemoryWidget::update()
+{
+
+	vm_statistics_data_t vm_info;
+	mach_msg_type_number_t info_count;
+	DIR *dirp;
+	struct dirent *dp;
+	off_t total;
+
+	info_count = HOST_VM_INFO_COUNT;
+	if (host_statistics(mach_host_self (), HOST_VM_INFO, (host_info_t)&vm_info, &info_count)) {
+		kdDebug() << "could not get memory statistics" << endl;
+		return;
+	}
+
+	Memory_Info[TOTAL_MEM]    = (vm_info.active_count + vm_info.inactive_count +
+		vm_info.free_count + vm_info.wire_count) * vm_page_size;
+	Memory_Info[FREE_MEM]     = vm_info.free_count * vm_page_size;
+	Memory_Info[SHARED_MEM]   = NO_MEMORY_INFO;
+	Memory_Info[BUFFER_MEM]   = NO_MEMORY_INFO;
+	Memory_Info[CACHED_MEM]   = NO_MEMORY_INFO;
+
+	dirp = opendir("/private/var/vm");
+	if (!dirp) {
+		kdDebug() << "unable to open /private/var/vm" << endl;
+		return;
+	}
+
+	total = 0;
+
+	while ((dp = readdir (dirp)) != NULL) {
+		struct stat sb;
+		char fname [MAXNAMLEN];
+
+		if (strncmp (dp->d_name, "swapfile", 8))
+			continue;
+
+		strcpy (fname, "/private/var/vm/");
+		strcat (fname, dp->d_name);
+		if (stat (fname, &sb) < 0)
+			continue;
+
+		total += sb.st_size;
+	}
+	closedir (dirp);
+
+	info_count = HOST_VM_INFO_COUNT;
+	if (host_statistics (mach_host_self (), HOST_VM_INFO,
+		(host_info_t) &vm_info, &info_count)) {
+			kdDebug() << "unable to get VM info" << endl;
+	}
+
+	Memory_Info[SWAP_MEM]     = total;
+	// off_t used = (vm_info.pageouts - vm_info.pageins) * vm_page_size;
+	Memory_Info[FREESWAP_MEM] = NO_MEMORY_INFO;
+
+	/* free = vm_info.free_count * vm_page_size;
+	   used = vm_info.active_count * vm_page_size;
+	   total = (vm_info.active_count + vm_info.inactive_count +
+		vm_info.free_count + vm_info.wire_count) * vm_page_size; */
+
+}
Index: kcontrol/input/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/input/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/input/Makefile.am	10 Jul 2002 03:17:57 -0000	1.1.1.2
+++ kcontrol/input/Makefile.am	10 Jul 2002 03:42:56 -0000	1.3
@@ -4,8 +4,8 @@
 
 kcm_input_la_SOURCES = main.cpp mouse.cpp kmousedlg.ui
 
-kcm_input_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_input_la_LIBADD = $(XTESTLIB) $(LIB_KIO) $(LIB_KDEUI)
+kcm_input_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_input_la_LIBADD = $(XTESTLIB) $(LIB_KIO) $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/ioslaveinfo/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/ioslaveinfo/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/ioslaveinfo/Makefile.am	10 Jul 2002 03:17:59 -0000	1.1.1.2
+++ kcontrol/ioslaveinfo/Makefile.am	10 Jul 2002 03:42:56 -0000	1.3
@@ -2,8 +2,8 @@
 
 kcm_ioslaveinfo_la_SOURCES = kcmioslaveinfo.cpp
 
-kcm_ioslaveinfo_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_ioslaveinfo_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_ioslaveinfo_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_ioslaveinfo_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/kcontrol/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kcontrol/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/kcontrol/Makefile.am	1 Oct 2002 02:34:11 -0000	1.1.1.4
+++ kcontrol/kcontrol/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -33,19 +33,19 @@
 	quickhelp.cpp moduletreeview.cpp moduleiconview.cpp \
 	kecdialog.cpp kcrootonly.cpp moduleIface.cpp moduleIface.skel
 
-kcontrol_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcontrol_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcontrol_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEFX) $(LIB_DCOP)
+kcontrol_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
 
 kcmshell_la_SOURCES = kcmshell.cpp moduleinfo.cpp modloader.cpp kecdialog.cpp \
 			proxywidget.cpp kcdialog.cpp global.cpp \
 			kcdialog.skel
-kcmshell_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcmshell_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcmshell_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_DCOP) $(LIB_KDECORE) $(LIB_QT)
+kcmshell_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
 
 
 kcminit_la_SOURCES = kcminit.cpp global.cpp
-kcminit_la_LIBADD   = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcminit_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcminit_la_LIBADD   = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
+kcminit_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
 
 kcontrol_SOURCES = dummy.cpp
 kcontrol_LDADD = kcontrol.la
Index: kcontrol/kdm/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kdm/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
Index: kcontrol/keys/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/keys/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/keys/Makefile.am	1 Oct 2002 02:34:16 -0000	1.1.1.3
+++ kcontrol/keys/Makefile.am	1 Oct 2002 03:01:46 -0000	1.4
@@ -1,8 +1,8 @@
 kde_module_LTLIBRARIES = kcm_keys.la
 
 kcm_keys_la_SOURCES =  shortcuts.cpp modifiers.cpp main.cpp
-kcm_keys_la_LIBADD   = -lkdeui
-kcm_keys_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
+kcm_keys_la_LIBADD   = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
+kcm_keys_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/kfontinst/configure.in.in
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kfontinst/configure.in.in,v
retrieving revision 1.1.1.4
retrieving revision 1.3
diff -u -u -r1.1.1.4 -r1.3
Index: kcontrol/kfontinst/kfile-plugin/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kfontinst/kfile-plugin/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/kfontinst/kfile-plugin/Makefile.am	29 Oct 2002 03:03:12 -0000	1.1.1.3
+++ kcontrol/kfontinst/kfile-plugin/Makefile.am	29 Oct 2002 03:39:30 -0000	1.4
@@ -2,7 +2,7 @@
 
 kfile_font_la_SOURCES = kfile_font.cpp
 kfile_font_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LIBFREETYPE_RPATH) -module $(KDE_PLUGIN)
-kfile_font_la_LIBADD = $(LIB_KIO) $(LIBFREETYPE_LIBS)
+kfile_font_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KIO) $(LIBFREETYPE_LIBS)
 
 kdelnkdir = $(kde_servicesdir)
 kde_services_DATA = kfile_font.desktop
Index: kcontrol/kfontinst/kfontinst/FontEngine.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kfontinst/kfontinst/FontEngine.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/kfontinst/kfontinst/FontEngine.cpp	1 Oct 2002 02:34:18 -0000	1.1.1.4
+++ kcontrol/kfontinst/kfontinst/FontEngine.cpp	1 Oct 2002 03:01:46 -0000	1.5
@@ -26,6 +26,8 @@
 // (C) Craig Drummond, 2001
 ////////////////////////////////////////////////////////////////////////////////
 
+#include "config.h"
+
 #include "FontEngine.h"
 #if !defined KFI_THUMBNAIL && !defined KFI_METAINFO
 #include "KfiGlobal.h"
Index: kcontrol/kfontinst/kfontinst/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kfontinst/kfontinst/Makefile.am,v
retrieving revision 1.1.1.5
retrieving revision 1.6
diff -u -u -r1.1.1.5 -r1.6
Index: kcontrol/kicker/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kicker/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/kicker/Makefile.am	1 Oct 2002 02:34:21 -0000	1.1.1.4
+++ kcontrol/kicker/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -5,8 +5,9 @@
 			menutab_impl.cpp extensionInfo.cpp main.cpp \
                         lookandfeeltab_kcm.cpp advancedOptions.ui advancedDialog.cpp
 
-kcm_kicker_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kicker_la_LIBADD =  ../background/libbgnd.la $(LIB_KIO)
+kcm_kicker_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_kicker_la_LIBADD = $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_KIO) $(LIB_KSYCOCA) \
+	$(LIB_KFILE) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
 INCLUDES= -I$(srcdir)/../background $(all_includes)
 
 kcm_kicker_la_METASOURCES = AUTO
Index: kcontrol/kio/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kio/Makefile.am,v
retrieving revision 1.1.1.5
retrieving revision 1.6
diff -u -u -r1.1.1.5 -r1.6
--- kcontrol/kio/Makefile.am	29 Oct 2002 03:03:17 -0000	1.1.1.5
+++ kcontrol/kio/Makefile.am	29 Oct 2002 03:39:30 -0000	1.6
@@ -14,8 +14,8 @@
       uagentproviderdlg.cpp netpref.cpp cache.cpp ksaveioconfig.cpp \
       socks.cpp socksbase.ui
 
-kcm_kio_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kio_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KIO)
+kcm_kio_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_kio_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/kcmkio.pot
Index: kcontrol/knotify/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/knotify/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/knotify/Makefile.am	1 Oct 2002 02:34:24 -0000	1.1.1.4
+++ kcontrol/knotify/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -4,8 +4,8 @@
 
 kcm_knotify_la_SOURCES = knotify.cpp
 
-kcm_knotify_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_knotify_la_LIBADD = $(LIB_KIO)
+kcm_knotify_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_knotify_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
 INCLUDES= $(all_includes)
  
 kcm_knotify_la_METASOURCES = AUTO
Index: kcontrol/konq/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/konq/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/konq/Makefile.am	1 Oct 2002 02:35:03 -0000	1.1.1.4
+++ kcontrol/konq/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -9,8 +9,8 @@
 		fontopts.cpp previews.cpp browser.cpp \
 		desktop.cpp uiserver.stub main.cpp
 
-kcm_konq_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konq_la_LIBADD = $(LIB_KIO) $(LIB_KDEUI) $(LIB_KSYCOCA)
+kcm_konq_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_konq_la_LIBADD = $(LIB_KIO) $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 
 kcm_konq_la_DATA = overlapping.png onlyone.png
 kcm_konq_ladir = $(kde_datadir)/kcontrol/pics
Index: kcontrol/konqhtml/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/konqhtml/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/konqhtml/Makefile.am	1 Oct 2002 02:35:05 -0000	1.1.1.3
+++ kcontrol/konqhtml/Makefile.am	1 Oct 2002 03:01:47 -0000	1.4
@@ -9,8 +9,8 @@
 			     javaopts.cpp pluginopts.cpp appearance.cpp \
 			     khttpoptdlg.cpp policydlg.cpp main.cpp nsconfigwidget.ui
 
-kcm_konqhtml_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konqhtml_la_LIBADD = -lkhtml -lkdeui
+kcm_konqhtml_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_konqhtml_la_LIBADD = $(LIB_KHTML) $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP) $(LIB_KIO)
 
 data_DATA = khtml_behavior.desktop khtml_java_js.desktop khtml_fonts.desktop khtml_plugins.desktop
 datadir = $(kde_appsdir)/Settings/Network/WebBrowsing
Index: kcontrol/konsole/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/konsole/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/konsole/Makefile.am	1 Oct 2002 02:35:06 -0000	1.1.1.3
+++ kcontrol/konsole/Makefile.am	1 Oct 2002 03:01:47 -0000	1.4
@@ -5,8 +5,8 @@
 kcm_konsole_la_SOURCES =  schemaeditor.cpp sessioneditor.cpp kcmkonsole.cpp \
 	schemadialog.ui sessiondialog.ui kcmkonsoledialog.ui
 
-kcm_konsole_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konsole_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_konsole_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP) $(LIB_KDEFX)
 INCLUDES= $(all_includes) 
 
 kcm_konsole_la_METASOURCES = AUTO
Index: kcontrol/krdb/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/krdb/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/krdb/Makefile.am	10 Jul 2002 03:19:14 -0000	1.1.1.2
+++ kcontrol/krdb/Makefile.am	10 Jul 2002 03:42:58 -0000	1.3
@@ -7,8 +7,8 @@
 
 noinst_LTLIBRARIES = libkrdb.la
 libkrdb_la_SOURCES = krdb.cpp
-libkrdb_la_LIBADD = $(LIB_KDECORE)
-libkrdb_la_LDFLAGS = -no-undefined $(all_libraries) 
+libkrdb_la_LIBADD = $(LIB_KDECORE) $(LIB_X11) $(LIB_QT)
+libkrdb_la_LDFLAGS = -no-undefined $(all_libraries) $(QT_LDFLAGS)
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/krdb.pot
Index: kcontrol/launch/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/launch/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/launch/Makefile.am	25 Jun 2002 02:03:47 -0000	1.1.1.1
+++ kcontrol/launch/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -2,8 +2,8 @@
 kde_module_LTLIBRARIES        = kcm_launch.la
 INCLUDES                      = $(all_includes) 
 kcm_launch_la_SOURCES      = kcmlaunch.cpp
-kcm_launch_la_LDFLAGS      = $(all_libraries) $(KDE_PLUGIN) -module
-kcm_launch_la_LIBADD       = $(LIB_KDEUI)
+kcm_launch_la_LDFLAGS      = $(all_libraries) $(KDE_PLUGIN) -module $(QT_LDFLAGS)
+kcm_launch_la_LIBADD       = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 kcm_launch_la_METASOURCES  = AUTO
 noinst_HEADERS                = kcmlaunch.h
 data_DATA                     = kcmlaunch.desktop
Index: kcontrol/locale/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/locale/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/locale/Makefile.am	1 Oct 2002 02:35:08 -0000	1.1.1.3
+++ kcontrol/locale/Makefile.am	1 Oct 2002 03:01:47 -0000	1.4
@@ -10,9 +10,9 @@
 METASOURCES = AUTO
 noinst_HEADERS = toplevel.h kcmlocale.h klanguagebutton.h klocalesample.h menuitem.h localenum.h localemon.h localetime.h localeother.h kmenubutton.h
 
-kcm_locale_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_locale_la_LIBADD = $(LIB_KDEUI)
-
+kcm_locale_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_locale_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
+ 
 messages:
 	$(XGETTEXT) $(kcm_locale_la_SOURCES) -o $(podir)/kcmlocale.pot
 
Index: kcontrol/nics/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/nics/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/nics/Makefile.am	14 Aug 2002 14:28:21 -0000	1.1.1.3
+++ kcontrol/nics/Makefile.am	14 Aug 2002 15:35:42 -0000	1.4
@@ -2,8 +2,8 @@
 
 kcm_nic_la_SOURCES = nic.cpp
 
-kcm_nic_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_nic_la_LIBADD = -lkdeui $(LIB_KIO) $(LIBSOCKET)
+kcm_nic_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_nic_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBSOCKET) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/passwords/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/passwords/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/passwords/Makefile.am	1 Oct 2002 02:35:09 -0000	1.1.1.2
+++ kcontrol/passwords/Makefile.am	1 Oct 2002 03:01:47 -0000	1.3
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kcm_passwords.la
 kcm_passwords_la_SOURCES = passwords.cpp
 kcm_passwords_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_passwords_la_LIBADD = $(LIB_KDEUI) -lkdesu
+kcm_passwords_la_LIBADD = $(LIB_KDEUI) $(LIB_KDESU) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 noinst_HEADERS = passwords.h
Index: kcontrol/samba/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/samba/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/samba/Makefile.am	14 Aug 2002 14:28:31 -0000	1.1.1.3
+++ kcontrol/samba/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -2,8 +2,8 @@
 
 kcm_samba_la_SOURCES = main.cpp ksmbstatus.cpp kcmsambaimports.cpp kcmsambalog.cpp kcmsambastatistics.cpp
 
-kcm_samba_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_samba_la_LIBADD = $(LIB_KIO)
+kcm_samba_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_samba_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/screensaver/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/screensaver/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/screensaver/Makefile.am	1 Oct 2002 02:35:15 -0000	1.1.1.2
+++ kcontrol/screensaver/Makefile.am	1 Oct 2002 03:01:47 -0000	1.3
@@ -7,8 +7,8 @@
 kde_module_LTLIBRARIES = kcm_screensaver.la
 
 kcm_screensaver_la_SOURCES = scrnsave.cpp
-kcm_screensaver_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_screensaver_la_LIBADD = $(LIB_KSYCOCA) $(DPMSLIB)
+kcm_screensaver_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_screensaver_la_LIBADD = $(LIB_KSYCOCA) $(DPMSLIB) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
 kcm_screensaver_la_METASOURCES = scrnsave.moc
 
 noinst_HEADERS = scrnsave.h
Index: kcontrol/smartcard/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/smartcard/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/smartcard/Makefile.am	14 Aug 2002 14:29:18 -0000	1.1.1.3
+++ kcontrol/smartcard/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -3,9 +3,9 @@
 
 kcm_smartcard_la_SOURCES = smartcard.cpp smartcardbase.ui nosmartcardbase.ui smartcard.skel
 
-kcm_smartcard_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
+kcm_smartcard_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
 
-kcm_smartcard_la_LIBADD = -lkdeui -lksmartcard $(LIB_KIO)
+kcm_smartcard_la_LIBADD = $(LIB_KDEUI) -lksmartcard $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 kcm_smartcard_la_METASOURCES = AUTO
 
Index: kcontrol/smserver/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/smserver/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/smserver/Makefile.am	1 Oct 2002 02:35:16 -0000	1.1.1.2
+++ kcontrol/smserver/Makefile.am	1 Oct 2002 03:01:47 -0000	1.3
@@ -1,8 +1,8 @@
 kde_module_LTLIBRARIES = kcm_smserver.la
 
 kcm_smserver_la_SOURCES = kcmsmserver.cpp smserverconfigdlg.ui smserverconfigimpl.cpp
-kcm_smserver_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_smserver_la_LIBADD = -lkdeui
+kcm_smserver_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_smserver_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 INCLUDES= $(all_includes) 
 
 kcm_smserver_la_METASOURCES = AUTO
Index: kcontrol/spellchecking/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/spellchecking/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/spellchecking/Makefile.am	1 Oct 2002 02:35:16 -0000	1.1.1.2
+++ kcontrol/spellchecking/Makefile.am	1 Oct 2002 03:01:47 -0000	1.3
@@ -2,8 +2,8 @@
 
 kcm_spellchecking_la_SOURCES = spellchecking.cpp
 
-kcm_spellchecking_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_spellchecking_la_LIBADD = -lkdeui -lkspell
+kcm_spellchecking_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_spellchecking_la_LIBADD = $(LIB_KDEUI) $(LIB_KSPELL) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/taskbar/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/taskbar/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/taskbar/Makefile.am	1 Oct 2002 02:35:16 -0000	1.1.1.3
+++ kcontrol/taskbar/Makefile.am	1 Oct 2002 03:01:47 -0000	1.4
@@ -1,8 +1,8 @@
 kde_module_LTLIBRARIES = kcm_taskbar.la
 
 kcm_taskbar_la_SOURCES = kcmtaskbarui.ui kcmtaskbar.cpp
-kcm_taskbar_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_taskbar_la_LIBADD = -lkdeui
+kcm_taskbar_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_taskbar_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 INCLUDES= $(all_includes) 
 
 kcm_taskbar_la_METASOURCES = AUTO
Index: kcontrol/thememgr/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/thememgr/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/thememgr/Makefile.am	14 Aug 2002 14:29:26 -0000	1.1.1.3
+++ kcontrol/thememgr/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -13,8 +13,8 @@
 	options.h version.h groupdetails.h \
 	themecreator.h newthemedlg.h
 
-kcm_themes_la_LIBADD = $(LIB_KIO) 
-kcm_themes_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kcm_themes_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
+kcm_themes_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module $(QT_LDFLAGS)
 
 apps_DATA = kthememgr.desktop
 appsdir = $(kde_appsdir)/Settings/LookNFeel
Index: kcontrol/usbview/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/usbview/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/usbview/Makefile.am	25 Jun 2002 02:03:48 -0000	1.1.1.1
+++ kcontrol/usbview/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -2,8 +2,8 @@
 
 kcm_usb_la_SOURCES = kcmusb.cpp usbdevices.cpp usbdb.cpp
 
-kcm_usb_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_usb_la_LIBADD = $(LIB_KDEUI)
+kcm_usb_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_usb_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes) 
 
Index: kdeprint/kjobviewer/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kdeprint/kjobviewer/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kdeprint/kjobviewer/Makefile.am	25 Jun 2002 02:03:49 -0000	1.1.1.1
+++ kdeprint/kjobviewer/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -9,8 +9,8 @@
 
 kjobviewer_la_SOURCES = kjobviewer.cpp main.cpp
 kjobviewer_la_METASOURCES = AUTO
-kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI)
-kjobviewer_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
+kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_KDEPRINT) $(LIB_DCOP)
+kjobviewer_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH) $(QT_LDFLAGS)
 
 noinst_HEADERS = kjobviewer.h
 
Index: kdeprint/kprinter/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kdeprint/kprinter/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -u -r1.1.1.2 -r1.2
--- kdeprint/kprinter/Makefile.am	10 Jul 2002 03:20:23 -0000	1.1.1.2
+++ kdeprint/kprinter/Makefile.am	11 Jul 2002 22:35:30 -0000	1.2
@@ -8,7 +8,7 @@
 kprinter_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
 kprinter_la_SOURCES = main.cpp printwrapper.cpp
-kprinter_la_LIBADD = -lkdeprint
+kprinter_la_LIBADD = -lkdeprint $(LIB_QT) $(LIB_KIO) $(LIB_KDEUI) $(LIB_KDECORE)
 kprinter_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
 kprinter_METASOURCES = AUTO
 
Index: kdialog/kdialog.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kdialog/kdialog.cpp,v
retrieving revision 1.1.1.2
retrieving revision 1.6
diff -u -u -r1.1.1.2 -r1.6
Index: kdm/backend/dm.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kdm/backend/dm.h,v
retrieving revision 1.1.1.4
retrieving revision 1.4
diff -u -u -r1.1.1.4 -r1.4
--- kdm/backend/dm.h	29 Oct 2002 03:04:57 -0000	1.1.1.4
+++ kdm/backend/dm.h	29 Oct 2002 03:39:31 -0000	1.4
@@ -41,6 +41,10 @@
 #ifndef _DM_H_
 #define _DM_H_ 1
 
+#ifdef __APPLE__
+#define CSRG_BASED
+#endif
+
 #include "greet.h"
 
 #include <X11/Xos.h>
Index: khelpcenter/khelpcenter.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/khelpcenter/khelpcenter.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.5
diff -u -u -r1.1.1.5 -r1.5
Index: khotkeys/khotkeys/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/khotkeys/khotkeys/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- khotkeys/khotkeys/Makefile.am	25 Jun 2002 02:03:52 -0000	1.1.1.1
+++ khotkeys/khotkeys/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -4,7 +4,7 @@
 lib_LTLIBRARIES = khotkeys.la
 
 khotkeys_la_SOURCES = khotkeys.cpp main.cpp khotkeys.skel
-khotkeys_la_LIBADD   = ../shared/libshared.la $(LIB_KSYCOCA)
+khotkeys_la_LIBADD   = ../shared/libshared.la $(LIB_KSYCOCA) $(LIB_QT) $(LIB_X11) $(LIB_KDECORE) $(LIB_DCOP)
 khotkeys_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 khotkeys_SOURCES = dummy.cpp
Index: kicker/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kicker/Makefile.am	10 Jul 2002 03:21:29 -0000	1.1.1.2
+++ kicker/Makefile.am	10 Jul 2002 03:42:58 -0000	1.3
@@ -7,8 +7,10 @@
 
 CLEANFILES = dummy.cpp dummy_la.cpp
 
-kicker_la_LIBADD = core/libkicker_core.la  buttons/libkicker_buttons.la \
-	ui/libkicker_ui.la share/libkickermain.la $(LIB_KIO) 
+kicker_la_LIBADD = $(top_builddir)/kicker/core/libkicker_core.la \
+	$(top_builddir)/kicker/buttons/libkicker_buttons.la \
+	$(top_builddir)/kicker/ui/libkicker_ui.la \
+	$(top_builddir)/kicker/share/libkickermain.la $(LIB_KIO) 
 
 kicker_la_SOURCES = dummy.cpp
 kicker_la_LDFLAGS = $(KDE_PLUGIN) -no-undefined -module $(all_libraries)
Index: kicker/menuext/kdeprint/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/menuext/kdeprint/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kicker/menuext/kdeprint/Makefile.am	25 Jun 2002 02:03:52 -0000	1.1.1.1
+++ kicker/menuext/kdeprint/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -4,7 +4,7 @@
 
 kickermenu_kdeprint_la_SOURCES = print_mnu.cpp
 kickermenu_kdeprint_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_kdeprint_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) -lkdeprint
+kickermenu_kdeprint_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDEPRINT) $(LIB_KDECORE) $(LIB_QT)
 
 kickermenu_kdeprint_la_METASOURCES = AUTO
 
Index: kicker/menuext/konsole/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/menuext/konsole/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kicker/menuext/konsole/Makefile.am	14 Aug 2002 14:30:12 -0000	1.1.1.1
+++ kicker/menuext/konsole/Makefile.am	15 Aug 2002 15:26:45 -0000	1.2
@@ -3,8 +3,8 @@
 kde_module_LTLIBRARIES = kickermenu_konsole.la
 
 kickermenu_konsole_la_SOURCES = konsole_mnu.cpp konsolebookmarkhandler.cpp konsolebookmarkmenu.cpp
-kickermenu_konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
+kickermenu_konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+kickermenu_konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDECORE) $(LIB_QT)
 
 kickermenu_konsole_la_METASOURCES = AUTO
 
Index: kicker/menuext/prefmenu/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/menuext/prefmenu/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kicker/menuext/prefmenu/Makefile.am	10 Jul 2002 03:22:41 -0000	1.1.1.1
+++ kicker/menuext/prefmenu/Makefile.am	11 Jul 2002 22:35:30 -0000	1.2
@@ -4,7 +4,8 @@
 
 kickermenu_prefmenu_la_SOURCES = prefmenu.cpp
 kickermenu_prefmenu_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_prefmenu_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la
+kickermenu_prefmenu_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la \
+	$(top_builddir)/kicker/kicker.la
 
 kickermenu_prefmenu_la_METASOURCES = AUTO
 
Index: kicker/menuext/recentdocs/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/menuext/recentdocs/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kicker/menuext/recentdocs/Makefile.am	10 Jul 2002 03:22:42 -0000	1.1.1.1
+++ kicker/menuext/recentdocs/Makefile.am	11 Jul 2002 22:35:30 -0000	1.2
@@ -4,7 +4,8 @@
 
 kickermenu_recentdocs_la_SOURCES = recentdocsmenu.cpp
 kickermenu_recentdocs_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_recentdocs_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la
+kickermenu_recentdocs_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la \
+	$(top_builddir)/kicker/kicker.la
 
 kickermenu_recentdocs_la_METASOURCES = AUTO
 
Index: kioslave/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.6
diff -u -u -r1.1.1.4 -r1.6
--- kioslave/Makefile.am	29 Oct 2002 03:05:23 -0000	1.1.1.4
+++ kioslave/Makefile.am	29 Oct 2002 03:39:31 -0000	1.6
@@ -8,10 +8,14 @@
 SMB_SUBDIR=smb
 endif
 
+if include_kioslave_nfs
+NFS_SUBDIR=nfs
+endif
+
 if include_devicesdir
 DEVICES_SUBDIR=devices
 endif
 
-
-SUBDIRS = about cgi floppy filter fish info mac man nfs nntp pop3 imap4 smtp \
-  smbro sftp tar zip finger thumbnail $(LDAP_SUBDIR) $(SMB_SUBDIR) $(DEVICES_SUBDIR)
+SUBDIRS = about cgi floppy filter fish info mac man nntp pop3 imap4 smtp \
+	smbro sftp tar zip finger thumbnail $(LDAP_SUBDIR) $(SMB_SUBDIR) \
+	$(NFS_SUBDIR) $(DEVICES_SUBDIR)
Index: kioslave/devices/kdedmodule/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/devices/kdedmodule/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kioslave/devices/kdedmodule/Makefile.am	29 Oct 2002 03:05:23 -0000	1.1.1.2
+++ kioslave/devices/kdedmodule/Makefile.am	29 Oct 2002 03:39:32 -0000	1.3
@@ -2,8 +2,8 @@
 
 INCLUDES = $(all_includes)
 kded_mountwatcher_la_SOURCES = mountwatcher.cpp mountwatcher.skel disklist.cpp disks.cpp
-kded_mountwatcher_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_mountwatcher_la_LIBADD = $(LIB_KSYCOCA)
+kded_mountwatcher_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+kded_mountwatcher_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_DCOP) $(LIB_KDECORE) $(LIB_KDED)
 
 METASOURCES = AUTO
 
Index: kioslave/fish/fish.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/fish/fish.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -u -r1.1.1.3 -r1.2
--- kioslave/fish/fish.cpp	29 Oct 2002 03:05:24 -0000	1.1.1.3
+++ kioslave/fish/fish.cpp	29 Oct 2002 18:27:45 -0000	1.2
@@ -103,7 +103,7 @@
 #define sendmimeType(x) mimeType(x)
 #endif
 
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__) || defined(__APPLE__)
 #define SIGCLD SIGCHLD
 #endif
 
Index: kioslave/ldap/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/ldap/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kioslave/ldap/Makefile.am	25 Jun 2002 02:03:52 -0000	1.1.1.1
+++ kioslave/ldap/Makefile.am	21 Oct 2002 01:34:23 -0000	1.2
@@ -9,7 +9,7 @@
 kde_module_LTLIBRARIES = kio_ldap.la
 
 kio_ldap_la_SOURCES = kio_ldap.cpp kldap.cpp kldapurl.cpp
-kio_ldap_la_LIBADD = $(LIB_KIO) $(LDAP_LIBS) $(KERBEROS_LIBS)
+kio_ldap_la_LIBADD = $(LIB_KIO) $(LDAP_LIBS) $(LIBLDAP) $(KERBEROS_LIBS)
 kio_ldap_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LDAP_RPATH) $(KRB_RPATH) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = kio_ldap.h kldap.h kldapurl.h
Index: kioslave/ldap/configure.in.in
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/ldap/configure.in.in,v
retrieving revision 1.1.1.2
retrieving revision 1.5
diff -u -u -r1.1.1.2 -r1.5
--- kioslave/ldap/configure.in.in	10 Jul 2002 03:23:08 -0000	1.1.1.2
+++ kioslave/ldap/configure.in.in	20 Oct 2002 19:12:01 -0000	1.5
@@ -1,97 +1,13 @@
-AC_MSG_CHECKING(whether to compile LDAP support)
+AC_MSG_CHECKING([whether to compile LDAP support])
 AC_ARG_WITH(ldap,
-[  --without-ldap=PATH     Set path for LDAP files [default=check]],
-[ case "$withval" in
-  yes)
-    with_ldap=CHECK
-    ;;
-  esac ],
-[ with_ldap=CHECK ]
-)dnl
+  [  --without-ldap=PATH     Set path for LDAP files [default=check]],
+  [ ac_use_ldap="$withval" ],
+  [ ac_use_ldap=no ]
+)
+AC_MSG_RESULT($ac_use_ldap)
 
-if test "x$with_ldap" = "xCHECK" ; then
-  with_ldap=NOTFOUND
-  search_incs="$kde_includes /usr/include /usr/local/include"
-  AC_FIND_FILE(ldap.h, $search_incs, ldap_incdir)
-  if test -r $ldap_incdir/ldap.h ; then
-    test "x$ldap_incdir" != "x/usr/include" && LDAP_INCS="-I$ldap_incdir"
-    with_ldap=FOUND
-  fi
-  if test $with_ldap = FOUND ; then
-    with_ldap=NOTFOUND
-    for ext in la so sl a ; do
-      AC_FIND_FILE(libldap.$ext, $kde_libraries /usr/lib /usr/local/lib,
-        ldap_libdir)
-      if test -r $ldap_libdir/libldap.$ext ; then
-        if test "x$ldap_libdir" != "x/usr/lib" ; then
-          LDAP_LIBS="-L$ldap_libdir "
-          test "$USE_RPATH" = yes && LDAP_RPATH="-R $ldap_libdir"
-        fi
-        LDAP_LIBS="${LDAP_LIBS}-lldap -llber -lresolv"
-        with_ldap=FOUND
-        break
-      fi
-    done
-  fi
+if test "x$ac_use_ldap" != "no" ; then
+  KDE_CHECK_LDAP($ac_use_ldap)
 fi
 
-case "$with_ldap" in
-no) AC_MSG_RESULT(no) ;;
-NOTFOUND) AC_MSG_RESULT(searched but not found) ;;
-*)
-  if test "x$with_ldap" = "xFOUND" ; then
-    msg="incs=$ldap_incdir libs=$ldap_libdir"
-  else
-    msg="$with_ldap"
-    LDAP_ROOT="$with_ldap"
-    if test "x$LDAP_ROOT" != "x/usr" ; then
-      LDAP_INCS="-I${LDAP_ROOT}/include"
-      LDAP_LIBS="-L${LDAP_ROOT}/lib "
-      if test "$USE_RPATH" = "yes" ; then
-        LDAP_RPATH="-R ${LDAP_ROOT}/lib"
-      fi
-    fi
-    LDAP_LIBS="${LDAP_LIBS}-lldap -llber -lresolv"
-  fi
-  kde_safe_LIBS="$LIBS"
-  kde_safe_CFLAGS="$CFLAGS"
-  LIBS="$LIBS $all_libraries $LDAP_LIBS $KERBEROS_LIBS $X_EXTRA_LIBS"
-  CFLAGS="$CFLAGS $all_includes $LDAP_INCS $KERBEROS_INCS"
-  AC_LANG_SAVE
-  AC_LANG_C
-  AC_TRY_LINK(dnl
-  [
-  #include <lber.h>
-  #include <ldap.h>
-  #if LDAP_VENDOR_VERSION < 20000
-  #error OpenLDAP version too old, please upgrade to version 2 or higher
-  #endif
-  ],
-  [
-  LDAP *ldap;
-  ],
-  , with_ldap=no
-  )
-  AC_LANG_RESTORE
-  CFLAGS=$kde_safe_CFLAGS
-  LIBS=$kde_safe_LIBS
-  if test "$with_ldap" = "no" ; then
-    LDAP_INCS=
-    LDAP_LIBS=
-    LDAP_RPATH=
-    LDAP_SUBDIR=
-    AC_MSG_RESULT(no (but first try gave $msg))
-  else
-    AC_DEFINE_UNQUOTED(HAVE_LIBLDAP, 1, [Define if you have LDAP libraries])
-    LDAP_SUBDIR="ldap"
-    AC_MSG_RESULT($msg)
-  fi
-  ;;
-esac
-
-AC_SUBST(LDAP_INCS)
-AC_SUBST(LDAP_LIBS)
-AC_SUBST(LDAP_RPATH)
-
 AM_CONDITIONAL(include_kioslave_ldap, test -n "$LDAP_SUBDIR")
-
Index: kioslave/nfs/.cvsignore
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/nfs/.cvsignore,v
retrieving revision 1.1.1.4
retrieving revision 1.3
diff -u -u -r1.1.1.4 -r1.3
Index: kioslave/nfs/README
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/nfs/README,v
retrieving revision 1.1.1.1
retrieving revision 1.4
diff -u -u -r1.1.1.1 -r1.4
--- kioslave/nfs/README	25 Jun 2002 02:03:52 -0000	1.1.1.1
+++ kioslave/nfs/README	16 Sep 2002 14:52:42 -0000	1.4
@@ -1,3 +1,29 @@
 this is an ioslave for KDE 2 for NFS, version 2.
 
 Alex
+
+Darwin notes --
+
+It looks like there are C++ type issues with the Darwin headers
+(try building, you'll see the "too many arguments to function" stuff)
+
+The problem seems to be <rpc/clnt.h> having definitions that don't
+play nice with C++.  The client rpc handle does a bunch of void stuff
+in the struct which is fine in C but makes an empty arg list in C++.
+
+typedef struct {
+        AUTH    *cl_auth;                       /* authenticator */
+        struct clnt_ops {
+                enum clnt_stat  (*cl_call)();   /* call remote procedure */
+                void            (*cl_abort)();  /* abort a call */
+                void            (*cl_geterr)(); /* get specific error code */
+                bool_t          (*cl_freeres)(); /* frees results */
+                void            (*cl_destroy)();/* destroy this structure */
+                bool_t          (*cl_control)();/* the ioctl() of rpc */
+        } *cl_ops;
+        caddr_t                 cl_private;     /* private stuff */
+} CLIENT;
+
+
+The only solution is to probably reimplement clnt.h locally to fix
+these (wrapping the "#include <rpc/rpc.h>" in an extern "C" isn't enough).
Index: kioslave/nfs/configure.in.in
===================================================================
RCS file: kioslave/nfs/configure.in.in
diff -N kioslave/nfs/configure.in.in
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ kioslave/nfs/configure.in.in	12 Jul 2002 02:04:22 -0000	1.2
@@ -0,0 +1,7 @@
+AC_MSG_CHECKING(whether to compile NFS support)
+AC_ARG_WITH(nfs,
+[  --without-nfs           Disable NFS kioslave [default=no]],
+	with_nfs=$withval, with_nfs=yes
+)dnl
+AC_MSG_RESULT($withval)
+AM_CONDITIONAL(include_kioslave_nfs, test "$with_nfs" = "yes")
Index: kioslave/nfs/kio_nfs.cpp
===================================================================
RCS file: kioslave/nfs/kio_nfs.cpp
diff -N kioslave/nfs/kio_nfs.cpp
--- kioslave/nfs/kio_nfs.cpp	1 Oct 2002 02:36:16 -0000	1.1.1.1
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,1589 +0,0 @@
-/*  This file is part of the KDE project
-
-    $Id$
-
-    Copyright (C) 2000 Alexander Neundorf <neundorf@kde.org>
-
-    This library is free software; you can redistribute it and/or
-    modify it under the terms of the GNU Library General Public
-    License as published by the Free Software Foundation; either
-    version 2 of the License, or (at your option) any later version.
-
-    This library is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-    Library General Public License for more details.
-
-    You should have received a copy of the GNU Library General Public License
-    along with this library; see the file COPYING.LIB.  If not, write to
-    the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
-    Boston, MA 02111-1307, USA.
-*/
-
-#ifdef HAVE_CONFIG_H
-#include <config.h>
-#endif
-
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <sys/utsname.h>
-
-#include <arpa/inet.h>
-
-// This is needed on Solaris so that rpc.h defines clnttcp_create etc.
-#ifndef PORTMAP
-#define PORTMAP
-#endif
-#include <rpc/rpc.h> // for rpc calls
-
-#include <errno.h>
-#include <grp.h>
-#include <memory.h>
-#include <netdb.h>
-#include <pwd.h>
-#include <stdlib.h>
-#include <strings.h>
-#include <stdio.h>
-#include <time.h>
-#include <unistd.h>
-
-#include <qfile.h>
-#include <qdir.h>
-
-#include <kdebug.h>
-#include <kinstance.h>
-#include <klocale.h>
-
-#include <kio/global.h>
-
-#include "nfs_prot.h"
-#define fhandle _fhandle
-#include "mount.h"
-#include "kio_nfs.h"
-
-#define MAXHOSTLEN 256
-
-#define MAXFHAGE 60*15   //15 minutes maximum age for file handles
-
-//this ioslave is for NFS version 2
-#define NFSPROG ((u_long)100003)
-#define NFSVERS ((u_long)2)
-
-using namespace KIO;
-using namespace std;
-
-//this is taken from kdelibs/kdecore/fakes.cpp
-//#if !defined(HAVE_GETDOMAINNAME)
-
-int x_getdomainname(char *name, size_t len)
-{
-   struct utsname uts;
-   struct hostent *hent;
-   int rv = -1;
-
-   if (name == 0L)
-      errno = EINVAL;
-   else
-   {
-      name[0] = '\0';
-      if (uname(&uts) >= 0)
-      {
-         if ((hent = gethostbyname(uts.nodename)) != 0L)
-         {
-            char *p = strchr(hent->h_name, '.');
-            if (p != 0L)
-            {
-               ++p;
-               if (strlen(p) > len-1)
-                  errno = EINVAL;
-               else
-               {
-                  strcpy(name, p);
-                  rv = 0;
-               }
-            }
-         }
-      }
-   }
-   return rv;
-}
-//#endif
-
-
-extern "C" { int kdemain(int argc, char **argv); }
-
-int kdemain( int argc, char **argv )
-{
-  KInstance instance( "kio_nfs" );
-
-  if (argc != 4)
-  {
-     fprintf(stderr, "Usage: kio_nfs protocol domain-socket1 domain-socket2\n");
-     exit(-1);
-  }
-  kdDebug(7121) << "NFS: kdemain: starting" << endl;
-
-  NFSProtocol slave(argv[2], argv[3]);
-  slave.dispatchLoop();
-  return 0;
-}
-
-void stripTrailingSlash(QString& path)
-{
-   //if (path=="/") return;
-   if (path=="/") path="";
-   else if (path[path.length()-1]=='/') path.truncate(path.length()-1);
-};
-
-void getLastPart(const QString& path, QString& lastPart, QString& rest)
-{
-   int slashPos=path.findRev("/");
-   lastPart=path.mid(slashPos+1);
-   rest=path.left(slashPos+1);
-};
-
-QString removeFirstPart(const QString& path)
-{
-   QString result("");
-   if (path.isEmpty()) return result;
-   result=path.mid(1);
-   int slashPos=result.find("/");
-   return result.mid(slashPos+1);
-};
-
-NFSFileHandle::NFSFileHandle()
-:m_isInvalid(FALSE)
-{
-   m_handle=new char[NFS_FHSIZE+1];
-   memset(m_handle,'\0',NFS_FHSIZE+1);
-   m_detectTime=time(0);
-};
-
-NFSFileHandle::NFSFileHandle(const NFSFileHandle & handle)
-:m_isInvalid(FALSE)
-{
-   m_handle=new char[NFS_FHSIZE+1];
-   m_handle[NFS_FHSIZE]='\0';
-   memcpy(m_handle,handle.m_handle,NFS_FHSIZE);
-   m_isInvalid=handle.m_isInvalid;
-   m_detectTime=handle.m_detectTime;
-};
-
-NFSFileHandle::~NFSFileHandle()
-{
-   delete [] m_handle;
-}
-
-NFSFileHandle& NFSFileHandle::operator= (const NFSFileHandle& src)
-{
-   memcpy(m_handle,src.m_handle,NFS_FHSIZE);
-   m_isInvalid=src.m_isInvalid;
-   m_detectTime=src.m_detectTime;
-   return *this;
-}
-
-NFSFileHandle& NFSFileHandle::operator= (const char* src)
-{
-   if (src==0)
-   {
-      m_isInvalid=TRUE;
-      return *this;
-   };
-   memcpy(m_handle,src,NFS_FHSIZE);
-   m_isInvalid=FALSE;
-   m_detectTime=time(0);
-   return *this;
-}
-
-time_t NFSFileHandle::age() const
-{
-   return (time(0)-m_detectTime);
-};
-
-/*
-ostream& operator<< (ostream& s, const NFSFileHandle& x)
-{
-   for (int i =0; i<NFS_FHSIZE; i++)
-      s<<hex<<(unsigned int)x[i]<<" ";
-   s<<dec;
-   return s;
-}
-*/
-
-NFSProtocol::NFSProtocol (const QCString &pool, const QCString &app )
-:SlaveBase( "nfs", pool, app )
-,m_client(0)
-,m_sock(-1)
-,m_lastCheck(time(0))
-{
-   kdDebug(7121)<<"NFS::NFS: -"<<pool<<"-"<<endl;
-};
-
-NFSProtocol::~NFSProtocol()
-{
-   closeConnection();
-};
-
-void NFSProtocol::checkForOldFHs()
-{
-   kdDebug(7121)<<"checking for fhs older than "<<MAXFHAGE<<endl;
-   kdDebug(7121)<<"current items: "<<m_handleCache.count()<<endl;
-   NFSFileHandleMap::Iterator it=m_handleCache.begin();
-   NFSFileHandleMap::Iterator lastIt=it;
-   while (it!=m_handleCache.end())
-   {
-      kdDebug(7121)<<it.data().age()<<flush;
-      if (it.data().age()>MAXFHAGE)
-      {
-         kdDebug(7121)<<"removing"<<endl;
-         m_handleCache.remove(it);
-         if (it==lastIt)
-         {
-            it=m_handleCache.begin();
-            lastIt=it;
-         }
-         else
-            it=lastIt;
-      };
-      lastIt=it;
-      it++;
-   };
-   kdDebug(7121)<<"left items: "<<m_handleCache.count()<<endl;
-   m_lastCheck=time(0);
-};
-
-void NFSProtocol::closeConnection()
-{
-   close(m_sock);
-   m_sock=-1;
-   if (m_client==0) return;
-   CLNT_DESTROY(m_client);
-
-   m_client=0;
-};
-
-bool NFSProtocol::isExportedDir(const QString& path)
-{
-   return (m_exportedDirs.find(path.mid(1))!=m_exportedDirs.end());
-};
-
-bool NFSProtocol::isRoot(const QString& path)
-{
-   return (path.isEmpty() || (path=="/"));
-};
-
-//this one works recursive
-NFSFileHandle NFSProtocol::getFileHandle(QString path)
-{
-   if (m_client==0) openConnection();
-
-   //I'm not sure if this is useful
-   //if ((time(0)-m_lastCheck)>MAXFHAGE) checkForOldFHs();
-
-   stripTrailingSlash(path);
-   kdDebug(7121)<<"getting FH for -"<<path<<"-"<<endl;
-   //now the path looks like "/root/some/dir" or "" if it was "/"
-   NFSFileHandle parentFH;
-   //we didn't find it
-   if (path.isEmpty())
-   {
-      kdDebug(7121)<<"path is empty, invalidating the FH"<<endl;
-      parentFH.setInvalid();
-      return parentFH;
-   };
-   //check wether we have this filehandle cached
-   //the filehandles of the exported root dirs are always in the cache
-   if (m_handleCache.find(path)!=m_handleCache.end())
-   {
-      kdDebug(7121)<<"path is in the cache, returning the FH -"<<m_handleCache[path]<<"-"<<endl;
-      return m_handleCache[path];
-   };
-   QString rest, lastPart;
-   getLastPart(path,lastPart,rest);
-   kdDebug(7121)<<"splitting path into rest -"<<rest<<"- and lastPart -"<<lastPart<<"-"<<endl;
-
-   parentFH=getFileHandle(rest);
-   //f*ck, it's invalid
-   if (parentFH.isInvalid())
-   {
-      kdDebug(7121)<<"the parent FH is invalid"<<endl;
-      return parentFH;
-   };
-   // do the rpc call
-   diropargs dirargs;
-   diropres dirres;
-   memcpy(dirargs.dir.data,(const char*)parentFH,NFS_FHSIZE);
-   QCString tmpStr=QFile::encodeName(lastPart);
-   dirargs.name=tmpStr.data();
-
-   //cerr<<"calling rpc: FH: -"<<parentFH<<"- with name -"<<dirargs.name<<"-"<<endl;
-
-   int clnt_stat = clnt_call(m_client, NFSPROC_LOOKUP,
-                         (xdrproc_t) xdr_diropargs, (char*)&dirargs,
-                         (xdrproc_t) xdr_diropres, (char*)&dirres,total_timeout);
-
-   if ((clnt_stat!=RPC_SUCCESS) || (dirres.status!=NFS_OK))
-   {
-      //we failed
-      kdDebug(7121)<<"lookup of filehandle failed"<<endl;
-      parentFH.setInvalid();
-      return parentFH;
-   };
-   //everything went fine up to now :-)
-   parentFH=dirres.diropres_u.diropres.file.data;
-   //kdDebug(7121)<<"filesize: "<<dirres.diropres_u.diropres.attributes.size<<endl;
-   m_handleCache.insert(path,parentFH);
-   kdDebug(7121)<<"return FH -"<<parentFH<<"-"<<endl;
-   return parentFH;
-};
-
-void NFSProtocol::openConnection()
-{
-   kdDebug(7121)<<"NFS::openConnection"<<endl;
-   struct sockaddr_in server_addr;
-   if (m_currentHost[0] >= '0' && m_currentHost[0] <= '9')
-   {
-      server_addr.sin_family = AF_INET;
-      server_addr.sin_addr.s_addr = inet_addr(m_currentHost.latin1());
-   }
-   else
-   {
-      struct hostent *hp=gethostbyname(m_currentHost.latin1());
-      if (hp==0)
-      {
-         error( ERR_UNKNOWN_HOST, m_currentHost.latin1() );
-         return;
-      }
-      server_addr.sin_family = AF_INET;
-      memcpy(&server_addr.sin_addr, hp->h_addr, hp->h_length);
-   }
-
-   // create mount deamon client
-   closeConnection();
-   server_addr.sin_port = 0;
-   m_sock = RPC_ANYSOCK;
-   m_client=clnttcp_create(&server_addr,MOUNTPROG, MOUNTVERS, &m_sock, 0, 0);
-   if (m_client==0)
-   {
-      server_addr.sin_port = 0;
-      m_sock = RPC_ANYSOCK;
-      pertry_timeout.tv_sec = 3;
-      pertry_timeout.tv_usec = 0;
-      m_client = clntudp_create(&server_addr,MOUNTPROG, MOUNTVERS, pertry_timeout, &m_sock);
-      if (m_client==0)
-      {
-         clnt_pcreateerror(const_cast<char *>("mount clntudp_create"));
-         error(ERR_COULD_NOT_CONNECT, m_currentHost.latin1());
-         return;
-      }
-   }
-   QCString hostName("localhost");
-   char nameBuffer[1024];
-   if (gethostname(nameBuffer, 1024)==0) {
-      hostName=nameBuffer;
-      // I have the same problem here as Stefan Westerfeld, that's why I use
-      // the getdomainname() from fakes.cpp (renamed to x_getdomainname()), this one works
-      // taken from kdelibs/arts/mcopy/mcoputils.cc
-      if (x_getdomainname(nameBuffer, 1024)==0) {
-         /*
-          * I don't know why, but on my linux machine, the domainname
-          * always ends up being (none), which is certainly no valid
-          * domainname
-          */
-         if(strcmp(nameBuffer,"(none)") != 0) {
-            hostName += ".";
-            hostName += nameBuffer;
-         }
-      }
-   };
-   kdDebug(7121) << "hostname is -" << hostName << "-" << endl;
-   m_client->cl_auth = authunix_create(hostName.data(), geteuid(), getegid(), 0, 0);
-   total_timeout.tv_sec = 20;
-   total_timeout.tv_usec = 0;
-
-   exports exportlist;
-   //now do the stuff
-   memset(&exportlist, '\0', sizeof(exportlist));
-
-   int clnt_stat = clnt_call(m_client, MOUNTPROC_EXPORT,(xdrproc_t) xdr_void, NULL,
-                         (xdrproc_t) xdr_exports, (char*)&exportlist,total_timeout);
-   if (!checkForError(clnt_stat, 0, m_currentHost.latin1())) return;
-
-   fhstatus fhStatus;
-   bool atLeastOnceSucceeded(FALSE);
-   for(; exportlist!=0;exportlist = exportlist->ex_next) {
-      kdDebug(7121) << "found export: " << exportlist->ex_dir << endl;
-
-      memset(&fhStatus, 0, sizeof(fhStatus));
-      clnt_stat = clnt_call(m_client, MOUNTPROC_MNT,(xdrproc_t) xdr_dirpath, (char*)(&(exportlist->ex_dir)),
-                            (xdrproc_t) xdr_fhstatus,(char*) &fhStatus,total_timeout);
-      if (fhStatus.fhs_status==0) {
-         atLeastOnceSucceeded=TRUE;
-         NFSFileHandle fh;
-         fh=fhStatus.fhstatus_u.fhs_fhandle;
-         m_handleCache.insert(QString("/")+KIO::encodeFileName(exportlist->ex_dir),fh);
-         m_exportedDirs.append(KIO::encodeFileName(exportlist->ex_dir));
-         //cerr<<"appending file -"<<KIO::encodeFileName(exportlist->ex_dir).latin1()<<"- with FH: -"<<fhStatus.fhstatus_u.fhs_fhandle<<"-"<<endl;
-      };
-   }
-   if (!atLeastOnceSucceeded)
-   {
-      closeConnection();
-      error( ERR_COULD_NOT_AUTHENTICATE, m_currentHost.latin1());
-      return;
-   };
-   server_addr.sin_port = 0;
-
-   //now create the client for the nfs daemon
-   //first get rid of the old one
-   closeConnection();
-   m_sock = RPC_ANYSOCK;
-   m_client = clnttcp_create(&server_addr,NFSPROG,NFSVERS,&m_sock,0,0);
-   if (m_client == NULL)
-   {
-      error( ERR_COULD_NOT_CONNECT, m_currentHost.latin1());
-      return;
-   };
-   m_client->cl_auth = authunix_create(hostName.data(),geteuid(),getegid(),0,0);
-   connected();
-   kdDebug(7121)<<"openConnection succeeded"<<endl;
-}
-
-void NFSProtocol::listDir( const KURL& _url)
-{
-   KURL url(_url);
-   QString path( QFile::encodeName(url.path()));
-
-   if (path.isEmpty())
-   {
-      url.setPath("/");
-      redirection(url);
-      finished();
-      return;
-   };
-   //open the connection
-   if (m_client==0) openConnection();
-   //it failed
-   if (m_client==0) return;
-   if (isRoot(path))
-   {
-      kdDebug(7121)<<"listing root"<<endl;
-      totalSize( m_exportedDirs.count());
-      //in this case we don't need to do a real listdir
-      UDSEntry entry;
-      for (QStringList::Iterator it=m_exportedDirs.begin(); it!=m_exportedDirs.end(); it++)
-      {
-         UDSAtom atom;
-         entry.clear();
-         atom.m_uds = KIO::UDS_NAME;
-         atom.m_str = (*it);
-         kdDebug(7121)<<"listing "<<(*it)<<endl;
-         entry.append( atom );
-         createVirtualDirEntry(entry);
-         listEntry( entry, false);
-      };
-      listEntry( entry, true ); // ready
-      finished();
-      return;
-   }
-
-   QStringList filesToList;
-   kdDebug(7121)<<"getting subdir -"<<path<<"-"<<endl;
-   stripTrailingSlash(path);
-   NFSFileHandle fh=getFileHandle(path);
-   //cerr<<"this is the fh: -"<<fh<<"-"<<endl;
-   if (fh.isInvalid())
-   {
-      error( ERR_DOES_NOT_EXIST, path);
-      return;
-   };
-   readdirargs listargs;
-   memset(&listargs,0,sizeof(listargs));
-   listargs.count=1024*16;
-   memcpy(listargs.dir.data,fh,NFS_FHSIZE);
-   readdirres listres;
-   do
-   {
-      memset(&listres,'\0',sizeof(listres));
-      int clnt_stat = clnt_call(m_client, NFSPROC_READDIR, (xdrproc_t) xdr_readdirargs, (char*)&listargs,
-                                (xdrproc_t) xdr_readdirres, (char*)&listres,total_timeout);
-      if (!checkForError(clnt_stat,listres.status,path)) return;
-      for (entry *dirEntry=listres.readdirres_u.reply.entries;dirEntry!=0;dirEntry=dirEntry->nextentry)
-      {
-         if ((QString(".")!=dirEntry->name) && (QString("..")!=dirEntry->name))
-            filesToList.append(dirEntry->name);
-      };
-   } while (!listres.readdirres_u.reply.eof);
-   totalSize( filesToList.count());
-
-   UDSEntry entry;
-   //stat all files in filesToList
-   for (QStringList::Iterator it=filesToList.begin(); it!=filesToList.end(); it++)
-   {
-      UDSAtom atom;
-      diropargs dirargs;
-      diropres dirres;
-      memcpy(dirargs.dir.data,fh,NFS_FHSIZE);
-      QCString tmpStr=QFile::encodeName(*it);
-      dirargs.name=tmpStr.data();
-
-      kdDebug(7121)<<"calling rpc: FH: -"<<fh<<"- with name -"<<dirargs.name<<"-"<<endl;
-
-      int clnt_stat= clnt_call(m_client, NFSPROC_LOOKUP,
-                         (xdrproc_t) xdr_diropargs, (char*)&dirargs,
-                         (xdrproc_t) xdr_diropres, (char*)&dirres,total_timeout);
-      if (!checkForError(clnt_stat,dirres.status,(*it))) return;
-
-      NFSFileHandle tmpFH;
-      tmpFH=dirres.diropres_u.diropres.file.data;
-      m_handleCache.insert(path+"/"+(*it),tmpFH);
-
-      entry.clear();
-
-      atom.m_uds = KIO::UDS_NAME;
-      atom.m_str = (*it);
-      entry.append( atom );
-
-      //is it a symlink ?
-      if (S_ISLNK(dirres.diropres_u.diropres.attributes.mode))
-      {
-         kdDebug(7121)<<"it's a symlink !"<<endl;
-         //cerr<<"fh: "<<tmpFH<<endl;
-         nfs_fh nfsFH;
-         memcpy(nfsFH.data,dirres.diropres_u.diropres.file.data,NFS_FHSIZE);
-         //get the link dest
-         readlinkres readLinkRes;
-         char nameBuf[NFS_MAXPATHLEN];
-         readLinkRes.readlinkres_u.data=nameBuf;
-         int clnt_stat=clnt_call(m_client, NFSPROC_READLINK,
-                                 (xdrproc_t) xdr_nfs_fh, (char*)&nfsFH,
-                                 (xdrproc_t) xdr_readlinkres, (char*)&readLinkRes,total_timeout);
-         if (!checkForError(clnt_stat,readLinkRes.status,(*it))) return;
-         kdDebug(7121)<<"link dest is -"<<readLinkRes.readlinkres_u.data<<"-"<<endl;
-         QCString linkDest(readLinkRes.readlinkres_u.data);
-         atom.m_uds = KIO::UDS_LINK_DEST;
-         atom.m_str = linkDest;
-         entry.append( atom );
-
-         bool isValid=isValidLink(path,linkDest);
-         if (!isValid)
-         {
-            completeBadLinkUDSEntry(entry,dirres.diropres_u.diropres.attributes);
-         }
-         else
-         {
-            if (isAbsoluteLink(linkDest))
-            {
-               completeAbsoluteLinkUDSEntry(entry,linkDest);
-            }
-            else
-            {
-               tmpStr=QDir::cleanDirPath(path+QString("/")+QString(linkDest)).latin1();
-               dirargs.name=tmpStr.data();
-               tmpFH=getFileHandle(tmpStr);
-               memcpy(dirargs.dir.data,tmpFH,NFS_FHSIZE);
-
-               attrstat attrAndStat;
-
-               kdDebug(7121)<<"calling rpc: FH: -"<<fh<<"- with name -"<<dirargs.name<<"-"<<endl;
-
-               clnt_stat = clnt_call(m_client, NFSPROC_GETATTR,
-                                         (xdrproc_t) xdr_diropargs, (char*)&dirargs,
-                                         (xdrproc_t) xdr_attrstat, (char*)&attrAndStat,total_timeout);
-               if (!checkForError(clnt_stat,attrAndStat.status,tmpStr)) return;
-               completeUDSEntry(entry,attrAndStat.attrstat_u.attributes);
-            };
-         };
-      }
-      else
-         completeUDSEntry(entry,dirres.diropres_u.diropres.attributes);
-      listEntry( entry, false);
-   };
-   listEntry( entry, true ); // ready
-   finished();
-};
-
-void NFSProtocol::createVirtualDirEntry(UDSEntry & entry)
-{
-   UDSAtom atom;
-
-   atom.m_uds = KIO::UDS_FILE_TYPE;
-   atom.m_long = S_IFDIR;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_ACCESS;
-   atom.m_long = S_IRUSR | S_IXUSR | S_IRGRP | S_IXGRP | S_IROTH | S_IXOTH;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_USER;
-   atom.m_str = "root";
-   entry.append( atom );
-   atom.m_uds = KIO::UDS_GROUP;
-   atom.m_str = "root";
-   entry.append( atom );
-
-   //a dummy size
-   atom.m_uds = KIO::UDS_SIZE;
-   atom.m_long = 1024;
-   entry.append( atom );
-};
-
-void NFSProtocol::stat( const KURL & url)
-{
-   QString path( QFile::encodeName(url.path()));
-   stripTrailingSlash(path);
-   kdDebug(7121)<<"NFS::stat for -"<<path<<"-"<<endl;
-   QString tmpPath=path;
-   if ((tmpPath.length()>1) && (tmpPath[0]=='/')) tmpPath=tmpPath.mid(1);
-   // We can't stat root, but we know it's a dir
-   if (isRoot(path) || isExportedDir(path))
-   {
-      UDSEntry entry;
-      UDSAtom atom;
-
-      atom.m_uds = KIO::UDS_NAME;
-      atom.m_str = path;
-      entry.append( atom );
-      createVirtualDirEntry(entry);
-      // no size
-      statEntry( entry );
-      finished();
-      kdDebug(7121)<<"succeeded"<<endl;
-      return;
-   }
-
-   NFSFileHandle fh=getFileHandle(path);
-   if (fh.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,path);
-      return;
-   };
-
-   diropargs dirargs;
-   attrstat attrAndStat;
-   memcpy(dirargs.dir.data,fh,NFS_FHSIZE);
-   QCString tmpStr=QFile::encodeName(path);
-   dirargs.name=tmpStr.data();
-
-   kdDebug(7121)<<"calling rpc: FH: -"<<fh<<"- with name -"<<dirargs.name<<"-"<<endl;
-
-   int clnt_stat = clnt_call(m_client, NFSPROC_GETATTR,
-                         (xdrproc_t) xdr_diropargs, (char*)&dirargs,
-                         (xdrproc_t) xdr_attrstat, (char*)&attrAndStat,total_timeout);
-   if (!checkForError(clnt_stat,attrAndStat.status,path)) return;
-   UDSEntry entry;
-   entry.clear();
-
-   UDSAtom atom;
-
-   QString fileName, parentDir;
-   getLastPart(path, fileName, parentDir);
-   stripTrailingSlash(parentDir);
-
-   atom.m_uds = KIO::UDS_NAME;
-   atom.m_str = fileName;
-   entry.append( atom );
-
-   //is it a symlink ?
-   if (S_ISLNK(attrAndStat.attrstat_u.attributes.mode))
-   {
-      kdDebug(7121)<<"it's a symlink !"<<endl;
-      nfs_fh nfsFH;
-      memcpy(nfsFH.data,fh,NFS_FHSIZE);
-      //get the link dest
-      readlinkres readLinkRes;
-      char nameBuf[NFS_MAXPATHLEN];
-      readLinkRes.readlinkres_u.data=nameBuf;
-
-      int clnt_stat=clnt_call(m_client, NFSPROC_READLINK,
-                              (xdrproc_t) xdr_nfs_fh, (char*)&nfsFH,
-                              (xdrproc_t) xdr_readlinkres, (char*)&readLinkRes,total_timeout);
-      if (!checkForError(clnt_stat,readLinkRes.status,path)) return;
-      kdDebug(7121)<<"link dest is -"<<readLinkRes.readlinkres_u.data<<"-"<<endl;
-      QCString linkDest(readLinkRes.readlinkres_u.data);
-      atom.m_uds = KIO::UDS_LINK_DEST;
-      atom.m_str = linkDest;
-      entry.append( atom );
-
-      bool isValid=isValidLink(parentDir,linkDest);
-      if (!isValid)
-      {
-         completeBadLinkUDSEntry(entry,attrAndStat.attrstat_u.attributes);
-      }
-      else
-      {
-         if (isAbsoluteLink(linkDest))
-         {
-            completeAbsoluteLinkUDSEntry(entry,linkDest);
-         }
-         else
-         {
-
-            tmpStr=QDir::cleanDirPath(parentDir+QString("/")+QString(linkDest)).latin1();
-            diropargs dirargs;
-            dirargs.name=tmpStr.data();
-            NFSFileHandle tmpFH;
-            tmpFH=getFileHandle(tmpStr);
-            memcpy(dirargs.dir.data,tmpFH,NFS_FHSIZE);
-
-            kdDebug(7121)<<"calling rpc: FH: -"<<fh<<"- with name -"<<dirargs.name<<"-"<<endl;
-            clnt_stat = clnt_call(m_client, NFSPROC_GETATTR,
-                                  (xdrproc_t) xdr_diropargs, (char*)&dirargs,
-                                  (xdrproc_t) xdr_attrstat, (char*)&attrAndStat,total_timeout);
-            if (!checkForError(clnt_stat,attrAndStat.status,tmpStr)) return;
-            completeUDSEntry(entry,attrAndStat.attrstat_u.attributes);
-         };
-      };
-   }
-   else
-      completeUDSEntry(entry,attrAndStat.attrstat_u.attributes);
-   statEntry( entry );
-   finished();
-}
-
-void NFSProtocol::completeAbsoluteLinkUDSEntry(UDSEntry& entry, const QCString& path)
-{
-   //taken from file.cc
-   struct stat buff;
-   if ( ::stat( path.data(), &buff ) == -1 ) return;
-
-   UDSAtom atom;
-	atom.m_uds = KIO::UDS_FILE_TYPE;
-	atom.m_long = buff.st_mode & S_IFMT; // extract file type
-	entry.append( atom );
-
-	atom.m_uds = KIO::UDS_ACCESS;
-	atom.m_long = buff.st_mode & 07777; // extract permissions
-	entry.append( atom );
-
-	atom.m_uds = KIO::UDS_SIZE;
-	atom.m_long = buff.st_size;
-	entry.append( atom );
-
-   atom.m_uds = KIO::UDS_MODIFICATION_TIME;
-   atom.m_long = buff.st_mtime;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_USER;
-   uid_t uid = buff.st_uid;
-   QString *temp = usercache.find( uid );
-
-   if ( !temp )
-   {
-      struct passwd *user = getpwuid( uid );
-      if ( user )
-      {
-         usercache.insert( uid, new QString(QString::fromLatin1(user->pw_name)) );
-         atom.m_str = user->pw_name;
-      }
-      else
-         atom.m_str = "???";
-   }
-   else
-      atom.m_str = *temp;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_GROUP;
-   gid_t gid = buff.st_gid;
-   temp = groupcache.find( gid );
-   if ( !temp )
-   {
-      struct group *grp = getgrgid( gid );
-      if ( grp )
-      {
-         groupcache.insert( gid, new QString(QString::fromLatin1(grp->gr_name)) );
-         atom.m_str = grp->gr_name;
-      }
-      else
-         atom.m_str = "???";
-   }
-   else
-      atom.m_str = *temp;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_ACCESS_TIME;
-   atom.m_long = buff.st_atime;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_CREATION_TIME;
-   atom.m_long = buff.st_ctime;
-   entry.append( atom );
-};
-
-void NFSProtocol::completeBadLinkUDSEntry(UDSEntry& entry, fattr& attributes)
-{
-   // It is a link pointing to nowhere
-   completeUDSEntry(entry,attributes);
-
-   UDSAtom atom;
-   atom.m_uds = KIO::UDS_FILE_TYPE;
-   atom.m_long = S_IFMT - 1;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_ACCESS;
-   atom.m_long = S_IRWXU | S_IRWXG | S_IRWXO;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_SIZE;
-   atom.m_long = 0L;
-   entry.append( atom );
-};
-
-void NFSProtocol::completeUDSEntry(UDSEntry& entry, fattr& attributes)
-{
-   UDSAtom atom;
-
-   atom.m_uds = KIO::UDS_SIZE;
-   atom.m_long = attributes.size;
-   entry.append(atom);
-
-   atom.m_uds = KIO::UDS_MODIFICATION_TIME;
-   atom.m_long = attributes.mtime.seconds;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_ACCESS_TIME;
-   atom.m_long = attributes.atime.seconds;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_CREATION_TIME;
-   atom.m_long = attributes.ctime.seconds;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_ACCESS;
-   atom.m_long = (attributes.mode & 07777);
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_FILE_TYPE;
-   atom.m_long =attributes.mode & S_IFMT; // extract file type
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_USER;
-   uid_t uid = attributes.uid;
-   QString *temp = usercache.find( uid );
-   if ( !temp )
-   {
-      struct passwd *user = getpwuid( uid );
-      if ( user )
-      {
-         usercache.insert( uid, new QString(user->pw_name) );
-         atom.m_str = user->pw_name;
-      }
-      else
-         atom.m_str = "???";
-   }
-   else
-      atom.m_str = *temp;
-   entry.append( atom );
-
-   atom.m_uds = KIO::UDS_GROUP;
-   gid_t gid = attributes.gid;
-   temp = groupcache.find( gid );
-   if ( !temp )
-   {
-      struct group *grp = getgrgid( gid );
-      if ( grp )
-      {
-         groupcache.insert( gid, new QString(grp->gr_name) );
-         atom.m_str = grp->gr_name;
-      }
-      else
-         atom.m_str = "???";
-   }
-   else
-      atom.m_str = *temp;
-   entry.append( atom );
-
-/*   KIO::UDSEntry::ConstIterator it = entry.begin();
-   for( ; it != entry.end(); it++ ) {
-      switch ((*it).m_uds) {
-      case KIO::UDS_FILE_TYPE:
-         kdDebug(7121) << "File Type : " << (mode_t)((*it).m_long) << endl;
-         break;
-      case KIO::UDS_ACCESS:
-         kdDebug(7121) << "Access permissions : " << (mode_t)((*it).m_long) << endl;
-         break;
-      case KIO::UDS_USER:
-         kdDebug(7121) << "User : " << ((*it).m_str.ascii() ) << endl;
-         break;
-      case KIO::UDS_GROUP:
-         kdDebug(7121) << "Group : " << ((*it).m_str.ascii() ) << endl;
-         break;
-      case KIO::UDS_NAME:
-         kdDebug(7121) << "Name : " << ((*it).m_str.ascii() ) << endl;
-         //m_strText = decodeFileName( (*it).m_str );
-         break;
-      case KIO::UDS_URL:
-         kdDebug(7121) << "URL : " << ((*it).m_str.ascii() ) << endl;
-         break;
-      case KIO::UDS_MIME_TYPE:
-         kdDebug(7121) << "MimeType : " << ((*it).m_str.ascii() ) << endl;
-         break;
-      case KIO::UDS_LINK_DEST:
-         kdDebug(7121) << "LinkDest : " << ((*it).m_str.ascii() ) << endl;
-         break;
-      }
-   }*/
-};
-
-void NFSProtocol::setHost(const QString& host, int /*port*/, const QString& /*user*/, const QString& /*pass*/)
-{
-   kdDebug(7121)<<"setHost: -"<<host<<"-"<<endl;
-   if (host.isEmpty())
-   {
-      error(ERR_UNKNOWN_HOST,"");
-      return;
-   };
-   if (host==m_currentHost) return;
-   m_currentHost=host;
-   m_handleCache.clear();
-   m_exportedDirs.clear();
-   closeConnection();
-}
-
-void NFSProtocol::mkdir( const KURL& url, int permissions )
-{
-   kdDebug(7121)<<"mkdir"<<endl;
-   QString thePath( QFile::encodeName(url.path()));
-   stripTrailingSlash(thePath);
-   QString dirName, parentDir;
-   getLastPart(thePath, dirName, parentDir);
-   stripTrailingSlash(parentDir);
-   kdDebug(7121)<<"path: -"<<thePath<<"- dir: -"<<dirName<<"- parentDir: -"<<parentDir<<"-"<<endl;
-   if (isRoot(parentDir))
-   {
-      error(ERR_WRITE_ACCESS_DENIED,thePath);
-      return;
-   };
-   NFSFileHandle fh=getFileHandle(parentDir);
-   if (fh.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,thePath);
-      return;
-   };
-
-   createargs createArgs;
-   memcpy(createArgs.where.dir.data,fh,NFS_FHSIZE);
-   QCString tmpName=QFile::encodeName(dirName);
-   createArgs.where.name=tmpName.data();
-   if (permissions==-1) createArgs.attributes.mode=0755;
-   else createArgs.attributes.mode=permissions;
-
-   diropres dirres;
-
-   int clnt_stat = clnt_call(m_client, NFSPROC_MKDIR,
-                         (xdrproc_t) xdr_createargs, (char*)&createArgs,
-                         (xdrproc_t) xdr_diropres, (char*)&dirres,total_timeout);
-   if (!checkForError(clnt_stat,dirres.status,thePath)) return;
-   finished();
-}
-
-bool NFSProtocol::checkForError(int clientStat, int nfsStat, const QString& text)
-{
-   if (clientStat!=RPC_SUCCESS)
-   {
-      kdDebug(7121)<<"rpc error: "<<clientStat<<endl;
-      //does this mapping make sense ?
-      error(ERR_CONNECTION_BROKEN,i18n("An RPC error occurred."));
-      return FALSE;
-   };
-   if (nfsStat!=NFS_OK)
-   {
-      kdDebug(7121)<<"nfs error: "<<nfsStat<<endl;
-      switch (nfsStat)
-      {
-      case NFSERR_PERM:
-         error(ERR_ACCESS_DENIED,text);
-         break;
-      case NFSERR_NOENT:
-         error(ERR_DOES_NOT_EXIST,text);
-         break;
-      //does this mapping make sense ?
-      case NFSERR_IO:
-         error(ERR_INTERNAL_SERVER,text);
-         break;
-      //does this mapping make sense ?
-      case NFSERR_NXIO:
-         error(ERR_DOES_NOT_EXIST,text);
-         break;
-      case NFSERR_ACCES:
-         error(ERR_ACCESS_DENIED,text);
-         break;
-      case NFSERR_EXIST:
-         error(ERR_FILE_ALREADY_EXIST,text);
-         break;
-      //does this mapping make sense ?
-      case NFSERR_NODEV:
-         error(ERR_DOES_NOT_EXIST,text);
-         break;
-      case NFSERR_NOTDIR:
-         error(ERR_IS_FILE,text);
-         break;
-      case NFSERR_ISDIR:
-         error(ERR_IS_DIRECTORY,text);
-         break;
-      //does this mapping make sense ?
-      case NFSERR_FBIG:
-         error(ERR_INTERNAL_SERVER,text);
-         break;
-      //does this mapping make sense ?
-      case NFSERR_NOSPC:
-         error(ERR_INTERNAL_SERVER,i18n("No space left on device"));
-         break;
-      case NFSERR_ROFS:
-         error(ERR_COULD_NOT_WRITE,i18n("Read only file system"));
-         break;
-      case NFSERR_NAMETOOLONG:
-         error(ERR_INTERNAL_SERVER,i18n("Filename too long"));
-         break;
-      case NFSERR_NOTEMPTY:
-         error(ERR_COULD_NOT_RMDIR,text);
-         break;
-      //does this mapping make sense ?
-      case NFSERR_DQUOT:
-         error(ERR_INTERNAL_SERVER,i18n("Disk quota exceeded"));
-         break;
-      case NFSERR_STALE:
-         error(ERR_DOES_NOT_EXIST,text);
-         break;
-      default:
-         error(ERR_UNKNOWN,text);
-         break;
-      }
-      return FALSE;
-   };
-   return TRUE;
-};
-
-void NFSProtocol::del( const KURL& url, bool isfile)
-{
-   QString thePath( QFile::encodeName(url.path()));
-   stripTrailingSlash(thePath);
-
-   QString fileName, parentDir;
-   getLastPart(thePath, fileName, parentDir);
-   stripTrailingSlash(parentDir);
-   kdDebug(7121)<<"del(): path: -"<<thePath<<"- file -"<<fileName<<"- parentDir: -"<<parentDir<<"-"<<endl;
-   if (isRoot(parentDir))
-   {
-      error(ERR_ACCESS_DENIED,thePath);
-      return;
-   };
-
-   NFSFileHandle fh=getFileHandle(parentDir);
-   if (fh.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,thePath);
-      return;
-   };
-
-   if (isfile)
-   {
-      kdDebug(7121)<<"Deleting file "<<thePath<<endl;
-      diropargs dirOpArgs;
-      memcpy(dirOpArgs.dir.data,fh,NFS_FHSIZE);
-      QCString tmpName=QFile::encodeName(fileName);
-      dirOpArgs.name=tmpName.data();
-
-      nfsstat nfsStat;
-
-      int clnt_stat = clnt_call(m_client, NFSPROC_REMOVE,
-                            (xdrproc_t) xdr_diropargs, (char*)&dirOpArgs,
-                            (xdrproc_t) xdr_nfsstat, (char*)&nfsStat,total_timeout);
-      if (!checkForError(clnt_stat,nfsStat,thePath)) return;
-      kdDebug(7121)<<"removing "<<thePath<<" from cache"<<endl;
-      m_handleCache.remove(m_handleCache.find(thePath));
-      finished();
-   }
-   else
-   {
-      kdDebug(7121)<<"Deleting directory "<<thePath<<endl;
-      diropargs dirOpArgs;
-      memcpy(dirOpArgs.dir.data,fh,NFS_FHSIZE);
-      QCString tmpName=QFile::encodeName(fileName);
-      dirOpArgs.name=tmpName.data();
-
-      nfsstat nfsStat;
-
-      int clnt_stat = clnt_call(m_client, NFSPROC_RMDIR,
-                            (xdrproc_t) xdr_diropargs, (char*)&dirOpArgs,
-                            (xdrproc_t) xdr_nfsstat, (char*)&nfsStat,total_timeout);
-      if (!checkForError(clnt_stat,nfsStat,thePath)) return;
-      kdDebug(7121)<<"removing "<<thePath<<" from cache"<<endl;
-      m_handleCache.remove(m_handleCache.find(thePath));
-      finished();
-   };
-};
-
-void NFSProtocol::chmod( const KURL& url, int permissions )
-{
-   QString thePath( QFile::encodeName(url.path()));
-   stripTrailingSlash(thePath);
-   kdDebug( 7121 ) <<  "chmod -"<< thePath << "-"<<endl;
-   if (isRoot(thePath) || isExportedDir(thePath))
-   {
-      error(ERR_ACCESS_DENIED,thePath);
-      return;
-   };
-
-   NFSFileHandle fh=getFileHandle(thePath);
-   if (fh.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,thePath);
-      return;
-   };
-
-   sattrargs sAttrArgs;
-   memcpy(sAttrArgs.file.data,fh,NFS_FHSIZE);
-   sAttrArgs.attributes.uid=(unsigned int)-1;
-   sAttrArgs.attributes.gid=(unsigned int)-1;
-   sAttrArgs.attributes.size=(unsigned int)-1;
-   sAttrArgs.attributes.atime.seconds=(unsigned int)-1;
-   sAttrArgs.attributes.atime.useconds=(unsigned int)-1;
-   sAttrArgs.attributes.mtime.seconds=(unsigned int)-1;
-   sAttrArgs.attributes.mtime.useconds=(unsigned int)-1;
-
-   sAttrArgs.attributes.mode=permissions;
-
-   nfsstat nfsStat;
-
-   int clnt_stat = clnt_call(m_client, NFSPROC_SETATTR,
-                         (xdrproc_t) xdr_sattrargs, (char*)&sAttrArgs,
-                         (xdrproc_t) xdr_nfsstat, (char*)&nfsStat,total_timeout);
-   if (!checkForError(clnt_stat,nfsStat,thePath)) return;
-
-   finished();
-}
-
-void NFSProtocol::get( const KURL& url )
-{
-   QString thePath( QFile::encodeName(url.path()));
-   kdDebug(7121)<<"get() -"<<thePath<<"-"<<endl;
-   NFSFileHandle fh=getFileHandle(thePath);
-   if (fh.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,thePath);
-      return;
-   };
-   readargs readArgs;
-   memcpy(readArgs.file.data,fh,NFS_FHSIZE);
-   readArgs.offset=0;
-   readArgs.count=NFS_MAXDATA;
-   readArgs.totalcount=NFS_MAXDATA;
-   readres readRes;
-   int offset(0);
-   char buf[NFS_MAXDATA];
-   readRes.readres_u.reply.data.data_val=buf;
-
-   QByteArray array;
-   do
-   {
-      int clnt_stat = clnt_call(m_client, NFSPROC_READ,
-                            (xdrproc_t) xdr_readargs, (char*)&readArgs,
-                            (xdrproc_t) xdr_readres, (char*)&readRes,total_timeout);
-      if (!checkForError(clnt_stat,readRes.status,thePath)) return;
-      if (readArgs.offset==0)
-         totalSize(readRes.readres_u.reply.attributes.size);
-
-      offset=readRes.readres_u.reply.data.data_len;
-      //kdDebug(7121)<<"read "<<offset<<" bytes"<<endl;
-      readArgs.offset+=offset;
-      if (offset>0)
-      {
-         array.setRawData(readRes.readres_u.reply.data.data_val, offset);
-         data( array );
-         array.resetRawData(readRes.readres_u.reply.data.data_val, offset);
-
-	 processedSize(readArgs.offset);
-      };
-
-   } while (offset>0);
-   data( QByteArray() );
-   finished();
-};
-
-//TODO the partial putting thing is not yet implemented
-void NFSProtocol::put( const KURL& url, int _mode, bool _overwrite, bool /*_resume*/ )
-{
-    QString destPath( QFile::encodeName(url.path()));
-    kdDebug( 7121 ) << "Put -" << destPath <<"-"<<endl;
-    /*QString dest_part( dest_orig );
-    dest_part += ".part";*/
-
-    stripTrailingSlash(destPath);
-    QString parentDir, fileName;
-    getLastPart(destPath,fileName, parentDir);
-    if (isRoot(parentDir))
-    {
-       error(ERR_WRITE_ACCESS_DENIED,destPath);
-       return;
-    };
-
-    NFSFileHandle destFH;
-    destFH=getFileHandle(destPath);
-    kdDebug(7121)<<"file handle for -"<<destPath<<"- is "<<destFH<<endl;
-
-    //the file exists and we don't want to overwrite
-    if ((!_overwrite) && (!destFH.isInvalid()))
-    {
-       error(ERR_FILE_ALREADY_EXIST,destPath);
-       return;
-    };
-    //TODO: is this correct ?
-    //we have to "create" the file anyway, no matter if it already
-    //exists or not
-    //if we don't create it new, written text will be, hmm, "inserted"
-    //in the existing file, i.e. a file could not become smaller, since
-    //write only overwrites or extends, but doesn't remove stuff from a file (aleXXX)
-
-    kdDebug(7121)<<"creating the file -"<<fileName<<"-"<<endl;
-    NFSFileHandle parentFH;
-    parentFH=getFileHandle(parentDir);
-    //cerr<<"fh for parent dir: "<<parentFH<<endl;
-    //the directory doesn't exist
-    if (parentFH.isInvalid())
-    {
-       kdDebug(7121)<<"parent directory -"<<parentDir<<"- does not exist"<<endl;
-       error(ERR_DOES_NOT_EXIST,parentDir);
-       return;
-    };
-    createargs createArgs;
-    memcpy(createArgs.where.dir.data,(const char*)parentFH,NFS_FHSIZE);
-    QCString tmpName=QFile::encodeName(fileName);
-    createArgs.where.name=tmpName.data();
-
-    //the mode is apparently ignored if the file already exists
-    if (_mode==-1) createArgs.attributes.mode=0644;
-    else createArgs.attributes.mode=_mode;
-    createArgs.attributes.uid=geteuid();
-    createArgs.attributes.gid=getegid();
-    //this is required, otherwise we are not able to write shorter files
-    createArgs.attributes.size=0;
-    //hmm, do we need something here ? I don't think so
-    createArgs.attributes.atime.seconds=(unsigned int)-1;
-    createArgs.attributes.atime.useconds=(unsigned int)-1;
-    createArgs.attributes.mtime.seconds=(unsigned int)-1;
-    createArgs.attributes.mtime.useconds=(unsigned int)-1;
-
-    diropres dirOpRes;
-    int clnt_stat = clnt_call(m_client, NFSPROC_CREATE,
-                              (xdrproc_t) xdr_createargs, (char*)&createArgs,
-                              (xdrproc_t) xdr_diropres, (char*)&dirOpRes,total_timeout);
-    if (!checkForError(clnt_stat,dirOpRes.status,fileName)) return;
-    //we created the file successfully
-    //destFH=getFileHandle(destPath);
-    destFH=dirOpRes.diropres_u.diropres.file.data;
-    kdDebug(7121)<<"file -"<<fileName<<"- in dir -"<<parentDir<<"- created successfully"<<endl;
-    //cerr<<"with fh "<<destFH<<endl;
-
-    //now we can put
-    int result;
-    // Loop until we got 0 (end of data)
-    writeargs writeArgs;
-    memcpy(writeArgs.file.data,(const char*)destFH,NFS_FHSIZE);
-    writeArgs.beginoffset=0;
-    writeArgs.totalcount=0;
-    writeArgs.offset=0;
-    attrstat attrStat;
-    int bytesWritten(0);
-    kdDebug(7121)<<"starting to put"<<endl;
-    do
-    {
-       QByteArray buffer;
-       dataReq(); // Request for data
-       result = readData( buffer );
-       //kdDebug(7121)<<"received "<<result<<" bytes for putting"<<endl;
-       char * data=buffer.data();
-       int bytesToWrite=buffer.size();
-       int writeNow(0);
-       if (result > 0)
-       {
-          do
-          {
-             if (bytesToWrite>NFS_MAXDATA)
-             {
-                writeNow=NFS_MAXDATA;
-             }
-             else
-             {
-                writeNow=bytesToWrite;
-             };
-             writeArgs.data.data_val=data;
-             writeArgs.data.data_len=writeNow;
-
-             int clnt_stat = clnt_call(m_client, NFSPROC_WRITE,
-                                       (xdrproc_t) xdr_writeargs, (char*)&writeArgs,
-                                       (xdrproc_t) xdr_attrstat, (char*)&attrStat,total_timeout);
-             //kdDebug(7121)<<"written"<<endl;
-             if (!checkForError(clnt_stat,attrStat.status,fileName)) return;
-             bytesWritten+=writeNow;
-             writeArgs.offset=bytesWritten;
-
-             //adjust the pointer
-             data=data+writeNow;
-             //decrease the rest
-             bytesToWrite-=writeNow;
-          } while (bytesToWrite>0);
-       }
-    } while ( result > 0 );
-    finished();
-};
-
-void NFSProtocol::rename( const KURL &src, const KURL &dest, bool _overwrite )
-{
-   QString srcPath( QFile::encodeName(src.path()));
-   QString destPath( QFile::encodeName(dest.path()));
-   stripTrailingSlash(srcPath);
-   stripTrailingSlash(destPath);
-   kdDebug(7121)<<"renaming -"<<srcPath<<"- to -"<<destPath<<"-"<<endl;
-
-   if (isRoot(srcPath) || isExportedDir(srcPath))
-   {
-      error(ERR_CANNOT_RENAME,srcPath);
-      return;
-   };
-
-   if (!_overwrite)
-   {
-      NFSFileHandle testFH;
-      testFH=getFileHandle(destPath);
-      if (!testFH.isInvalid())
-      {
-         error(ERR_FILE_ALREADY_EXIST,destPath);
-         return;
-      };
-   };
-
-   QString srcFileName, srcParentDir, destFileName, destParentDir;
-
-   getLastPart(srcPath, srcFileName, srcParentDir);
-   NFSFileHandle srcFH=getFileHandle(srcParentDir);
-   if (srcFH.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,srcParentDir);
-      return;
-   };
-   renameargs renameArgs;
-   memcpy(renameArgs.from.dir.data,srcFH,NFS_FHSIZE);
-   QCString tmpName=QFile::encodeName(srcFileName);
-   renameArgs.from.name=tmpName.data();
-
-   getLastPart(destPath, destFileName, destParentDir);
-   NFSFileHandle destFH=getFileHandle(destParentDir);
-   if (destFH.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,destParentDir);
-      return;
-   };
-   memcpy(renameArgs.to.dir.data,destFH,NFS_FHSIZE);
-   QCString tmpName2=QFile::encodeName(destFileName);
-   renameArgs.to.name=tmpName2.data();
-   nfsstat nfsStat;
-
-   int clnt_stat = clnt_call(m_client, NFSPROC_RENAME,
-                             (xdrproc_t) xdr_renameargs, (char*)&renameArgs,
-                             (xdrproc_t) xdr_nfsstat, (char*)&nfsStat,total_timeout);
-   if (!checkForError(clnt_stat,nfsStat,destPath)) return;
-   finished();
-};
-
-void NFSProtocol::copy( const KURL &src, const KURL &dest, int _mode, bool _overwrite )
-{
-   //prepare the source
-   QString thePath( QFile::encodeName(src.path()));
-   stripTrailingSlash(thePath);
-   kdDebug( 7121 ) << "Copy to -" << thePath <<"-"<<endl;
-   NFSFileHandle fh=getFileHandle(thePath);
-   if (fh.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,thePath);
-      return;
-   };
-
-   //create the destination
-   QString destPath( QFile::encodeName(dest.path()));
-   stripTrailingSlash(destPath);
-   QString parentDir, fileName;
-   getLastPart(destPath,fileName, parentDir);
-   if (isRoot(parentDir))
-   {
-      error(ERR_ACCESS_DENIED,destPath);
-      return;
-   };
-   NFSFileHandle destFH;
-   destFH=getFileHandle(destPath);
-   kdDebug(7121)<<"file handle for -"<<destPath<<"- is "<<destFH<<endl;
-
-   //the file exists and we don't want to overwrite
-   if ((!_overwrite) && (!destFH.isInvalid()))
-   {
-      error(ERR_FILE_ALREADY_EXIST,destPath);
-      return;
-   };
-   //TODO: is this correct ?
-   //we have to "create" the file anyway, no matter if it already
-   //exists or not
-   //if we don't create it new, written text will be, hmm, "inserted"
-   //in the existing file, i.e. a file could not become smaller, since
-   //write only overwrites or extends, but doesn't remove stuff from a file
-
-   kdDebug(7121)<<"creating the file -"<<fileName<<"-"<<endl;
-   NFSFileHandle parentFH;
-   parentFH=getFileHandle(parentDir);
-   //the directory doesn't exist
-   if (parentFH.isInvalid())
-   {
-      kdDebug(7121)<<"parent directory -"<<parentDir<<"- does not exist"<<endl;
-      error(ERR_DOES_NOT_EXIST,parentDir);
-      return;
-   };
-   createargs createArgs;
-   memcpy(createArgs.where.dir.data,(const char*)parentFH,NFS_FHSIZE);
-   QCString tmpName=QFile::encodeName(fileName);
-   createArgs.where.name=tmpName.data();
-   if (_mode==-1) createArgs.attributes.mode=0644;
-   else createArgs.attributes.mode=_mode;
-   createArgs.attributes.uid=geteuid();
-   createArgs.attributes.gid=getegid();
-   createArgs.attributes.size=0;
-   createArgs.attributes.atime.seconds=(unsigned int)-1;
-   createArgs.attributes.atime.useconds=(unsigned int)-1;
-   createArgs.attributes.mtime.seconds=(unsigned int)-1;
-   createArgs.attributes.mtime.useconds=(unsigned int)-1;
-
-   diropres dirOpRes;
-   int clnt_stat = clnt_call(m_client, NFSPROC_CREATE,
-                             (xdrproc_t) xdr_createargs, (char*)&createArgs,
-                             (xdrproc_t) xdr_diropres, (char*)&dirOpRes,total_timeout);
-   if (!checkForError(clnt_stat,dirOpRes.status,destPath)) return;
-   //we created the file successfully
-   destFH=dirOpRes.diropres_u.diropres.file.data;
-   kdDebug(7121)<<"file -"<<fileName<<"- in dir -"<<parentDir<<"- created successfully"<<endl;
-
-   char buf[NFS_MAXDATA];
-   writeargs writeArgs;
-   memcpy(writeArgs.file.data,(const char*)destFH,NFS_FHSIZE);
-   writeArgs.beginoffset=0;
-   writeArgs.totalcount=0;
-   writeArgs.offset=0;
-   writeArgs.data.data_val=buf;
-   attrstat attrStat;
-
-   readargs readArgs;
-   memcpy(readArgs.file.data,fh,NFS_FHSIZE);
-   readArgs.offset=0;
-   readArgs.count=NFS_MAXDATA;
-   readArgs.totalcount=NFS_MAXDATA;
-   readres readRes;
-   readRes.readres_u.reply.data.data_val=buf;
-
-   int bytesRead(0);
-   do
-   {
-      //first read
-      int clnt_stat = clnt_call(m_client, NFSPROC_READ,
-                                (xdrproc_t) xdr_readargs, (char*)&readArgs,
-                                (xdrproc_t) xdr_readres, (char*)&readRes,total_timeout);
-      if (!checkForError(clnt_stat,readRes.status,thePath)) return;
-      if (readArgs.offset==0)
-         totalSize(readRes.readres_u.reply.attributes.size);
-
-      bytesRead=readRes.readres_u.reply.data.data_len;
-      //kdDebug(7121)<<"read "<<bytesRead<<" bytes"<<endl;
-      //then write
-      if (bytesRead>0)
-      {
-         readArgs.offset+=bytesRead;
-
-         writeArgs.data.data_len=bytesRead;
-
-         clnt_stat = clnt_call(m_client, NFSPROC_WRITE,
-                               (xdrproc_t) xdr_writeargs, (char*)&writeArgs,
-                               (xdrproc_t) xdr_attrstat, (char*)&attrStat,total_timeout);
-         //kdDebug(7121)<<"written"<<endl;
-         if (!checkForError(clnt_stat,attrStat.status,destPath)) return;
-         writeArgs.offset+=bytesRead;
-      };
-   } while (bytesRead>0);
-
-   finished();
-}
-
-//TODO why isn't this even called ?
-void NFSProtocol::symlink( const QString &target, const KURL &dest, bool )
-{
-   kdDebug(7121)<<"symlinking "<<endl;
-   QString destPath=dest.path();
-   stripTrailingSlash(destPath);
-
-   QString parentDir, fileName;
-   getLastPart(destPath,fileName, parentDir);
-   kdDebug(7121)<<"symlinking "<<parentDir<<" "<<fileName<<" to "<<target<<endl;
-   NFSFileHandle fh=getFileHandle(parentDir);
-   if (fh.isInvalid())
-   {
-      error(ERR_DOES_NOT_EXIST,parentDir);
-      return;
-   };
-   if (isRoot(parentDir))
-   {
-      error(ERR_ACCESS_DENIED,destPath);
-      return;
-   };
-
-   kdDebug(7121)<<"tach"<<endl;
-   QCString tmpStr=target.latin1();
-   symlinkargs symLinkArgs;
-   symLinkArgs.to=tmpStr.data();
-   memcpy(symLinkArgs.from.dir.data,(const char*)fh,NFS_FHSIZE);
-   QCString tmpStr2=QFile::encodeName(destPath);
-   symLinkArgs.from.name=tmpStr2.data();
-
-   nfsstat nfsStat;
-   int clnt_stat = clnt_call(m_client, NFSPROC_SYMLINK,
-                             (xdrproc_t) xdr_symlinkargs, (char*)&symLinkArgs,
-                             (xdrproc_t) xdr_nfsstat, (char*)&nfsStat,total_timeout);
-   if (!checkForError(clnt_stat,nfsStat,destPath)) return;
-
-   finished();
-
-};
-
-bool NFSProtocol::isValidLink(const QString& parentDir, const QString& linkDest)
-{
-   kdDebug(7121)<<"isValidLink: parent: "<<parentDir<<" link: "<<linkDest<<endl;
-   if (linkDest.isEmpty()) return FALSE;
-   if (isAbsoluteLink(linkDest))
-   {
-      kdDebug(7121)<<"is an absolute link"<<endl;
-      return QFile::exists(linkDest);
-   }
-   else
-   {
-      kdDebug(7121)<<"is a relative link"<<endl;
-      QString absDest=parentDir+"/"+linkDest;
-      kdDebug(7121)<<"pointing abs to "<<absDest<<endl;
-      absDest=removeFirstPart(absDest);
-      kdDebug(7121)<<"removed first part "<<absDest<<endl;
-      absDest=QDir::cleanDirPath(absDest);
-      kdDebug(7121)<<"simplified to "<<absDest<<endl;
-      if (absDest.find("../")==0)
-         return FALSE;
-
-      kdDebug(7121)<<"is inside the nfs tree"<<endl;
-      absDest=parentDir+"/"+linkDest;
-      absDest=QDir::cleanDirPath(absDest);
-      kdDebug(7121)<<"getting file handle of "<<absDest<<endl;
-      NFSFileHandle fh=getFileHandle(absDest);
-      return (!fh.isInvalid());
-   };
-   return FALSE;
-};
-
-bool NFSProtocol::isAbsoluteLink(const QString& path)
-{
-   //hmm, don't know
-   if (path.isEmpty()) return TRUE;
-   if (path[0]=='/') return TRUE;
-   return FALSE;
-};
-
Index: kioslave/nfs/kio_nfs.h
===================================================================
RCS file: kioslave/nfs/kio_nfs.h
diff -N kioslave/nfs/kio_nfs.h
--- kioslave/nfs/kio_nfs.h	1 Oct 2002 02:36:16 -0000	1.1.1.1
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,110 +0,0 @@
-/*  This file is part of the KDE project
-    Copyright (C) 2000 Alexander Neundorf <neundorf@kde.org>
-
-    This library is free software; you can redistribute it and/or
-    modify it under the terms of the GNU Library General Public
-    License as published by the Free Software Foundation; either
-    version 2 of the License, or (at your option) any later version.
-
-    This library is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-    Library General Public License for more details.
-
-    You should have received a copy of the GNU Library General Public License
-    along with this library; see the file COPYING.LIB.  If not, write to
-    the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
-    Boston, MA 02111-1307, USA.
-*/
-
-#ifndef KIO_NFS_H
-#define KIO_NFS_H
-
-#include <kio/slavebase.h>
-#include <kio/global.h>
-
-#include <qmap.h>
-#include <qstring.h>
-#include <qstringlist.h>
-#include <qintdict.h>
-#include <qtimer.h>
-
-#define PORTMAP  //this seems to be required to compile on Solaris
-#include <rpc/rpc.h>
-#include <sys/socket.h>
-#include <netinet/in.h>
-#include <sys/time.h>
-
-class NFSFileHandle
-{
-   public:
-      NFSFileHandle();
-      NFSFileHandle(const NFSFileHandle & handle);
-      ~NFSFileHandle();
-      NFSFileHandle& operator= (const NFSFileHandle& src);
-      NFSFileHandle& operator= (const char* src);
-      operator const char* () const {return m_handle;};
-      bool isInvalid() const {return m_isInvalid;}
-      void setInvalid() {m_isInvalid=TRUE;};
-      time_t age() const;
-   protected:
-      char *m_handle;
-      bool m_isInvalid;
-      time_t m_detectTime;
-};
-
-//ostream& operator<<(ostream&, const NFSFileHandle&);
-
-typedef QMap<QString,NFSFileHandle> NFSFileHandleMap;
-
-
-class NFSProtocol : public KIO::SlaveBase
-{
-   public:
-      NFSProtocol (const QCString &pool, const QCString &app );
-      virtual ~NFSProtocol();
-
-      virtual void openConnection();
-      virtual void closeConnection();
-
-      virtual void setHost( const QString& host, int port, const QString& user, const QString& pass );
-
-      virtual void put( const KURL& url, int _mode,bool _overwrite, bool _resume );
-      virtual void get( const KURL& url );
-      virtual void listDir( const KURL& url);
-      virtual void symlink( const QString &target, const KURL &dest, bool );
-      virtual void stat( const KURL & url);
-      virtual void mkdir( const KURL& url, int permissions );
-      virtual void del( const KURL& url, bool isfile);
-      virtual void chmod(const KURL& url, int permissions );
-      virtual void rename(const KURL &src, const KURL &dest, bool overwrite);
-      virtual void copy( const KURL& src, const KURL &dest, int mode, bool overwrite );
-   protected:
-      void createVirtualDirEntry(KIO::UDSEntry & entry);
-      bool checkForError(int clientStat, int nfsStat, const QString& text);
-      bool isExportedDir(const QString& path);
-      bool isRoot(const QString& path);
-      void completeUDSEntry(KIO::UDSEntry& entry, fattr& attributes);
-      void completeBadLinkUDSEntry(KIO::UDSEntry& entry, fattr& attributes);
-      void completeAbsoluteLinkUDSEntry(KIO::UDSEntry& entry, const QCString& path);
-      bool isValidLink(const QString& parentDir, const QString& linkDest);
-      bool isAbsoluteLink(const QString& path);
-      
-      NFSFileHandle getFileHandle(QString path);
-
-      NFSFileHandleMap m_handleCache;
-      QIntDict<QString> usercache;      // maps long ==> QString *
-      QIntDict<QString> groupcache;
-
-      QStringList m_exportedDirs;
-      QString m_currentHost;
-      CLIENT *m_client;
-      CLIENT *m_nfsClient;
-      timeval total_timeout;
-      timeval pertry_timeout;
-      int m_sock;
-      time_t m_lastCheck;
-      void checkForOldFHs();
-};
-
-#endif
Index: klipper/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/klipper/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- klipper/Makefile.am	29 Oct 2002 03:05:34 -0000	1.1.1.3
+++ klipper/Makefile.am	3 Oct 2002 22:02:42 -0000	1.4
@@ -6,12 +6,12 @@
 
 CLEANFILES = dummy.cpp
 
-klipper_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) 
+klipper_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE) $(LIB_X11) $(LIB_DCOP)
 klipper_la_SOURCES = main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp \
     toplevel.skel
 
 klipper_la_METASOURCES = AUTO
-klipper_la_LDFLAGS = $(all_libraries) -module -avoid-version
+klipper_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
 
 klipper_LDADD = klipper.la $(LIB_KSYCOCA)
 klipper_SOURCES = dummy.cpp
Index: kmenuedit/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kmenuedit/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kmenuedit/Makefile.am	14 Aug 2002 14:27:55 -0000	1.1.1.3
+++ kmenuedit/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -7,8 +7,8 @@
 
 kmenuedit_la_SOURCES = basictab.cpp treeview.cpp desktopfileeditor.cpp menueditview.cpp kmenuedit.cpp main.cpp khotkeys.cpp
 
-kmenuedit_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
-kmenuedit_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kmenuedit_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
+kmenuedit_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
 
 kmenuedit_SOURCES = dummy.cpp
 kmenuedit_LDADD   = kmenuedit.la
Index: konqueror/client/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konqueror/client/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.4
diff -u -u -r1.1.1.2 -r1.4
--- konqueror/client/Makefile.am	14 Aug 2002 14:30:59 -0000	1.1.1.2
+++ konqueror/client/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -4,8 +4,8 @@
 lib_LTLIBRARIES = kfmclient.la
 
 INCLUDES= -I.. $(all_includes)
-kfmclient_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kfmclient_la_LIBADD =  $(LIB_KIO)
+kfmclient_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
+kfmclient_la_LIBADD =  $(LIB_KIO) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP) $(LIB_KDEUI)
 kfmclient_la_SOURCES = kfmclient.cc KonquerorIface.stub KDesktopIface.stub
 
 noinst_HEADERS = kfmclient.h
Index: konqueror/keditbookmarks/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konqueror/keditbookmarks/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
Index: konqueror/sidebar/trees/history_module/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konqueror/sidebar/trees/history_module/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- konqueror/sidebar/trees/history_module/Makefile.am	1 Oct 2002 02:36:50 -0000	1.1.1.3
+++ konqueror/sidebar/trees/history_module/Makefile.am	1 Oct 2002 03:01:48 -0000	1.4
@@ -6,7 +6,7 @@
 
 konq_sidebartree_history_la_SOURCES = history_module.cpp history_item.cpp \
 	history_settings.cpp history_settings.skel
-konq_sidebartree_history_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
+konq_sidebartree_history_la_LDFLAGS = $(all_libraries) -no-undefined -module $(KDE_PLUGIN)
 konq_sidebartree_history_la_LIBADD =  ../../libkonqsidebarplugin.la ../libkonq_sidebar_tree.la
 
 kcm_history_la_SOURCES = kcmhistory.cpp history_dlg.ui history_settings.cpp history_settings.skel
Index: konqueror/sidebar/trees/history_module/history_module.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konqueror/sidebar/trees/history_module/history_module.h,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- konqueror/sidebar/trees/history_module/history_module.h	14 Aug 2002 14:30:58 -0000	1.1.1.2
+++ konqueror/sidebar/trees/history_module/history_module.h	14 Aug 2002 15:35:44 -0000	1.3
@@ -53,8 +53,7 @@
     bool sortsByName() const { return m_sortsByName; }
 
     static QString groupForURL( const KURL& url ) {
-	static const QString& misc = KGlobal::staticQString(i18n("Miscellaneous"));
-	return url.host().isEmpty() ? misc : url.host();
+	return url.host().isEmpty() ? KGlobal::staticQString(i18n("Miscellaneous")) : url.host();
     }
 
 public slots:
Index: konsole/kcmkonsole.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/kcmkonsole.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/konsole.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/konsolehere.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsolehere.desktop,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
Index: konsole/konsolepart.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsolepart.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/konsolesu.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsolesu.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/kwrited.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/kwrited.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.4
diff -u -u -r1.1.1.5 -r1.4
Index: konsole/konsole/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.4
diff -u -u -r1.1.1.4 -r1.4
--- konsole/konsole/Makefile.am	29 Oct 2002 03:06:19 -0000	1.1.1.4
+++ konsole/konsole/Makefile.am	29 Oct 2002 03:39:34 -0000	1.4
@@ -47,8 +47,8 @@
 konsole_la_SOURCES = TEPty.cpp BlockArray.cpp main.cpp konsole.cpp schema.cpp session.cpp TEWidget.cpp TEmuVt102.cpp \
      TEScreen.cpp TEmulation.cpp TEHistory.cpp keytrans.cpp konsoleiface.skel sessioniface.skel \
      konsole_wcwidth.cpp konsolebookmarkhandler.cpp konsolebookmarkmenu.cpp konsole_child.cpp
-konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version
-konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBUTIL) $(XTESTLIB)
+konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBUTIL) $(XTESTLIB) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 # konsole executable
 konsole_SOURCES = dummy.cpp
Index: konsole/konsole/TEPty.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEPty.cpp,v
retrieving revision 1.1.1.5
retrieving revision 1.8
diff -u -u -r1.1.1.5 -r1.8
Index: konsole/konsole/TEPty.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEPty.h,v
retrieving revision 1.1.1.4
retrieving revision 1.3
diff -u -u -r1.1.1.4 -r1.3
Index: konsole/konsole/TEScreen.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEScreen.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
Index: konsole/konsole/TEScreen.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEScreen.h,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
Index: konsole/konsole/TEWidget.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEWidget.cpp,v
retrieving revision 1.1.1.5
retrieving revision 1.4
diff -u -u -r1.1.1.5 -r1.4
Index: konsole/konsole/TEWidget.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEWidget.h,v
retrieving revision 1.1.1.5
retrieving revision 1.4
diff -u -u -r1.1.1.5 -r1.4
Index: konsole/konsole/TEmuVt102.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEmuVt102.cpp,v
retrieving revision 1.1.1.5
retrieving revision 1.4
diff -u -u -r1.1.1.5 -r1.4
Index: konsole/konsole/TEmulation.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEmulation.cpp,v
retrieving revision 1.1.1.5
retrieving revision 1.4
diff -u -u -r1.1.1.5 -r1.4
Index: konsole/konsole/konsole.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole.cpp,v
retrieving revision 1.1.1.5
retrieving revision 1.4
diff -u -u -r1.1.1.5 -r1.4
Index: konsole/konsole/konsole.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole.h,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/konsole/konsole_child.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_child.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
Index: konsole/konsole/konsole_child.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_child.h,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
Index: konsole/konsole/konsole_grantpty.c
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_grantpty.c,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
--- konsole/konsole/konsole_grantpty.c	1 Oct 2002 02:36:59 -0000	1.1.1.3
+++ konsole/konsole/konsole_grantpty.c	22 Oct 2002 03:05:32 -0000	1.3
@@ -45,6 +45,13 @@
 
 int main (int argc, char *argv[])
 {
+
+  if (strcmp(getenv("DEBUG_ME"), "sleepinmain") == 0)
+  {
+    fprintf(stderr, "My PID is %d\n", (int) getpid());
+    kill(getpid(), SIGSTOP);
+  }
+
   char*         pty;
   struct stat   st;
   struct group* p;
Index: konsole/konsole/konsole_part.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_part.cpp,v
retrieving revision 1.1.1.5
retrieving revision 1.4
diff -u -u -r1.1.1.5 -r1.4
Index: konsole/konsole/konsole_part.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_part.h,v
retrieving revision 1.1.1.5
retrieving revision 1.4
diff -u -u -r1.1.1.5 -r1.4
Index: konsole/konsole/main.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/main.cpp,v
retrieving revision 1.1.1.5
retrieving revision 1.3
diff -u -u -r1.1.1.5 -r1.3
Index: konsole/konsole/session.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/session.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.3
diff -u -u -r1.1.1.4 -r1.3
Index: konsole/konsole/session.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/session.h,v
retrieving revision 1.1.1.4
retrieving revision 1.3
diff -u -u -r1.1.1.4 -r1.3
Index: konsole/konsole/x-konsole.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/x-konsole.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/other/linux.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/linux.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/other/mc.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/mc.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/other/screen.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/screen.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/other/shell.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/shell.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/other/su.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/su.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/other/su.kdelnk
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/su.kdelnk,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: konsole/other/sumc.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/sumc.desktop,v
retrieving revision 1.1.1.6
retrieving revision 1.4
diff -u -u -r1.1.1.6 -r1.4
Index: kscreensaver/configure.in.in
===================================================================
RCS file: kscreensaver/configure.in.in
diff -N kscreensaver/configure.in.in
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ kscreensaver/configure.in.in	7 Oct 2002 02:30:18 -0000	1.1
@@ -0,0 +1 @@
+DO_NOT_COMPILE="$DO_NOT_COMPILE kscreensaver"
Index: ksmserver/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksmserver/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- ksmserver/Makefile.am	10 Jul 2002 03:24:29 -0000	1.1.1.2
+++ ksmserver/Makefile.am	10 Jul 2002 03:42:59 -0000	1.3
@@ -28,9 +28,9 @@
 ksmserver_la_SOURCES = main.cpp server.cpp shutdown.cpp KSMServerInterface.skel
 ksmserver_SOURCES = dummy.cpp
 
-ksmserver_la_LDFLAGS = $(all_libraries) -avoid-version -module
+ksmserver_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -avoid-version -module
 ksmserver_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-ksmserver_la_LIBADD = $(LIB_KDEUI)
+ksmserver_la_LIBADD = $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP) $(LIBSM)
 ksmserver_LDADD = ksmserver.la
 
 picsdir = $(kde_datadir)/ksmserver/pics
Index: ksysguard/CContLib/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksysguard/CContLib/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -u -r1.1.1.2 -r1.2
--- ksysguard/CContLib/Makefile.am	10 Jul 2002 03:24:36 -0000	1.1.1.2
+++ ksysguard/CContLib/Makefile.am	16 Sep 2002 14:31:34 -0000	1.2
@@ -4,5 +4,3 @@
 include_HEADERS = ccont.h
 
 libccont_a_SOURCES = ccont.c
-
-AM_CFLAGS = -ggdb
Index: ksysguard/gui/SensorDisplayLib/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksysguard/gui/SensorDisplayLib/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -u -r1.1.1.3 -r1.2
--- ksysguard/gui/SensorDisplayLib/Makefile.am	14 Aug 2002 14:27:16 -0000	1.1.1.3
+++ ksysguard/gui/SensorDisplayLib/Makefile.am	16 Sep 2002 14:31:34 -0000	1.2
@@ -4,8 +4,9 @@
  
 lib_LTLIBRARIES = libsensordisplays.la
 
-libsensordisplays_la_LDFLAGS = $(all_libraries)
-libsensordisplays_la_LIBADD = $(LIB_KDEUI)
+libsensordisplays_la_LDFLAGS = $(all_libraries) -fno-common
+libsensordisplays_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) \
+	$(top_builddir)/ksysguard/gui/ksgrd/libksgrd.la
 
 # Which sources should be compiled for the sensor display lib.
 libsensordisplays_la_SOURCES = \
Index: ksysguard/gui/SensorDisplayLib/SensorDisplay.cc
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksysguard/gui/SensorDisplayLib/SensorDisplay.cc,v
retrieving revision 1.1.1.4
retrieving revision 1.3
diff -u -u -r1.1.1.4 -r1.3
--- ksysguard/gui/SensorDisplayLib/SensorDisplay.cc	1 Oct 2002 02:37:23 -0000	1.1.1.4
+++ ksysguard/gui/SensorDisplayLib/SensorDisplay.cc	1 Oct 2002 03:01:48 -0000	1.3
@@ -62,7 +62,6 @@
 	pausedWhileHidden = false;
 
 	timerOn();
-	QWhatsThis::add(this, "dummy");
 
 	frame = new QGroupBox(2, Qt::Vertical, "", this, "displayFrame"); 
 	Q_CHECK_PTR(frame);
Index: ksysguard/gui/ksgrd/StyleEngine.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksysguard/gui/ksgrd/StyleEngine.h,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- ksysguard/gui/ksgrd/StyleEngine.h	25 Jun 2002 02:03:54 -0000	1.1.1.1
+++ ksysguard/gui/ksgrd/StyleEngine.h	16 Sep 2002 14:31:34 -0000	1.2
@@ -68,11 +68,12 @@
 	}
 	const QColor& getSensorColor(uint i)
 	{
-		static QColor dummy;
-		if (i < sensorColors.count())
+		if (i < sensorColors.count()) {
 			return *(sensorColors.at(i));
-		else
+		} else {
+			QColor dummy;
 			return dummy;
+		}
 	}
 	uint getSensorColorCount() const
 	{
Index: ktip/tips
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ktip/tips,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- ktip/tips	29 Oct 2002 03:06:51 -0000	1.1.1.5
+++ ktip/tips	31 Oct 2002 19:19:37 -0000	1.2
@@ -704,20 +704,6 @@
 </tip>
 
 
-<tip category="Win2Unix">
-<html>
-<p>
-You might wonder why there are very few (if any) files whose
-names end in <code>.exe</code> or <code>.bat</code> on UNIX
-systems. This is because filenames on UNIX do not need an
-extension. Executable files in KDE are represented by the gear icon
-in Konqueror. In the Konsole window, they are often colored red 
-(depending on your settings).
-</p>
-<p align="right"><em>Contributed by Carsten Niehaus</em></p>
-</html>
-</tip>
-
 <tip category="KDE|Win2Unix|General">
 <html>
 <p>
Index: kwin/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kwin/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kwin/Makefile.am	10 Jul 2002 03:24:51 -0000	1.1.1.2
+++ kwin/Makefile.am	10 Jul 2002 03:42:59 -0000	1.3
@@ -9,7 +9,7 @@
 kwin_la_SOURCES = workspace.cpp placement.cpp atoms.cpp  client.cpp main.cpp \
 	popupinfo.cpp tabbox.cpp options.cpp plugins.cpp events.cpp KWinInterface.skel \
 	killwindow.cpp kwinbutton.cpp
-kwin_la_LIBADD = $(LIB_KDEUI) $(LIBXINERAMA)
+kwin_la_LIBADD = $(LIB_KDEUI) $(LIBXINERAMA) $(LIB_KDECORE) $(LIB_X11) $(LIB_XEXT) $(LIB_DCOP) $(LIB_QT)
 kwin_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 include_HEADERS = KWinInterface.h
Index: kwin/kcmkwin/kwinoptions/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kwin/kcmkwin/kwinoptions/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- kwin/kcmkwin/kwinoptions/Makefile.am	1 Oct 2002 02:37:36 -0000	1.1.1.4
+++ kwin/kcmkwin/kwinoptions/Makefile.am	1 Oct 2002 12:06:42 -0000	1.2
@@ -10,7 +10,7 @@
 kcm_kwinoptions_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
 kcm_kwinoptions_la_LIBADD = $(LIB_KDEUI)
 
-noinst_HEADERS = windows.h mouse.h 
+noinst_HEADERS = windows.h mouse.h main.h
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/kcmkwm.pot
Index: kwin/kcmkwin/kwinoptions/kwinoptions.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kwin/kcmkwin/kwinoptions/kwinoptions.desktop,v
retrieving revision 1.1.1.4
retrieving revision 1.4
diff -u -u -r1.1.1.4 -r1.4
Index: kwin/kcmkwin/kwinoptions/main.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kwin/kcmkwin/kwinoptions/main.h,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
Index: kxkb/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kxkb/Makefile.am,v
retrieving revision 1.1.1.5
retrieving revision 1.7
diff -u -u -r1.1.1.5 -r1.7
--- kxkb/Makefile.am	29 Oct 2002 03:07:04 -0000	1.1.1.5
+++ kxkb/Makefile.am	29 Oct 2002 03:39:39 -0000	1.7
@@ -19,8 +19,8 @@
 kcm_keyboard_la_LIBADD = $(XTESTLIB) $(LIB_KIO) -lxkbfile
 
 kxkb_la_SOURCES = kxkb.cpp rules.cpp extension.cpp pixmap.cpp
-kxkb_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kxkb_la_LIBADD = -lX11 -lXext $(LIB_KDEUI) -lxkbfile
+kxkb_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
+kxkb_la_LIBADD = -lX11 -lXext -lxkbfile $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 data_DATA = keyboard.desktop
 datadir = $(kde_appsdir)/Settings/Peripherals
Index: legacyimport/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/legacyimport/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- legacyimport/Makefile.am	14 Aug 2002 14:27:42 -0000	1.1.1.2
+++ legacyimport/Makefile.am	14 Aug 2002 15:35:44 -0000	1.3
@@ -4,8 +4,8 @@
 lib_LTLIBRARIES = klegacyimport.la
 
 klegacyimport_la_SOURCES = legacyimport.cpp
-klegacyimport_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
-klegacyimport_la_LDFLAGS = $(all_libraries) -module -avoid-version
+klegacyimport_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KFILE) $(LIB_KDECORE) $(LIB_QT)
+klegacyimport_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
 
 klegacyimport_SOURCES = dummy.cpp
 klegacyimport_LDADD   = klegacyimport.la
Index: libkonq/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/libkonq/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- libkonq/Makefile.am	1 Oct 2002 02:37:43 -0000	1.1.1.4
+++ libkonq/Makefile.am	1 Oct 2002 03:01:48 -0000	1.5
@@ -20,8 +20,8 @@
 SUBDIRS = pics favicons
 
 lib_LTLIBRARIES = libkonq.la
-libkonq_la_LDFLAGS = $(all_libraries) -version-info 5:0:1 -no-undefined
-libkonq_la_LIBADD = $(LIB_KPARTS)
+libkonq_la_LDFLAGS = $(all_libraries) -version-info 5:0:1 -no-undefined $(QT_LDFLAGS)
+libkonq_la_LIBADD = $(LIB_KPARTS) $(LIB_KDECORE) $(LIB_QT) $(LIB_MCOP) $(LIB_KDEUI) $(LIB_KIO) $(LIB_DCOP) $(LIB_KDEFX)
 
 libkonq_la_SOURCES = konq_popupmenu.cc knewmenu.cc \
    konq_xmlguiclient.cc\
@@ -59,7 +59,7 @@
 kde_module_LTLIBRARIES = konq_sound.la
 konq_sound_la_SOURCES = konq_sound.cc
 konq_sound_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-konq_sound_la_LIBADD = -lsoundserver_idl -lartskde
+konq_sound_la_LIBADD = -lsoundserver_idl -lartskde $(LIB_KDECORE) $(LIB_QT) $(LIB_MCOP)
 
 noinst_HEADERS = konq_sound.h
 
Index: libkonq/konq_iconviewwidget.cc
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/libkonq/konq_iconviewwidget.cc,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- libkonq/konq_iconviewwidget.cc	29 Oct 2002 03:07:07 -0000	1.1.1.4
+++ libkonq/konq_iconviewwidget.cc	30 Oct 2002 01:04:46 -0000	1.2
@@ -44,6 +44,7 @@
 #include <kiconeffect.h>
 #include <kurldrag.h>
 #include <kstandarddirs.h>
+#include <kprotocolinfo.h>
 
 #include <assert.h>
 #include <unistd.h>
@@ -1114,8 +1115,9 @@
 
 void KonqIconViewWidget::slotSelectionChanged()
 {
-    // This code is very related to TreeViewBrowserExtension::updateActions
-    bool cutcopy, del;
+    // This code is very related to ListViewBrowserExtension::updateActions
+    int canCopy = 0;
+    int canDel = 0;
     bool bInTrash = false;
     int iCount = 0;
     KFileItem * firstSelectedItem = 0L;
@@ -1125,20 +1127,24 @@
         if ( it->isSelected() )
         {
             iCount++;
+            canCopy++;
+
             if ( ! firstSelectedItem )
                 firstSelectedItem = (static_cast<KFileIVI *>( it ))->item();
 
-            if ( (static_cast<KFileIVI *>( it ))->item()->url().directory(false) == KGlobalSettings::trashPath() )
+            KURL url = ( static_cast<KFileIVI *>( it ) )->item()->url();
+            if ( url.directory(false) == KGlobalSettings::trashPath() )
                 bInTrash = true;
+            if ( KProtocolInfo::supportsDeleting( url ) )
+                canDel++;
         }
     }
-    cutcopy = del = ( iCount > 0 );
 
-    emit enableAction( "cut", cutcopy );
-    emit enableAction( "copy", cutcopy );
-    emit enableAction( "trash", del && !bInTrash && m_url.isLocalFile() );
-    emit enableAction( "del", del );
-    emit enableAction( "shred", del );
+    emit enableAction( "cut", canDel > 0 );
+    emit enableAction( "copy", canCopy > 0 );
+    emit enableAction( "trash", canDel > 0 && !bInTrash && m_url.isLocalFile() );
+    emit enableAction( "del", canDel > 0 );
+    emit enableAction( "shred", canDel > 0 );
 
     KFileItemList lstItems;
     if ( firstSelectedItem )
Index: libkonq/konq_operations.cc
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/libkonq/konq_operations.cc,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- libkonq/konq_operations.cc	29 Oct 2002 03:07:07 -0000	1.1.1.4
+++ libkonq/konq_operations.cc	30 Oct 2002 01:04:46 -0000	1.2
@@ -191,8 +191,17 @@
      (void) new KonqCommandRecorder( method==MOVE?KonqCommand::MOVE:KonqCommand::LINK, selectedURLs, destUrl, job );
 };
 
-void KonqOperations::_del( int method, const KURL::List & selectedURLs, int confirmation )
+void KonqOperations::_del( int method, const KURL::List & _selectedURLs, int confirmation )
 {
+    KURL::List selectedURLs;
+    for (KURL::List::ConstIterator it = _selectedURLs.begin(); it != _selectedURLs.end(); ++it)
+        if (KProtocolInfo::supportsDeleting(*it))
+            selectedURLs.append(*it);
+    if (selectedURLs.isEmpty()) {
+        delete this;
+        return;
+    }
+
   m_method = method;
   if ( confirmation == SKIP_CONFIRMATION || askDeleteConfirmation( selectedURLs, confirmation ) )
   {
@@ -538,9 +547,15 @@
     assert(m_info); // setDropInfo - and asyncDrop - should have been called before asyncDrop
     KURL::List lst = m_info->lst;
     QDropEvent::Action action = m_info->action;
-    if ( m_destURL.path( 1 ) == KGlobalSettings::trashPath() )
+
+    KURL::List mlst;
+    for (KURL::List::ConstIterator it = lst.begin(); it != lst.end(); ++it)
+        if ( KProtocolInfo::supportsDeleting( *it ) )
+             mlst.append(*it);
+
+    if ( !mlst.isEmpty() && m_destURL.path( 1 ) == KGlobalSettings::trashPath() )
     {
-        if ( askDeleteConfirmation( lst, DEFAULT_CONFIRMATION ) )
+        if ( askDeleteConfirmation( mlst, DEFAULT_CONFIRMATION ) )
             action = QDropEvent::Move;
         else
         {
@@ -606,7 +621,9 @@
     KIO::Job * job = 0;
     switch ( action ) {
     case QDropEvent::Move :
-        job = KIO::move( lst, m_destURL );
+        if (mlst.isEmpty())
+            return;
+        job = KIO::move( mlst, m_destURL );
         job->setMetaData( m_info->metaData );
         setOperation( job, MOVE, lst, m_destURL );
         (void) new KonqCommandRecorder( KonqCommand::MOVE, lst, m_destURL, job );
Index: libkonq/favicons/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/libkonq/favicons/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- libkonq/favicons/Makefile.am	25 Jun 2002 02:03:55 -0000	1.1.1.1
+++ libkonq/favicons/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -2,8 +2,8 @@
 
 INCLUDES = $(all_includes)
 kded_favicons_la_SOURCES = favicons.cpp favicons.skel
-kded_favicons_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_favicons_la_LIBADD = $(LIB_KSYCOCA)
+kded_favicons_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+kded_favicons_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP) $(LIB_KDED)
 
 METASOURCES = AUTO
 
Index: nsplugins/pluginscan.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/nsplugins/pluginscan.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- nsplugins/pluginscan.cpp	29 Oct 2002 03:07:09 -0000	1.1.1.3
+++ nsplugins/pluginscan.cpp	29 Oct 2002 03:39:40 -0000	1.4
@@ -443,6 +443,7 @@
         paths.append("/usr/lib/netscape/plugins");
         paths.append("/usr/lib/netscape/plugins-libc5");
         paths.append("/usr/lib/netscape/plugins-libc6");
+        paths.append("@PREFIX@/lib/mozilla/plugins");
         paths.append("/usr/lib/mozilla/plugins");
         paths.append("$MOZILLA_HOME/plugins");
         config->writeEntry( "scanPaths", paths );
