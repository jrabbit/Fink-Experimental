Package: debconf
Version: 1.2.34
Revision: 1
BuildDepends: html2text
Depends: dialog
Type: perl
Source: mirror:debian:/pool/main/d/debconf/%n_%v.tar.gz
Source-MD5: 
#SourceRename: %n-%v.tar.gz
SourceDirectory: %n
PatchScript: sed 's|@FINKPREFIX@|%p|' < %a/%f.patch | patch -p1
TarFilesRename: debconf/debconf$:debconf/debconf.tmp
UpdatePOD: true
CompileScript: <<
#!/bin/sh

# Openjade crap is broken...
cd doc
make manpages
cd ..
make -C po

<<

InstallScript: <<
  mkdir -p %i/etc/apt/apt.conf.d
  install -m 0644 debian/apt.conf %i/etc/apt/apt.conf.d/70debconf
  make install prefix=%i
  make install-utils prefix=%i
  make install-rest prefix=%i
  mv doc/man/Debconf::Client::ConfModule.3pm doc/man/Debconf::Client::ConfModule.3

# Ok, move debconf to it's correct name

  mv %i/bin/debconf.tmp %i/bin/debconf

# Install docs manually...

  mkdir -p %i/share/doc/%n  
  rm -rf samples/CVS
  mv samples %i/share/doc/%n/

  mkdir -p %i/share/man/man1
  mv %b/doc/man/gen/*.1 %i/share/man/man1

  mkdir -p %i/share/man/man3
  mv %b/doc/man/*.3 %i/share/man/man3

  mkdir -p %i/share/man/man8
  mv %b/doc/man/*.8 %i/share/man/man8

  mkdir -p %i/share/man/man7
  mv %b/doc/man/*.7 %i/share/man/man7

  mkdir -p %i/share/podfiles
  mv %b/doc/man/*.pod %i/share/podfiles

  mkdir -p %d/DEBIAN
  cp debian/config debian/templates %d/DEBIAN
<<
# Fix up broken db's before debconf starts up.
PostInstScript: <<
#!/bin/sh -e

# configdb splits into passworded and non-passworded parts, before debconf
# starts up. Do so only if the debconf.conf has the new databases in it.
if [ -z "$DEBIAN_HAS_FRONTEND" -a "$1" = configure -a -n "$2" ] && \
   dpkg --compare-versions "$2" lt 1.1.0 &&
   perl -e 'use Debconf::Db; Debconf::Db->load; for (@ARGV) { exit 1 unless
            Debconf::DbDriver->driver($_) }' config passwords; then
        # copies in only the passwords, of course
        debconf-copydb config passwords
        # makes a new config with only non-passwords in it
        debconf-copydb config newconfig \
                -c Name:newconfig \
                -c Driver:File \
                -c Reject-Type:password \
                -c Filename:%p/var/cache/debconf/newconfig.dat \
                -c Mode:644
        mv -f %p/var/cache/debconf/newconfig.dat %p/var/cache/debconf/config.dat
fi

. %p/share/debconf/confmodule
<<

DocFiles: doc/COPYRIGHT doc/EXAMPLES doc/README.LDAP doc/CREDITS doc/Makefile doc/README.translators doc/CREDITS doc/Makefile doc/README.translators doc/README doc/TODO doc/debconf.schema doc/passthrough.txt doc/graph.pl doc/tutorial.xml doc/html.dsl doc/namespace.txt
Description: Package configuration management system
DescDetail: <<
Debconf is a configuration management system for debian/fink packages. Packages use Debconf to ask questions when they are installed.
<<
License: GPL
Maintainer: Chris Zubrzycki <beren12@users.sourceforge.net>
Homepage: http://packages.debian.org/unstable/admin/debconf.html
