Binary files cdrdao-1.1.5.orig/scsilib/.DS_Store and cdrdao-1.1.5/scsilib/.DS_Store differ
diff -ruN cdrdao-1.1.5.orig/scsilib/.clean cdrdao-1.1.5/scsilib/.clean
--- cdrdao-1.1.5.orig/scsilib/.clean	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/.clean	2000-07-20 12:24:51.000000000 -0400
@@ -0,0 +1,8 @@
+#!/bin/sh
+rm -rf */OBJ */*/OBJ libs/* incs/*
+rm -f core */core */*/core
+rm -f .EDT* */.EDT* */*/.EDT*
+rm -f .vedt* */.vedt* */*/.vedt*
+rm -f *.bak */*.bak */*/*.bak
+rm -f */tags */*/tags
+rm -f */TAGS */*/TAGS
diff -ruN cdrdao-1.1.5.orig/scsilib/DEFAULTS/Defaults.amigaos cdrdao-1.1.5/scsilib/DEFAULTS/Defaults.amigaos
--- cdrdao-1.1.5.orig/scsilib/DEFAULTS/Defaults.amigaos	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/DEFAULTS/Defaults.amigaos	2001-11-27 15:29:05.000000000 -0500
@@ -0,0 +1,38 @@
+#ident "%W% %E% %Q%"
+###########################################################################
+#
+# global definitions for AmigaOS Systems using CC=gcc
+#
+###########################################################################
+#
+# Compiler stuff
+#
+###########################################################################
+#DEFCCOM=	cc
+DEFCCOM=	gcc
+###########################################################################
+#
+# If the next line is commented out, compilattion is done with max warn level
+# If the next line is uncommented, compilattion is done with minimal warnings
+#
+###########################################################################
+CWARNOPTS=
+
+DEFINCDIRS=	$(SRCROOT)/include
+LDPATH=		-L/opt/schily/lib
+RUNPATH=	-R $(INS_BASE)/lib -R /opt/schily/lib -R $(OLIBSDIR)
+
+###########################################################################
+#
+# Installation config stuff
+#
+###########################################################################
+INS_BASE=	/opt/schily
+INS_KBASE=	/
+#
+DEFUMASK=	002
+#
+DEFINSMODEF=	444
+DEFINSMODEX=	755
+DEFINSUSR=	bin
+DEFINSGRP=	bin
diff -ruN cdrdao-1.1.5.orig/scsilib/DEFAULTS/Defaults.qnx cdrdao-1.1.5/scsilib/DEFAULTS/Defaults.qnx
--- cdrdao-1.1.5.orig/scsilib/DEFAULTS/Defaults.qnx	2001-04-29 04:44:44.000000000 -0400
+++ cdrdao-1.1.5/scsilib/DEFAULTS/Defaults.qnx	2001-11-11 08:09:04.000000000 -0500
@@ -7,9 +7,12 @@
 #
 # Compiler stuff
 #
+# When QNX support started in december 1999, there was only the watcom
+# C-compler (cc). Now, in novemver 2001 we switch to gcc.
+#
 ###########################################################################
-DEFCCOM=	cc
-#DEFCCOM=	gcc
+#DEFCCOM=	cc
+DEFCCOM=	gcc
 ###########################################################################
 #
 # If the next line is commented out, compilattion is done with max warn level
diff -ruN cdrdao-1.1.5.orig/scsilib/DEFAULTS_ENG/Defaults.amigaos cdrdao-1.1.5/scsilib/DEFAULTS_ENG/Defaults.amigaos
--- cdrdao-1.1.5.orig/scsilib/DEFAULTS_ENG/Defaults.amigaos	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/DEFAULTS_ENG/Defaults.amigaos	2001-11-27 15:29:35.000000000 -0500
@@ -0,0 +1,40 @@
+#ident "%W% %E% %Q%"
+###########################################################################
+#
+# global definitions for AmigaOS Systems using CC=gcc
+#
+###########################################################################
+#
+# Compiler stuff
+#
+###########################################################################
+#DEFCCOM=	cc
+DEFCCOM=	gcc
+###########################################################################
+#
+# If the next line is commented out, compilattion is done with max warn level
+# If the next line is uncommented, compilattion is done with minimal warnings
+#
+###########################################################################
+#CWARNOPTS=
+
+DEFINCDIRS=	$(SRCROOT)/include
+LDPATH=		-L/opt/schily/lib
+RUNPATH=	-R $(INS_BASE)/lib -R /opt/schily/lib -R $(OLIBSDIR)
+
+###########################################################################
+#
+# Installation config stuff
+#
+###########################################################################
+#INS_BASE=	/opt/schily
+#INS_KBASE=	/
+INS_BASE=	/tmp/schily
+INS_KBASE=	/tmp/schily/root
+#
+DEFUMASK=	002
+#
+DEFINSMODEF=	444
+DEFINSMODEX=	755
+DEFINSUSR=	bin
+DEFINSGRP=	bin
diff -ruN cdrdao-1.1.5.orig/scsilib/DEFAULTS_ENG/Defaults.qnx cdrdao-1.1.5/scsilib/DEFAULTS_ENG/Defaults.qnx
--- cdrdao-1.1.5.orig/scsilib/DEFAULTS_ENG/Defaults.qnx	2001-04-29 04:44:44.000000000 -0400
+++ cdrdao-1.1.5/scsilib/DEFAULTS_ENG/Defaults.qnx	2001-11-11 08:09:30.000000000 -0500
@@ -7,9 +7,12 @@
 #
 # Compiler stuff
 #
+# When QNX support started in december 1999, there was only the watcom
+# C-compler (cc). Now, in novemver 2001 we switch to gcc.
+#
 ###########################################################################
-DEFCCOM=	cc
-#DEFCCOM=	gcc
+#DEFCCOM=	cc
+DEFCCOM=	gcc
 ###########################################################################
 #
 # If the next line is commented out, compilattion is done with max warn level
diff -ruN cdrdao-1.1.5.orig/scsilib/PORTING cdrdao-1.1.5/scsilib/PORTING
--- cdrdao-1.1.5.orig/scsilib/PORTING	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/PORTING	2001-04-13 16:40:32.000000000 -0400
@@ -0,0 +1,142 @@
+Porting FAQ for SING (Schily Is Not Gnu) utilities.
+
+-	The base for porting is the makefile system.
+	Always look into:
+		ftp://ftp.fokus.gmd.de/pub/unix/makefiles
+	for a version that might be newer than the one used
+	inside the program that should be ported.
+
+	If you want to know more about the makefile system,
+	read the man pages makefiles4 and makerules.4,
+	they are located in man/man4/*
+
+		to convert a manpage troff->postscript use:
+			gtroff -man file.tr | grops > file.ps
+
+		to convert a manpage troff->Terminal use:
+			nroff -man file.tr | more -s
+
+
+-	To be able to use the makefile system, you need a
+	make program that meets the minimum requirements 
+	for a make program (see makerules(4) man page)
+	Currently, the following make programs meet this
+	minimum requirements: Smake (my program), SunPro Make and Gmake
+
+	A good idea is to first compile 'smake' if you don't
+	have it already.
+
+	The smake source can be found on:
+
+		ftp://fokus.gmd.de/pub/unix/smake/
+	or
+		ftp://fokus.gmd.de/pub/unix/smake/alpha
+
+	for the most recent version.
+
+-	To be able to use the makefile system with gmake,
+	the operating system must have a command named 'uname'.
+	If not, you have to provide it as a shell script.
+
+
+1)	If you are using smake release 1.1 or newer and 
+	a recent makefile system, the next step should be done
+	automagically (smake-1.1 or newer implement a -version
+	option to retrieve the version number).
+
+	If you are using gmake, you need to do this by hand.
+
+	First step for adding a new architecture is creating
+	the appropriate rule files in the RULES directory:
+
+		RULES/os-{newos}.id	For OS identification
+		RULES/os-{newos}.def	For OS definition (man style)
+		RULES/{newarch}-{newos}-cc.rul
+		RULES/{newarch}-{newos}-gcc.rul
+
+	And create a file:
+
+		DEFAULTS/Defaults.{newos}
+
+	Have a look in similar files for a template.
+
+	If the files hae been generated automagically by smake,
+	please check the content and mail me a working set for your OS.
+
+2)	All C-porting control is located in include/mconfig.h
+	and in the file incs/{newarch}-{newos}-{cc!gcc}/xconfig.h
+	The later file is created automatically using GNU 
+	configure. The File conf/xconfig.h.in contains all
+	templates and comments for the various things that are tested.
+
+	In any case, it is recommended to carefully watch the
+	outout from the 'configure' run (which is automatically
+	started from within 'make'). You may also wish to check all
+	files that are created in the directory 
+	incs/{newarch}-{newos}-{cc!gcc}/
+
+3)	Everything should compile now.
+	If not, try to hack the files and mail me your problems.
+
+	You should have a closer look at the sources as it may be that
+	the first attempt to port a utility will not support
+	all possible features of the new OS.
+	If your OS supportes these features in a non standard way,
+	you need to hack conf/configure.in and the source and add 
+	support for the non standard behaviour of your OS.
+
+	This is definitely recommended if you want to port programs 
+	like 'cdrecord' 'star' and similar which need fork(2) and
+	mmap(2) or setprioriry(2) or if you check programs on
+	non POSIX operating systems like W95/W98/WNT OS/2 and
+	similar.
+
+
+Notice for porting tools, that use the SCSI library libscg:
+
+I)	Cdrecord should compile at this moment if you are using
+	a new architecture. The SCSI transport however will not work.
+	Check this!
+
+	All files that contain low level code for SCSI transport are 
+	located in the directory libscg/
+
+II)	Implementing a SCSI Transport Layer for your architecture:
+
+	You need to add a new block into scsihack.c that will add
+	support for your OS. Copy the block:
+
+	#ifdef  __NEW_ARCHITECTURE
+	#define SCSI_IMPL               /* We have a SCSI implementation for XXX */
+	/*
+	 * Add new hacks here
+	 */
+	#include "scsi-new-arch.c"
+	#endif
+
+	and rename __NEW_ARCHITECTURE to reflect your new architecture.
+
+	Add a new file that will be called scsi-{newarch}.c
+	Have a look into scsi-linux-sg.c for a template how to do this.
+
+	More hints for writing the needed SCSI low level transport functions
+	is in:
+
+		ftp://fokus.gmd.de/pub/unix/cdrecord/README.scsi-IF
+
+4)	Test your ported program.
+
+5)	You may check other programs from me to see if everything compiles
+	and works.
+
+6)	Send me your changes
+
+Joerg Schilling
+
+schilling@fokus.gmd.de
+joerg@schily.isdn.cs.tu-berlin.de
+js@cs.tu-berlin.de
+
+
+
+
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/MKLINKS cdrdao-1.1.5/scsilib/RULES/MKLINKS
--- cdrdao-1.1.5.orig/scsilib/RULES/MKLINKS	2001-04-29 04:44:44.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/MKLINKS	2002-04-29 06:35:02.000000000 -0400
@@ -1,6 +1,6 @@
 #!/bin/sh
 ###########################################################################
-#ident "@(#)MKLINKS	1.37 01/03/17 "
+#ident "@(#)MKLINKS	1.43 02/04/29 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -45,11 +45,13 @@
 ln -s	hppa-nextstep-cc.rul	m68k-nextstep-gcc.rul
 ln -s	hppa-nextstep-cc.rul	sparc-nextstep-gcc.rul
 ln -s	os-irix.id		os-irix64.id
+ln -s	ip22-irix-cc.rul	ip17-irix-cc.rul
 ln -s	ip22-irix-cc.rul	ip20-irix-cc.rul
 ln -s	ip22-irix-cc.rul	ip27-irix-cc.rul
 ln -s	ip22-irix-cc.rul	ip28-irix-cc.rul
 ln -s	ip22-irix-cc.rul	ip30-irix-cc.rul
 ln -s	ip22-irix-cc.rul	ip32-irix-cc.rul
+ln -s	ip22-irix-gcc.rul	ip17-irix-gcc.rul
 ln -s	ip22-irix-gcc.rul	ip20-irix-gcc.rul
 ln -s	ip22-irix-gcc.rul	ip27-irix-gcc.rul
 ln -s	ip22-irix-gcc.rul	ip28-irix-gcc.rul
@@ -86,20 +88,28 @@
 ln -s	i586-linux-gcc.rul	mips-linux-gcc.rul
 ln -s	i586-linux-cc.rul	mipsel-linux-cc.rul
 ln -s	i586-linux-gcc.rul	mipsel-linux-gcc.rul
+ln -s	i586-linux-cc.rul	s390-linux-cc.rul
+ln -s	i586-linux-gcc.rul	s390-linux-gcc.rul
+ln -s	i586-linux-cc.rul	parisc-linux-cc.rul
+ln -s	i586-linux-gcc.rul	parisc-linux-gcc.rul
+ln -s	i586-linux-cc.rul	parisc64-linux-cc.rul
+ln -s	i586-linux-gcc.rul	parisc64-linux-gcc.rul
+ln -s	i586-linux-cc.rul	ia64-linux-cc.rul
+ln -s	i586-linux-gcc.rul	ia64-linux-gcc.rul
 ln -s	os-cygwin32_nt.id	os-cygwin_95-4.0.id
 ln -s	os-cygwin32_nt.id	os-cygwin_98-4.0.id
 ln -s	os-cygwin32_nt.id	os-cygwin_98-4.10.id
 ln -s	os-cygwin32_nt.id	os-cygwin_me-4.90.id 
-ln -s	os-cygwin32_nt.id	os-cygwin_nt-5.0.id
 ln -s	os-cygwin32_nt.id	os-cygwin_nt-4.0.id
+ln -s	os-cygwin32_nt.id	os-cygwin_nt-5.0.id
+ln -s	os-cygwin32_nt.id	os-cygwin_nt-5.1.id
+ln -s	os-unixware.id		os-openunix.id
 ln -s	i486-cygwin32_nt-cc.rul	i586-cygwin32_nt-cc.rul
 ln -s	i486-cygwin32_nt-cc.rul	i686-cygwin32_nt-cc.rul
 ln -s	i486-cygwin32_nt-gcc.rul	i586-cygwin32_nt-gcc.rul
 ln -s	i486-cygwin32_nt-gcc.rul	i686-cygwin32_nt-gcc.rul
 ln -s	power-macintosh-rhapsody-cc.rul	power-macintosh-mac-os10-cc.rul
 ln -s	power-macintosh-rhapsody-gcc.rul	power-macintosh-mac-os10-gcc.rul
-ln -s	power-macintosh-rhapsody-cc.rul		power-macintosh-darwin-cc.rul
-ln -s	power-macintosh-rhapsody-gcc.rul	power-macintosh-darwin-gcc.rul
 ln -s	sun4-sunos4-cc.rul	sun4c-sunos4-cc.rul
 ln -s	sun4-sunos4-gcc.rul	sun4c-sunos4-gcc.rul
 ln -s	sun4-sunos5-cc.rul	sun4c-sunos5-cc.rul
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/alpha-osf1-cc.rul cdrdao-1.1.5/scsilib/RULES/alpha-osf1-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/alpha-osf1-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/alpha-osf1-cc.rul	2001-09-27 11:23:47.000000000 -0400
@@ -1,4 +1,4 @@
-#ident "@(#)alpha-osf1-cc.rul	1.2 99/08/29 "
+#ident "@(#)alpha-osf1-cc.rul	1.3 01/09/27 "
 ###########################################################################
 # Written 1998 by J. Schilling
 ###########################################################################
@@ -28,8 +28,7 @@
 
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
-CWOPTS=		-Wall -Wtraditional \
-		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+CWOPTS=		
 COPTOPT=	-O
 KDEFINES=	-DKERNEL -D_KERNEL
 COPTDYN=	-fpic
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/bemac-beos-cc.rul cdrdao-1.1.5/scsilib/RULES/bemac-beos-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/bemac-beos-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/bemac-beos-cc.rul	2001-11-26 17:54:17.000000000 -0500
@@ -1,4 +1,4 @@
-#ident @(#)bemac-beos-cc.rul	1.2 01/02/25 
+#ident @(#)bemac-beos-cc.rul	1.3 01/11/26 
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -27,10 +27,13 @@
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
 #
-# XXX -DNO_FLOATINGPOINT use the printf() stuff of libroot.so
-# XXX In order to do so, disable the (f,s)printf() code in libschily.
+# XXX Old BeOS needs libroot.so to get [efg]cvt()
+# XXX New BeOS seems to have this in libc and in addition we include
+# XXX strtod.c for floating point conversion on OS without such code.
+# XXX For this reason, -DNO_FLOATINGPOINT -DUSE_FLOATINGARGS has been
+# XXX removed and printing floating numbers will work with old/new BeOS
 #
-OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
+#OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
 
 CPPOPTS=	-O4 -g -i- -I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/bemac-beos-mwcc.rul cdrdao-1.1.5/scsilib/RULES/bemac-beos-mwcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/bemac-beos-mwcc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/bemac-beos-mwcc.rul	2001-11-26 17:54:17.000000000 -0500
@@ -1,4 +1,4 @@
-#ident @(#)bemac-beos-mwcc.rul	1.2 01/02/25 
+#ident @(#)bemac-beos-mwcc.rul	1.3 01/11/26 
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -27,10 +27,13 @@
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
 #
-# XXX -DNO_FLOATINGPOINT use the printf() stuff of libroot.so
-# XXX In order to do so, disable the (f,s)printf() code in libschily.
+# XXX Old BeOS needs libroot.so to get [efg]cvt()
+# XXX New BeOS seems to have this in libc and in addition we include
+# XXX strtod.c for floating point conversion on OS without such code.
+# XXX For this reason, -DNO_FLOATINGPOINT -DUSE_FLOATINGARGS has been
+# XXX removed and printing floating numbers will work with old/new BeOS
 #
-OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
+#OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
 
 CPPOPTS=	-relax_pointers -opt all -sym on -g -i- -I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/bepc-beos-cc.rul cdrdao-1.1.5/scsilib/RULES/bepc-beos-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/bepc-beos-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/bepc-beos-cc.rul	2001-11-26 17:54:17.000000000 -0500
@@ -1,4 +1,4 @@
-#ident @(#)bepc-beos-gcc.rul	1.2 99/08/29 
+#ident @(#)bepc-beos-cc.rul	1.2 01/11/26 
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -27,10 +27,13 @@
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
 #
-# XXX -DNO_FLOATINGPOINT use the printf() stuff of libroot.so
-# XXX In order to do so, disable the (f,s)printf() code in libschily.
+# XXX Old BeOS needs libroot.so to get [efg]cvt()
+# XXX New BeOS seems to have this in libc and in addition we include
+# XXX strtod.c for floating point conversion on OS without such code.
+# XXX For this reason, -DNO_FLOATINGPOINT -DUSE_FLOATINGARGS has been
+# XXX removed and printing floating numbers will work with old/new BeOS
 #
-OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
+#OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
 
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/bepc-beos-gcc.rul cdrdao-1.1.5/scsilib/RULES/bepc-beos-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/bepc-beos-gcc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/bepc-beos-gcc.rul	2001-11-26 17:54:17.000000000 -0500
@@ -1,4 +1,4 @@
-#ident @(#)bepc-beos-gcc.rul	1.2 99/08/29 
+#ident @(#)bepc-beos-gcc.rul	1.3 01/11/26 
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -27,9 +27,13 @@
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
 #
-# XXX -DNO_FLOATINGPOINT until printf() stuff has been fixed
+# XXX Old BeOS needs libroot.so to get [efg]cvt()
+# XXX New BeOS seems to have this in libc and in addition we include
+# XXX strtod.c for floating point conversion on OS without such code.
+# XXX For this reason, -DNO_FLOATINGPOINT -DUSE_FLOATINGARGS has been
+# XXX removed and printing floating numbers will work with old/new BeOS
 #
-OSDEFS +=	-DNO_FLOATINGPOINT
+#OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
 
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ia64-linux-cc.rul cdrdao-1.1.5/scsilib/RULES/ia64-linux-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ia64-linux-cc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/ia64-linux-cc.rul	1999-08-29 10:09:57.000000000 -0400
@@ -0,0 +1,70 @@
+#ident "@(#)i586-linux-cc.rul	1.4 99/08/29 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Linux
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ia64-linux-gcc.rul cdrdao-1.1.5/scsilib/RULES/ia64-linux-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ia64-linux-gcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/ia64-linux-gcc.rul	1999-08-29 10:09:57.000000000 -0400
@@ -0,0 +1,70 @@
+#ident "@(#)i586-linux-gcc.rul	1.4 99/08/29 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Linux
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ip17-irix-cc.rul cdrdao-1.1.5/scsilib/RULES/ip17-irix-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ip17-irix-cc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/ip17-irix-cc.rul	2001-12-09 10:52:31.000000000 -0500
@@ -0,0 +1,71 @@
+#ident "@(#)ip22-irix-cc.rul	1.5 01/12/09 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Silicon Graphics IRIX
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+OSDEFS=		-D__SVR4 -DSVR4 $(LARGEFILE_OPT)
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-fullwarn
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-Kpic
+COPTGPROF=	-p1
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1
+
+LIB_SOCKET=	
+LIB_MATH=	-lm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) $(LARGEFILE_OPT)
+#LDOPTDYN=	-dy -G -ztext -h $(TARGET) -ldl
+LNDYNLIB=	@
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; cc
+LDCC=		@echo "	==> LINKING \"$@\""; cc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; cc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	crs
+#
+# lorder seems not to work on some machines, disable it
+#
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); cc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ip17-irix-gcc.rul cdrdao-1.1.5/scsilib/RULES/ip17-irix-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ip17-irix-gcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/ip17-irix-gcc.rul	2001-01-06 10:50:18.000000000 -0500
@@ -0,0 +1,72 @@
+#ident "@(#)ip22-irix-gcc.rul	1.5 01/01/06 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Silicon Graphics IRIX
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+OSDEFS=		-D__SVR4 -DSVR4
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1
+
+LIB_SOCKET=	
+LIB_MATH=	-lm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+#LDOPTDYN=	-dy -G -ztext -h $(TARGET) -ldl
+LNDYNLIB=	@
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	crs
+#
+# lorder seems not to work on some machines, disable it
+#
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ip20-irix-cc.rul cdrdao-1.1.5/scsilib/RULES/ip20-irix-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ip20-irix-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/ip20-irix-cc.rul	2001-12-09 10:52:31.000000000 -0500
@@ -1,4 +1,4 @@
-#ident "@(#)ip22-irix-cc.rul	1.4 99/08/29 "
+#ident "@(#)ip22-irix-cc.rul	1.5 01/12/09 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -26,7 +26,7 @@
 CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
-OSDEFS=		-D__SVR4 -DSVR4
+OSDEFS=		-D__SVR4 -DSVR4 $(LARGEFILE_OPT)
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
 CWOPTS=		-fullwarn
@@ -49,7 +49,7 @@
 LDLIBS=		$(LIBS) $(LIBX)
 
 #LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
-LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) $(LARGEFILE_OPT)
 #LDOPTDYN=	-dy -G -ztext -h $(TARGET) -ldl
 LNDYNLIB=	@
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ip22-irix-cc.rul cdrdao-1.1.5/scsilib/RULES/ip22-irix-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ip22-irix-cc.rul	2001-04-29 04:44:44.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/ip22-irix-cc.rul	2001-12-09 10:52:31.000000000 -0500
@@ -1,4 +1,4 @@
-#ident "@(#)ip22-irix-cc.rul	1.4 99/08/29 "
+#ident "@(#)ip22-irix-cc.rul	1.5 01/12/09 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -26,7 +26,7 @@
 CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
-OSDEFS=		-D__SVR4 -DSVR4
+OSDEFS=		-D__SVR4 -DSVR4 $(LARGEFILE_OPT)
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
 CWOPTS=		-fullwarn
@@ -49,7 +49,7 @@
 LDLIBS=		$(LIBS) $(LIBX)
 
 #LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
-LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) $(LARGEFILE_OPT)
 #LDOPTDYN=	-dy -G -ztext -h $(TARGET) -ldl
 LNDYNLIB=	@
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ip27-irix-cc.rul cdrdao-1.1.5/scsilib/RULES/ip27-irix-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ip27-irix-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/ip27-irix-cc.rul	2001-12-09 10:52:31.000000000 -0500
@@ -1,4 +1,4 @@
-#ident "@(#)ip22-irix-cc.rul	1.4 99/08/29 "
+#ident "@(#)ip22-irix-cc.rul	1.5 01/12/09 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -26,7 +26,7 @@
 CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
-OSDEFS=		-D__SVR4 -DSVR4
+OSDEFS=		-D__SVR4 -DSVR4 $(LARGEFILE_OPT)
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
 CWOPTS=		-fullwarn
@@ -49,7 +49,7 @@
 LDLIBS=		$(LIBS) $(LIBX)
 
 #LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
-LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) $(LARGEFILE_OPT)
 #LDOPTDYN=	-dy -G -ztext -h $(TARGET) -ldl
 LNDYNLIB=	@
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ip28-irix-cc.rul cdrdao-1.1.5/scsilib/RULES/ip28-irix-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ip28-irix-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/ip28-irix-cc.rul	2001-12-09 10:52:31.000000000 -0500
@@ -1,4 +1,4 @@
-#ident "@(#)ip22-irix-cc.rul	1.4 99/08/29 "
+#ident "@(#)ip22-irix-cc.rul	1.5 01/12/09 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -26,7 +26,7 @@
 CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
-OSDEFS=		-D__SVR4 -DSVR4
+OSDEFS=		-D__SVR4 -DSVR4 $(LARGEFILE_OPT)
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
 CWOPTS=		-fullwarn
@@ -49,7 +49,7 @@
 LDLIBS=		$(LIBS) $(LIBX)
 
 #LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
-LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) $(LARGEFILE_OPT)
 #LDOPTDYN=	-dy -G -ztext -h $(TARGET) -ldl
 LNDYNLIB=	@
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ip30-irix-cc.rul cdrdao-1.1.5/scsilib/RULES/ip30-irix-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ip30-irix-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/ip30-irix-cc.rul	2001-12-09 10:52:31.000000000 -0500
@@ -1,4 +1,4 @@
-#ident "@(#)ip22-irix-cc.rul	1.4 99/08/29 "
+#ident "@(#)ip22-irix-cc.rul	1.5 01/12/09 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -26,7 +26,7 @@
 CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
-OSDEFS=		-D__SVR4 -DSVR4
+OSDEFS=		-D__SVR4 -DSVR4 $(LARGEFILE_OPT)
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
 CWOPTS=		-fullwarn
@@ -49,7 +49,7 @@
 LDLIBS=		$(LIBS) $(LIBX)
 
 #LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
-LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) $(LARGEFILE_OPT)
 #LDOPTDYN=	-dy -G -ztext -h $(TARGET) -ldl
 LNDYNLIB=	@
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/ip32-irix-cc.rul cdrdao-1.1.5/scsilib/RULES/ip32-irix-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/ip32-irix-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/ip32-irix-cc.rul	2001-12-09 10:52:31.000000000 -0500
@@ -1,4 +1,4 @@
-#ident "@(#)ip22-irix-cc.rul	1.4 99/08/29 "
+#ident "@(#)ip22-irix-cc.rul	1.5 01/12/09 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -26,7 +26,7 @@
 CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
-OSDEFS=		-D__SVR4 -DSVR4
+OSDEFS=		-D__SVR4 -DSVR4 $(LARGEFILE_OPT)
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
 CWOPTS=		-fullwarn
@@ -49,7 +49,7 @@
 LDLIBS=		$(LIBS) $(LIBX)
 
 #LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
-LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) $(LARGEFILE_OPT)
 #LDOPTDYN=	-dy -G -ztext -h $(TARGET) -ldl
 LNDYNLIB=	@
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/m68k-amigaos-gcc.rul cdrdao-1.1.5/scsilib/RULES/m68k-amigaos-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/m68k-amigaos-gcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/m68k-amigaos-gcc.rul	2001-11-28 12:02:05.000000000 -0500
@@ -0,0 +1,70 @@
+#ident "@(#)m68k-amigaos-gcc.rul	1.1 01/11/28 "
+###########################################################################
+# Written 1997,2001 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for AmigaOS GCC systems
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; ranlib
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/os-amigaos.def cdrdao-1.1.5/scsilib/RULES/os-amigaos.def
--- cdrdao-1.1.5.orig/scsilib/RULES/os-amigaos.def	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/os-amigaos.def	2001-11-28 12:00:43.000000000 -0500
@@ -0,0 +1,23 @@
+#ident "@(#)os-amigaos.def	1.1 01/11/28 "
+###########################################################################
+# Written 2001 by J. Schilling
+###########################################################################
+#
+# Global os definitions for AmigaOS
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+MANSTYLE=	bsd
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/os-amigaos.id cdrdao-1.1.5/scsilib/RULES/os-amigaos.id
--- cdrdao-1.1.5.orig/scsilib/RULES/os-amigaos.id	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/os-amigaos.id	2001-11-28 12:00:43.000000000 -0500
@@ -0,0 +1,24 @@
+#ident "@(#)os-amigaos.id	1.1 01/11/28 "
+###########################################################################
+# Written 2001 by J. Schilling
+###########################################################################
+#
+# OS specific MACRO definitions for AmigaOS
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+O_ARCH=		amigaos
+-O_ARCH=	-$(O_ARCH)
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/os-cygwin_nt-5.1.id cdrdao-1.1.5/scsilib/RULES/os-cygwin_nt-5.1.id
--- cdrdao-1.1.5.orig/scsilib/RULES/os-cygwin_nt-5.1.id	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/os-cygwin_nt-5.1.id	1998-08-18 04:30:38.000000000 -0400
@@ -0,0 +1,24 @@
+#ident "@(#)os-cygwin32_nt.id	1.1 98/08/18 "
+###########################################################################
+# Written 1997 by J. Schilling
+###########################################################################
+#
+# OS specific MACRO definitions for Cygnus GCC for MS Windows NT
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+O_ARCH=		cygwin32_nt
+-O_ARCH=	-$(O_ARCH)
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/os-openunix.id cdrdao-1.1.5/scsilib/RULES/os-openunix.id
--- cdrdao-1.1.5.orig/scsilib/RULES/os-openunix.id	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/os-openunix.id	2000-01-23 08:10:49.000000000 -0500
@@ -0,0 +1,24 @@
+#ident "@(#)os-unixware.id	1.1 00/01/23 "
+###########################################################################
+# Written 2000 by J. Schilling/Santa Cruz Operation
+###########################################################################
+#
+# OS specific MACRO definitions for UnixWare 7
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+O_ARCH=		unixware
+-O_ARCH=	-$(O_ARCH)
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/parisc-linux-cc.rul cdrdao-1.1.5/scsilib/RULES/parisc-linux-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/parisc-linux-cc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/parisc-linux-cc.rul	1999-08-29 10:09:57.000000000 -0400
@@ -0,0 +1,70 @@
+#ident "@(#)i586-linux-cc.rul	1.4 99/08/29 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Linux
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/parisc-linux-gcc.rul cdrdao-1.1.5/scsilib/RULES/parisc-linux-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/parisc-linux-gcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/parisc-linux-gcc.rul	1999-08-29 10:09:57.000000000 -0400
@@ -0,0 +1,70 @@
+#ident "@(#)i586-linux-gcc.rul	1.4 99/08/29 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Linux
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/parisc64-linux-cc.rul cdrdao-1.1.5/scsilib/RULES/parisc64-linux-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/parisc64-linux-cc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/parisc64-linux-cc.rul	1999-08-29 10:09:57.000000000 -0400
@@ -0,0 +1,70 @@
+#ident "@(#)i586-linux-cc.rul	1.4 99/08/29 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Linux
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/parisc64-linux-gcc.rul cdrdao-1.1.5/scsilib/RULES/parisc64-linux-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/parisc64-linux-gcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/parisc64-linux-gcc.rul	1999-08-29 10:09:57.000000000 -0400
@@ -0,0 +1,70 @@
+#ident "@(#)i586-linux-gcc.rul	1.4 99/08/29 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Linux
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/power-macintosh-darwin-cc.rul cdrdao-1.1.5/scsilib/RULES/power-macintosh-darwin-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/power-macintosh-darwin-cc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/power-macintosh-darwin-cc.rul	2001-10-24 18:50:00.000000000 -0400
@@ -1,9 +1,9 @@
-#ident "@(#)power-macintosh-rhapsody-cc.rul	1.5 00/05/05 "
+#ident "@(#)power-macintosh-darwin-cc.rul	1.6 01/10/25 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
 #
-# Platform dependent MACROS for NeXT Step 4.x (Apple Rhapsody) PPC (GCC)
+# Platform dependent MACROS for Darwin-1.2 ff. (Apple MacOS X) PPC (GCC)
 #
 ###########################################################################
 # This program is free software; you can redistribute it and/or modify
@@ -49,7 +49,7 @@
 LDLIBS=		$(LIBS) $(LIBX)
 
 #LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
-LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) -framework IOKit -framework CoreFoundation
 LDOPTDYN=
 LNDYNLIB=	@
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/power-macintosh-darwin-gcc.rul cdrdao-1.1.5/scsilib/RULES/power-macintosh-darwin-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/power-macintosh-darwin-gcc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/power-macintosh-darwin-gcc.rul	2001-10-24 18:50:00.000000000 -0400
@@ -1,9 +1,9 @@
-#ident "@(#)power-macintosh-rhapsody-gcc.rul	1.5 00/05/05 "
+#ident "@(#)power-macintosh-darwin-gcc.rul	1.6 01/10/25 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
 #
-# Platform dependent MACROS for NeXT Step 4.x (Apple Rhapsody) PPC (GCC)
+# Platform dependent MACROS for Darwin-1.2 ff. (Apple MacOS X) PPC (GCC)
 #
 ###########################################################################
 # This program is free software; you can redistribute it and/or modify
@@ -49,7 +49,7 @@
 LDLIBS=		$(LIBS) $(LIBX)
 
 #LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
-LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH) -framework IOKit -framework CoreFoundation
 LDOPTDYN=
 LNDYNLIB=	@
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/powerpc-beos-gcc.rul cdrdao-1.1.5/scsilib/RULES/powerpc-beos-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/powerpc-beos-gcc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/powerpc-beos-gcc.rul	2001-11-26 17:54:17.000000000 -0500
@@ -1,4 +1,4 @@
-#ident @(#)powerpc-beos-gcc.rul	1.1 99/3/05 
+#ident "@(#)powerpc-beos-gcc.rul	1.2 01/11/26 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -27,9 +27,13 @@
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
 #
-# XXX -DNO_FLOATINGPOINT until printf() stuff has been fixed
+# XXX Old BeOS needs libroot.so to get [efg]cvt()
+# XXX New BeOS seems to have this in libc and in addition we include
+# XXX strtod.c for floating point conversion on OS without such code.
+# XXX For this reason, -DNO_FLOATINGPOINT -DUSE_FLOATINGARGS has been
+# XXX removed and printing floating numbers will work with old/new BeOS
 #
-OSDEFS +=	-DNO_FLOATINGPOINT
+#OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
 
 CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/powerpc-beos-mwcc.rul cdrdao-1.1.5/scsilib/RULES/powerpc-beos-mwcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/powerpc-beos-mwcc.rul	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/powerpc-beos-mwcc.rul	2001-11-26 17:54:17.000000000 -0500
@@ -1,4 +1,4 @@
-#ident "@(#)powerpc-beos-mwcc.rul	1.2 01/02/25 "
+#ident "@(#)powerpc-beos-mwcc.rul	1.3 01/11/26 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -26,10 +26,14 @@
 CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
 CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
 
+w#
+# XXX Old BeOS needs libroot.so to get [efg]cvt()
+# XXX New BeOS seems to have this in libc and in addition we include
+# XXX strtod.c for floating point conversion on OS without such code.
+# XXX For this reason, -DNO_FLOATINGPOINT -DUSE_FLOATINGARGS has been
+# XXX removed and printing floating numbers will work with old/new BeOS
 #
-# XXX -DNO_FLOATINGPOINT use the printf() stuff of libroot.so
-#
-OSDEFS +=	-DNO_FLOATINGPOINT
+#OSDEFS +=	-DNO_FLOATINGPOINT -DUSE_FLOATINGARGS
 
 CPPOPTS=	-relax_pointers -opt global -sym on -g -i- -I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
 COPTS=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/rules.cmd cdrdao-1.1.5/scsilib/RULES/rules.cmd
--- cdrdao-1.1.5.orig/scsilib/RULES/rules.cmd	2001-04-29 04:50:52.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/rules.cmd	2001-02-04 16:29:59.000000000 -0500
@@ -39,6 +39,6 @@
 include		$(SRCROOT)/$(RULESDIR)/rules.ins
 include		$(SRCROOT)/$(RULESDIR)/rules.tag
 include		$(SRCROOT)/$(RULESDIR)/rules.hlp
-#include		$(SRCROOT)/$(RULESDIR)/rules.cnf
+include		$(SRCROOT)/$(RULESDIR)/rules.cnf
 include		$(SRCROOT)/$(RULESDIR)/rules.dep
 ###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/rules.cnf cdrdao-1.1.5/scsilib/RULES/rules.cnf
--- cdrdao-1.1.5.orig/scsilib/RULES/rules.cnf	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/rules.cnf	2002-01-27 10:11:31.000000000 -0500
@@ -1,4 +1,4 @@
-#ident @(#)rules.cnf	1.6 01/02/25 
+#ident @(#)rules.cnf	1.7 02/01/27 
 ###########################################################################
 # Written 1998 by J. Schilling
 ###########################################################################
@@ -42,8 +42,6 @@
 
 #CONFFLAGS +=	-cc=$(XCCCOM)
 
-include		$(DEFLTSROOT)/$(DEFLTSDIR)/Defaults
-
 $(OINCSDIR)/rules.cnf $(OINCSDIR)/xconfig.h: $(OINCSDIR)/Inull \
 						$(SRCROOT)/conf/configure \
 						$(SRCROOT)/conf/rules.cnf.in \
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/rules.inc cdrdao-1.1.5/scsilib/RULES/rules.inc
--- cdrdao-1.1.5.orig/scsilib/RULES/rules.inc	2001-04-29 04:47:22.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/rules.inc	2000-03-19 11:16:43.000000000 -0500
@@ -43,6 +43,6 @@
 include		$(SRCROOT)/$(RULESDIR)/rules.ins
 include		$(SRCROOT)/$(RULESDIR)/rules.tag
 include		$(SRCROOT)/$(RULESDIR)/rules.hlp
-#include		$(SRCROOT)/$(RULESDIR)/rules.cnf
+include		$(SRCROOT)/$(RULESDIR)/rules.cnf
 include		$(SRCROOT)/$(RULESDIR)/rules.dep
 ###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/rules.lib cdrdao-1.1.5/scsilib/RULES/rules.lib
--- cdrdao-1.1.5.orig/scsilib/RULES/rules.lib	2001-04-29 04:49:41.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/rules.lib	2000-03-19 11:16:43.000000000 -0500
@@ -44,6 +44,6 @@
 include		$(SRCROOT)/$(RULESDIR)/rules.ins
 include		$(SRCROOT)/$(RULESDIR)/rules.tag
 include		$(SRCROOT)/$(RULESDIR)/rules.hlp
-#include		$(SRCROOT)/$(RULESDIR)/rules.cnf
+include		$(SRCROOT)/$(RULESDIR)/rules.cnf
 include		$(SRCROOT)/$(RULESDIR)/rules.dep
 ###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/rules.mks cdrdao-1.1.5/scsilib/RULES/rules.mks
--- cdrdao-1.1.5.orig/scsilib/RULES/rules.mks	2001-04-29 04:48:31.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/rules.mks	1998-09-20 19:17:49.000000000 -0400
@@ -35,5 +35,5 @@
 
 ###########################################################################
 include		$(SRCROOT)/$(RULESDIR)/rules.hlp
-#include		$(SRCROOT)/$(RULESDIR)/rules.cnf
+include		$(SRCROOT)/$(RULESDIR)/rules.cnf
 ###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/rules1.dir cdrdao-1.1.5/scsilib/RULES/rules1.dir
--- cdrdao-1.1.5.orig/scsilib/RULES/rules1.dir	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/rules1.dir	2001-05-02 18:04:19.000000000 -0400
@@ -1,4 +1,4 @@
-#ident @(#)rules1.dir	1.8 00/12/01 
+#ident %W% %E% %Q%
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -8,25 +8,13 @@
 # The code that is shared bwtween rules.dir and rules.rdi
 #
 ###########################################################################
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2, or (at your option)
-# any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; see the file COPYING.  If not, write to
-# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+#@@C@@
 ###########################################################################
 
 $(ALLTARGETS):
 	@list="$(DIRS)";							\
-	[ -d TARGETS -a -f TARGETS/15conf ] && 					\
-		list=`echo TARGETS/[0-9][0-9]* | sed -e 's;TARGETS/[0-9][0-9];;g'`;\
+	[ -d TARGETS -a -f TARGETS/__slot ] && 					\
+		list=`echo TARGETS/[0-9][0-9]* | sed -e 's;TARGETS/[0-9][0-9];;g' | sed -e 's;!@!;/;g'`;\
 	for DIR in $${list} ;							\
 	do									\
 		(								\
@@ -40,12 +28,12 @@
 	done
 
 tinfo:
-	@[ -d TARGETS -a -f TARGETS/15conf ] && list=`echo TARGETS/[0-9][0-9]*`;\
+	@[ -d TARGETS -a -f TARGETS/__slot ] && list=`echo TARGETS/[0-9][0-9]*`;\
 	for i in $${list};							\
 	do									\
 		(read line < $$i;						\
-		name=`echo $$i | sed -e 's;TARGETS/[0-9][0-9];;'`;		\
-		echo "$$name	- $${line}";					\
+		name=`echo $$i | sed -e 's;TARGETS/[0-9][0-9];;' | sed -e 's;!@!;/;g'`;		\
+		echo "$$name		- $${line}";					\
 		);								\
 	done
 
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/rules1.top cdrdao-1.1.5/scsilib/RULES/rules1.top
--- cdrdao-1.1.5.orig/scsilib/RULES/rules1.top	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/RULES/rules1.top	2002-01-27 16:59:10.000000000 -0500
@@ -1,4 +1,4 @@
-#ident "@(#)rules1.top	1.22 01/02/04 "
+#ident "@(#)rules1.top	1.23 02/01/27 "
 ###########################################################################
 # Written 1996 by J. Schilling
 ###########################################################################
@@ -32,6 +32,13 @@
 
 ###########################################################################
 #
+# Make sure this becomes the default target
+#
+###########################################################################
+all:
+
+###########################################################################
+#
 # Global handler for failed inludes
 #
 ###########################################################################
@@ -158,18 +165,13 @@
 
 ###########################################################################
 #
-# Build $(ARCHDIR) which occupies a central role in the whole
-# make file system. ARCHDIR is used as a sub directory name to keep
-# platform dependent files on different places.
+# Prepare come macros needed to build $(ARCHDIR)
 #
-# It is built from:
+# Build macros for:
 #	- processor type
 #	- operating system
 #	- compiler identification
 #
-# A possible name could be:
-#	mc68020-sunos4-cc
-#
 ###########################################################################
 KARCH_DEF=	$(K_ARCH)
 MARCH_DEF=	$(M_ARCH)
@@ -185,11 +187,51 @@
 __PARCH=	$(_PARCH:$(_UNIQ)=$(PARCH_DEF))
 PARCH=		$(__PARCH:$(_UNIQ)%=%)
 
+###########################################################################
+#
+# Now include the file $(SRCROOT)/incs/Dcc.$(PARCH)$(-O_ARCH) 
+# which is needed if the C-complier from the manual default configutration 
+# is not present on the current system. We try to use GCC as fallback
+# in this case.
+#
+# Due to a serious bug in SunPRO make we need to do some tricks to make
+# the following code working.
+# SunPRO make inconsistsently shortens rules that start with "./"
+# and thus will not find existing rules for a file to be included.
+# We use pattern matching macro expansions to consistently shorten the
+# name if it starts with "./".
+# Note that Thus bug has been reported to Sun in 1998 but Sun seems not
+# interested to fix the bug.
+#
+###########################################################################
+__DCC= $(SRCROOT)/incs/Dcc.$(PARCH)$(-O_ARCH)
+_DCC=  $(__DCC:./%=%)
+
+$(_DCC):
+	sh $(SRCROOT)/conf/cc-config.sh $(C_ARCH) $@
+
+include		$(_DCC)
+
+###########################################################################
+#
+# Build $(ARCHDIR) which occupies a central role in the whole
+# make file system. ARCHDIR is used as a sub directory name to keep
+# platform dependent files on different places.
+#
+# It is built from:
+#	- processor type
+#	- operating system
+#	- compiler identification
+#
+# A possible name could be:
+#	mc68020-sunos4-cc
+#
+###########################################################################
 #OARCH=		$(MARCH)$(-O_ARCH)-$(C_ARCH)
 OARCH=		$(PARCH)$(-O_ARCH)-$(C_ARCH)
 XARCH=		$(K_ARCH)$(-O_ARCH)-$(C_ARCH)
 .print:
-	echo $(XP_ARCH) $(P_ARCH)
+	echo $(XP_ARCH) $(P_ARCH) $(OARCH) $(XARCH)
 
 ###########################################################################
 #
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/s390-linux-cc.rul cdrdao-1.1.5/scsilib/RULES/s390-linux-cc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/s390-linux-cc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/s390-linux-cc.rul	1999-08-29 10:09:57.000000000 -0400
@@ -0,0 +1,70 @@
+#ident "@(#)i586-linux-cc.rul	1.4 99/08/29 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Linux
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/s390-linux-gcc.rul cdrdao-1.1.5/scsilib/RULES/s390-linux-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/s390-linux-gcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/s390-linux-gcc.rul	1999-08-29 10:09:57.000000000 -0400
@@ -0,0 +1,70 @@
+#ident "@(#)i586-linux-gcc.rul	1.4 99/08/29 "
+###########################################################################
+# Written 1996 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for Linux
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/RULES/x86pc-qnx-gcc.rul cdrdao-1.1.5/scsilib/RULES/x86pc-qnx-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/RULES/x86pc-qnx-gcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/RULES/x86pc-qnx-gcc.rul	2001-11-11 08:17:36.000000000 -0500
@@ -0,0 +1,74 @@
+###########################################################################
+#ident "@(#)x86pc-qnx-gcc.rul	1.1 01/11/11 "
+###########################################################################
+# Written 2001 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for QNX Neutrino
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	-lsocks -lrpc
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+#RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; ranlib
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+#LORDER=		lorder
+#TSORT=		tsort
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/15conf cdrdao-1.1.5/scsilib/TARGETS/15conf
--- cdrdao-1.1.5.orig/scsilib/TARGETS/15conf	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/15conf	2001-11-13 02:46:38.000000000 -0500
@@ -0,0 +1 @@
+Makefiles Autoconfiguration part 1. Automated run of configure.
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/25inc cdrdao-1.1.5/scsilib/TARGETS/25inc
--- cdrdao-1.1.5.orig/scsilib/TARGETS/25inc	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/25inc	2001-11-13 02:46:43.000000000 -0500
@@ -0,0 +1 @@
+Makefiles Autoconfiguration part 2. Create autogenerated include files.
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/45libdeflt cdrdao-1.1.5/scsilib/TARGETS/45libdeflt
--- cdrdao-1.1.5.orig/scsilib/TARGETS/45libdeflt	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/45libdeflt	2001-05-02 17:37:30.000000000 -0400
@@ -0,0 +1 @@
+Library to read local defaults from /etc/default/*
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/45libfile cdrdao-1.1.5/scsilib/TARGETS/45libfile
--- cdrdao-1.1.5.orig/scsilib/TARGETS/45libfile	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/45libfile	2001-05-02 17:37:54.000000000 -0400
@@ -0,0 +1 @@
+Library version of the file(1) command
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/45libhfs_iso cdrdao-1.1.5/scsilib/TARGETS/45libhfs_iso
--- cdrdao-1.1.5.orig/scsilib/TARGETS/45libhfs_iso	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/45libhfs_iso	2001-05-02 17:50:04.000000000 -0400
@@ -0,0 +1 @@
+Library to handle Apple HFS extensions
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/45libparanoia cdrdao-1.1.5/scsilib/TARGETS/45libparanoia
--- cdrdao-1.1.5.orig/scsilib/TARGETS/45libparanoia	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/45libparanoia	2002-04-09 17:54:07.000000000 -0400
@@ -0,0 +1 @@
+Portable CD Audio paranoia extraction library
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/45librscg cdrdao-1.1.5/scsilib/TARGETS/45librscg
--- cdrdao-1.1.5.orig/scsilib/TARGETS/45librscg	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/45librscg	2001-05-02 17:50:24.000000000 -0400
@@ -0,0 +1 @@
+Remote SCSI transport library
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/45libscg cdrdao-1.1.5/scsilib/TARGETS/45libscg
--- cdrdao-1.1.5.orig/scsilib/TARGETS/45libscg	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/45libscg	2001-05-02 17:50:50.000000000 -0400
@@ -0,0 +1 @@
+Portable SCSI transport library
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/45libschily cdrdao-1.1.5/scsilib/TARGETS/45libschily
--- cdrdao-1.1.5.orig/scsilib/TARGETS/45libschily	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/45libschily	2001-05-02 17:51:27.000000000 -0400
@@ -0,0 +1 @@
+Library containing Schily SING (Schily Is Not GNU) extensions
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/45libunls cdrdao-1.1.5/scsilib/TARGETS/45libunls
--- cdrdao-1.1.5.orig/scsilib/TARGETS/45libunls	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/45libunls	2001-05-02 17:51:57.000000000 -0400
@@ -0,0 +1 @@
+National language support library for UNICODE
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/55cdda2wav cdrdao-1.1.5/scsilib/TARGETS/55cdda2wav
--- cdrdao-1.1.5.orig/scsilib/TARGETS/55cdda2wav	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/55cdda2wav	2001-05-03 16:57:30.000000000 -0400
@@ -0,0 +1 @@
+CD digital audio extraction program
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/55cdrecord cdrdao-1.1.5/scsilib/TARGETS/55cdrecord
--- cdrdao-1.1.5.orig/scsilib/TARGETS/55cdrecord	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/55cdrecord	2001-05-03 16:58:08.000000000 -0400
@@ -0,0 +1 @@
+CD audio/data recording program
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/55mkisofs cdrdao-1.1.5/scsilib/TARGETS/55mkisofs
--- cdrdao-1.1.5.orig/scsilib/TARGETS/55mkisofs	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/55mkisofs	2001-05-03 16:58:36.000000000 -0400
@@ -0,0 +1 @@
+Creates populated ISO-9660 filesystem images
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/55mkisofs!@!diag cdrdao-1.1.5/scsilib/TARGETS/55mkisofs!@!diag
--- cdrdao-1.1.5.orig/scsilib/TARGETS/55mkisofs!@!diag	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/55mkisofs!@!diag	2001-05-02 17:54:26.000000000 -0400
@@ -0,0 +1 @@
+Diagnose tools for Mkisofs
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/55readcd cdrdao-1.1.5/scsilib/TARGETS/55readcd
--- cdrdao-1.1.5.orig/scsilib/TARGETS/55readcd	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/55readcd	2001-05-18 13:49:55.000000000 -0400
@@ -0,0 +1 @@
+CD data extraction program
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/55rscsi cdrdao-1.1.5/scsilib/TARGETS/55rscsi
--- cdrdao-1.1.5.orig/scsilib/TARGETS/55rscsi	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/55rscsi	2001-05-02 18:05:46.000000000 -0400
@@ -0,0 +1 @@
+Remote SCSI transport server program (daemon)
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/55scgcheck cdrdao-1.1.5/scsilib/TARGETS/55scgcheck
--- cdrdao-1.1.5.orig/scsilib/TARGETS/55scgcheck	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/55scgcheck	2001-05-02 17:55:43.000000000 -0400
@@ -0,0 +1 @@
+Libscg ABI compliance checker
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/README cdrdao-1.1.5/scsilib/TARGETS/README
--- cdrdao-1.1.5.orig/scsilib/TARGETS/README	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/README	2000-12-25 13:11:22.000000000 -0500
@@ -0,0 +1,12 @@
+05patches
+15conf	- Autofonfiguration part 1. Automated run of configure.
+25inc	- Autofonfiguration part 2. Create autogenerated include files.
+
+35	reserved
+
+45lib
+55cmd
+65kern
+75	reserved
+85man
+95	reserved
\ No newline at end of file
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/Targetdirs cdrdao-1.1.5/scsilib/TARGETS/Targetdirs
--- cdrdao-1.1.5.orig/scsilib/TARGETS/Targetdirs	2000-10-28 13:02:27.000000000 -0400
+++ cdrdao-1.1.5/scsilib/TARGETS/Targetdirs	2001-05-13 08:39:33.000000000 -0400
@@ -1,4 +1,6 @@
-#ident %W% %E% %Q%
 ###########################################################################
-DIRS=		conf inc lib libscg librscg libdeflt rscsi export
+#
+# This file is intentionally left empty. The targets are now defined by the
+# "Slottable Source" feature of the makefile system
+#
 ###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TARGETS/__slot cdrdao-1.1.5/scsilib/TARGETS/__slot
--- cdrdao-1.1.5.orig/scsilib/TARGETS/__slot	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TARGETS/__slot	2001-05-03 16:55:45.000000000 -0400
@@ -0,0 +1 @@
+This file enables the "slot" feature of the Schily SING makefile system
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Defaults.gcc cdrdao-1.1.5/scsilib/TEMPLATES/Defaults.gcc
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Defaults.gcc	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Defaults.gcc	2000-03-25 14:30:01.000000000 -0500
@@ -0,0 +1,38 @@
+#ident "%W% %E% %Q%"
+###########################################################################
+#
+# global definitions for unknown Systems using CC=gcc
+#
+###########################################################################
+#
+# Compiler stuff
+#
+###########################################################################
+#DEFCCOM=	cc
+DEFCCOM=	gcc
+###########################################################################
+#
+# If the next line is commented out, compilattion is done with max warn level
+# If the next line is uncommented, compilattion is done with minimal warnings
+#
+###########################################################################
+#CWARNOPTS=
+
+DEFINCDIRS=	$(SRCROOT)/include
+LDPATH=		-L/opt/schily/lib
+RUNPATH=	-R $(INS_BASE)/lib -R /opt/schily/lib -R $(OLIBSDIR)
+
+###########################################################################
+#
+# Installation config stuff
+#
+###########################################################################
+INS_BASE=	/opt/schily
+INS_KBASE=	/
+#
+DEFUMASK=	002
+#
+DEFINSMODEF=	444
+DEFINSMODEX=	755
+DEFINSUSR=	bin
+DEFINSGRP=	bin
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Defaults.xcc cdrdao-1.1.5/scsilib/TEMPLATES/Defaults.xcc
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Defaults.xcc	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Defaults.xcc	2000-03-25 14:30:32.000000000 -0500
@@ -0,0 +1,38 @@
+#ident "%W% %E% %Q%"
+###########################################################################
+#
+# global definitions for unknown Systems using CC=cc
+#
+###########################################################################
+#
+# Compiler stuff
+#
+###########################################################################
+DEFCCOM=	cc
+#DEFCCOM=	gcc
+###########################################################################
+#
+# If the next line is commented out, compilattion is done with max warn level
+# If the next line is uncommented, compilattion is done with minimal warnings
+#
+###########################################################################
+#CWARNOPTS=
+
+DEFINCDIRS=	$(SRCROOT)/include
+LDPATH=		-L/opt/schily/lib
+#RUNPATH=	-R $(INS_BASE)/lib -R /opt/schily/lib -R $(OLIBSDIR)	Will probably not work
+
+###########################################################################
+#
+# Installation config stuff
+#
+###########################################################################
+INS_BASE=	/opt/schily
+INS_KBASE=	/
+#
+DEFUMASK=	002
+#
+DEFINSMODEF=	444
+DEFINSMODEX=	755
+DEFINSUSR=	bin
+DEFINSGRP=	bin
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.aux cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.aux
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.aux	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.aux	2000-03-25 14:27:51.000000000 -0500
@@ -0,0 +1,16 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for installing non-localized auxiliary files
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		etc
+TARGET=		help.dat
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.aux
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.cmd cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.cmd
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.cmd	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.cmd	1997-03-04 10:29:29.000000000 -0500
@@ -0,0 +1,19 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for general application programs
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		bin
+TARGET=		cfform
+#CPPOPTS +=	-Ispecincl
+CFILES=		cfform.c
+LIBS=		-lat
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.cmd
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.dir cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.dir
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.dir	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.dir	1997-02-12 06:46:16.000000000 -0500
@@ -0,0 +1,14 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for sub directory makes
+###########################################################################
+SRCROOT=	..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+include		Targetdirs.$(M_ARCH)
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.dir
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.drv cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.drv
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.drv	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.drv	1997-03-04 10:29:29.000000000 -0500
@@ -0,0 +1,21 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for general device drivers
+###########################################################################
+SRCROOT=	../../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		usr/kernel/drv
+TARGET=		ga
+CPPOPTS +=	-DFOKUS -DATMNA -DBROKEN_PROM -DTPI_COMPAT \
+		-DGADEBUG -DGADEBUG_MASK=0x0 
+CFILES=		ga.c
+SRCLIBS=
+LIBS=		
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.drv
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.inc cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.inc
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.inc	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.inc	1999-08-28 13:22:11.000000000 -0400
@@ -0,0 +1,15 @@
+#ident %W% %E% %Q%
+###########################################################################
+SRCROOT=	..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		include
+TARGET=		align.h
+TARGETC=	align_test
+CFILES=		align_test.c
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.inc
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.lib cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.lib
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.lib	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.lib	1997-03-04 10:29:30.000000000 -0500
@@ -0,0 +1,19 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for non-shared libraries
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		lib
+TARGETLIB=	aal
+CPPOPTS +=	-DFOKUS
+CFILES=		aallib.c
+LIBS=
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.lib
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.loc cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.loc
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.loc	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.loc	2000-03-25 14:28:03.000000000 -0500
@@ -0,0 +1,17 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for installing localized auxiliary files
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		etc
+TARGET=		test
+SRCFILE=	test
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.loc
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.man cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.man
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.man	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.man	2000-03-25 14:26:38.000000000 -0500
@@ -0,0 +1,18 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for installing manual pages
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+MANDIR=		man
+TARGETMAN=	test
+MANSECT=	$(MANSECT_LIB)
+MANSUFFIX=	$(MANSUFF_LIB)
+MANFILE=	test.tr
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.man
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.mks cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.mks
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.mks	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.mks	1997-03-04 10:29:30.000000000 -0500
@@ -0,0 +1,16 @@
+#ident "%W% %E% %Q%"
+###########################################################################
+# Sample makefile for sub-makes in one directory
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+#MK_FILES=	cfform.mk cfget20.mk cfhec11.mk cfinfo20.mk cfpld.mk cfput20.mk
+MK_FILES=	cfform.mk
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.mks
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.mod cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.mod
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.mod	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.mod	1998-09-08 08:30:24.000000000 -0400
@@ -0,0 +1,21 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for loadable streams modules
+###########################################################################
+SRCROOT=	../../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		usr/kernel/strmod
+TARGET=		ga
+CPPOPTS +=	-DFOKUS -DATMNA -DBROKEN_PROM -DTPI_COMPAT \
+		-DGADEBUG -DGADEBUG_MASK=0x0 
+CFILES=		ga.c
+SRCLIBS=
+LIBS=		
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.mod
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.root cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.root
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.root	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.root	1998-09-20 18:57:22.000000000 -0400
@@ -0,0 +1,17 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for the source root
+###########################################################################
+SRCROOT=	.
+DIRNAME=	SRCROOT
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+include		Targetdirs.$(M_ARCH)
+
+###########################################################################
+# Due to a bug in SunPRO make we need special rules for the root makefile
+#
+include		$(SRCROOT)/$(RULESDIR)/rules.rdi
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.scr cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.scr
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.scr	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.scr	1997-03-04 10:29:30.000000000 -0500
@@ -0,0 +1,17 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for installing localized shell scripts
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		bin
+TARGET=		test
+SCRFILE=	test.sh
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.scr
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.shl cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.shl
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile.shl	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile.shl	1997-03-04 10:29:30.000000000 -0500
@@ -0,0 +1,19 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for shared libraries
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		lib
+TARGETLIB=	aal
+CPPOPTS +=	-DFOKUS
+CFILES=		aallib.c
+LIBS=
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.shl
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile_de.man cdrdao-1.1.5/scsilib/TEMPLATES/Makefile_de.man
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/Makefile_de.man	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/Makefile_de.man	2000-03-25 14:27:21.000000000 -0500
@@ -0,0 +1,20 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for installing non english manual pages
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+# Rules for German manual pages (replace de with your locale)
+###########################################################################
+
+MANDIR=		man/de
+TARGETMAN=	test
+MANSECT=	$(MANSECT_LIB)
+MANSUFFIX=	$(MANSUFF_LIB)
+MANFILE=	test-de.tr
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.man
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/cmd.mk cdrdao-1.1.5/scsilib/TEMPLATES/cmd.mk
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/cmd.mk	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/cmd.mk	1997-03-04 10:29:29.000000000 -0500
@@ -0,0 +1,19 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for general application programs
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		bin
+TARGET=		cfform
+#CPPOPTS +=	-Ispecincl
+CFILES=		cfform.c
+LIBS=		-lat
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.cmd
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/inc.mk cdrdao-1.1.5/scsilib/TEMPLATES/inc.mk
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/inc.mk	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/inc.mk	1999-08-28 13:22:11.000000000 -0400
@@ -0,0 +1,15 @@
+#ident %W% %E% %Q%
+###########################################################################
+SRCROOT=	..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		include
+TARGET=		align.h
+TARGETC=	align_test
+CFILES=		align_test.c
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.inc
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/lib.mk cdrdao-1.1.5/scsilib/TEMPLATES/lib.mk
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/lib.mk	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/lib.mk	1997-03-04 10:29:30.000000000 -0500
@@ -0,0 +1,19 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for non-shared libraries
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		lib
+TARGETLIB=	aal
+CPPOPTS +=	-DFOKUS
+CFILES=		aallib.c
+LIBS=
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.lib
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/shl.mk cdrdao-1.1.5/scsilib/TEMPLATES/shl.mk
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/shl.mk	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/shl.mk	1997-03-04 10:29:30.000000000 -0500
@@ -0,0 +1,19 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for shared libraries
+###########################################################################
+SRCROOT=	../..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		lib
+TARGETLIB=	aal
+CPPOPTS +=	-DFOKUS
+CFILES=		aallib.c
+LIBS=
+XMK_FILE=	Makefile.man
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.shl
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/temp-gcc.rul cdrdao-1.1.5/scsilib/TEMPLATES/temp-gcc.rul
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/temp-gcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/temp-gcc.rul	2000-01-04 06:01:39.000000000 -0500
@@ -0,0 +1,75 @@
+#ident "%W% %E% %Q%"
+###########################################################################
+# Written 1997 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for unknown GCC systems
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		-Wall -Wtraditional \
+		-Wshadow -Wmissing-prototypes -Wstrict-prototypes
+COPTOPT=	-O
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; gcc
+LDCC=		@echo "	==> LINKING \"$@\""; gcc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; gcc
+#RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; ranlib
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+#LORDER=		lorder
+#TSORT=		tsort
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); gcc -M
+MKDEP_OUT=
+
+MKDIR=		$(MKDIR_SH)
diff -ruN cdrdao-1.1.5.orig/scsilib/TEMPLATES/temp-xcc.rul cdrdao-1.1.5/scsilib/TEMPLATES/temp-xcc.rul
--- cdrdao-1.1.5.orig/scsilib/TEMPLATES/temp-xcc.rul	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/TEMPLATES/temp-xcc.rul	2000-01-04 06:01:07.000000000 -0500
@@ -0,0 +1,76 @@
+#ident "%W% %E% %Q%"
+###########################################################################
+# Written 1997 by J. Schilling
+###########################################################################
+#
+# Platform dependent MACROS for unknown systems systems with dumb cc
+#
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+include $(SRCROOT)/$(RULESDIR)/rules.prg
+###########################################################################
+
+CPPFLAGS=	$(CPPOPTS) $(CPPOPTX)
+CFLAGS=		$(COPTS) $(CWARNOPTS) $(COPTOPT) $(COPTX)
+
+CPPOPTS=	-I. -I$(ARCHDIR) -I$(OINCSDIR) $(INCDIRS:%=-I%) $(OSDEFS)
+COPTS=
+CWOPTS=		
+#
+# Switch optimizing on if your compiler supports it
+#COPTOPT=	-O
+COPTOPT=	
+KDEFINES=	-DKERNEL -D_KERNEL
+COPTDYN=	-fpic
+COPTGPROF=	-pg
+
+LIB_PREFIX=	lib
+LIB_SUFFIX=	.a
+SHL_SUFFIX=	.so.1.0
+
+#LIB_SOCKET=	-lsocket -lnsl -ldl
+LIB_SOCKET=	
+LIB_MATH=	-lm
+#LIB_KVM=	-lkvm
+LIB_KVM=	
+
+LIBS_PATH=	-L$(OLIBSDIR)
+
+LDFLAGS=	$(LDOPTS) $(LDOPTX)
+LDLIBS=		$(LIBS) $(LIBX)
+
+#LDOPTS=		$(LIBS_PATH) $(LDPATH) $(RUNPATH)
+LDOPTS=		$(LIBS_PATH) $(LDPATH)
+LDOPTDYN=	-shared -Wl,-soname,$(TARGET)
+LNDYNLIB=	@$(SYMLINK) $(TARGET) $(PTARGET_BASE).so
+
+FLOAT_OPTIONS=	
+
+CC=		@echo "	==> COMPILING \"$@\""; cc
+LDCC=		@echo "	==> LINKING \"$@\""; cc
+DYNLD=		@echo "	==> LINKING dynamic library \"$@\""; cc
+#RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; ranlib
+RANLIB=		@echo "	==> RANDOMIZING ARCHIVE \"$@\""; true
+ARFLAGS=	cr
+#LORDER=		lorder
+#TSORT=		tsort
+LORDER=		echo
+TSORT=		cat
+
+RMDEP=		:
+#MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); cc -M
+MKDEP=		@echo "	==> MAKING DEPENDENCIES \"$@\""; $(RMDEP); echo "Cannot do -M with unknown cc"; :
+MKDEP_OUT=
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/aclocal.m4 cdrdao-1.1.5/scsilib/conf/aclocal.m4
--- cdrdao-1.1.5.orig/scsilib/conf/aclocal.m4	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/aclocal.m4	2002-04-21 08:22:05.000000000 -0400
@@ -1,4 +1,4 @@
-dnl @(#)aclocal.m4	1.18 01/02/24 Copyright 1998 J. Schilling
+dnl @(#)aclocal.m4	1.24 02/04/21 Copyright 1998 J. Schilling
 
 dnl Set VARIABLE to VALUE in C-string form, verbatim, or 1.
 dnl AC_DEFINE_STRING(VARIABLE [, VALUE])
@@ -41,6 +41,19 @@
   AC_DEFINE(HAVE_ST_NSEC)
 fi])
 
+dnl Checks if structure 'stat' have field 'st_flags'.
+dnl Defines HAVE_ST_FLAGS on success.
+AC_DEFUN(AC_STRUCT_ST_FLAGS,
+[AC_CACHE_CHECK([if struct stat contains st_flags], ac_cv_struct_st_flags,
+                [AC_TRY_COMPILE([#include <sys/types.h>
+#include <sys/stat.h>],
+                                [struct  stat s; s.st_flags = 0;],
+                                [ac_cv_struct_st_flags=yes],
+                                [ac_cv_struct_st_flags=no])])
+if test $ac_cv_struct_st_flags = yes; then
+  AC_DEFINE(HAVE_ST_FLAGS)
+fi])
+
 dnl Checks if structure 'mtget' have field 'mt_type'.
 dnl Defines HAVE_MTGET_TYPE on success.
 AC_DEFUN(AC_STRUCT_MTGET_TYPE,
@@ -214,7 +227,7 @@
 dnl Checks for USG derived STDIO that uses _filbuf()
 dnl Defines HAVE__FILBUF on success.
 AC_DEFUN(AC_HEADER__FILBUF,
-[AC_CACHE_CHECK([for _filbuf()], ac_cv_header__filbuf,
+[AC_CACHE_CHECK([for _filbuf()], ac_cv_func__filbuf,
                 [AC_TRY_LINK([#include <stdio.h>],
 [FILE    *f;
 int     flag;
@@ -230,16 +243,16 @@
 count = f->_cnt;
 ptr = (char *)f->_ptr;
 fclose(f);],
-                [ac_cv_header__filbuf=yes],
-                [ac_cv_header__filbuf=no])])
-if test $ac_cv_header__filbuf = yes; then
+                [ac_cv_func__filbuf=yes],
+                [ac_cv_func__filbuf=no])])
+if test $ac_cv_func__filbuf = yes; then
   AC_DEFINE(HAVE__FILBUF)
 fi])
 
 dnl Checks for USG derived STDIO that uses __filbuf()
 dnl Defines HAVE___FILBUF on success.
 AC_DEFUN(AC_HEADER___FILBUF,
-[AC_CACHE_CHECK([for __filbuf()], ac_cv_header___filbuf,
+[AC_CACHE_CHECK([for __filbuf()], ac_cv_func___filbuf,
                 [AC_TRY_LINK([#include <stdio.h>],
 [FILE    *f;
 int     flag;
@@ -255,9 +268,9 @@
 count = f->_cnt;
 ptr = (char *)f->_ptr;
 fclose(f);],
-                [ac_cv_header___filbuf=yes],
-                [ac_cv_header___filbuf=no])])
-if test $ac_cv_header___filbuf = yes; then
+                [ac_cv_func___filbuf=yes],
+                [ac_cv_func___filbuf=no])])
+if test $ac_cv_func___filbuf = yes; then
   AC_DEFINE(HAVE___FILBUF)
 fi])
 
@@ -1304,6 +1317,24 @@
   AC_DEFINE(NEED_SYS_SELECT_H)
 fi])
 
+dnl Checks if select() needs sys/socket.h
+dnl Defines NEED_SYS_SOCKET_H on success.
+AC_DEFUN(AC_HEADER_SELECT2,
+[AC_REQUIRE([AC_HEADER_SELECT_NONSTD])dnl
+AC_CACHE_CHECK([if sys/socket.h is needed for select], ac_cv_header_need_sys_socket_h,
+                [AC_TRY_COMPILE([#include <sys/types.h>
+#include <sys/time.h>
+#include <sys/socket.h>
+#ifndef	SELECT_NONSTD_HDR
+do not compile if we do not need nonstandard headers
+#endif],
+			[fd_set rfd; FD_ZERO(&rfd); select(1, &rfd, 0, 0, 0);],
+				[ac_cv_header_need_sys_socket_h=yes],
+				[ac_cv_header_need_sys_socket_h=no])])
+if test $ac_cv_header_need_sys_socket_h = yes; then
+  AC_DEFINE(NEED_SYS_SOCKET_H)
+fi])
+
 dnl Checks if file locking via fcntl() is available
 dnl Defines HAVE_FCNTL_LOCKF on success.
 AC_DEFUN(AC_FUNC_FCNTL_LOCKF,
@@ -1321,9 +1352,17 @@
 fi])
 
 
-dnl XXXXXXXXXXXXXXXXXX Begin Stolen from GNU tar XXXXXXXXXXXXXXXXXXXXXXXXXXX
-dnl One line has been changed to:    [ac_save_CC="${CC-cc}"
+dnl XXXXXXXXXXXXXXXXXX Begin Stolen (but modified) from GNU tar XXXXXXXXXXXXXXXXXXXXXXXXXXX
+dnl Changes:
+
+dnl One line has been changed to:    [ac_save_CC="${CC-cc}" to default to "'cc"
 
+dnl AC_SYS_LARGEFILE_MACRO_VALUE test moved from AC_FUNC_FSEEKO into AC_SYS_LARGEFILE
+dnl Do not call AC_FUNC_FSEEKO because it does not check whether fseeko() is
+dnl available on non Large File mode. There are additionoal tests for fseeko()/ftello()
+dnl inside the AC_HAVE_LARGEFILES test.
+
+dnl largefile_cc_opt definition added
 
 #serial 18
 
@@ -1373,6 +1412,7 @@
      AC_CACHE_CHECK([for special C compiler options needed for large files],
        ac_cv_sys_largefile_CC,
        [ac_cv_sys_largefile_CC=no
+        largefile_cc_opt=""
         if test "$GCC" != yes; then
 	  # IRIX 6.2 and later do not support large files by default,
 	  # so use the C compiler's -n32 option if that helps.
@@ -1385,6 +1425,7 @@
         fi])
      if test "$ac_cv_sys_largefile_CC" != no; then
        CC="$CC$ac_cv_sys_largefile_CC"
+       largefile_cc_opt="$ac_cv_sys_largefile_CC"
      fi
 
      AC_SYS_LARGEFILE_MACRO_VALUE(_FILE_OFFSET_BITS, 64,
@@ -1395,6 +1436,10 @@
        ac_cv_sys_large_files,
        [Define for large files, on AIX-style hosts.],
        AC_SYS_LARGEFILE_TEST_INCLUDES)
+     AC_SYS_LARGEFILE_MACRO_VALUE(_LARGEFILE_SOURCE, 1,
+       ac_cv_sys_largefile_source,
+       [Define to make fseeko visible on some hosts (e.g. glibc 2.2).],
+       [#include <stdio.h>], [return !fseeko;])
    fi
   ])
 
@@ -1419,7 +1464,7 @@
    fi])
 
 
-dnl XXXXXXXXXXXXXXXXXX End Stolen from GNU tar XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
+dnl XXXXXXXXXXXXXXXXXX End Stolen (but modified) from GNU tar XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
 
 AC_DEFUN(AC_HAVE_LARGEFILES,
 [AC_CACHE_CHECK([if system supports Large Files at all], ac_cv_largefiles,
@@ -1436,9 +1481,49 @@
     int off_t_is_large[(LARGE_OFF_T % 2147483629 == 721
 			&& LARGE_OFF_T % 2147483647 == 1)
 		       ? 1 : -1];
+return !fseeko;
 return !ftello;],
      		[ac_cv_largefiles=yes],
      		[ac_cv_largefiles=no])])
 	if test $ac_cv_largefiles = yes; then
 		AC_DEFINE(HAVE_LARGEFILES)
 	fi])
+
+dnl Checks for whether fseeko() is available in non large file mode
+dnl and whether there is a prototype for fseeko()
+dnl Defines HAVE_FSEEKO on success.
+AC_DEFUN(AC_SMALL_FSEEKO,
+[AC_CACHE_CHECK([for fseeko()], ac_cv_func_fseeko,
+                [AC_TRY_LINK([#include <stdio.h>],
+[return !fseeko;],
+                [ac_cv_func_fseeko=yes],
+                [ac_cv_func_fseeko=no])])
+if test $ac_cv_func_fseeko = yes; then
+  AC_DEFINE(HAVE_FSEEKO)
+fi])
+
+dnl Checks for whether ftello() is available in non large file mode
+dnl and whether there is a prototype for ftello()
+dnl Defines HAVE_FTELLO on success.
+AC_DEFUN(AC_SMALL_FTELLO,
+[AC_CACHE_CHECK([for ftello()], ac_cv_func_ftello,
+                [AC_TRY_LINK([#include <stdio.h>],
+[return !ftello;],
+                [ac_cv_func_ftello=yes],
+                [ac_cv_func_ftello=no])])
+if test $ac_cv_func_ftello = yes; then
+  AC_DEFINE(HAVE_FTELLO)
+fi])
+
+dnl Checks if compiler allows dynamic arrays.
+dnl Defines HAVE_DYN_ARRAYS on success.
+AC_DEFUN(AC_DYN_ARRAYS,
+[AC_CACHE_CHECK([if compiler allows dynamic arrays], ac_cv_dyn_arrays,
+                [AC_TRY_COMPILE([],
+                                [extern int __aa(); int len = __aa(); char some_array[len];],
+                                [ac_cv_dyn_arrays=yes],
+                                [ac_cv_dyn_arrays=no])])
+if test $ac_cv_dyn_arrays = yes; then
+  AC_DEFINE(HAVE_DYN_ARRAYS)
+fi])
+
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/cc-config.sh cdrdao-1.1.5/scsilib/conf/cc-config.sh
--- cdrdao-1.1.5.orig/scsilib/conf/cc-config.sh	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/conf/cc-config.sh	2002-01-27 12:02:51.000000000 -0500
@@ -0,0 +1,71 @@
+#!/bin/sh
+# @(#)cc-config.sh	1.1 02/01/27 Copyright 2002 J. Schilling
+###########################################################################
+# Written 2002 by J. Schilling
+###########################################################################
+# Configuration script called to verify system default C-compiler.
+# It tries to fall back to GCC if the system default could not be found.
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+
+CC=$1
+echo "Trying to find $CC"
+#
+# There are old shells that don't support the 'type' builtin.
+# For this reason it is not a simple task to find out whether
+# this compiler exists and works.
+#
+# First try to run the default C-compiler without args
+#
+$CC > /dev/null 2>&1
+if [ $? = 0 ]; then
+	echo "Found $CC"
+	echo "Creating empty '$2'"
+	:> $2
+	exit
+fi
+
+#
+# Now try to run the default C-compiler and check whether it creates
+# any output (usualla an error message).
+#
+# This test will fail if the shell does redirect the error message
+# "cc: not found". All shells I tested send this message to the stderr
+# stream the shell itself is attached to and only redirects the output
+# from the command. As there may no outout if there is no binary, this
+# prooves the existence of the default compiler.
+#
+ccout=`$CC 2>&1`
+if [ -n "$ccout" ]; then
+	echo "Found $CC"
+	echo "Creating empty '$2'"
+	:> $2
+	exit
+fi
+
+echo 'Trying to find GCC'
+
+gcc -v 2> /dev/null && CC=gcc
+
+if [ ".$CC" = ".$1" ]; then
+	echo "GCC not found, keeping current global default"
+	echo "Creating empty '$2'"
+	:> $2
+else
+	echo "Found $CC"
+	echo "Making $CC the default compiler in '$2'"
+	echo DEFCCOM=$CC > $2
+fi
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/config.guess cdrdao-1.1.5/scsilib/conf/config.guess
--- cdrdao-1.1.5.orig/scsilib/conf/config.guess	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/config.guess	2001-09-10 06:19:10.000000000 -0400
@@ -690,10 +690,11 @@
 		echo ${UNAME_MACHINE}-pc-sysv${UNAME_RELEASE}
 	fi
 	exit 0 ;;
-    i?86:*:5:7*)
+    i?86:*:5:*)
         # Fixed at (any) Pentium or better
         UNAME_MACHINE=i586
-        if [ ${UNAME_SYSTEM} = "UnixWare" ] ; then
+        if [ ${UNAME_SYSTEM} = "UnixWare" ] ||
+	   [ ${UNAME_SYSTEM} = "OpenUNIX" ]; then
             echo ${UNAME_MACHINE}-sco-sysv${UNAME_RELEASE}uw${UNAME_VERSION}
         else
             echo ${UNAME_MACHINE}-pc-sysv${UNAME_RELEASE}
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/config.sub cdrdao-1.1.5/scsilib/conf/config.sub
--- cdrdao-1.1.5.orig/scsilib/conf/config.sub	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/config.sub	2001-05-18 13:38:35.000000000 -0400
@@ -460,6 +460,9 @@
 		basic_machine=i860-intel
 		os=-osf
 		;;
+	parisc-unknown)
+		basic_machine=parisc-unknown
+		;;
 	pbd)
 		basic_machine=sparc-tti
 		;;
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/configure cdrdao-1.1.5/scsilib/conf/configure
--- cdrdao-1.1.5.orig/scsilib/conf/configure	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/configure	2002-04-21 08:22:26.000000000 -0400
@@ -107,6 +107,12 @@
 
 
 
+
+
+
+
+
+
 #serial 18
 
 
@@ -123,6 +129,13 @@
 
 
 
+
+
+
+
+
+
+
 # Guess values for system-dependent variables and create Makefiles.
 # Generated automatically using autoconf version 2.13 
 # Copyright (C) 1992, 93, 94, 95, 96 Free Software Foundation, Inc.
@@ -676,7 +689,7 @@
 fi
 
 echo $ac_n "checking host system type""... $ac_c" 1>&6
-echo "configure:680: checking host system type" >&5
+echo "configure:693: checking host system type" >&5
 
 host_alias=$host
 case "$host_alias" in
@@ -698,12 +711,12 @@
 
 
 echo $ac_n "checking for Cygwin environment""... $ac_c" 1>&6
-echo "configure:702: checking for Cygwin environment" >&5
+echo "configure:715: checking for Cygwin environment" >&5
 if eval "test \"`echo '$''{'ac_cv_cygwin'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 707 "configure"
+#line 720 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -714,7 +727,7 @@
 return __CYGWIN__;
 ; return 0; }
 EOF
-if { (eval echo configure:718: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:731: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_cygwin=yes
 else
@@ -731,19 +744,19 @@
 CYGWIN=
 test "$ac_cv_cygwin" = yes && CYGWIN=yes
 echo $ac_n "checking for mingw32 environment""... $ac_c" 1>&6
-echo "configure:735: checking for mingw32 environment" >&5
+echo "configure:748: checking for mingw32 environment" >&5
 if eval "test \"`echo '$''{'ac_cv_mingw32'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 740 "configure"
+#line 753 "configure"
 #include "confdefs.h"
 
 int main() {
 return __MINGW32__;
 ; return 0; }
 EOF
-if { (eval echo configure:747: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:760: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_mingw32=yes
 else
@@ -760,19 +773,19 @@
 MINGW32=
 test "$ac_cv_mingw32" = yes && MINGW32=yes
 echo $ac_n "checking for EMX/OS2 environment""... $ac_c" 1>&6
-echo "configure:764: checking for EMX/OS2 environment" >&5
+echo "configure:777: checking for EMX/OS2 environment" >&5
 if eval "test \"`echo '$''{'ac_cv_emxos2'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 769 "configure"
+#line 782 "configure"
 #include "confdefs.h"
 
 int main() {
 return __EMX__;
 ; return 0; }
 EOF
-if { (eval echo configure:776: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:789: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_emxos2=yes
 else
@@ -803,7 +816,7 @@
 
 
 echo $ac_n "checking for executable suffix""... $ac_c" 1>&6
-echo "configure:807: checking for executable suffix" >&5
+echo "configure:820: checking for executable suffix" >&5
 if eval "test \"`echo '$''{'ac_cv_exeext'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -813,7 +826,7 @@
   rm -f conftest*
   echo 'int main () { return 0; }' > conftest.$ac_ext
   ac_cv_exeext=
-  if { (eval echo configure:817: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  if { (eval echo configure:830: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
     for file in conftest.*; do
       case $file in
       *.c | *.o | *.obj) ;;
@@ -834,7 +847,7 @@
 ac_exeext=$EXEEXT
 
 echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
-echo "configure:838: checking how to run the C preprocessor" >&5
+echo "configure:851: checking how to run the C preprocessor" >&5
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
@@ -849,13 +862,13 @@
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp.
   cat > conftest.$ac_ext <<EOF
-#line 853 "configure"
+#line 866 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:859: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:872: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -866,13 +879,13 @@
   rm -rf conftest*
   CPP="${CC-cc} -E -traditional-cpp"
   cat > conftest.$ac_ext <<EOF
-#line 870 "configure"
+#line 883 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:876: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:889: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -883,13 +896,13 @@
   rm -rf conftest*
   CPP="${CC-cc} -nologo -E"
   cat > conftest.$ac_ext <<EOF
-#line 887 "configure"
+#line 900 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:893: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:906: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -916,7 +929,7 @@
 # Extract the first word of "ranlib", so it can be a program name with args.
 set dummy ranlib; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:920: checking for $ac_word" >&5
+echo "configure:933: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -944,7 +957,7 @@
 fi
 
 echo $ac_n "checking whether ${MAKE-make} sets \${MAKE}""... $ac_c" 1>&6
-echo "configure:948: checking whether ${MAKE-make} sets \${MAKE}" >&5
+echo "configure:961: checking whether ${MAKE-make} sets \${MAKE}" >&5
 set dummy ${MAKE-make}; ac_make=`echo "$2" | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -972,12 +985,12 @@
 
 
 echo $ac_n "checking for ANSI C header files""... $ac_c" 1>&6
-echo "configure:976: checking for ANSI C header files" >&5
+echo "configure:989: checking for ANSI C header files" >&5
 if eval "test \"`echo '$''{'ac_cv_header_stdc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 981 "configure"
+#line 994 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 #include <stdarg.h>
@@ -985,7 +998,7 @@
 #include <float.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:989: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1002: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1002,7 +1015,7 @@
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
 cat > conftest.$ac_ext <<EOF
-#line 1006 "configure"
+#line 1019 "configure"
 #include "confdefs.h"
 #include <string.h>
 EOF
@@ -1020,7 +1033,7 @@
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
 cat > conftest.$ac_ext <<EOF
-#line 1024 "configure"
+#line 1037 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 EOF
@@ -1041,7 +1054,7 @@
   :
 else
   cat > conftest.$ac_ext <<EOF
-#line 1045 "configure"
+#line 1058 "configure"
 #include "confdefs.h"
 #include <ctype.h>
 #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
@@ -1052,7 +1065,7 @@
 exit (0); }
 
 EOF
-if { (eval echo configure:1056: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:1069: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   :
 else
@@ -1076,12 +1089,12 @@
 fi
 
 echo $ac_n "checking for UNIX-98 compliant inttypes.h""... $ac_c" 1>&6
-echo "configure:1080: checking for UNIX-98 compliant inttypes.h" >&5
+echo "configure:1093: checking for UNIX-98 compliant inttypes.h" >&5
 if eval "test \"`echo '$''{'ac_cv_header_inttypes'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1085 "configure"
+#line 1098 "configure"
 #include "confdefs.h"
 #include <inttypes.h>
 int main() {
@@ -1090,7 +1103,7 @@
 intptr_t ip; uintptr_t uip;
 ; return 0; }
 EOF
-if { (eval echo configure:1094: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1107: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_header_inttypes=yes
 else
@@ -1114,12 +1127,12 @@
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr that defines DIR""... $ac_c" 1>&6
-echo "configure:1118: checking for $ac_hdr that defines DIR" >&5
+echo "configure:1131: checking for $ac_hdr that defines DIR" >&5
 if eval "test \"`echo '$''{'ac_cv_header_dirent_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1123 "configure"
+#line 1136 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <$ac_hdr>
@@ -1127,7 +1140,7 @@
 DIR *dirp = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:1131: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1144: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_dirent_$ac_safe=yes"
 else
@@ -1152,7 +1165,7 @@
 # Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
 if test $ac_header_dirent = dirent.h; then
 echo $ac_n "checking for opendir in -ldir""... $ac_c" 1>&6
-echo "configure:1156: checking for opendir in -ldir" >&5
+echo "configure:1169: checking for opendir in -ldir" >&5
 ac_lib_var=`echo dir'_'opendir | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -1160,7 +1173,7 @@
   ac_save_LIBS="$LIBS"
 LIBS="-ldir  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 1164 "configure"
+#line 1177 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -1171,7 +1184,7 @@
 opendir()
 ; return 0; }
 EOF
-if { (eval echo configure:1175: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:1188: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -1193,7 +1206,7 @@
 
 else
 echo $ac_n "checking for opendir in -lx""... $ac_c" 1>&6
-echo "configure:1197: checking for opendir in -lx" >&5
+echo "configure:1210: checking for opendir in -lx" >&5
 ac_lib_var=`echo x'_'opendir | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -1201,7 +1214,7 @@
   ac_save_LIBS="$LIBS"
 LIBS="-lx  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 1205 "configure"
+#line 1218 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -1212,7 +1225,7 @@
 opendir()
 ; return 0; }
 EOF
-if { (eval echo configure:1216: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:1229: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -1235,12 +1248,12 @@
 fi
 
 echo $ac_n "checking whether stat file-mode macros are broken""... $ac_c" 1>&6
-echo "configure:1239: checking whether stat file-mode macros are broken" >&5
+echo "configure:1252: checking whether stat file-mode macros are broken" >&5
 if eval "test \"`echo '$''{'ac_cv_header_stat_broken'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1244 "configure"
+#line 1257 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/stat.h>
@@ -1291,12 +1304,12 @@
 fi
 
 echo $ac_n "checking whether time.h and sys/time.h may both be included""... $ac_c" 1>&6
-echo "configure:1295: checking whether time.h and sys/time.h may both be included" >&5
+echo "configure:1308: checking whether time.h and sys/time.h may both be included" >&5
 if eval "test \"`echo '$''{'ac_cv_header_time'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1300 "configure"
+#line 1313 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/time.h>
@@ -1305,7 +1318,7 @@
 struct tm *tp;
 ; return 0; }
 EOF
-if { (eval echo configure:1309: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1322: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_header_time=yes
 else
@@ -1326,12 +1339,12 @@
 fi
 
 echo $ac_n "checking for sys/wait.h that is POSIX.1 compatible""... $ac_c" 1>&6
-echo "configure:1330: checking for sys/wait.h that is POSIX.1 compatible" >&5
+echo "configure:1343: checking for sys/wait.h that is POSIX.1 compatible" >&5
 if eval "test \"`echo '$''{'ac_cv_header_sys_wait_h'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1335 "configure"
+#line 1348 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/wait.h>
@@ -1347,7 +1360,7 @@
 s = WIFEXITED (s) ? WEXITSTATUS (s) : 1;
 ; return 0; }
 EOF
-if { (eval echo configure:1351: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1364: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_header_sys_wait_h=yes
 else
@@ -1368,12 +1381,12 @@
 fi
 
 echo $ac_n "checking if select needs nonstd include files""... $ac_c" 1>&6
-echo "configure:1372: checking if select needs nonstd include files" >&5
+echo "configure:1385: checking if select needs nonstd include files" >&5
 if eval "test \"`echo '$''{'ac_cv_header_slect_nonstd_hdr'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1377 "configure"
+#line 1390 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/time.h>
@@ -1381,7 +1394,7 @@
 fd_set rfd; FD_ZERO(&rfd); select(1, &rfd, 0, 0, 0);
 ; return 0; }
 EOF
-if { (eval echo configure:1385: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1398: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_header_slect_nonstd_hdr=no
 else
@@ -1401,12 +1414,12 @@
 
 fi
 echo $ac_n "checking if sys/select.h is needed for select""... $ac_c" 1>&6
-echo "configure:1405: checking if sys/select.h is needed for select" >&5
+echo "configure:1418: checking if sys/select.h is needed for select" >&5
 if eval "test \"`echo '$''{'ac_cv_header_need_sys_select_h'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1410 "configure"
+#line 1423 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/time.h>
@@ -1418,7 +1431,7 @@
 fd_set rfd; FD_ZERO(&rfd); select(1, &rfd, 0, 0, 0);
 ; return 0; }
 EOF
-if { (eval echo configure:1422: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1435: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_header_need_sys_select_h=yes
 else
@@ -1437,21 +1450,58 @@
 EOF
 
 fi
+echo $ac_n "checking if sys/socket.h is needed for select""... $ac_c" 1>&6
+echo "configure:1455: checking if sys/socket.h is needed for select" >&5
+if eval "test \"`echo '$''{'ac_cv_header_need_sys_socket_h'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1460 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/time.h>
+#include <sys/socket.h>
+#ifndef	SELECT_NONSTD_HDR
+do not compile if we do not need nonstandard headers
+#endif
+int main() {
+fd_set rfd; FD_ZERO(&rfd); select(1, &rfd, 0, 0, 0);
+; return 0; }
+EOF
+if { (eval echo configure:1472: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_header_need_sys_socket_h=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_header_need_sys_socket_h=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_header_need_sys_socket_h" 1>&6
+if test $ac_cv_header_need_sys_socket_h = yes; then
+  cat >> confdefs.h <<\EOF
+#define NEED_SYS_SOCKET_H 1
+EOF
+
+fi
 for ac_hdr in varargs.h stdarg.h stdlib.h string.h strings.h unistd.h fcntl.h sys/file.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1445: checking for $ac_hdr" >&5
+echo "configure:1495: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1450 "configure"
+#line 1500 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1455: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1505: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1481,17 +1531,17 @@
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1485: checking for $ac_hdr" >&5
+echo "configure:1535: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1490 "configure"
+#line 1540 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1495: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1545: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1521,17 +1571,17 @@
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1525: checking for $ac_hdr" >&5
+echo "configure:1575: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1530 "configure"
+#line 1580 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1535: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1585: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1561,17 +1611,17 @@
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1565: checking for $ac_hdr" >&5
+echo "configure:1615: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1570 "configure"
+#line 1620 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1575: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1625: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1601,17 +1651,17 @@
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1605: checking for $ac_hdr" >&5
+echo "configure:1655: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1610 "configure"
+#line 1660 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1615: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1665: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1637,21 +1687,21 @@
 fi
 done
 
-for ac_hdr in shadow.h syslog.h
+for ac_hdr in pwd.h grp.h sys/acl.h acllib.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1645: checking for $ac_hdr" >&5
+echo "configure:1695: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1650 "configure"
+#line 1700 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1655: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1705: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1677,21 +1727,21 @@
 fi
 done
 
-for ac_hdr in sys/time.h sys/times.h utime.h sys/utime.h sys/ioctl.h sys/filio.h sys/param.h sys/systeminfo.h
+for ac_hdr in shadow.h syslog.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1685: checking for $ac_hdr" >&5
+echo "configure:1735: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1690 "configure"
+#line 1740 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1695: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1745: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1717,21 +1767,21 @@
 fi
 done
 
-for ac_hdr in mntent.h sys/mntent.h sys/mnttab.h sys/mount.h
+for ac_hdr in sys/time.h sys/times.h utime.h sys/utime.h sys/ioctl.h sys/filio.h sys/param.h sys/systeminfo.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1725: checking for $ac_hdr" >&5
+echo "configure:1775: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1730 "configure"
+#line 1780 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1735: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1785: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1757,21 +1807,21 @@
 fi
 done
 
-for ac_hdr in wait.h sys/resource.h sys/procfs.h
+for ac_hdr in sys/syscall.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1765: checking for $ac_hdr" >&5
+echo "configure:1815: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1770 "configure"
+#line 1820 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1775: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1825: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1797,21 +1847,21 @@
 fi
 done
 
-for ac_hdr in sys/utsname.h sys/priocntl.h sys/rtpriocntl.h
+for ac_hdr in mntent.h sys/mntent.h sys/mnttab.h sys/mount.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1805: checking for $ac_hdr" >&5
+echo "configure:1855: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1810 "configure"
+#line 1860 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1815: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1865: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1837,21 +1887,21 @@
 fi
 done
 
-for ac_hdr in sys/mtio.h sys/mman.h linux/pg.h camlib.h
+for ac_hdr in wait.h sys/resource.h sys/procfs.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1845: checking for $ac_hdr" >&5
+echo "configure:1895: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1850 "configure"
+#line 1900 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1855: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1905: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1877,21 +1927,21 @@
 fi
 done
 
-for ac_hdr in sys/shm.h sys/ipc.h
+for ac_hdr in sys/utsname.h sys/priocntl.h sys/rtpriocntl.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1885: checking for $ac_hdr" >&5
+echo "configure:1935: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1890 "configure"
+#line 1940 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1895: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1945: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1917,21 +1967,21 @@
 fi
 done
 
-for ac_hdr in sys/dkio.h sys/dklabel.h sun/dkio.h sun/dklabel.h
+for ac_hdr in sys/mtio.h sys/mman.h linux/pg.h camlib.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1925: checking for $ac_hdr" >&5
+echo "configure:1975: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1930 "configure"
+#line 1980 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1935: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1985: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1957,21 +2007,21 @@
 fi
 done
 
-for ac_hdr in poll.h sys/poll.h sys/select.h
+for ac_hdr in sys/shm.h sys/ipc.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1965: checking for $ac_hdr" >&5
+echo "configure:2015: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1970 "configure"
+#line 2020 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1975: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:2025: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1997,21 +2047,21 @@
 fi
 done
 
-for ac_hdr in ieeefp.h fp.h
+for ac_hdr in sys/dkio.h sys/dklabel.h sun/dkio.h sun/dklabel.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:2005: checking for $ac_hdr" >&5
+echo "configure:2055: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2010 "configure"
+#line 2060 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:2015: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:2065: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -2037,21 +2087,21 @@
 fi
 done
 
-for ac_hdr in values.h float.h
+for ac_hdr in sys/types.h sys/stat.h types.h stat.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:2045: checking for $ac_hdr" >&5
+echo "configure:2095: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2050 "configure"
+#line 2100 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:2055: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:2105: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -2077,21 +2127,21 @@
 fi
 done
 
-for ac_hdr in bsd/dev/scsireg.h
+for ac_hdr in poll.h sys/poll.h sys/select.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:2085: checking for $ac_hdr" >&5
+echo "configure:2135: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2090 "configure"
+#line 2140 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:2095: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:2145: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -2117,411 +2167,691 @@
 fi
 done
 
-
-echo $ac_n "checking for header file containing  major(), minor() and makedev()""... $ac_c" 1>&6
-echo "configure:2123: checking for header file containing  major(), minor() and makedev()" >&5
-if eval "test \"`echo '$''{'ac_cv_header_makedev'+set}'`\" = set"; then
+for ac_hdr in netdb.h sys/socket.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2175: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  ac_cv_header_makedev=none
-cat > conftest.$ac_ext <<EOF
-#line 2129 "configure"
+  cat > conftest.$ac_ext <<EOF
+#line 2180 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/mkdev.h>
-int main() {
-int i = major(0); i = minor(0); i = makedev(0,0);
-; return 0; }
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:2137: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2185: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
   rm -rf conftest*
-  ac_cv_header_makedev=sys/mkdev.h
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
 fi
 rm -f conftest*
-if test $ac_cv_header_makedev = none; then
+fi
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
+EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
+
+for ac_hdr in ieeefp.h fp.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2215: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
   cat > conftest.$ac_ext <<EOF
-#line 2147 "configure"
+#line 2220 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/sysmacros.h>
-int main() {
-int i = major(0); i = minor(0); i = makedev(0,0);
-; return 0; }
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:2155: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2225: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
   rm -rf conftest*
-  ac_cv_header_makedev=sys/sysmacros.h
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
 fi
 rm -f conftest*
 fi
-fi
-
-echo "$ac_t""$ac_cv_header_makedev" 1>&6
-if test $ac_cv_header_makedev = sys/mkdev.h; then
-  cat >> confdefs.h <<\EOF
-#define MAJOR_IN_MKDEV 1
-EOF
-
-fi
-if test $ac_cv_header_makedev = sys/sysmacros.h; then
-  cat >> confdefs.h <<\EOF
-#define MAJOR_IN_SYSMACROS 1
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
+done
 
-
-echo $ac_n "checking bits in minor device number""... $ac_c" 1>&6
-echo "configure:2182: checking bits in minor device number" >&5
-if eval "test \"`echo '$''{'ac_cv_dev_minor_bits'+set}'`\" = set"; then
+for ac_hdr in values.h float.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2255: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
-else
   cat > conftest.$ac_ext <<EOF
-#line 2190 "configure"
+#line 2260 "configure"
 #include "confdefs.h"
-#include <stdio.h>
-#include <sys/types.h>
-#ifdef major
-#	define _FOUND_MAJOR_
-#endif
-
-#ifdef MAJOR_IN_MKDEV
-#	include <sys/mkdev.h>
-#	define _FOUND_MAJOR_
-#endif
-
-#ifndef _FOUND_MAJOR_
-#	ifdef MAJOR_IN_SYSMACROS
-#		include <sys/sysmacros.h>
-#		define _FOUND_MAJOR_
-#	endif
-#endif
-
-#ifndef _FOUND_MAJOR_
-#	if defined(hpux) || defined(__hpux__) || defined(__hpux)
-#		include <sys/mknod.h>
-#		define _FOUND_MAJOR_
-#	endif
-#endif
-
-#ifndef _FOUND_MAJOR_
-#	define major(dev)		(((dev) >> 8) & 0xFF)
-#	define minor(dev)		((dev) & 0xFF)
-#	define makedev(majo, mino)	(((majo) << 8) | (mino))
-#endif
-int
-main()
-{
-	long	l = 1;
-	int	i;
-	int	m;
-	int	c = 0;
-	FILE	*f=fopen("conftestval", "w");
-
-	if (!f) exit(1);
-
-	for (i=1, m=0; i <= 32; i++, l<<=1) {
-		if (minor(l) == 0 && c == 0)
-			c = m;
-		if (minor(l) != 0)
-			m = i;
-	}
-	fprintf(f, "%d\n", m);
-	exit(0);
-}
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:2243: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_dev_minor_bits=`cat conftestval`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2265: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_dev_minor_bits=0
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
 fi
-
+rm -f conftest*
 fi
-echo "$ac_t""$ac_cv_dev_minor_bits" 1>&6
-cat >> confdefs.h <<EOF
-#define DEV_MINOR_BITS $ac_cv_dev_minor_bits
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
 EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
 
-
-echo $ac_n "checking whether bits in minor device numbers are non contiguous""... $ac_c" 1>&6
-echo "configure:2263: checking whether bits in minor device numbers are non contiguous" >&5
-if eval "test \"`echo '$''{'ac_cv_dev_minor_noncontig'+set}'`\" = set"; then
+for ac_hdr in arpa/inet.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2295: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
-else
   cat > conftest.$ac_ext <<EOF
-#line 2271 "configure"
+#line 2300 "configure"
 #include "confdefs.h"
-
-#include <sys/types.h>
-#ifdef major
-#	define _FOUND_MAJOR_
-#endif
-
-#ifdef MAJOR_IN_MKDEV
-#	include <sys/mkdev.h>
-#	define _FOUND_MAJOR_
-#endif
-
-#ifndef _FOUND_MAJOR_
-#	ifdef MAJOR_IN_SYSMACROS
-#		include <sys/sysmacros.h>
-#		define _FOUND_MAJOR_
-#	endif
-#endif
-
-#ifndef _FOUND_MAJOR_
-#	if defined(hpux) || defined(__hpux__) || defined(__hpux)
-#		include <sys/mknod.h>
-#		define _FOUND_MAJOR_
-#	endif
-#endif
-
-#ifndef _FOUND_MAJOR_
-#	define major(dev)		(((dev) >> 8) & 0xFF)
-#	define minor(dev)		((dev) & 0xFF)
-#	define makedev(majo, mino)	(((majo) << 8) | (mino))
-#endif
-int
-main()
-{
-	long	l = 1;
-	int	i;
-	int	m;
-	int	c = 0;
-
-	for (i=1, m=0; i <= 32; i++, l<<=1) {
-		if (minor(l) == 0 && c == 0)
-			c = m;
-		if (minor(l) != 0)
-			m = i;
-	}
-exit (m == c);}
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:2319: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_dev_minor_noncontig=yes
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2305: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_dev_minor_noncontig=no
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
 fi
-
+rm -f conftest*
 fi
-
-echo "$ac_t""$ac_cv_dev_minor_noncontig" 1>&6
-if test $ac_cv_dev_minor_noncontig = yes; then
-  cat >> confdefs.h <<\EOF
-#define DEV_MINOR_NONCONTIG 1
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
+done
 
-echo $ac_n "checking for _filbuf()""... $ac_c" 1>&6
-echo "configure:2342: checking for _filbuf()" >&5
-if eval "test \"`echo '$''{'ac_cv_header__filbuf'+set}'`\" = set"; then
+for ac_hdr in bsd/dev/scsireg.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2335: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2347 "configure"
+#line 2340 "configure"
 #include "confdefs.h"
-#include <stdio.h>
-int main() {
-FILE    *f;
-int     flag;
-int     count;
-char    *ptr;
-char	c = 0;
-f = fopen("confdefs.h", "r");
-_filbuf(f);
-_flsbuf(c, f);
-flag  = f->_flag & _IONBF;
-flag |= f->_flag & _IOERR;
-flag |= f->_flag & _IOEOF;
-count = f->_cnt;
-ptr = (char *)f->_ptr;
-fclose(f);
-; return 0; }
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:2367: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2345: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
   rm -rf conftest*
-  ac_cv_header__filbuf=yes
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_header__filbuf=no
+  eval "ac_cv_header_$ac_safe=no"
 fi
 rm -f conftest*
 fi
-
-echo "$ac_t""$ac_cv_header__filbuf" 1>&6
-if test $ac_cv_header__filbuf = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE__FILBUF 1
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for __filbuf()""... $ac_c" 1>&6
-echo "configure:2387: checking for __filbuf()" >&5
-if eval "test \"`echo '$''{'ac_cv_header___filbuf'+set}'`\" = set"; then
+done
+
+for ac_hdr in sys/bsdtty.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2375: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2392 "configure"
+#line 2380 "configure"
 #include "confdefs.h"
-#include <stdio.h>
-int main() {
-FILE    *f;
-int     flag;
-int     count;
-char    *ptr;
-char	c = 0;
-f = fopen("confdefs.h", "r");
-__filbuf(f);
-__flsbuf(c, f);
-flag  = f->_flag & _IONBF;
-flag |= f->_flag & _IOERR;
-flag |= f->_flag & _IOEOF;
-count = f->_cnt;
-ptr = (char *)f->_ptr;
-fclose(f);
-; return 0; }
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:2412: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2385: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
   rm -rf conftest*
-  ac_cv_header___filbuf=yes
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_header___filbuf=no
+  eval "ac_cv_header_$ac_safe=no"
 fi
 rm -f conftest*
 fi
-
-echo "$ac_t""$ac_cv_header___filbuf" 1>&6
-if test $ac_cv_header___filbuf = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE___FILBUF 1
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for USG derived STDIO""... $ac_c" 1>&6
-echo "configure:2432: checking for USG derived STDIO" >&5
-if eval "test \"`echo '$''{'ac_cv_header_usg_stdio'+set}'`\" = set"; then
+done
+
+for ac_hdr in OS.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2415: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2437 "configure"
+#line 2420 "configure"
 #include "confdefs.h"
-#include <stdio.h>
-int main() {
-FILE    *f;
-int     flag;
-int     count;
-char    *ptr;
-char	c = 0;
-f = fopen("confdefs.h", "r");
-#ifdef	HAVE___FILBUF
-__filbuf(f);
-__flsbuf(c, f);
-#else
-#	ifdef	HAVE__FILBUF
-_filbuf(f);
-_flsbuf(c, f);
-#	else
-no filbuf()
-#	endif
-#endif
-flag  = f->_flag & _IONBF;
-flag |= f->_flag & _IOERR;
-flag |= f->_flag & _IOEOF;
-count = f->_cnt;
-ptr = (char *)f->_ptr;
-fclose(f);
-; return 0; }
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:2466: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2425: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
   rm -rf conftest*
-  ac_cv_header_usg_stdio=yes
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_header_usg_stdio=no
+  eval "ac_cv_header_$ac_safe=no"
 fi
 rm -f conftest*
 fi
-
-echo "$ac_t""$ac_cv_header_usg_stdio" 1>&6
-if test $ac_cv_header_usg_stdio = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_USG_STDIO 1
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for errno definition in errno.h""... $ac_c" 1>&6
-echo "configure:2486: checking for errno definition in errno.h" >&5
-if eval "test \"`echo '$''{'ac_cv_header_errno_def'+set}'`\" = set"; then
+done
+
+
+echo $ac_n "checking for header file containing  major(), minor() and makedev()""... $ac_c" 1>&6
+echo "configure:2453: checking for header file containing  major(), minor() and makedev()" >&5
+if eval "test \"`echo '$''{'ac_cv_header_makedev'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  cat > conftest.$ac_ext <<EOF
-#line 2491 "configure"
+  ac_cv_header_makedev=none
+cat > conftest.$ac_ext <<EOF
+#line 2459 "configure"
 #include "confdefs.h"
-#include <errno.h>
+#include <sys/types.h>
+#include <sys/mkdev.h>
 int main() {
-errno = 0;
+int i = major(0); i = minor(0); i = makedev(0,0);
 ; return 0; }
 EOF
-if { (eval echo configure:2498: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2467: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_header_errno_def=yes
+  ac_cv_header_makedev=sys/mkdev.h
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
+fi
+rm -f conftest*
+if test $ac_cv_header_makedev = none; then
+  cat > conftest.$ac_ext <<EOF
+#line 2477 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/sysmacros.h>
+int main() {
+int i = major(0); i = minor(0); i = makedev(0,0);
+; return 0; }
+EOF
+if { (eval echo configure:2485: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_header_errno_def=no
+  ac_cv_header_makedev=sys/sysmacros.h
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
 fi
 rm -f conftest*
 fi
+fi
 
-echo "$ac_t""$ac_cv_header_errno_def" 1>&6
-if test $ac_cv_header_errno_def = yes; then
+echo "$ac_t""$ac_cv_header_makedev" 1>&6
+if test $ac_cv_header_makedev = sys/mkdev.h; then
   cat >> confdefs.h <<\EOF
-#define HAVE_ERRNO_DEF 1
+#define MAJOR_IN_MKDEV 1
 EOF
 
 fi
+if test $ac_cv_header_makedev = sys/sysmacros.h; then
+  cat >> confdefs.h <<\EOF
+#define MAJOR_IN_SYSMACROS 1
+EOF
 
-echo $ac_n "checking for working const""... $ac_c" 1>&6
-echo "configure:2519: checking for working const" >&5
-if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  cat > conftest.$ac_ext <<EOF
-#line 2524 "configure"
-#include "confdefs.h"
+fi
+
+
+echo $ac_n "checking bits in minor device number""... $ac_c" 1>&6
+echo "configure:2512: checking bits in minor device number" >&5
+if eval "test \"`echo '$''{'ac_cv_dev_minor_bits'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+else
+  cat > conftest.$ac_ext <<EOF
+#line 2520 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+#include <sys/types.h>
+#ifdef major
+#	define _FOUND_MAJOR_
+#endif
+
+#ifdef MAJOR_IN_MKDEV
+#	include <sys/mkdev.h>
+#	define _FOUND_MAJOR_
+#endif
+
+#ifndef _FOUND_MAJOR_
+#	ifdef MAJOR_IN_SYSMACROS
+#		include <sys/sysmacros.h>
+#		define _FOUND_MAJOR_
+#	endif
+#endif
+
+#ifndef _FOUND_MAJOR_
+#	if defined(hpux) || defined(__hpux__) || defined(__hpux)
+#		include <sys/mknod.h>
+#		define _FOUND_MAJOR_
+#	endif
+#endif
+
+#ifndef _FOUND_MAJOR_
+#	define major(dev)		(((dev) >> 8) & 0xFF)
+#	define minor(dev)		((dev) & 0xFF)
+#	define makedev(majo, mino)	(((majo) << 8) | (mino))
+#endif
+int
+main()
+{
+	long	l = 1;
+	int	i;
+	int	m;
+	int	c = 0;
+	FILE	*f=fopen("conftestval", "w");
+
+	if (!f) exit(1);
+
+	for (i=1, m=0; i <= 32; i++, l<<=1) {
+		if (minor(l) == 0 && c == 0)
+			c = m;
+		if (minor(l) != 0)
+			m = i;
+	}
+	fprintf(f, "%d\n", m);
+	exit(0);
+}
+EOF
+if { (eval echo configure:2573: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_dev_minor_bits=`cat conftestval`
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -fr conftest*
+  ac_cv_dev_minor_bits=0
+fi
+rm -fr conftest*
+fi
+
+fi
+echo "$ac_t""$ac_cv_dev_minor_bits" 1>&6
+cat >> confdefs.h <<EOF
+#define DEV_MINOR_BITS $ac_cv_dev_minor_bits
+EOF
+
+
+echo $ac_n "checking whether bits in minor device numbers are non contiguous""... $ac_c" 1>&6
+echo "configure:2593: checking whether bits in minor device numbers are non contiguous" >&5
+if eval "test \"`echo '$''{'ac_cv_dev_minor_noncontig'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+else
+  cat > conftest.$ac_ext <<EOF
+#line 2601 "configure"
+#include "confdefs.h"
+
+#include <sys/types.h>
+#ifdef major
+#	define _FOUND_MAJOR_
+#endif
+
+#ifdef MAJOR_IN_MKDEV
+#	include <sys/mkdev.h>
+#	define _FOUND_MAJOR_
+#endif
+
+#ifndef _FOUND_MAJOR_
+#	ifdef MAJOR_IN_SYSMACROS
+#		include <sys/sysmacros.h>
+#		define _FOUND_MAJOR_
+#	endif
+#endif
+
+#ifndef _FOUND_MAJOR_
+#	if defined(hpux) || defined(__hpux__) || defined(__hpux)
+#		include <sys/mknod.h>
+#		define _FOUND_MAJOR_
+#	endif
+#endif
+
+#ifndef _FOUND_MAJOR_
+#	define major(dev)		(((dev) >> 8) & 0xFF)
+#	define minor(dev)		((dev) & 0xFF)
+#	define makedev(majo, mino)	(((majo) << 8) | (mino))
+#endif
+int
+main()
+{
+	long	l = 1;
+	int	i;
+	int	m;
+	int	c = 0;
+
+	for (i=1, m=0; i <= 32; i++, l<<=1) {
+		if (minor(l) == 0 && c == 0)
+			c = m;
+		if (minor(l) != 0)
+			m = i;
+	}
+exit (m == c);}
+EOF
+if { (eval echo configure:2649: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_dev_minor_noncontig=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -fr conftest*
+  ac_cv_dev_minor_noncontig=no
+fi
+rm -fr conftest*
+fi
+
+fi
+
+echo "$ac_t""$ac_cv_dev_minor_noncontig" 1>&6
+if test $ac_cv_dev_minor_noncontig = yes; then
+  cat >> confdefs.h <<\EOF
+#define DEV_MINOR_NONCONTIG 1
+EOF
+
+fi
+
+echo $ac_n "checking for _filbuf()""... $ac_c" 1>&6
+echo "configure:2672: checking for _filbuf()" >&5
+if eval "test \"`echo '$''{'ac_cv_func__filbuf'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 2677 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+FILE    *f;
+int     flag;
+int     count;
+char    *ptr;
+char	c = 0;
+f = fopen("confdefs.h", "r");
+_filbuf(f);
+_flsbuf(c, f);
+flag  = f->_flag & _IONBF;
+flag |= f->_flag & _IOERR;
+flag |= f->_flag & _IOEOF;
+count = f->_cnt;
+ptr = (char *)f->_ptr;
+fclose(f);
+; return 0; }
+EOF
+if { (eval echo configure:2697: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func__filbuf=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_func__filbuf=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_func__filbuf" 1>&6
+if test $ac_cv_func__filbuf = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE__FILBUF 1
+EOF
+
+fi
+echo $ac_n "checking for __filbuf()""... $ac_c" 1>&6
+echo "configure:2717: checking for __filbuf()" >&5
+if eval "test \"`echo '$''{'ac_cv_func___filbuf'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 2722 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+FILE    *f;
+int     flag;
+int     count;
+char    *ptr;
+char	c = 0;
+f = fopen("confdefs.h", "r");
+__filbuf(f);
+__flsbuf(c, f);
+flag  = f->_flag & _IONBF;
+flag |= f->_flag & _IOERR;
+flag |= f->_flag & _IOEOF;
+count = f->_cnt;
+ptr = (char *)f->_ptr;
+fclose(f);
+; return 0; }
+EOF
+if { (eval echo configure:2742: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func___filbuf=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_func___filbuf=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_func___filbuf" 1>&6
+if test $ac_cv_func___filbuf = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE___FILBUF 1
+EOF
+
+fi
+echo $ac_n "checking for USG derived STDIO""... $ac_c" 1>&6
+echo "configure:2762: checking for USG derived STDIO" >&5
+if eval "test \"`echo '$''{'ac_cv_header_usg_stdio'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 2767 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+FILE    *f;
+int     flag;
+int     count;
+char    *ptr;
+char	c = 0;
+f = fopen("confdefs.h", "r");
+#ifdef	HAVE___FILBUF
+__filbuf(f);
+__flsbuf(c, f);
+#else
+#	ifdef	HAVE__FILBUF
+_filbuf(f);
+_flsbuf(c, f);
+#	else
+no filbuf()
+#	endif
+#endif
+flag  = f->_flag & _IONBF;
+flag |= f->_flag & _IOERR;
+flag |= f->_flag & _IOEOF;
+count = f->_cnt;
+ptr = (char *)f->_ptr;
+fclose(f);
+; return 0; }
+EOF
+if { (eval echo configure:2796: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_header_usg_stdio=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_header_usg_stdio=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_header_usg_stdio" 1>&6
+if test $ac_cv_header_usg_stdio = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_USG_STDIO 1
+EOF
+
+fi
+echo $ac_n "checking for errno definition in errno.h""... $ac_c" 1>&6
+echo "configure:2816: checking for errno definition in errno.h" >&5
+if eval "test \"`echo '$''{'ac_cv_header_errno_def'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 2821 "configure"
+#include "confdefs.h"
+#include <errno.h>
+int main() {
+errno = 0;
+; return 0; }
+EOF
+if { (eval echo configure:2828: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_header_errno_def=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_header_errno_def=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_header_errno_def" 1>&6
+if test $ac_cv_header_errno_def = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_ERRNO_DEF 1
+EOF
+
+fi
+
+echo $ac_n "checking for working const""... $ac_c" 1>&6
+echo "configure:2849: checking for working const" >&5
+if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 2854 "configure"
+#include "confdefs.h"
 
 int main() {
 
@@ -2569,7 +2899,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:2573: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2903: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_c_const=yes
 else
@@ -2590,14 +2920,14 @@
 fi
 
 echo $ac_n "checking whether byte ordering is bigendian""... $ac_c" 1>&6
-echo "configure:2594: checking whether byte ordering is bigendian" >&5
+echo "configure:2924: checking whether byte ordering is bigendian" >&5
 if eval "test \"`echo '$''{'ac_cv_c_bigendian'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_cv_c_bigendian=unknown
 # See if sys/param.h defines the BYTE_ORDER macro.
 cat > conftest.$ac_ext <<EOF
-#line 2601 "configure"
+#line 2931 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/param.h>
@@ -2608,11 +2938,11 @@
 #endif
 ; return 0; }
 EOF
-if { (eval echo configure:2612: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2942: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   # It does; now see whether it defined to BIG_ENDIAN or not.
 cat > conftest.$ac_ext <<EOF
-#line 2616 "configure"
+#line 2946 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/param.h>
@@ -2623,7 +2953,7 @@
 #endif
 ; return 0; }
 EOF
-if { (eval echo configure:2627: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2957: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_c_bigendian=yes
 else
@@ -2643,7 +2973,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 2647 "configure"
+#line 2977 "configure"
 #include "confdefs.h"
 main () {
   /* Are we little or big endian?  From Harbison&Steele.  */
@@ -2656,7 +2986,7 @@
   exit (u.c[sizeof (long) - 1] == 1);
 }
 EOF
-if { (eval echo configure:2660: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:2990: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_c_bigendian=no
 else
@@ -2680,7 +3010,7 @@
 fi
 
 echo $ac_n "checking whether bitorder in bitfields is htol""... $ac_c" 1>&6
-echo "configure:2684: checking whether bitorder in bitfields is htol" >&5
+echo "configure:3014: checking whether bitorder in bitfields is htol" >&5
 if eval "test \"`echo '$''{'ac_cv_c_bitfields_htol'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2688,7 +3018,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 2692 "configure"
+#line 3022 "configure"
 #include "confdefs.h"
 
 struct {
@@ -2704,7 +3034,7 @@
 *cp = 0x12;
 exit(a.x1 == 2);}
 EOF
-if { (eval echo configure:2708: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3038: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_c_bitfields_htol=yes
 else
@@ -2726,12 +3056,12 @@
 
 fi
 echo $ac_n "checking return type of signal handlers""... $ac_c" 1>&6
-echo "configure:2730: checking return type of signal handlers" >&5
+echo "configure:3060: checking return type of signal handlers" >&5
 if eval "test \"`echo '$''{'ac_cv_type_signal'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2735 "configure"
+#line 3065 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <signal.h>
@@ -2748,7 +3078,7 @@
 int i;
 ; return 0; }
 EOF
-if { (eval echo configure:2752: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3082: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_type_signal=void
 else
@@ -2767,12 +3097,12 @@
 
 
 echo $ac_n "checking for uid_t in sys/types.h""... $ac_c" 1>&6
-echo "configure:2771: checking for uid_t in sys/types.h" >&5
+echo "configure:3101: checking for uid_t in sys/types.h" >&5
 if eval "test \"`echo '$''{'ac_cv_type_uid_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2776 "configure"
+#line 3106 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 EOF
@@ -2801,7 +3131,7 @@
 fi
 
 echo $ac_n "checking type of array argument to getgroups""... $ac_c" 1>&6
-echo "configure:2805: checking type of array argument to getgroups" >&5
+echo "configure:3135: checking type of array argument to getgroups" >&5
 if eval "test \"`echo '$''{'ac_cv_type_getgroups'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2809,7 +3139,7 @@
   ac_cv_type_getgroups=cross
 else
   cat > conftest.$ac_ext <<EOF
-#line 2813 "configure"
+#line 3143 "configure"
 #include "confdefs.h"
 
 /* Thanks to Mike Rendell for this test.  */
@@ -2834,7 +3164,7 @@
 }
 
 EOF
-if { (eval echo configure:2838: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3168: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
     ac_cv_type_getgroups=gid_t
 else
@@ -2848,7 +3178,7 @@
 
 if test $ac_cv_type_getgroups = cross; then
         cat > conftest.$ac_ext <<EOF
-#line 2852 "configure"
+#line 3182 "configure"
 #include "confdefs.h"
 #include <unistd.h>
 EOF
@@ -2872,19 +3202,19 @@
 
 
 echo $ac_n "checking for type long long""... $ac_c" 1>&6
-echo "configure:2876: checking for type long long" >&5
+echo "configure:3206: checking for type long long" >&5
 if eval "test \"`echo '$''{'ac_cv_type_longlong'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2881 "configure"
+#line 3211 "configure"
 #include "confdefs.h"
 
 int main() {
 long long i;
 ; return 0; }
 EOF
-if { (eval echo configure:2888: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3218: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_type_longlong=yes
 else
@@ -2904,7 +3234,7 @@
 
 fi
 echo $ac_n "checking for prototypes""... $ac_c" 1>&6
-echo "configure:2908: checking for prototypes" >&5
+echo "configure:3238: checking for prototypes" >&5
 if eval "test \"`echo '$''{'ac_cv_type_prototypes'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2912,7 +3242,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 2916 "configure"
+#line 3246 "configure"
 #include "confdefs.h"
 
 doit(int i, ...)
@@ -2922,7 +3252,7 @@
 { doit(1, 2, 3);
 exit(0);}
 EOF
-if { (eval echo configure:2926: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3256: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_type_prototypes=yes
 else
@@ -2944,12 +3274,12 @@
 
 fi
 echo $ac_n "checking if we may not define our own malloc()""... $ac_c" 1>&6
-echo "configure:2948: checking if we may not define our own malloc()" >&5
+echo "configure:3278: checking if we may not define our own malloc()" >&5
 if eval "test \"`echo '$''{'ac_cv_no_user_malloc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2953 "configure"
+#line 3283 "configure"
 #include "confdefs.h"
 
 char * malloc(x)
@@ -2961,7 +3291,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:2965: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3295: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_no_user_malloc=no
 else
@@ -2980,14 +3310,46 @@
 EOF
 
 fi
+echo $ac_n "checking if compiler allows dynamic arrays""... $ac_c" 1>&6
+echo "configure:3315: checking if compiler allows dynamic arrays" >&5
+if eval "test \"`echo '$''{'ac_cv_dyn_arrays'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 3320 "configure"
+#include "confdefs.h"
+
+int main() {
+extern int __aa(); int len = __aa(); char some_array[len];
+; return 0; }
+EOF
+if { (eval echo configure:3327: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_dyn_arrays=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_dyn_arrays=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_dyn_arrays" 1>&6
+if test $ac_cv_dyn_arrays = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_DYN_ARRAYS 1
+EOF
+
+fi
 
 echo $ac_n "checking for uid_t in sys/types.h""... $ac_c" 1>&6
-echo "configure:2986: checking for uid_t in sys/types.h" >&5
+echo "configure:3348: checking for uid_t in sys/types.h" >&5
 if eval "test \"`echo '$''{'ac_cv_type_uid_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2991 "configure"
+#line 3353 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 EOF
@@ -3016,12 +3378,12 @@
 fi
 
 echo $ac_n "checking for size_t""... $ac_c" 1>&6
-echo "configure:3020: checking for size_t" >&5
+echo "configure:3382: checking for size_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_size_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3025 "configure"
+#line 3387 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3048,13 +3410,46 @@
 
 fi
 
+echo $ac_n "checking for ssize_t""... $ac_c" 1>&6
+echo "configure:3415: checking for ssize_t" >&5
+if eval "test \"`echo '$''{'ac_cv_type_ssize_t'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 3420 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#if STDC_HEADERS
+#include <stdlib.h>
+#include <stddef.h>
+#endif
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "(^|[^a-zA-Z_0-9])ssize_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  rm -rf conftest*
+  ac_cv_type_ssize_t=yes
+else
+  rm -rf conftest*
+  ac_cv_type_ssize_t=no
+fi
+rm -f conftest*
+
+fi
+echo "$ac_t""$ac_cv_type_ssize_t" 1>&6
+if test $ac_cv_type_ssize_t = no; then
+  cat >> confdefs.h <<\EOF
+#define ssize_t int
+EOF
+
+fi
+
 echo $ac_n "checking for pid_t""... $ac_c" 1>&6
-echo "configure:3053: checking for pid_t" >&5
+echo "configure:3448: checking for pid_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_pid_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3058 "configure"
+#line 3453 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3082,12 +3477,12 @@
 fi
 
 echo $ac_n "checking for off_t""... $ac_c" 1>&6
-echo "configure:3086: checking for off_t" >&5
+echo "configure:3481: checking for off_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_off_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3091 "configure"
+#line 3486 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3115,12 +3510,12 @@
 fi
 
 echo $ac_n "checking for mode_t""... $ac_c" 1>&6
-echo "configure:3119: checking for mode_t" >&5
+echo "configure:3514: checking for mode_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_mode_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3124 "configure"
+#line 3519 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3148,12 +3543,12 @@
 fi
 
 echo $ac_n "checking for time_t""... $ac_c" 1>&6
-echo "configure:3152: checking for time_t" >&5
+echo "configure:3547: checking for time_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_time_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3157 "configure"
+#line 3552 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
@@ -3171,7 +3566,7 @@
 time_t t;
 ; return 0; }
 EOF
-if { (eval echo configure:3175: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3570: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_type_time_t=yes
 else
@@ -3191,12 +3586,12 @@
 
 fi
 echo $ac_n "checking for caddr_t""... $ac_c" 1>&6
-echo "configure:3195: checking for caddr_t" >&5
+echo "configure:3590: checking for caddr_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_caddr_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3200 "configure"
+#line 3595 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3224,12 +3619,78 @@
 fi
 
 echo $ac_n "checking for daddr_t""... $ac_c" 1>&6
-echo "configure:3228: checking for daddr_t" >&5
+echo "configure:3623: checking for daddr_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_daddr_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3233 "configure"
+#line 3628 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#if STDC_HEADERS
+#include <stdlib.h>
+#include <stddef.h>
+#endif
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "(^|[^a-zA-Z_0-9])daddr_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  rm -rf conftest*
+  ac_cv_type_daddr_t=yes
+else
+  rm -rf conftest*
+  ac_cv_type_daddr_t=no
+fi
+rm -f conftest*
+
+fi
+echo "$ac_t""$ac_cv_type_daddr_t" 1>&6
+if test $ac_cv_type_daddr_t = no; then
+  cat >> confdefs.h <<\EOF
+#define daddr_t long
+EOF
+
+fi
+
+echo $ac_n "checking for dev_t""... $ac_c" 1>&6
+echo "configure:3656: checking for dev_t" >&5
+if eval "test \"`echo '$''{'ac_cv_type_dev_t'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 3661 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#if STDC_HEADERS
+#include <stdlib.h>
+#include <stddef.h>
+#endif
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "(^|[^a-zA-Z_0-9])dev_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  rm -rf conftest*
+  ac_cv_type_dev_t=yes
+else
+  rm -rf conftest*
+  ac_cv_type_dev_t=no
+fi
+rm -f conftest*
+
+fi
+echo "$ac_t""$ac_cv_type_dev_t" 1>&6
+if test $ac_cv_type_dev_t = no; then
+  cat >> confdefs.h <<\EOF
+#define dev_t unsigned short
+EOF
+
+fi
+
+echo $ac_n "checking for ino_t""... $ac_c" 1>&6
+echo "configure:3689: checking for ino_t" >&5
+if eval "test \"`echo '$''{'ac_cv_type_ino_t'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 3694 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3238,31 +3699,31 @@
 #endif
 EOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  egrep "(^|[^a-zA-Z_0-9])daddr_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  egrep "(^|[^a-zA-Z_0-9])ino_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
   rm -rf conftest*
-  ac_cv_type_daddr_t=yes
+  ac_cv_type_ino_t=yes
 else
   rm -rf conftest*
-  ac_cv_type_daddr_t=no
+  ac_cv_type_ino_t=no
 fi
 rm -f conftest*
 
 fi
-echo "$ac_t""$ac_cv_type_daddr_t" 1>&6
-if test $ac_cv_type_daddr_t = no; then
+echo "$ac_t""$ac_cv_type_ino_t" 1>&6
+if test $ac_cv_type_ino_t = no; then
   cat >> confdefs.h <<\EOF
-#define daddr_t long
+#define ino_t unsigned long
 EOF
 
 fi
 
-echo $ac_n "checking for dev_t""... $ac_c" 1>&6
-echo "configure:3261: checking for dev_t" >&5
-if eval "test \"`echo '$''{'ac_cv_type_dev_t'+set}'`\" = set"; then
+echo $ac_n "checking for nlink_t""... $ac_c" 1>&6
+echo "configure:3722: checking for nlink_t" >&5
+if eval "test \"`echo '$''{'ac_cv_type_nlink_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3266 "configure"
+#line 3727 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3271,31 +3732,31 @@
 #endif
 EOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  egrep "(^|[^a-zA-Z_0-9])dev_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  egrep "(^|[^a-zA-Z_0-9])nlink_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
   rm -rf conftest*
-  ac_cv_type_dev_t=yes
+  ac_cv_type_nlink_t=yes
 else
   rm -rf conftest*
-  ac_cv_type_dev_t=no
+  ac_cv_type_nlink_t=no
 fi
 rm -f conftest*
 
 fi
-echo "$ac_t""$ac_cv_type_dev_t" 1>&6
-if test $ac_cv_type_dev_t = no; then
+echo "$ac_t""$ac_cv_type_nlink_t" 1>&6
+if test $ac_cv_type_nlink_t = no; then
   cat >> confdefs.h <<\EOF
-#define dev_t unsigned short
+#define nlink_t unsigned long
 EOF
 
 fi
 
 echo $ac_n "checking for socklen_t""... $ac_c" 1>&6
-echo "configure:3294: checking for socklen_t" >&5
+echo "configure:3755: checking for socklen_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_socklen_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3299 "configure"
+#line 3760 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3324,12 +3785,12 @@
 fi
 
 echo $ac_n "checking for u_char""... $ac_c" 1>&6
-echo "configure:3328: checking for u_char" >&5
+echo "configure:3789: checking for u_char" >&5
 if eval "test \"`echo '$''{'ac_cv_type_u_char'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3333 "configure"
+#line 3794 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3357,12 +3818,12 @@
 fi
 
 echo $ac_n "checking for u_short""... $ac_c" 1>&6
-echo "configure:3361: checking for u_short" >&5
+echo "configure:3822: checking for u_short" >&5
 if eval "test \"`echo '$''{'ac_cv_type_u_short'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3366 "configure"
+#line 3827 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3390,12 +3851,12 @@
 fi
 
 echo $ac_n "checking for u_int""... $ac_c" 1>&6
-echo "configure:3394: checking for u_int" >&5
+echo "configure:3855: checking for u_int" >&5
 if eval "test \"`echo '$''{'ac_cv_type_u_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3399 "configure"
+#line 3860 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3423,12 +3884,12 @@
 fi
 
 echo $ac_n "checking for u_long""... $ac_c" 1>&6
-echo "configure:3427: checking for u_long" >&5
+echo "configure:3888: checking for u_long" >&5
 if eval "test \"`echo '$''{'ac_cv_type_u_long'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3432 "configure"
+#line 3893 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -3457,7 +3918,7 @@
 
 
 echo $ac_n "checking size of char""... $ac_c" 1>&6
-echo "configure:3461: checking size of char" >&5
+echo "configure:3922: checking size of char" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_char'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3465,7 +3926,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3469 "configure"
+#line 3930 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3476,7 +3937,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3480: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3941: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_char=`cat conftestval`
 else
@@ -3496,7 +3957,7 @@
 
 
 echo $ac_n "checking size of short int""... $ac_c" 1>&6
-echo "configure:3500: checking size of short int" >&5
+echo "configure:3961: checking size of short int" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_short_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3504,7 +3965,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3508 "configure"
+#line 3969 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3515,7 +3976,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3519: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3980: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_short_int=`cat conftestval`
 else
@@ -3535,7 +3996,7 @@
 
 
 echo $ac_n "checking size of int""... $ac_c" 1>&6
-echo "configure:3539: checking size of int" >&5
+echo "configure:4000: checking size of int" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3543,7 +4004,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3547 "configure"
+#line 4008 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3554,7 +4015,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3558: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4019: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_int=`cat conftestval`
 else
@@ -3574,7 +4035,7 @@
 
 
 echo $ac_n "checking size of long int""... $ac_c" 1>&6
-echo "configure:3578: checking size of long int" >&5
+echo "configure:4039: checking size of long int" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_long_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3582,7 +4043,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3586 "configure"
+#line 4047 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3593,7 +4054,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3597: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4058: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_long_int=`cat conftestval`
 else
@@ -3613,7 +4074,7 @@
 
 
 echo $ac_n "checking size of long long""... $ac_c" 1>&6
-echo "configure:3617: checking size of long long" >&5
+echo "configure:4078: checking size of long long" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_long_long'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3621,7 +4082,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3625 "configure"
+#line 4086 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3632,7 +4093,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3636: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4097: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_long_long=`cat conftestval`
 else
@@ -3652,7 +4113,7 @@
 
 
 echo $ac_n "checking size of char *""... $ac_c" 1>&6
-echo "configure:3656: checking size of char *" >&5
+echo "configure:4117: checking size of char *" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_char_p'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3660,7 +4121,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3664 "configure"
+#line 4125 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3671,7 +4132,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3675: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4136: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_char_p=`cat conftestval`
 else
@@ -3692,7 +4153,7 @@
 
 
 echo $ac_n "checking size of unsigned char""... $ac_c" 1>&6
-echo "configure:3696: checking size of unsigned char" >&5
+echo "configure:4157: checking size of unsigned char" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_unsigned_char'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3700,7 +4161,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3704 "configure"
+#line 4165 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3711,7 +4172,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3715: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4176: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_unsigned_char=`cat conftestval`
 else
@@ -3731,7 +4192,7 @@
 
 
 echo $ac_n "checking size of unsigned short int""... $ac_c" 1>&6
-echo "configure:3735: checking size of unsigned short int" >&5
+echo "configure:4196: checking size of unsigned short int" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_unsigned_short_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3739,7 +4200,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3743 "configure"
+#line 4204 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3750,7 +4211,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3754: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4215: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_unsigned_short_int=`cat conftestval`
 else
@@ -3770,7 +4231,7 @@
 
 
 echo $ac_n "checking size of unsigned int""... $ac_c" 1>&6
-echo "configure:3774: checking size of unsigned int" >&5
+echo "configure:4235: checking size of unsigned int" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_unsigned_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3778,7 +4239,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3782 "configure"
+#line 4243 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3789,7 +4250,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3793: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4254: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_unsigned_int=`cat conftestval`
 else
@@ -3809,7 +4270,7 @@
 
 
 echo $ac_n "checking size of unsigned long int""... $ac_c" 1>&6
-echo "configure:3813: checking size of unsigned long int" >&5
+echo "configure:4274: checking size of unsigned long int" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_unsigned_long_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3817,7 +4278,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3821 "configure"
+#line 4282 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3828,7 +4289,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3832: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4293: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_unsigned_long_int=`cat conftestval`
 else
@@ -3848,7 +4309,7 @@
 
 
 echo $ac_n "checking size of unsigned long long""... $ac_c" 1>&6
-echo "configure:3852: checking size of unsigned long long" >&5
+echo "configure:4313: checking size of unsigned long long" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_unsigned_long_long'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3856,7 +4317,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3860 "configure"
+#line 4321 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3867,7 +4328,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3871: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4332: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_unsigned_long_long=`cat conftestval`
 else
@@ -3887,7 +4348,7 @@
 
 
 echo $ac_n "checking size of unsigned char *""... $ac_c" 1>&6
-echo "configure:3891: checking size of unsigned char *" >&5
+echo "configure:4352: checking size of unsigned char *" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_unsigned_char_p'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3895,7 +4356,7 @@
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3899 "configure"
+#line 4360 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -3906,7 +4367,7 @@
   exit(0);
 }
 EOF
-if { (eval echo configure:3910: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4371: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_unsigned_char_p=`cat conftestval`
 else
@@ -3927,7 +4388,7 @@
 
 
 echo $ac_n "checking if char is unsigned""... $ac_c" 1>&6
-echo "configure:3931: checking if char is unsigned" >&5
+echo "configure:4392: checking if char is unsigned" >&5
 if eval "test \"`echo '$''{'ac_cv_type_char_unsigned'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3935,7 +4396,7 @@
   ac_cv_type_char_unsigned=no
 else
   cat > conftest.$ac_ext <<EOF
-#line 3939 "configure"
+#line 4400 "configure"
 #include "confdefs.h"
 
 int
@@ -3946,7 +4407,7 @@
 	c = -1;
 	exit(c < 0);}
 EOF
-if { (eval echo configure:3950: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:4411: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_type_char_unsigned=yes
 else
@@ -3968,12 +4429,12 @@
 
 fi
 echo $ac_n "checking if va_list is an array""... $ac_c" 1>&6
-echo "configure:3972: checking if va_list is an array" >&5
+echo "configure:4433: checking if va_list is an array" >&5
 if eval "test \"`echo '$''{'ac_cv_type_va_list_array'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3977 "configure"
+#line 4438 "configure"
 #include "confdefs.h"
 
 #ifdef	HAVE_STDARG_H
@@ -3989,7 +4450,7 @@
 a = b;
 ; return 0; }
 EOF
-if { (eval echo configure:3993: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4454: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_type_va_list_array=no
 else
@@ -4009,12 +4470,12 @@
 
 fi
 echo $ac_n "checking if struct mtget contains mt_type""... $ac_c" 1>&6
-echo "configure:4013: checking if struct mtget contains mt_type" >&5
+echo "configure:4474: checking if struct mtget contains mt_type" >&5
 if eval "test \"`echo '$''{'ac_cv_struct_mtget_type'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4018 "configure"
+#line 4479 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/mtio.h>
@@ -4022,971 +4483,1546 @@
 struct  mtget t; t.mt_type = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:4026: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4487: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_struct_mtget_type=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_struct_mtget_type=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_struct_mtget_type" 1>&6
+if test $ac_cv_struct_mtget_type = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_MTGET_TYPE 1
+EOF
+
+fi
+echo $ac_n "checking if struct mtget contains mt_dsreg""... $ac_c" 1>&6
+echo "configure:4507: checking if struct mtget contains mt_dsreg" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_mtget_dsreg'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 4512 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/mtio.h>
+int main() {
+struct  mtget t; t.mt_dsreg = 0;
+; return 0; }
+EOF
+if { (eval echo configure:4520: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_struct_mtget_dsreg=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_struct_mtget_dsreg=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_struct_mtget_dsreg" 1>&6
+if test $ac_cv_struct_mtget_dsreg = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_MTGET_DSREG 1
+EOF
+
+fi
+echo $ac_n "checking if struct mtget contains mt_erreg""... $ac_c" 1>&6
+echo "configure:4540: checking if struct mtget contains mt_erreg" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_mtget_erreg'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 4545 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/mtio.h>
+int main() {
+struct  mtget t; t.mt_erreg = 0;
+; return 0; }
+EOF
+if { (eval echo configure:4553: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_struct_mtget_erreg=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_struct_mtget_erreg=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_struct_mtget_erreg" 1>&6
+if test $ac_cv_struct_mtget_erreg = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_MTGET_ERREG 1
+EOF
+
+fi
+echo $ac_n "checking if struct mtget contains mt_resid""... $ac_c" 1>&6
+echo "configure:4573: checking if struct mtget contains mt_resid" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_mtget_resid'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 4578 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/mtio.h>
+int main() {
+struct  mtget t; t.mt_resid = 0;
+; return 0; }
+EOF
+if { (eval echo configure:4586: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_struct_mtget_resid=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_struct_mtget_resid=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_struct_mtget_resid" 1>&6
+if test $ac_cv_struct_mtget_resid = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_MTGET_RESID 1
+EOF
+
+fi
+echo $ac_n "checking if struct mtget contains mt_fileno""... $ac_c" 1>&6
+echo "configure:4606: checking if struct mtget contains mt_fileno" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_mtget_fileno'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 4611 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/mtio.h>
+int main() {
+struct  mtget t; t.mt_fileno = 0;
+; return 0; }
+EOF
+if { (eval echo configure:4619: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_struct_mtget_fileno=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_struct_mtget_fileno=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_struct_mtget_fileno" 1>&6
+if test $ac_cv_struct_mtget_fileno = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_MTGET_FILENO 1
+EOF
+
+fi
+echo $ac_n "checking if struct mtget contains mt_blkno""... $ac_c" 1>&6
+echo "configure:4639: checking if struct mtget contains mt_blkno" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_mtget_blkno'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 4644 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/mtio.h>
+int main() {
+struct  mtget t; t.mt_blkno = 0;
+; return 0; }
+EOF
+if { (eval echo configure:4652: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_struct_mtget_blkno=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_struct_mtget_blkno=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_struct_mtget_blkno" 1>&6
+if test $ac_cv_struct_mtget_blkno = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_MTGET_BLKNO 1
+EOF
+
+fi
+echo $ac_n "checking if struct mtget contains mt_flags""... $ac_c" 1>&6
+echo "configure:4672: checking if struct mtget contains mt_flags" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_mtget_flags'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 4677 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/mtio.h>
+int main() {
+struct  mtget t; t.mt_flags = 0;
+; return 0; }
+EOF
+if { (eval echo configure:4685: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_struct_mtget_flags=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_struct_mtget_flags=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_struct_mtget_flags" 1>&6
+if test $ac_cv_struct_mtget_flags = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_MTGET_FLAGS 1
+EOF
+
+fi
+echo $ac_n "checking if struct mtget contains mt_bf""... $ac_c" 1>&6
+echo "configure:4705: checking if struct mtget contains mt_bf" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_mtget_bf'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 4710 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/mtio.h>
+int main() {
+struct  mtget t; t.mt_bf = 0;
+; return 0; }
+EOF
+if { (eval echo configure:4718: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_struct_mtget_bf=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_struct_mtget_bf=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_struct_mtget_bf" 1>&6
+if test $ac_cv_struct_mtget_bf = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_MTGET_BF 1
+EOF
+
+fi
+echo $ac_n "checking if struct rusage is declared in sys/resource.h""... $ac_c" 1>&6
+echo "configure:4738: checking if struct rusage is declared in sys/resource.h" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_rusage'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 4743 "configure"
+#include "confdefs.h"
+#include <sys/time.h>
+#include <sys/resource.h>
+int main() {
+struct rusage r;
+; return 0; }
+EOF
+if { (eval echo configure:4751: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_mtget_type=yes
+  ac_cv_struct_rusage=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_mtget_type=no
+  ac_cv_struct_rusage=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_mtget_type" 1>&6
-if test $ac_cv_struct_mtget_type = yes; then
+echo "$ac_t""$ac_cv_struct_rusage" 1>&6
+if test $ac_cv_struct_rusage = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MTGET_TYPE 1
+#define HAVE_STRUCT_RUSAGE 1
 EOF
 
 fi
-echo $ac_n "checking if struct mtget contains mt_dsreg""... $ac_c" 1>&6
-echo "configure:4046: checking if struct mtget contains mt_dsreg" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_mtget_dsreg'+set}'`\" = set"; then
+echo $ac_n "checking if an illegal declaration for union semun in sys/sem.h exists""... $ac_c" 1>&6
+echo "configure:4771: checking if an illegal declaration for union semun in sys/sem.h exists" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_union_semun'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4051 "configure"
+#line 4776 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#include <sys/mtio.h>
+#include <sys/ipc.h>
+#include <sys/sem.h>
 int main() {
-struct  mtget t; t.mt_dsreg = 0;
+union semun s;
 ; return 0; }
 EOF
-if { (eval echo configure:4059: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4785: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_mtget_dsreg=yes
+  ac_cv_struct_union_semun=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_mtget_dsreg=no
+  ac_cv_struct_union_semun=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_mtget_dsreg" 1>&6
-if test $ac_cv_struct_mtget_dsreg = yes; then
+echo "$ac_t""$ac_cv_struct_union_semun" 1>&6
+if test $ac_cv_struct_union_semun = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MTGET_DSREG 1
+#define HAVE_UNION_SEMUN 1
 EOF
 
 fi
-echo $ac_n "checking if struct mtget contains mt_erreg""... $ac_c" 1>&6
-echo "configure:4079: checking if struct mtget contains mt_erreg" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_mtget_erreg'+set}'`\" = set"; then
+echo $ac_n "checking if union wait is declared in wait.h or sys/wait.h""... $ac_c" 1>&6
+echo "configure:4805: checking if union wait is declared in wait.h or sys/wait.h" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_union_wait'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4084 "configure"
+#line 4810 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#include <sys/mtio.h>
+#if	defined(HAVE_WAIT_H)
+#	include <wait.h>
+#else
+#include <sys/wait.h>
+#endif
 int main() {
-struct  mtget t; t.mt_erreg = 0;
+union wait w;
 ; return 0; }
 EOF
-if { (eval echo configure:4092: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4822: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_mtget_erreg=yes
+  ac_cv_struct_union_wait=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_mtget_erreg=no
+  ac_cv_struct_union_wait=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_mtget_erreg" 1>&6
-if test $ac_cv_struct_mtget_erreg = yes; then
+echo "$ac_t""$ac_cv_struct_union_wait" 1>&6
+if test $ac_cv_struct_union_wait = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MTGET_ERREG 1
+#define HAVE_UNION_WAIT 1
 EOF
 
 fi
-echo $ac_n "checking if struct mtget contains mt_resid""... $ac_c" 1>&6
-echo "configure:4112: checking if struct mtget contains mt_resid" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_mtget_resid'+set}'`\" = set"; then
+echo $ac_n "checking if struct stat contains st_spare1""... $ac_c" 1>&6
+echo "configure:4842: checking if struct stat contains st_spare1" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_st_spare1'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4117 "configure"
+#line 4847 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#include <sys/mtio.h>
+#include <sys/stat.h>
 int main() {
-struct  mtget t; t.mt_resid = 0;
+struct  stat s; s.st_spare1 = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:4125: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4855: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_mtget_resid=yes
+  ac_cv_struct_st_spare1=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_mtget_resid=no
+  ac_cv_struct_st_spare1=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_mtget_resid" 1>&6
-if test $ac_cv_struct_mtget_resid = yes; then
+echo "$ac_t""$ac_cv_struct_st_spare1" 1>&6
+if test $ac_cv_struct_st_spare1 = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MTGET_RESID 1
+#define HAVE_ST_SPARE1 1
 EOF
 
 fi
-echo $ac_n "checking if struct mtget contains mt_fileno""... $ac_c" 1>&6
-echo "configure:4145: checking if struct mtget contains mt_fileno" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_mtget_fileno'+set}'`\" = set"; then
+echo $ac_n "checking if struct stat contains st_atim.tv_nsec""... $ac_c" 1>&6
+echo "configure:4875: checking if struct stat contains st_atim.tv_nsec" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_st_nsec'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4150 "configure"
+#line 4880 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#include <sys/mtio.h>
+#include <sys/stat.h>
 int main() {
-struct  mtget t; t.mt_fileno = 0;
+struct  stat s; s.st_atim.tv_nsec = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:4158: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4888: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_mtget_fileno=yes
+  ac_cv_struct_st_nsec=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_mtget_fileno=no
+  ac_cv_struct_st_nsec=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_mtget_fileno" 1>&6
-if test $ac_cv_struct_mtget_fileno = yes; then
+echo "$ac_t""$ac_cv_struct_st_nsec" 1>&6
+if test $ac_cv_struct_st_nsec = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MTGET_FILENO 1
+#define HAVE_ST_NSEC 1
 EOF
 
 fi
-echo $ac_n "checking if struct mtget contains mt_blkno""... $ac_c" 1>&6
-echo "configure:4178: checking if struct mtget contains mt_blkno" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_mtget_blkno'+set}'`\" = set"; then
+echo $ac_n "checking for st_blksize in struct stat""... $ac_c" 1>&6
+echo "configure:4908: checking for st_blksize in struct stat" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_st_blksize'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4183 "configure"
+#line 4913 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#include <sys/mtio.h>
+#include <sys/stat.h>
 int main() {
-struct  mtget t; t.mt_blkno = 0;
+struct stat s; s.st_blksize;
 ; return 0; }
 EOF
-if { (eval echo configure:4191: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4921: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_mtget_blkno=yes
+  ac_cv_struct_st_blksize=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_mtget_blkno=no
+  ac_cv_struct_st_blksize=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_mtget_blkno" 1>&6
-if test $ac_cv_struct_mtget_blkno = yes; then
+echo "$ac_t""$ac_cv_struct_st_blksize" 1>&6
+if test $ac_cv_struct_st_blksize = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MTGET_BLKNO 1
+#define HAVE_ST_BLKSIZE 1
 EOF
 
 fi
-echo $ac_n "checking if struct mtget contains mt_flags""... $ac_c" 1>&6
-echo "configure:4211: checking if struct mtget contains mt_flags" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_mtget_flags'+set}'`\" = set"; then
+
+echo $ac_n "checking for st_blocks in struct stat""... $ac_c" 1>&6
+echo "configure:4942: checking for st_blocks in struct stat" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_st_blocks'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4216 "configure"
+#line 4947 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#include <sys/mtio.h>
+#include <sys/stat.h>
 int main() {
-struct  mtget t; t.mt_flags = 0;
+struct stat s; s.st_blocks;
 ; return 0; }
 EOF
-if { (eval echo configure:4224: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4955: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_mtget_flags=yes
+  ac_cv_struct_st_blocks=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_mtget_flags=no
+  ac_cv_struct_st_blocks=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_mtget_flags" 1>&6
-if test $ac_cv_struct_mtget_flags = yes; then
+echo "$ac_t""$ac_cv_struct_st_blocks" 1>&6
+if test $ac_cv_struct_st_blocks = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MTGET_FLAGS 1
+#define HAVE_ST_BLOCKS 1
 EOF
 
+else
+  LIBOBJS="$LIBOBJS fileblocks.${ac_objext}"
 fi
-echo $ac_n "checking if struct mtget contains mt_bf""... $ac_c" 1>&6
-echo "configure:4244: checking if struct mtget contains mt_bf" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_mtget_bf'+set}'`\" = set"; then
+
+echo $ac_n "checking for st_rdev in struct stat""... $ac_c" 1>&6
+echo "configure:4978: checking for st_rdev in struct stat" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_st_rdev'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4249 "configure"
+#line 4983 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#include <sys/mtio.h>
+#include <sys/stat.h>
 int main() {
-struct  mtget t; t.mt_bf = 0;
+struct stat s; s.st_rdev;
 ; return 0; }
 EOF
-if { (eval echo configure:4257: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4991: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_mtget_bf=yes
+  ac_cv_struct_st_rdev=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_mtget_bf=no
+  ac_cv_struct_st_rdev=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_mtget_bf" 1>&6
-if test $ac_cv_struct_mtget_bf = yes; then
+echo "$ac_t""$ac_cv_struct_st_rdev" 1>&6
+if test $ac_cv_struct_st_rdev = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MTGET_BF 1
+#define HAVE_ST_RDEV 1
 EOF
 
 fi
-echo $ac_n "checking if struct rusage is declared in sys/resource.h""... $ac_c" 1>&6
-echo "configure:4277: checking if struct rusage is declared in sys/resource.h" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_rusage'+set}'`\" = set"; then
+
+echo $ac_n "checking if struct stat contains st_flags""... $ac_c" 1>&6
+echo "configure:5012: checking if struct stat contains st_flags" >&5
+if eval "test \"`echo '$''{'ac_cv_struct_st_flags'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4282 "configure"
+#line 5017 "configure"
 #include "confdefs.h"
-#include <sys/time.h>
-#include <sys/resource.h>
+#include <sys/types.h>
+#include <sys/stat.h>
 int main() {
-struct rusage r;
+struct  stat s; s.st_flags = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:4290: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5025: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_struct_rusage=yes
+  ac_cv_struct_st_flags=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_rusage=no
+  ac_cv_struct_st_flags=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_rusage" 1>&6
-if test $ac_cv_struct_rusage = yes; then
+echo "$ac_t""$ac_cv_struct_st_flags" 1>&6
+if test $ac_cv_struct_st_flags = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_STRUCT_RUSAGE 1
+#define HAVE_ST_FLAGS 1
 EOF
 
 fi
-echo $ac_n "checking if an illegal declaration for union semun in sys/sem.h exists""... $ac_c" 1>&6
-echo "configure:4310: checking if an illegal declaration for union semun in sys/sem.h exists" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_union_semun'+set}'`\" = set"; then
+
+echo $ac_n "checking for wait3 that fills in rusage""... $ac_c" 1>&6
+echo "configure:5046: checking for wait3 that fills in rusage" >&5
+if eval "test \"`echo '$''{'ac_cv_func_wait3_rusage'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
+  if test "$cross_compiling" = yes; then
+  ac_cv_func_wait3_rusage=no
+else
   cat > conftest.$ac_ext <<EOF
-#line 4315 "configure"
+#line 5054 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#include <sys/ipc.h>
-#include <sys/sem.h>
-int main() {
-union semun s;
-; return 0; }
+#include <sys/time.h>
+#include <sys/resource.h>
+#include <stdio.h>
+/* HP-UX has wait3 but does not fill in rusage at all.  */
+main() {
+  struct rusage r;
+  int i;
+  /* Use a field that we can force nonzero --
+     voluntary context switches.
+     For systems like NeXT and OSF/1 that don't set it,
+     also use the system CPU time.  And page faults (I/O) for Linux.  */
+  r.ru_nvcsw = 0;
+  r.ru_stime.tv_sec = 0;
+  r.ru_stime.tv_usec = 0;
+  r.ru_majflt = r.ru_minflt = 0;
+  switch (fork()) {
+  case 0: /* Child.  */
+    sleep(1); /* Give up the CPU.  */
+    _exit(0);
+  case -1: _exit(0); /* What can we do?  */
+  default: /* Parent.  */
+    wait3(&i, 0, &r);
+    sleep(2); /* Avoid "text file busy" from rm on fast HP-UX machines.  */
+    exit(r.ru_nvcsw == 0 && r.ru_majflt == 0 && r.ru_minflt == 0
+	 && r.ru_stime.tv_sec == 0 && r.ru_stime.tv_usec == 0);
+  }
+}
 EOF
-if { (eval echo configure:4324: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  rm -rf conftest*
-  ac_cv_struct_union_semun=yes
+if { (eval echo configure:5085: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_func_wait3_rusage=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  ac_cv_struct_union_semun=no
+  rm -fr conftest*
+  ac_cv_func_wait3_rusage=no
 fi
-rm -f conftest*
+rm -fr conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_union_semun" 1>&6
-if test $ac_cv_struct_union_semun = yes; then
+fi
+
+echo "$ac_t""$ac_cv_func_wait3_rusage" 1>&6
+if test $ac_cv_func_wait3_rusage = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_UNION_SEMUN 1
+#define HAVE_WAIT3 1
 EOF
 
 fi
-echo $ac_n "checking if union wait is declared in wait.h or sys/wait.h""... $ac_c" 1>&6
-echo "configure:4344: checking if union wait is declared in wait.h or sys/wait.h" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_union_wait'+set}'`\" = set"; then
+
+echo $ac_n "checking for mlockall""... $ac_c" 1>&6
+echo "configure:5108: checking for mlockall" >&5
+if eval "test \"`echo '$''{'ac_cv_func_mlockall'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
+  if test "$cross_compiling" = yes; then
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+else
   cat > conftest.$ac_ext <<EOF
-#line 4349 "configure"
+#line 5116 "configure"
 #include "confdefs.h"
+
 #include <sys/types.h>
-#if	defined(HAVE_WAIT_H)
-#	include <wait.h>
-#else
-#include <sys/wait.h>
-#endif
-int main() {
-union wait w;
-; return 0; }
+#include <sys/mman.h>
+#include <errno.h>
+
+int
+main()
+{
+	if (mlockall(MCL_CURRENT|MCL_FUTURE) < 0) {
+		if (errno == EPERM || errno ==  EACCES)
+			exit(0);
+		exit(-1);
+	}
+	exit(0);
+}
+
 EOF
-if { (eval echo configure:4361: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  rm -rf conftest*
-  ac_cv_struct_union_wait=yes
+if { (eval echo configure:5135: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_func_mlockall=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  ac_cv_struct_union_wait=no
+  rm -fr conftest*
+  ac_cv_func_mlockall=no
 fi
-rm -f conftest*
+rm -fr conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_union_wait" 1>&6
-if test $ac_cv_struct_union_wait = yes; then
+fi
+
+echo "$ac_t""$ac_cv_func_mlockall" 1>&6
+if test $ac_cv_func_mlockall = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_UNION_WAIT 1
+#define HAVE_MLOCKALL 1
 EOF
 
 fi
-echo $ac_n "checking if struct stat contains st_spare1""... $ac_c" 1>&6
-echo "configure:4381: checking if struct stat contains st_spare1" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_st_spare1'+set}'`\" = set"; then
+echo $ac_n "checking for va_copy""... $ac_c" 1>&6
+echo "configure:5157: checking for va_copy" >&5
+if eval "test \"`echo '$''{'ac_cv_func_va_copy'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4386 "configure"
+#line 5162 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/stat.h>
+
+#ifdef	HAVE_STDARG_H
+#	include <stdarg.h>
+#else
+#	include <varargs.h>
+#endif
 int main() {
-struct  stat s; s.st_spare1 = 0;
+
+va_list a, b;
+
+va_copy(a, b);
 ; return 0; }
 EOF
-if { (eval echo configure:4394: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5177: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_struct_st_spare1=yes
+  ac_cv_func_va_copy=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_st_spare1=no
+  ac_cv_func_va_copy=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_st_spare1" 1>&6
-if test $ac_cv_struct_st_spare1 = yes; then
+echo "$ac_t""$ac_cv_func_va_copy" 1>&6
+if test $ac_cv_func_va_copy = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_ST_SPARE1 1
+#define HAVE_VA_COPY 1
 EOF
 
 fi
-echo $ac_n "checking if struct stat contains st_atim.tv_nsec""... $ac_c" 1>&6
-echo "configure:4414: checking if struct stat contains st_atim.tv_nsec" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_st_nsec'+set}'`\" = set"; then
+echo $ac_n "checking for __va_copy""... $ac_c" 1>&6
+echo "configure:5197: checking for __va_copy" >&5
+if eval "test \"`echo '$''{'ac_cv_func__va_copy'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4419 "configure"
+#line 5202 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/stat.h>
+
+#ifdef	HAVE_STDARG_H
+#	include <stdarg.h>
+#else
+#	include <varargs.h>
+#endif
 int main() {
-struct  stat s; s.st_atim.tv_nsec = 0;
+
+va_list a, b;
+
+__va_copy(a, b);
 ; return 0; }
 EOF
-if { (eval echo configure:4427: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5217: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_struct_st_nsec=yes
+  ac_cv_func__va_copy=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_struct_st_nsec=no
+  ac_cv_func__va_copy=no
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_st_nsec" 1>&6
-if test $ac_cv_struct_st_nsec = yes; then
+echo "$ac_t""$ac_cv_func__va_copy" 1>&6
+if test $ac_cv_func__va_copy = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_ST_NSEC 1
+#define HAVE__VA_COPY 1
 EOF
 
 fi
-echo $ac_n "checking for st_blksize in struct stat""... $ac_c" 1>&6
-echo "configure:4447: checking for st_blksize in struct stat" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_st_blksize'+set}'`\" = set"; then
+echo $ac_n "checking for working ecvt() ""... $ac_c" 1>&6
+echo "configure:5237: checking for working ecvt() " >&5
+if eval "test \"`echo '$''{'ac_cv_func_ecvt'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
+  if test "$cross_compiling" = yes; then
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+else
   cat > conftest.$ac_ext <<EOF
-#line 4452 "configure"
+#line 5245 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/stat.h>
-int main() {
-struct stat s; s.st_blksize;
-; return 0; }
+
+extern	char *ecvt();
+
+sprintf(s)
+	char	*s;
+{
+	strcpy(s, "DEAD");
+}
+
+int
+main()
+{
+	int a, b;
+
+/*	exit (strcmp("DEAD", ecvt(1.9, 2, &a, &b)) == 0);*/
+	exit (strcmp("19", ecvt(1.9, 2, &a, &b)) != 0);
+}
 EOF
-if { (eval echo configure:4460: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  rm -rf conftest*
-  ac_cv_struct_st_blksize=yes
+if { (eval echo configure:5265: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_func_ecvt=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  ac_cv_struct_st_blksize=no
+  rm -fr conftest*
+  ac_cv_func_ecvt=no
 fi
-rm -f conftest*
+rm -fr conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_st_blksize" 1>&6
-if test $ac_cv_struct_st_blksize = yes; then
+fi
+
+echo "$ac_t""$ac_cv_func_ecvt" 1>&6
+if test $ac_cv_func_ecvt = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_ST_BLKSIZE 1
+#define HAVE_ECVT 1
 EOF
 
 fi
-
-echo $ac_n "checking for st_blocks in struct stat""... $ac_c" 1>&6
-echo "configure:4481: checking for st_blocks in struct stat" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_st_blocks'+set}'`\" = set"; then
+echo $ac_n "checking for working fcvt() ""... $ac_c" 1>&6
+echo "configure:5287: checking for working fcvt() " >&5
+if eval "test \"`echo '$''{'ac_cv_func_fcvt'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
+  if test "$cross_compiling" = yes; then
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+else
   cat > conftest.$ac_ext <<EOF
-#line 4486 "configure"
+#line 5295 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/stat.h>
-int main() {
-struct stat s; s.st_blocks;
-; return 0; }
+
+extern	char *fcvt();
+
+sprintf(s)
+	char	*s;
+{
+	strcpy(s, "DEAD");
+}
+
+int
+main()
+{
+	int a, b;
+
+/*	exit (strcmp("DEAD", fcvt(1.9, 2, &a, &b)) == 0);*/
+	exit (strcmp("190", fcvt(1.9, 2, &a, &b)) != 0);
+}
 EOF
-if { (eval echo configure:4494: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  rm -rf conftest*
-  ac_cv_struct_st_blocks=yes
+if { (eval echo configure:5315: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_func_fcvt=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  ac_cv_struct_st_blocks=no
+  rm -fr conftest*
+  ac_cv_func_fcvt=no
 fi
-rm -f conftest*
+rm -fr conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_st_blocks" 1>&6
-if test $ac_cv_struct_st_blocks = yes; then
+fi
+
+echo "$ac_t""$ac_cv_func_fcvt" 1>&6
+if test $ac_cv_func_fcvt = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_ST_BLOCKS 1
+#define HAVE_FCVT 1
 EOF
 
-else
-  LIBOBJS="$LIBOBJS fileblocks.${ac_objext}"
 fi
-
-echo $ac_n "checking for st_rdev in struct stat""... $ac_c" 1>&6
-echo "configure:4517: checking for st_rdev in struct stat" >&5
-if eval "test \"`echo '$''{'ac_cv_struct_st_rdev'+set}'`\" = set"; then
+echo $ac_n "checking for working gcvt() ""... $ac_c" 1>&6
+echo "configure:5337: checking for working gcvt() " >&5
+if eval "test \"`echo '$''{'ac_cv_func_gcvt'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
+  if test "$cross_compiling" = yes; then
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+else
   cat > conftest.$ac_ext <<EOF
-#line 4522 "configure"
+#line 5345 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/stat.h>
-int main() {
-struct stat s; s.st_rdev;
-; return 0; }
+
+extern	char *gcvt();
+
+sprintf(s)
+	char	*s;
+{
+	strcpy(s, "DEAD");
+}
+
+int
+main()
+{
+	char	buf[32];
+
+/*	exit (strcmp("DEAD", gcvt(1.9, 10, buf)) == 0);*/
+	exit (strcmp("1.9", gcvt(1.9, 10, buf)) != 0);
+}
 EOF
-if { (eval echo configure:4530: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  rm -rf conftest*
-  ac_cv_struct_st_rdev=yes
+if { (eval echo configure:5365: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_func_gcvt=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  ac_cv_struct_st_rdev=no
+  rm -fr conftest*
+  ac_cv_func_gcvt=no
 fi
-rm -f conftest*
+rm -fr conftest*
 fi
 
-echo "$ac_t""$ac_cv_struct_st_rdev" 1>&6
-if test $ac_cv_struct_st_rdev = yes; then
+fi
+
+echo "$ac_t""$ac_cv_func_gcvt" 1>&6
+if test $ac_cv_func_gcvt = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_ST_RDEV 1
+#define HAVE_GCVT 1
 EOF
 
 fi
-
-
-echo $ac_n "checking for wait3 that fills in rusage""... $ac_c" 1>&6
-echo "configure:4552: checking for wait3 that fills in rusage" >&5
-if eval "test \"`echo '$''{'ac_cv_func_wait3_rusage'+set}'`\" = set"; then
+echo $ac_n "checking for __dtoa""... $ac_c" 1>&6
+echo "configure:5387: checking for __dtoa" >&5
+if eval "test \"`echo '$''{'ac_cv_func_dtoa'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  if test "$cross_compiling" = yes; then
-  ac_cv_func_wait3_rusage=no
-else
   cat > conftest.$ac_ext <<EOF
-#line 4560 "configure"
+#line 5392 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/time.h>
-#include <sys/resource.h>
-#include <stdio.h>
-/* HP-UX has wait3 but does not fill in rusage at all.  */
-main() {
-  struct rusage r;
-  int i;
-  /* Use a field that we can force nonzero --
-     voluntary context switches.
-     For systems like NeXT and OSF/1 that don't set it,
-     also use the system CPU time.  And page faults (I/O) for Linux.  */
-  r.ru_nvcsw = 0;
-  r.ru_stime.tv_sec = 0;
-  r.ru_stime.tv_usec = 0;
-  r.ru_majflt = r.ru_minflt = 0;
-  switch (fork()) {
-  case 0: /* Child.  */
-    sleep(1); /* Give up the CPU.  */
-    _exit(0);
-  case -1: _exit(0); /* What can we do?  */
-  default: /* Parent.  */
-    wait3(&i, 0, &r);
-    sleep(2); /* Avoid "text file busy" from rm on fast HP-UX machines.  */
-    exit(r.ru_nvcsw == 0 && r.ru_majflt == 0 && r.ru_minflt == 0
-	 && r.ru_stime.tv_sec == 0 && r.ru_stime.tv_usec == 0);
-  }
-}
+extern  char *__dtoa();
+int main() {
+int decpt; int sign; char *ep; char *bp;
+bp = __dtoa(0.0, 2, 6, &decpt, &sign, &ep);
+; return 0; }
 EOF
-if { (eval echo configure:4591: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_func_wait3_rusage=yes
+if { (eval echo configure:5400: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func_dtoa=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_func_wait3_rusage=no
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  ac_cv_func_dtoa=no
 fi
-
+rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_wait3_rusage" 1>&6
-if test $ac_cv_func_wait3_rusage = yes; then
+echo "$ac_t""$ac_cv_func_dtoa" 1>&6
+if test $ac_cv_func_dtoa = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_WAIT3 1
+#define HAVE_DTOA 1
 EOF
 
 fi
-
-echo $ac_n "checking for mlockall""... $ac_c" 1>&6
-echo "configure:4614: checking for mlockall" >&5
-if eval "test \"`echo '$''{'ac_cv_func_mlockall'+set}'`\" = set"; then
+echo $ac_n "checking for __dtoa that needs result ptr""... $ac_c" 1>&6
+echo "configure:5420: checking for __dtoa that needs result ptr" >&5
+if eval "test \"`echo '$''{'ac_cv_func_dtoa_r'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 4622 "configure"
+#line 5428 "configure"
 #include "confdefs.h"
 
-#include <sys/types.h>
-#include <sys/mman.h>
-#include <errno.h>
-
+extern	char *__dtoa();
 int
 main()
 {
-	if (mlockall(MCL_CURRENT|MCL_FUTURE) < 0) {
-		if (errno == EPERM || errno ==  EACCES)
-			exit(0);
-		exit(-1);
-	}
-	exit(0);
-}
+#ifdef	HAVE_DTOA
+	int	decpt, sign;
+	char	*bp;
+	char	*ep;
+	char	*result;
 
+	result = 0;
+	bp = __dtoa(1.9, 2, 5, &decpt, &sign, &ep, &result);
+	exit(result == 0);
+#else
+	exit(1);
+#endif
+}
 EOF
-if { (eval echo configure:4641: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:5449: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
-  ac_cv_func_mlockall=yes
+  ac_cv_func_dtoa_r=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -fr conftest*
-  ac_cv_func_mlockall=no
+  ac_cv_func_dtoa_r=no
 fi
 rm -fr conftest*
 fi
 
 fi
 
-echo "$ac_t""$ac_cv_func_mlockall" 1>&6
-if test $ac_cv_func_mlockall = yes; then
+echo "$ac_t""$ac_cv_func_dtoa_r" 1>&6
+if test $ac_cv_func_dtoa_r = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MLOCKALL 1
+#define HAVE_DTOA_R 1
 EOF
 
 fi
-echo $ac_n "checking for va_copy""... $ac_c" 1>&6
-echo "configure:4663: checking for va_copy" >&5
-if eval "test \"`echo '$''{'ac_cv_func_va_copy'+set}'`\" = set"; then
+for ac_hdr in unistd.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:5474: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4668 "configure"
+#line 5479 "configure"
 #include "confdefs.h"
-
-#ifdef	HAVE_STDARG_H
-#	include <stdarg.h>
-#else
-#	include <varargs.h>
-#endif
-int main() {
-
-va_list a, b;
-
-va_copy(a, b);
-; return 0; }
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:4683: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:5484: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
   rm -rf conftest*
-  ac_cv_func_va_copy=yes
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_func_va_copy=no
+  eval "ac_cv_header_$ac_safe=no"
 fi
 rm -f conftest*
 fi
-
-echo "$ac_t""$ac_cv_func_va_copy" 1>&6
-if test $ac_cv_func_va_copy = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_VA_COPY 1
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for __va_copy""... $ac_c" 1>&6
-echo "configure:4703: checking for __va_copy" >&5
-if eval "test \"`echo '$''{'ac_cv_func__va_copy'+set}'`\" = set"; then
+done
+
+for ac_func in getpagesize
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:5513: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4708 "configure"
+#line 5518 "configure"
 #include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
 
-#ifdef	HAVE_STDARG_H
-#	include <stdarg.h>
-#else
-#	include <varargs.h>
-#endif
 int main() {
 
-va_list a, b;
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
 
-__va_copy(a, b);
 ; return 0; }
 EOF
-if { (eval echo configure:4723: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5541: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_func__va_copy=yes
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_func__va_copy=no
+  eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func__va_copy" 1>&6
-if test $ac_cv_func__va_copy = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE__VA_COPY 1
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for working ecvt() ""... $ac_c" 1>&6
-echo "configure:4743: checking for working ecvt() " >&5
-if eval "test \"`echo '$''{'ac_cv_func_ecvt'+set}'`\" = set"; then
+done
+
+echo $ac_n "checking for mmap that needs ptr to size""... $ac_c" 1>&6
+echo "configure:5566: checking for mmap that needs ptr to size" >&5
+if eval "test \"`echo '$''{'ac_cv_func_mmap_sizep'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+  ac_cv_func_mmap_sizep=no
 else
   cat > conftest.$ac_ext <<EOF
-#line 4751 "configure"
+#line 5574 "configure"
 #include "confdefs.h"
 
-extern	char *ecvt();
+#include <sys/types.h>
+#include <fcntl.h>
+#include <signal.h>
+#include <setjmp.h>
+#include <sys/mman.h>
 
-sprintf(s)
-	char	*s;
+#ifndef MAP_FILE
+#define MAP_FILE   0		/* Needed on Apollo Domain/OS */
+#endif
+
+/* This mess was copied from the GNU getpagesize.h.  */
+#ifndef HAVE_GETPAGESIZE
+# ifdef HAVE_UNISTD_H
+#  include <unistd.h>
+# endif
+
+/* Assume that all systems that can run configure have sys/param.h.  */
+# ifndef HAVE_SYS_PARAM_H
+#  define HAVE_SYS_PARAM_H 1
+# endif
+
+# ifdef _SC_PAGESIZE
+#  define getpagesize() sysconf(_SC_PAGESIZE)
+# else /* no _SC_PAGESIZE */
+#  ifdef HAVE_SYS_PARAM_H
+#   include <sys/param.h>
+#   ifdef EXEC_PAGESIZE
+#    define getpagesize() EXEC_PAGESIZE
+#   else /* no EXEC_PAGESIZE */
+#    ifdef NBPG
+#     define getpagesize() NBPG * CLSIZE
+#     ifndef CLSIZE
+#      define CLSIZE 1
+#     endif /* no CLSIZE */
+#    else /* no NBPG */
+#     ifdef NBPC
+#      define getpagesize() NBPC
+#     else /* no NBPC */
+#      ifdef PAGESIZE
+#       define getpagesize() PAGESIZE
+#      endif /* PAGESIZE */
+#     endif /* no NBPC */
+#    endif /* no NBPG */
+#   endif /* no EXEC_PAGESIZE */
+#  else /* no HAVE_SYS_PARAM_H */
+#   define getpagesize() 8192	/* punt totally */
+#  endif /* no HAVE_SYS_PARAM_H */
+# endif /* no _SC_PAGESIZE */
+
+#endif /* no HAVE_GETPAGESIZE */
+
+#ifdef __cplusplus
+extern "C" { void *malloc(unsigned); }
+#else
+char *malloc();
+#endif
+
+jmp_buf jenv;
+
+int
+intr()
 {
-	strcpy(s, "DEAD");
+	signal(SIGSEGV, intr);
+	longjmp(jenv, 1);
 }
 
 int
 main()
 {
-	int a, b;
+	char *data, *data2;
+	int i, pagesize, ps;
+	int fd;
 
-/*	exit (strcmp("DEAD", ecvt(1.9, 2, &a, &b)) == 0);*/
-	exit (strcmp("19", ecvt(1.9, 2, &a, &b)) != 0);
-}
-EOF
-if { (eval echo configure:4771: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_func_ecvt=yes
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_func_ecvt=no
-fi
-rm -fr conftest*
-fi
+	pagesize = getpagesize();
+
+	/*
+	 * First, make a file with some known garbage in it.
+	 */
+	data = malloc(pagesize);
+	if (!data)
+		exit(1);
+	for (i = 0; i < pagesize; ++i)
+		*(data + i) = rand();
+	umask(0);
+	fd = creat("conftestmmap", 0600);
+	if (fd < 0)
+		exit(1);
+	if (write(fd, data, pagesize) != pagesize)
+		exit(1);
+	close(fd);
+
+	/*
+	 * Next, try to mmap the file at a fixed address which
+	 * already has something else allocated at it.  If we can,
+	 * also make sure that we see the same garbage.
+	 */
+	fd = open("conftestmmap", O_RDWR);
+	if (fd < 0)
+		exit(1);
 
-fi
+	/*
+	 * Keep a copy, Apollo modifies the value...
+	 */
+	ps = pagesize;
 
-echo "$ac_t""$ac_cv_func_ecvt" 1>&6
-if test $ac_cv_func_ecvt = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_ECVT 1
-EOF
+	/*
+	 * Apollo mmap() is not a syscall but a library function and fails
+	 * if it tries to dereference 'ps'. We must use setjmp in order to
+	 * catch the failure.
+	 */
+	signal(SIGSEGV, intr);
+	if (setjmp(jenv) == 0) {
+		data2 = mmap(0, ps, PROT_READ, MAP_FILE | MAP_PRIVATE, fd, 0L);
+	} else {
+		data2 = (char *)-1;
+	}
+	if (data2 != (char *)-1)
+		exit(1);
 
-fi
-echo $ac_n "checking for working fcvt() ""... $ac_c" 1>&6
-echo "configure:4793: checking for working fcvt() " >&5
-if eval "test \"`echo '$''{'ac_cv_func_fcvt'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
-else
-  cat > conftest.$ac_ext <<EOF
-#line 4801 "configure"
-#include "confdefs.h"
+	signal(SIGSEGV, intr);
+	if (setjmp(jenv) == 0) {
+		data2 = mmap(0, &ps, PROT_READ, MAP_FILE | MAP_PRIVATE, fd, 0L);
+	} else {
+		data2 = (char *)-1;
+	}
+	if (data2 == (char *)-1)
+		exit(1);
 
-extern	char *fcvt();
+	for (i = 0; i < pagesize; ++i)
+		if (*(data + i) != *(data2 + i))
+			exit(1);
 
-sprintf(s)
-	char	*s;
-{
-	strcpy(s, "DEAD");
+	close(fd);
+	unlink("conftestmmap");
+	exit(0);
 }
 
-int
-main()
-{
-	int a, b;
-
-/*	exit (strcmp("DEAD", fcvt(1.9, 2, &a, &b)) == 0);*/
-	exit (strcmp("190", fcvt(1.9, 2, &a, &b)) != 0);
-}
 EOF
-if { (eval echo configure:4821: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:5715: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
-  ac_cv_func_fcvt=yes
+  ac_cv_func_mmap_sizep=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -fr conftest*
-  ac_cv_func_fcvt=no
+  ac_cv_func_mmap_sizep=no
 fi
 rm -fr conftest*
 fi
 
 fi
 
-echo "$ac_t""$ac_cv_func_fcvt" 1>&6
-if test $ac_cv_func_fcvt = yes; then
+echo "$ac_t""$ac_cv_func_mmap_sizep" 1>&6
+if test $ac_cv_func_mmap_sizep = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_FCVT 1
+#define _MMAP_WITH_SIZEP 1
 EOF
 
 fi
-echo $ac_n "checking for working gcvt() ""... $ac_c" 1>&6
-echo "configure:4843: checking for working gcvt() " >&5
-if eval "test \"`echo '$''{'ac_cv_func_gcvt'+set}'`\" = set"; then
+
+for ac_hdr in unistd.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:5741: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
-else
   cat > conftest.$ac_ext <<EOF
-#line 4851 "configure"
+#line 5746 "configure"
 #include "confdefs.h"
-
-extern	char *gcvt();
-
-sprintf(s)
-	char	*s;
-{
-	strcpy(s, "DEAD");
-}
-
-int
-main()
-{
-	char	buf[32];
-
-/*	exit (strcmp("DEAD", gcvt(1.9, 10, buf)) == 0);*/
-	exit (strcmp("1.9", gcvt(1.9, 10, buf)) != 0);
-}
+#include <$ac_hdr>
 EOF
-if { (eval echo configure:4871: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_func_gcvt=yes
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:5751: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
 else
+  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_func_gcvt=no
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
 fi
-
+rm -f conftest*
 fi
-
-echo "$ac_t""$ac_cv_func_gcvt" 1>&6
-if test $ac_cv_func_gcvt = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_GCVT 1
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for __dtoa""... $ac_c" 1>&6
-echo "configure:4893: checking for __dtoa" >&5
-if eval "test \"`echo '$''{'ac_cv_func_dtoa'+set}'`\" = set"; then
+done
+
+for ac_func in getpagesize
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:5780: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4898 "configure"
+#line 5785 "configure"
 #include "confdefs.h"
-extern  char *__dtoa();
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
+
 int main() {
-int decpt; int sign; char *ep; char *bp;
-bp = __dtoa(0.0, 2, 6, &decpt, &sign, &ep);
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
 ; return 0; }
 EOF
-if { (eval echo configure:4906: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5808: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_func_dtoa=yes
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_func_dtoa=no
+  eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_dtoa" 1>&6
-if test $ac_cv_func_dtoa = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_DTOA 1
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for __dtoa that needs result ptr""... $ac_c" 1>&6
-echo "configure:4926: checking for __dtoa that needs result ptr" >&5
-if eval "test \"`echo '$''{'ac_cv_func_dtoa_r'+set}'`\" = set"; then
+done
+
+echo $ac_n "checking for working mmap""... $ac_c" 1>&6
+echo "configure:5833: checking for working mmap" >&5
+if eval "test \"`echo '$''{'ac_cv_func_mmap_fixed_mapped'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+  ac_cv_func_mmap_fixed_mapped=no
 else
   cat > conftest.$ac_ext <<EOF
-#line 4934 "configure"
+#line 5841 "configure"
 #include "confdefs.h"
 
-extern	char *__dtoa();
+/* Thanks to Mike Haertel and Jim Avera for this test.
+   Here is a matrix of mmap possibilities:
+	mmap private not fixed
+	mmap private fixed at somewhere currently unmapped
+	mmap private fixed at somewhere already mapped
+	mmap shared not fixed
+	mmap shared fixed at somewhere currently unmapped
+	mmap shared fixed at somewhere already mapped
+   For private mappings, we should verify that changes cannot be read()
+   back from the file, nor mmap's back from the file at a different
+   address.  (There have been systems where private was not correctly
+   implemented like the infamous i386 svr4.0, and systems where the
+   VM page cache was not coherent with the filesystem buffer cache
+   like early versions of FreeBSD and possibly contemporary NetBSD.)
+   For shared mappings, we should conversely verify that changes get
+   propogated back to all the places they're supposed to be.
+
+   Grep wants private fixed already mapped.
+   The main things grep needs to know about mmap are:
+   * does it exist and is it safe to write into the mmap'd area
+   * how to use it (BSD variants)  */
+#include <sys/types.h>
+#include <fcntl.h>
+#include <sys/mman.h>
+
+/*
+ * Needed for Apollo Domain/OS and may be for others?
+ */
+#ifdef	_MMAP_WITH_SIZEP
+#	define	mmap_sizeparm(s)	(&(s))
+#else
+#	define	mmap_sizeparm(s)	(s)
+#endif
+
+/* This mess was copied from the GNU getpagesize.h.  */
+#ifndef HAVE_GETPAGESIZE
+# ifdef HAVE_UNISTD_H
+#  include <unistd.h>
+# endif
+
+/* Assume that all systems that can run configure have sys/param.h.  */
+# ifndef HAVE_SYS_PARAM_H
+#  define HAVE_SYS_PARAM_H 1
+# endif
+
+# ifdef _SC_PAGESIZE
+#  define getpagesize() sysconf(_SC_PAGESIZE)
+# else /* no _SC_PAGESIZE */
+#  ifdef HAVE_SYS_PARAM_H
+#   include <sys/param.h>
+#   ifdef EXEC_PAGESIZE
+#    define getpagesize() EXEC_PAGESIZE
+#   else /* no EXEC_PAGESIZE */
+#    ifdef NBPG
+#     define getpagesize() NBPG * CLSIZE
+#     ifndef CLSIZE
+#      define CLSIZE 1
+#     endif /* no CLSIZE */
+#    else /* no NBPG */
+#     ifdef NBPC
+#      define getpagesize() NBPC
+#     else /* no NBPC */
+#      ifdef PAGESIZE
+#       define getpagesize() PAGESIZE
+#      endif /* PAGESIZE */
+#     endif /* no NBPC */
+#    endif /* no NBPG */
+#   endif /* no EXEC_PAGESIZE */
+#  else /* no HAVE_SYS_PARAM_H */
+#   define getpagesize() 8192	/* punt totally */
+#  endif /* no HAVE_SYS_PARAM_H */
+# endif /* no _SC_PAGESIZE */
+
+#endif /* no HAVE_GETPAGESIZE */
+
+#ifdef __cplusplus
+extern "C" { void *malloc(unsigned); }
+#else
+char *malloc();
+#endif
+
 int
 main()
 {
-#ifdef	HAVE_DTOA
-	int	decpt, sign;
-	char	*bp;
-	char	*ep;
-	char	*result;
+	char *data, *data2, *data3;
+	int i, pagesize;
+	int fd;
 
-	result = 0;
-	bp = __dtoa(1.9, 2, 5, &decpt, &sign, &ep, &result);
-	exit(result == 0);
-#else
-	exit(1);
-#endif
+	pagesize = getpagesize();
+
+	/*
+	 * First, make a file with some known garbage in it.
+	 */
+	data = malloc(pagesize);
+	if (!data)
+		exit(1);
+	for (i = 0; i < pagesize; ++i)
+		*(data + i) = rand();
+	umask(0);
+	fd = creat("conftestmmap", 0600);
+	if (fd < 0)
+		exit(1);
+	if (write(fd, data, pagesize) != pagesize)
+		exit(1);
+	close(fd);
+
+	/*
+	 * Next, try to mmap the file at a fixed address which
+	 * already has something else allocated at it.  If we can,
+	 * also make sure that we see the same garbage.
+	 */
+	fd = open("conftestmmap", O_RDWR);
+	if (fd < 0)
+		exit(1);
+	data2 = malloc(2 * pagesize);
+	if (!data2)
+		exit(1);
+	data2 += (pagesize - ((int) data2 & (pagesize - 1))) & (pagesize - 1);
+	if (data2 != mmap(data2, mmap_sizeparm(pagesize), PROT_READ | PROT_WRITE,
+	    MAP_PRIVATE | MAP_FIXED, fd, 0L))
+		exit(1);
+	for (i = 0; i < pagesize; ++i)
+		if (*(data + i) != *(data2 + i))
+			exit(1);
+
+	/*
+	 * Finally, make sure that changes to the mapped area
+	 * do not percolate back to the file as seen by read().
+	 * (This is a bug on some variants of i386 svr4.0.)
+	 */
+	for (i = 0; i < pagesize; ++i)
+		*(data2 + i) = *(data2 + i) + 1;
+	data3 = malloc(pagesize);
+	if (!data3)
+		exit(1);
+	if (read(fd, data3, pagesize) != pagesize)
+		exit(1);
+	for (i = 0; i < pagesize; ++i)
+		if (*(data + i) != *(data3 + i))
+			exit(1);
+	close(fd);
+	unlink("conftestmmap");
+	exit(0);
 }
+
 EOF
-if { (eval echo configure:4955: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:5990: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
-  ac_cv_func_dtoa_r=yes
+  ac_cv_func_mmap_fixed_mapped=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -fr conftest*
-  ac_cv_func_dtoa_r=no
+  ac_cv_func_mmap_fixed_mapped=no
 fi
 rm -fr conftest*
 fi
 
 fi
 
-echo "$ac_t""$ac_cv_func_dtoa_r" 1>&6
-if test $ac_cv_func_dtoa_r = yes; then
+echo "$ac_t""$ac_cv_func_mmap_fixed_mapped" 1>&6
+if test $ac_cv_func_mmap_fixed_mapped = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_DTOA_R 1
+#define HAVE_MMAP 1
 EOF
 
 fi
+
 for ac_hdr in unistd.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:4980: checking for $ac_hdr" >&5
+echo "configure:6016: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4985 "configure"
+#line 6021 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:4990: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:6026: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5015,12 +6051,12 @@
 for ac_func in getpagesize
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:5019: checking for $ac_func" >&5
+echo "configure:6055: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5024 "configure"
+#line 6060 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -5043,7 +6079,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:5047: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6083: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -5068,7 +6104,7 @@
 done
 
 echo $ac_n "checking for mmap that needs ptr to size""... $ac_c" 1>&6
-echo "configure:5072: checking for mmap that needs ptr to size" >&5
+echo "configure:6108: checking for mmap that needs ptr to size" >&5
 if eval "test \"`echo '$''{'ac_cv_func_mmap_sizep'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -5076,7 +6112,7 @@
   ac_cv_func_mmap_sizep=no
 else
   cat > conftest.$ac_ext <<EOF
-#line 5080 "configure"
+#line 6116 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
@@ -5217,7 +6253,7 @@
 }
 
 EOF
-if { (eval echo configure:5221: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:6257: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_func_mmap_sizep=yes
 else
@@ -5239,55 +6275,245 @@
 
 fi
 
-for ac_hdr in unistd.h
-do
-ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
-echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:5247: checking for $ac_hdr" >&5
-if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+echo $ac_n "checking if mmap works to get shared memory""... $ac_c" 1>&6
+echo "configure:6280: checking if mmap works to get shared memory" >&5
+if eval "test \"`echo '$''{'ac_cv_func_smmap'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
+  if test "$cross_compiling" = yes; then
+  ac_cv_func_smmap=no
+else
   cat > conftest.$ac_ext <<EOF
-#line 5252 "configure"
+#line 6288 "configure"
 #include "confdefs.h"
-#include <$ac_hdr>
+
+#include <sys/types.h>
+#include <sys/mman.h>
+
+#ifndef	MAP_ANONYMOUS
+#	ifdef	MAP_ANON
+#		define MAP_ANONYMOUS MAP_ANON
+#	endif
+#endif
+
+/*
+ * Needed for Apollo Domain/OS and may be for others?
+ */
+#ifdef	_MMAP_WITH_SIZEP
+#	define	mmap_sizeparm(s)	(&(s))
+#else
+#	define	mmap_sizeparm(s)	(s)
+#endif
+
+char *
+mkshare()
+{
+        int     size = 8192;
+        int     f;
+        char    *addr;
+
+#ifdef  MAP_ANONYMOUS   /* HP/UX */
+        f = -1;
+        addr = mmap(0, mmap_sizeparm(size), PROT_READ|PROT_WRITE, MAP_SHARED|MAP_ANONYMOUS, f, 0);
+#else
+        if ((f = open("/dev/zero", 2)) < 0)
+                exit(1);
+        addr = mmap(0, mmap_sizeparm(size), PROT_READ|PROT_WRITE, MAP_SHARED, f, 0);
+#endif
+        if (addr == (char *)-1)
+                exit(1);
+        close(f);
+
+        return (addr);
+}
+
+int
+main()
+{
+        char    *addr;
+        
+        addr = mkshare();
+        *addr = 'I';
+
+        switch (fork()) {
+
+        case -1:
+                printf("help\n"); exit(1);
+
+        case 0: /* child */
+                *addr = 'N';
+                _exit(0);
+                break;
+        default: /* parent */
+                wait(0);
+                sleep(1);
+                break;
+        }
+
+        if (*addr != 'N')
+                exit(1);
+        exit(0);
+}
+
 EOF
-ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5257: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
-ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
-if test -z "$ac_err"; then
+if { (eval echo configure:6360: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_func_smmap=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -fr conftest*
+  ac_cv_func_smmap=no
+fi
+rm -fr conftest*
+fi
+
+fi
+
+echo "$ac_t""$ac_cv_func_smmap" 1>&6
+if test $ac_cv_func_smmap = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_SMMAP 1
+EOF
+
+fi
+# The Ultrix 4.2 mips builtin alloca declared by alloca.h only works
+# for constant arguments.  Useless!
+echo $ac_n "checking for working alloca.h""... $ac_c" 1>&6
+echo "configure:6384: checking for working alloca.h" >&5
+if eval "test \"`echo '$''{'ac_cv_header_alloca_h'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 6389 "configure"
+#include "confdefs.h"
+#include <alloca.h>
+int main() {
+char *p = alloca(2 * sizeof(int));
+; return 0; }
+EOF
+if { (eval echo configure:6396: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_header_alloca_h=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_header_alloca_h=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_header_alloca_h" 1>&6
+if test $ac_cv_header_alloca_h = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_ALLOCA_H 1
+EOF
+
+fi
+
+echo $ac_n "checking for alloca""... $ac_c" 1>&6
+echo "configure:6417: checking for alloca" >&5
+if eval "test \"`echo '$''{'ac_cv_func_alloca_works'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 6422 "configure"
+#include "confdefs.h"
+
+#ifdef __GNUC__
+# define alloca __builtin_alloca
+#else
+# ifdef _MSC_VER
+#  include <malloc.h>
+#  define alloca _alloca
+# else
+#  if HAVE_ALLOCA_H
+#   include <alloca.h>
+#  else
+#   ifdef _AIX
+ #pragma alloca
+#   else
+#    ifndef alloca /* predefined by HP cc +Olibcalls */
+char *alloca ();
+#    endif
+#   endif
+#  endif
+# endif
+#endif
+
+int main() {
+char *p = (char *) alloca(1);
+; return 0; }
+EOF
+if { (eval echo configure:6450: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func_alloca_works=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_func_alloca_works=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_func_alloca_works" 1>&6
+if test $ac_cv_func_alloca_works = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_ALLOCA 1
+EOF
+
+fi
+
+if test $ac_cv_func_alloca_works = no; then
+  # The SVR3 libPW and SVR4 libucb both contain incompatible functions
+  # that cause trouble.  Some versions do not even contain alloca or
+  # contain a buggy version.  If you still want to use their alloca,
+  # use ar to extract alloca.o from them instead of compiling alloca.c.
+  ALLOCA=alloca.${ac_objext}
+  cat >> confdefs.h <<\EOF
+#define C_ALLOCA 1
+EOF
+
+
+echo $ac_n "checking whether alloca needs Cray hooks""... $ac_c" 1>&6
+echo "configure:6482: checking whether alloca needs Cray hooks" >&5
+if eval "test \"`echo '$''{'ac_cv_os_cray'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 6487 "configure"
+#include "confdefs.h"
+#if defined(CRAY) && ! defined(CRAY2)
+webecray
+#else
+wenotbecray
+#endif
+
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "webecray" >/dev/null 2>&1; then
   rm -rf conftest*
-  eval "ac_cv_header_$ac_safe=yes"
+  ac_cv_os_cray=yes
 else
-  echo "$ac_err" >&5
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
   rm -rf conftest*
-  eval "ac_cv_header_$ac_safe=no"
+  ac_cv_os_cray=no
 fi
 rm -f conftest*
+
 fi
-if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
-    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
-  cat >> confdefs.h <<EOF
-#define $ac_tr_hdr 1
-EOF
- 
-else
-  echo "$ac_t""no" 1>&6
-fi
-done
 
-for ac_func in getpagesize
-do
-echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:5286: checking for $ac_func" >&5
+echo "$ac_t""$ac_cv_os_cray" 1>&6
+if test $ac_cv_os_cray = yes; then
+for ac_func in _getb67 GETB67 getb67; do
+  echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:6512: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5291 "configure"
+#line 6517 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -5310,7 +6536,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:5314: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6540: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -5324,211 +6550,182 @@
 
 if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
   cat >> confdefs.h <<EOF
-#define $ac_tr_func 1
+#define CRAY_STACKSEG_END $ac_func
 EOF
- 
+
+  break
 else
   echo "$ac_t""no" 1>&6
 fi
+
 done
+fi
 
-echo $ac_n "checking for working mmap""... $ac_c" 1>&6
-echo "configure:5339: checking for working mmap" >&5
-if eval "test \"`echo '$''{'ac_cv_func_mmap_fixed_mapped'+set}'`\" = set"; then
+echo $ac_n "checking stack direction for C alloca""... $ac_c" 1>&6
+echo "configure:6567: checking stack direction for C alloca" >&5
+if eval "test \"`echo '$''{'ac_cv_c_stack_direction'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
-  ac_cv_func_mmap_fixed_mapped=no
+  ac_cv_c_stack_direction=0
 else
   cat > conftest.$ac_ext <<EOF
-#line 5347 "configure"
+#line 6575 "configure"
 #include "confdefs.h"
+find_stack_direction ()
+{
+  static char *addr = 0;
+  auto char dummy;
+  if (addr == 0)
+    {
+      addr = &dummy;
+      return find_stack_direction ();
+    }
+  else
+    return (&dummy > addr) ? 1 : -1;
+}
+main ()
+{
+  exit (find_stack_direction() < 0);
+}
+EOF
+if { (eval echo configure:6594: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_c_stack_direction=1
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -fr conftest*
+  ac_cv_c_stack_direction=-1
+fi
+rm -fr conftest*
+fi
 
-/* Thanks to Mike Haertel and Jim Avera for this test.
-   Here is a matrix of mmap possibilities:
-	mmap private not fixed
-	mmap private fixed at somewhere currently unmapped
-	mmap private fixed at somewhere already mapped
-	mmap shared not fixed
-	mmap shared fixed at somewhere currently unmapped
-	mmap shared fixed at somewhere already mapped
-   For private mappings, we should verify that changes cannot be read()
-   back from the file, nor mmap's back from the file at a different
-   address.  (There have been systems where private was not correctly
-   implemented like the infamous i386 svr4.0, and systems where the
-   VM page cache was not coherent with the filesystem buffer cache
-   like early versions of FreeBSD and possibly contemporary NetBSD.)
-   For shared mappings, we should conversely verify that changes get
-   propogated back to all the places they're supposed to be.
-
-   Grep wants private fixed already mapped.
-   The main things grep needs to know about mmap are:
-   * does it exist and is it safe to write into the mmap'd area
-   * how to use it (BSD variants)  */
-#include <sys/types.h>
-#include <fcntl.h>
-#include <sys/mman.h>
-
-/*
- * Needed for Apollo Domain/OS and may be for others?
- */
-#ifdef	_MMAP_WITH_SIZEP
-#	define	mmap_sizeparm(s)	(&(s))
-#else
-#	define	mmap_sizeparm(s)	(s)
-#endif
-
-/* This mess was copied from the GNU getpagesize.h.  */
-#ifndef HAVE_GETPAGESIZE
-# ifdef HAVE_UNISTD_H
-#  include <unistd.h>
-# endif
-
-/* Assume that all systems that can run configure have sys/param.h.  */
-# ifndef HAVE_SYS_PARAM_H
-#  define HAVE_SYS_PARAM_H 1
-# endif
+fi
 
-# ifdef _SC_PAGESIZE
-#  define getpagesize() sysconf(_SC_PAGESIZE)
-# else /* no _SC_PAGESIZE */
-#  ifdef HAVE_SYS_PARAM_H
-#   include <sys/param.h>
-#   ifdef EXEC_PAGESIZE
-#    define getpagesize() EXEC_PAGESIZE
-#   else /* no EXEC_PAGESIZE */
-#    ifdef NBPG
-#     define getpagesize() NBPG * CLSIZE
-#     ifndef CLSIZE
-#      define CLSIZE 1
-#     endif /* no CLSIZE */
-#    else /* no NBPG */
-#     ifdef NBPC
-#      define getpagesize() NBPC
-#     else /* no NBPC */
-#      ifdef PAGESIZE
-#       define getpagesize() PAGESIZE
-#      endif /* PAGESIZE */
-#     endif /* no NBPC */
-#    endif /* no NBPG */
-#   endif /* no EXEC_PAGESIZE */
-#  else /* no HAVE_SYS_PARAM_H */
-#   define getpagesize() 8192	/* punt totally */
-#  endif /* no HAVE_SYS_PARAM_H */
-# endif /* no _SC_PAGESIZE */
+echo "$ac_t""$ac_cv_c_stack_direction" 1>&6
+cat >> confdefs.h <<EOF
+#define STACK_DIRECTION $ac_cv_c_stack_direction
+EOF
 
-#endif /* no HAVE_GETPAGESIZE */
+fi
 
-#ifdef __cplusplus
-extern "C" { void *malloc(unsigned); }
-#else
-char *malloc();
-#endif
+echo $ac_n "checking if quotactl is an ioctl""... $ac_c" 1>&6
+echo "configure:6616: checking if quotactl is an ioctl" >&5
+if eval "test \"`echo '$''{'ac_cv_func_quotaioctl'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 6621 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <sys/fs/ufs_quota.h>
+int main() {
+struct quotctl q; ioctl(0, Q_QUOTACTL, &q)
+; return 0; }
+EOF
+if { (eval echo configure:6629: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func_quotaioctl=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_func_quotaioctl=no
+fi
+rm -f conftest*
+fi
 
-int
-main()
-{
-	char *data, *data2, *data3;
-	int i, pagesize;
-	int fd;
+echo "$ac_t""$ac_cv_func_quotaioctl" 1>&6 
+if test $ac_cv_func_quotaioctl = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_QUOTAIOCTL 1
+EOF
 
-	pagesize = getpagesize();
+fi
+echo $ac_n "checking for file locking via fcntl""... $ac_c" 1>&6
+echo "configure:6649: checking for file locking via fcntl" >&5
+if eval "test \"`echo '$''{'ac_cv_func_fcntl_lock'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 6654 "configure"
+#include "confdefs.h"
 
-	/*
-	 * First, make a file with some known garbage in it.
-	 */
-	data = malloc(pagesize);
-	if (!data)
-		exit(1);
-	for (i = 0; i < pagesize; ++i)
-		*(data + i) = rand();
-	umask(0);
-	fd = creat("conftestmmap", 0600);
-	if (fd < 0)
-		exit(1);
-	if (write(fd, data, pagesize) != pagesize)
-		exit(1);
-	close(fd);
+#include <sys/types.h>
+#include <fcntl.h>
+int main() {
 
-	/*
-	 * Next, try to mmap the file at a fixed address which
-	 * already has something else allocated at it.  If we can,
-	 * also make sure that we see the same garbage.
-	 */
-	fd = open("conftestmmap", O_RDWR);
-	if (fd < 0)
-		exit(1);
-	data2 = malloc(2 * pagesize);
-	if (!data2)
-		exit(1);
-	data2 += (pagesize - ((int) data2 & (pagesize - 1))) & (pagesize - 1);
-	if (data2 != mmap(data2, mmap_sizeparm(pagesize), PROT_READ | PROT_WRITE,
-	    MAP_PRIVATE | MAP_FIXED, fd, 0L))
-		exit(1);
-	for (i = 0; i < pagesize; ++i)
-		if (*(data + i) != *(data2 + i))
-			exit(1);
+struct flock fl;
+fcntl(0, F_SETLK, &fl);
+; return 0; }
+EOF
+if { (eval echo configure:6665: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func_fcntl_lock=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_func_fcntl_lock=no
+fi
+rm -f conftest*
+fi
 
-	/*
-	 * Finally, make sure that changes to the mapped area
-	 * do not percolate back to the file as seen by read().
-	 * (This is a bug on some variants of i386 svr4.0.)
-	 */
-	for (i = 0; i < pagesize; ++i)
-		*(data2 + i) = *(data2 + i) + 1;
-	data3 = malloc(pagesize);
-	if (!data3)
-		exit(1);
-	if (read(fd, data3, pagesize) != pagesize)
-		exit(1);
-	for (i = 0; i < pagesize; ++i)
-		if (*(data + i) != *(data3 + i))
-			exit(1);
-	close(fd);
-	unlink("conftestmmap");
-	exit(0);
-}
+echo "$ac_t""$ac_cv_func_fcntl_lock" 1>&6
+if test $ac_cv_func_fcntl_lock = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_FCNTL_LOCKF 1
+EOF
 
+fi
+echo $ac_n "checking for uname""... $ac_c" 1>&6
+echo "configure:6685: checking for uname" >&5
+if eval "test \"`echo '$''{'ac_cv_func_uname'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 6690 "configure"
+#include "confdefs.h"
+#include <sys/utsname.h>
+int main() {
+struct	utsname un;
+uname(&un);
+; return 0; }
 EOF
-if { (eval echo configure:5496: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_func_mmap_fixed_mapped=yes
+if { (eval echo configure:6698: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func_uname=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_func_mmap_fixed_mapped=no
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  ac_cv_func_uname=no
 fi
-
+rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_mmap_fixed_mapped" 1>&6
-if test $ac_cv_func_mmap_fixed_mapped = yes; then
+echo "$ac_t""$ac_cv_func_uname" 1>&6
+if test $ac_cv_func_uname = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_MMAP 1
+#define HAVE_UNAME 1
 EOF
 
 fi
-
-for ac_hdr in unistd.h
-do
-ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
-echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:5522: checking for $ac_hdr" >&5
+ac_safe=`echo "vfork.h" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for vfork.h""... $ac_c" 1>&6
+echo "configure:6719: checking for vfork.h" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5527 "configure"
+#line 6724 "configure"
 #include "confdefs.h"
-#include <$ac_hdr>
+#include <vfork.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5532: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:6729: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5544,797 +6741,768 @@
 fi
 if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
-  cat >> confdefs.h <<EOF
-#define $ac_tr_hdr 1
+  cat >> confdefs.h <<\EOF
+#define HAVE_VFORK_H 1
 EOF
- 
+
 else
   echo "$ac_t""no" 1>&6
 fi
-done
 
-for ac_func in getpagesize
-do
-echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:5561: checking for $ac_func" >&5
-if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+echo $ac_n "checking for working vfork""... $ac_c" 1>&6
+echo "configure:6754: checking for working vfork" >&5
+if eval "test \"`echo '$''{'ac_cv_func_vfork_works'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  echo $ac_n "checking for vfork""... $ac_c" 1>&6
+echo "configure:6760: checking for vfork" >&5
+if eval "test \"`echo '$''{'ac_cv_func_vfork'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5566 "configure"
+#line 6765 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func(); below.  */
+    which can conflict with char vfork(); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char $ac_func();
+char vfork();
 
 int main() {
 
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
     something starting with __ and the normal name is an alias.  */
-#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+#if defined (__stub_vfork) || defined (__stub___vfork)
 choke me
 #else
-$ac_func();
+vfork();
 #endif
 
 ; return 0; }
 EOF
-if { (eval echo configure:5589: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6788: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  eval "ac_cv_func_$ac_func=yes"
+  eval "ac_cv_func_vfork=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  eval "ac_cv_func_$ac_func=no"
+  eval "ac_cv_func_vfork=no"
 fi
 rm -f conftest*
 fi
 
-if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+if eval "test \"`echo '$ac_cv_func_'vfork`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
-  cat >> confdefs.h <<EOF
-#define $ac_tr_func 1
-EOF
- 
+  :
 else
   echo "$ac_t""no" 1>&6
 fi
-done
 
-echo $ac_n "checking for mmap that needs ptr to size""... $ac_c" 1>&6
-echo "configure:5614: checking for mmap that needs ptr to size" >&5
-if eval "test \"`echo '$''{'ac_cv_func_mmap_sizep'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  if test "$cross_compiling" = yes; then
-  ac_cv_func_mmap_sizep=no
+ac_cv_func_vfork_works=$ac_cv_func_vfork
 else
   cat > conftest.$ac_ext <<EOF
-#line 5622 "configure"
+#line 6810 "configure"
 #include "confdefs.h"
-
+/* Thanks to Paul Eggert for this test.  */
+#include <stdio.h>
 #include <sys/types.h>
-#include <fcntl.h>
-#include <signal.h>
-#include <setjmp.h>
-#include <sys/mman.h>
-
-#ifndef MAP_FILE
-#define MAP_FILE   0		/* Needed on Apollo Domain/OS */
+#include <sys/stat.h>
+#ifdef HAVE_UNISTD_H
+#include <unistd.h>
 #endif
-
-/* This mess was copied from the GNU getpagesize.h.  */
-#ifndef HAVE_GETPAGESIZE
-# ifdef HAVE_UNISTD_H
-#  include <unistd.h>
-# endif
-
-/* Assume that all systems that can run configure have sys/param.h.  */
-# ifndef HAVE_SYS_PARAM_H
-#  define HAVE_SYS_PARAM_H 1
-# endif
-
-# ifdef _SC_PAGESIZE
-#  define getpagesize() sysconf(_SC_PAGESIZE)
-# else /* no _SC_PAGESIZE */
-#  ifdef HAVE_SYS_PARAM_H
-#   include <sys/param.h>
-#   ifdef EXEC_PAGESIZE
-#    define getpagesize() EXEC_PAGESIZE
-#   else /* no EXEC_PAGESIZE */
-#    ifdef NBPG
-#     define getpagesize() NBPG * CLSIZE
-#     ifndef CLSIZE
-#      define CLSIZE 1
-#     endif /* no CLSIZE */
-#    else /* no NBPG */
-#     ifdef NBPC
-#      define getpagesize() NBPC
-#     else /* no NBPC */
-#      ifdef PAGESIZE
-#       define getpagesize() PAGESIZE
-#      endif /* PAGESIZE */
-#     endif /* no NBPC */
-#    endif /* no NBPG */
-#   endif /* no EXEC_PAGESIZE */
-#  else /* no HAVE_SYS_PARAM_H */
-#   define getpagesize() 8192	/* punt totally */
-#  endif /* no HAVE_SYS_PARAM_H */
-# endif /* no _SC_PAGESIZE */
-
-#endif /* no HAVE_GETPAGESIZE */
-
+#ifdef HAVE_VFORK_H
+#include <vfork.h>
+#endif
+/* On some sparc systems, changes by the child to local and incoming
+   argument registers are propagated back to the parent.
+   The compiler is told about this with #include <vfork.h>,
+   but some compilers (e.g. gcc -O) don't grok <vfork.h>.
+   Test for this by using a static variable whose address
+   is put into a register that is clobbered by the vfork.  */
+static
 #ifdef __cplusplus
-extern "C" { void *malloc(unsigned); }
+sparc_address_test (int arg)
 #else
-char *malloc();
+sparc_address_test (arg) int arg;
 #endif
-
-jmp_buf jenv;
-
-int
-intr()
 {
-	signal(SIGSEGV, intr);
-	longjmp(jenv, 1);
+  static pid_t child;
+  if (!child) {
+    child = vfork ();
+    if (child < 0) {
+      perror ("vfork");
+      _exit(2);
+    }
+    if (!child) {
+      arg = getpid();
+      write(-1, "", 0);
+      _exit (arg);
+    }
+  }
 }
+main() {
+  pid_t parent = getpid ();
+  pid_t child;
 
-int
-main()
-{
-	char *data, *data2;
-	int i, pagesize, ps;
-	int fd;
-
-	pagesize = getpagesize();
+  sparc_address_test ();
 
-	/*
-	 * First, make a file with some known garbage in it.
-	 */
-	data = malloc(pagesize);
-	if (!data)
-		exit(1);
-	for (i = 0; i < pagesize; ++i)
-		*(data + i) = rand();
-	umask(0);
-	fd = creat("conftestmmap", 0600);
-	if (fd < 0)
-		exit(1);
-	if (write(fd, data, pagesize) != pagesize)
-		exit(1);
-	close(fd);
+  child = vfork ();
 
-	/*
-	 * Next, try to mmap the file at a fixed address which
-	 * already has something else allocated at it.  If we can,
-	 * also make sure that we see the same garbage.
-	 */
-	fd = open("conftestmmap", O_RDWR);
-	if (fd < 0)
-		exit(1);
+  if (child == 0) {
+    /* Here is another test for sparc vfork register problems.
+       This test uses lots of local variables, at least
+       as many local variables as main has allocated so far
+       including compiler temporaries.  4 locals are enough for
+       gcc 1.40.3 on a Solaris 4.1.3 sparc, but we use 8 to be safe.
+       A buggy compiler should reuse the register of parent
+       for one of the local variables, since it will think that
+       parent can't possibly be used any more in this routine.
+       Assigning to the local variable will thus munge parent
+       in the parent process.  */
+    pid_t
+      p = getpid(), p1 = getpid(), p2 = getpid(), p3 = getpid(),
+      p4 = getpid(), p5 = getpid(), p6 = getpid(), p7 = getpid();
+    /* Convince the compiler that p..p7 are live; otherwise, it might
+       use the same hardware register for all 8 local variables.  */
+    if (p != p1 || p != p2 || p != p3 || p != p4
+	|| p != p5 || p != p6 || p != p7)
+      _exit(1);
 
-	/*
-	 * Keep a copy, Apollo modifies the value...
-	 */
-	ps = pagesize;
+    /* On some systems (e.g. IRIX 3.3),
+       vfork doesn't separate parent from child file descriptors.
+       If the child closes a descriptor before it execs or exits,
+       this munges the parent's descriptor as well.
+       Test for this by closing stdout in the child.  */
+    _exit(close(fileno(stdout)) != 0);
+  } else {
+    int status;
+    struct stat st;
 
-	/*
-	 * Apollo mmap() is not a syscall but a library function and fails
-	 * if it tries to dereference 'ps'. We must use setjmp in order to
-	 * catch the failure.
-	 */
-	signal(SIGSEGV, intr);
-	if (setjmp(jenv) == 0) {
-		data2 = mmap(0, ps, PROT_READ, MAP_FILE | MAP_PRIVATE, fd, 0L);
-	} else {
-		data2 = (char *)-1;
-	}
-	if (data2 != (char *)-1)
-		exit(1);
+    while (wait(&status) != child)
+      ;
+    exit(
+	 /* Was there some problem with vforking?  */
+	 child < 0
 
-	signal(SIGSEGV, intr);
-	if (setjmp(jenv) == 0) {
-		data2 = mmap(0, &ps, PROT_READ, MAP_FILE | MAP_PRIVATE, fd, 0L);
-	} else {
-		data2 = (char *)-1;
-	}
-	if (data2 == (char *)-1)
-		exit(1);
+	 /* Did the child fail?  (This shouldn't happen.)  */
+	 || status
 
-	for (i = 0; i < pagesize; ++i)
-		if (*(data + i) != *(data2 + i))
-			exit(1);
+	 /* Did the vfork/compiler bug occur?  */
+	 || parent != getpid()
 
-	close(fd);
-	unlink("conftestmmap");
-	exit(0);
+	 /* Did the file descriptor bug occur?  */
+	 || fstat(fileno(stdout), &st) != 0
+	 );
+  }
 }
-
 EOF
-if { (eval echo configure:5763: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:6905: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
-  ac_cv_func_mmap_sizep=yes
+  ac_cv_func_vfork_works=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -fr conftest*
-  ac_cv_func_mmap_sizep=no
+  ac_cv_func_vfork_works=no
 fi
 rm -fr conftest*
 fi
 
 fi
 
-echo "$ac_t""$ac_cv_func_mmap_sizep" 1>&6
-if test $ac_cv_func_mmap_sizep = yes; then
+echo "$ac_t""$ac_cv_func_vfork_works" 1>&6
+if test $ac_cv_func_vfork_works = no; then
   cat >> confdefs.h <<\EOF
-#define _MMAP_WITH_SIZEP 1
+#define vfork fork
 EOF
 
 fi
 
-echo $ac_n "checking if mmap works to get shared memory""... $ac_c" 1>&6
-echo "configure:5786: checking if mmap works to get shared memory" >&5
-if eval "test \"`echo '$''{'ac_cv_func_smmap'+set}'`\" = set"; then
+echo $ac_n "checking for sys_siglist""... $ac_c" 1>&6
+echo "configure:6928: checking for sys_siglist" >&5
+if eval "test \"`echo '$''{'ac_cv_func_sys_siglist'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
-  ac_cv_func_smmap=no
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 5794 "configure"
+#line 6936 "configure"
 #include "confdefs.h"
 
-#include <sys/types.h>
-#include <sys/mman.h>
-
-#ifndef	MAP_ANONYMOUS
-#	ifdef	MAP_ANON
-#		define MAP_ANONYMOUS MAP_ANON
-#	endif
-#endif
-
-/*
- * Needed for Apollo Domain/OS and may be for others?
- */
-#ifdef	_MMAP_WITH_SIZEP
-#	define	mmap_sizeparm(s)	(&(s))
-#else
-#	define	mmap_sizeparm(s)	(s)
-#endif
-
-char *
-mkshare()
-{
-        int     size = 8192;
-        int     f;
-        char    *addr;
-
-#ifdef  MAP_ANONYMOUS   /* HP/UX */
-        f = -1;
-        addr = mmap(0, mmap_sizeparm(size), PROT_READ|PROT_WRITE, MAP_SHARED|MAP_ANONYMOUS, f, 0);
-#else
-        if ((f = open("/dev/zero", 2)) < 0)
-                exit(1);
-        addr = mmap(0, mmap_sizeparm(size), PROT_READ|PROT_WRITE, MAP_SHARED, f, 0);
-#endif
-        if (addr == (char *)-1)
-                exit(1);
-        close(f);
-
-        return (addr);
-}
-
 int
 main()
-{
-        char    *addr;
-        
-        addr = mkshare();
-        *addr = 'I';
-
-        switch (fork()) {
+{ extern char *sys_siglist[];
+if (sys_siglist[1] == 0)
+	exit(1);
+exit(0);}
+EOF
+if { (eval echo configure:6946: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_func_sys_siglist=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -fr conftest*
+  ac_cv_func_sys_siglist=no
+fi
+rm -fr conftest*
+fi
 
-        case -1:
-                printf("help\n"); exit(1);
+fi
 
-        case 0: /* child */
-                *addr = 'N';
-                _exit(0);
-                break;
-        default: /* parent */
-                wait(0);
-                sleep(1);
-                break;
-        }
+echo "$ac_t""$ac_cv_func_sys_siglist" 1>&6
+if test $ac_cv_func_sys_siglist = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_SYS_SIGLIST 1
+EOF
 
-        if (*addr != 'N')
-                exit(1);
-        exit(0);
-}
+fi
+echo $ac_n "checking for BSD compliant getpgrp""... $ac_c" 1>&6
+echo "configure:6968: checking for BSD compliant getpgrp" >&5
+if eval "test \"`echo '$''{'ac_cv_func_bsd_getpgrp'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+else
+  cat > conftest.$ac_ext <<EOF
+#line 6976 "configure"
+#include "confdefs.h"
 
+int
+main()
+{ long p;
+/*
+ * POSIX getpgrp() has void parameter...
+ */
+	p = getpgrp(-1);
+	if (p == getpgrp(1) && p == getpgrp(getpid()))
+		exit(1);
+exit(0);}
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:6990: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
-  ac_cv_func_smmap=yes
+  ac_cv_func_bsd_getpgrp=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -fr conftest*
-  ac_cv_func_smmap=no
+  ac_cv_func_bsd_getpgrp=no
 fi
 rm -fr conftest*
 fi
 
 fi
 
-echo "$ac_t""$ac_cv_func_smmap" 1>&6
-if test $ac_cv_func_smmap = yes; then
+echo "$ac_t""$ac_cv_func_bsd_getpgrp" 1>&6
+if test $ac_cv_func_bsd_getpgrp = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_SMMAP 1
+#define HAVE_BSD_GETPGRP 1
 EOF
 
 fi
-echo $ac_n "checking if quotactl is an ioctl""... $ac_c" 1>&6
-echo "configure:5888: checking if quotactl is an ioctl" >&5
-if eval "test \"`echo '$''{'ac_cv_func_quotaioctl'+set}'`\" = set"; then
+echo $ac_n "checking for BSD compliant setpgrp""... $ac_c" 1>&6
+echo "configure:7012: checking for BSD compliant setpgrp" >&5
+if eval "test \"`echo '$''{'ac_cv_func_bsd_setpgrp'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
+  if test "$cross_compiling" = yes; then
+    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
+else
   cat > conftest.$ac_ext <<EOF
-#line 5893 "configure"
+#line 7020 "configure"
 #include "confdefs.h"
-#include <sys/types.h>
-#include <sys/fs/ufs_quota.h>
-int main() {
-struct quotctl q; ioctl(0, Q_QUOTACTL, &q)
-; return 0; }
+
+#include <errno.h>
+#ifndef	HAVE_ERRNO_DEF
+extern	int	errno;
+#endif
+int
+main()
+{ errno = 0;
+/*
+ * Force illegal pid on BSD
+ */
+if (setpgrp(-1, 100) < 0 && errno == ESRCH)
+	exit(0);
+exit(1);}
 EOF
-if { (eval echo configure:5901: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  ac_cv_func_quotaioctl=yes
+if { (eval echo configure:7037: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  ac_cv_func_bsd_setpgrp=yes
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  ac_cv_func_quotaioctl=no
+  rm -fr conftest*
+  ac_cv_func_bsd_setpgrp=no
 fi
-rm -f conftest*
+rm -fr conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_quotaioctl" 1>&6 
-if test $ac_cv_func_quotaioctl = yes; then
+fi
+
+echo "$ac_t""$ac_cv_func_bsd_setpgrp" 1>&6
+if test $ac_cv_func_bsd_setpgrp = yes; then
   cat >> confdefs.h <<\EOF
-#define HAVE_QUOTAIOCTL 1
+#define HAVE_BSD_SETPGRP 1
 EOF
 
 fi
-echo $ac_n "checking for file locking via fcntl""... $ac_c" 1>&6
-echo "configure:5921: checking for file locking via fcntl" >&5
-if eval "test \"`echo '$''{'ac_cv_func_fcntl_lock'+set}'`\" = set"; then
+for ac_func in brk sbrk strerror nice memmove flock lockf fchdir statvfs quotactl
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:7061: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5926 "configure"
+#line 7066 "configure"
 #include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
 
-#include <sys/types.h>
-#include <fcntl.h>
 int main() {
 
-struct flock fl;
-fcntl(0, F_SETLK, &fl);
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
 ; return 0; }
 EOF
-if { (eval echo configure:5937: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7089: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_func_fcntl_lock=yes
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_func_fcntl_lock=no
+  eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_fcntl_lock" 1>&6
-if test $ac_cv_func_fcntl_lock = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_FCNTL_LOCKF 1
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for uname""... $ac_c" 1>&6
-echo "configure:5957: checking for uname" >&5
-if eval "test \"`echo '$''{'ac_cv_func_uname'+set}'`\" = set"; then
+done
+
+for ac_func in getcwd shmat semget
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:7116: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5962 "configure"
+#line 7121 "configure"
 #include "confdefs.h"
-#include <sys/utsname.h>
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
+
 int main() {
-struct	utsname un;
-uname(&un);
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
 ; return 0; }
 EOF
-if { (eval echo configure:5970: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7144: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_func_uname=yes
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_func_uname=no
+  eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_uname" 1>&6
-if test $ac_cv_func_uname = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_UNAME 1
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-ac_safe=`echo "vfork.h" | sed 'y%./+-%__p_%'`
-echo $ac_n "checking for vfork.h""... $ac_c" 1>&6
-echo "configure:5991: checking for vfork.h" >&5
-if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+done
+
+for ac_func in lstat readlink link rename mkfifo mknod
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:7171: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5996 "configure"
+#line 7176 "configure"
 #include "confdefs.h"
-#include <vfork.h>
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
+
+int main() {
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
+; return 0; }
 EOF
-ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:6001: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
-ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
-if test -z "$ac_err"; then
+if { (eval echo configure:7199: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  eval "ac_cv_header_$ac_safe=yes"
+  eval "ac_cv_func_$ac_func=yes"
 else
-  echo "$ac_err" >&5
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  eval "ac_cv_header_$ac_safe=no"
+  eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
 fi
-if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  cat >> confdefs.h <<\EOF
-#define HAVE_VFORK_H 1
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
 else
   echo "$ac_t""no" 1>&6
 fi
+done
 
-echo $ac_n "checking for working vfork""... $ac_c" 1>&6
-echo "configure:6026: checking for working vfork" >&5
-if eval "test \"`echo '$''{'ac_cv_func_vfork_works'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  if test "$cross_compiling" = yes; then
-  echo $ac_n "checking for vfork""... $ac_c" 1>&6
-echo "configure:6032: checking for vfork" >&5
-if eval "test \"`echo '$''{'ac_cv_func_vfork'+set}'`\" = set"; then
+for ac_func in setreuid setresuid seteuid setuid
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:7226: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6037 "configure"
+#line 7231 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char vfork(); below.  */
+    which can conflict with char $ac_func(); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char vfork();
+char $ac_func();
 
 int main() {
 
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
     something starting with __ and the normal name is an alias.  */
-#if defined (__stub_vfork) || defined (__stub___vfork)
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
 choke me
 #else
-vfork();
+$ac_func();
 #endif
 
 ; return 0; }
 EOF
-if { (eval echo configure:6060: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7254: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  eval "ac_cv_func_vfork=yes"
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  eval "ac_cv_func_vfork=no"
+  eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
 fi
 
-if eval "test \"`echo '$ac_cv_func_'vfork`\" = yes"; then
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  :
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
+EOF
+ 
 else
   echo "$ac_t""no" 1>&6
 fi
+done
 
-ac_cv_func_vfork_works=$ac_cv_func_vfork
+for ac_func in setregid setresgid setegid setgid
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:7281: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6082 "configure"
+#line 7286 "configure"
 #include "confdefs.h"
-/* Thanks to Paul Eggert for this test.  */
-#include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#ifdef HAVE_UNISTD_H
-#include <unistd.h>
-#endif
-#ifdef HAVE_VFORK_H
-#include <vfork.h>
-#endif
-/* On some sparc systems, changes by the child to local and incoming
-   argument registers are propagated back to the parent.
-   The compiler is told about this with #include <vfork.h>,
-   but some compilers (e.g. gcc -O) don't grok <vfork.h>.
-   Test for this by using a static variable whose address
-   is put into a register that is clobbered by the vfork.  */
-static
-#ifdef __cplusplus
-sparc_address_test (int arg)
-#else
-sparc_address_test (arg) int arg;
-#endif
-{
-  static pid_t child;
-  if (!child) {
-    child = vfork ();
-    if (child < 0) {
-      perror ("vfork");
-      _exit(2);
-    }
-    if (!child) {
-      arg = getpid();
-      write(-1, "", 0);
-      _exit (arg);
-    }
-  }
-}
-main() {
-  pid_t parent = getpid ();
-  pid_t child;
-
-  sparc_address_test ();
-
-  child = vfork ();
-
-  if (child == 0) {
-    /* Here is another test for sparc vfork register problems.
-       This test uses lots of local variables, at least
-       as many local variables as main has allocated so far
-       including compiler temporaries.  4 locals are enough for
-       gcc 1.40.3 on a Solaris 4.1.3 sparc, but we use 8 to be safe.
-       A buggy compiler should reuse the register of parent
-       for one of the local variables, since it will think that
-       parent can't possibly be used any more in this routine.
-       Assigning to the local variable will thus munge parent
-       in the parent process.  */
-    pid_t
-      p = getpid(), p1 = getpid(), p2 = getpid(), p3 = getpid(),
-      p4 = getpid(), p5 = getpid(), p6 = getpid(), p7 = getpid();
-    /* Convince the compiler that p..p7 are live; otherwise, it might
-       use the same hardware register for all 8 local variables.  */
-    if (p != p1 || p != p2 || p != p3 || p != p4
-	|| p != p5 || p != p6 || p != p7)
-      _exit(1);
-
-    /* On some systems (e.g. IRIX 3.3),
-       vfork doesn't separate parent from child file descriptors.
-       If the child closes a descriptor before it execs or exits,
-       this munges the parent's descriptor as well.
-       Test for this by closing stdout in the child.  */
-    _exit(close(fileno(stdout)) != 0);
-  } else {
-    int status;
-    struct stat st;
-
-    while (wait(&status) != child)
-      ;
-    exit(
-	 /* Was there some problem with vforking?  */
-	 child < 0
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
 
-	 /* Did the child fail?  (This shouldn't happen.)  */
-	 || status
+int main() {
 
-	 /* Did the vfork/compiler bug occur?  */
-	 || parent != getpid()
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
 
-	 /* Did the file descriptor bug occur?  */
-	 || fstat(fileno(stdout), &st) != 0
-	 );
-  }
-}
+; return 0; }
 EOF
-if { (eval echo configure:6177: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_func_vfork_works=yes
+if { (eval echo configure:7309: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_func_vfork_works=no
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
 fi
-
+rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_vfork_works" 1>&6
-if test $ac_cv_func_vfork_works = no; then
-  cat >> confdefs.h <<\EOF
-#define vfork fork
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
+done
 
-echo $ac_n "checking for sys_siglist""... $ac_c" 1>&6
-echo "configure:6200: checking for sys_siglist" >&5
-if eval "test \"`echo '$''{'ac_cv_func_sys_siglist'+set}'`\" = set"; then
+for ac_func in getpgid setpgid
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:7336: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
-else
   cat > conftest.$ac_ext <<EOF
-#line 6208 "configure"
+#line 7341 "configure"
 #include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
+
+int main() {
 
-int
-main()
-{ extern char *sys_siglist[];
-if (sys_siglist[1] == 0)
-	exit(1);
-exit(0);}
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
+; return 0; }
 EOF
-if { (eval echo configure:6218: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_func_sys_siglist=yes
+if { (eval echo configure:7364: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_func_sys_siglist=no
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
 fi
-
+rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_sys_siglist" 1>&6
-if test $ac_cv_func_sys_siglist = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_SYS_SIGLIST 1
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for BSD compliant getpgrp""... $ac_c" 1>&6
-echo "configure:6240: checking for BSD compliant getpgrp" >&5
-if eval "test \"`echo '$''{'ac_cv_func_bsd_getpgrp'+set}'`\" = set"; then
+done
+
+for ac_func in getpgrp setpgrp
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:7391: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
-else
   cat > conftest.$ac_ext <<EOF
-#line 6248 "configure"
+#line 7396 "configure"
 #include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
 
-int
-main()
-{ long p;
-/*
- * POSIX getpgrp() has void parameter...
- */
-	p = getpgrp(-1);
-	if (p == getpgrp(1) && p == getpgrp(getpid()))
-		exit(1);
-exit(0);}
+int main() {
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
+; return 0; }
 EOF
-if { (eval echo configure:6262: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_func_bsd_getpgrp=yes
+if { (eval echo configure:7419: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_func_bsd_getpgrp=no
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
 fi
-
+rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_bsd_getpgrp" 1>&6
-if test $ac_cv_func_bsd_getpgrp = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_BSD_GETPGRP 1
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-echo $ac_n "checking for BSD compliant setpgrp""... $ac_c" 1>&6
-echo "configure:6284: checking for BSD compliant setpgrp" >&5
-if eval "test \"`echo '$''{'ac_cv_func_bsd_setpgrp'+set}'`\" = set"; then
+done
+
+for ac_func in getspnam getspwnam
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:7446: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  if test "$cross_compiling" = yes; then
-    { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
-else
   cat > conftest.$ac_ext <<EOF
-#line 6292 "configure"
+#line 7451 "configure"
 #include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
 
-#include <errno.h>
-#ifndef	HAVE_ERRNO_DEF
-extern	int	errno;
+int main() {
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
 #endif
-int
-main()
-{ errno = 0;
-/*
- * Force illegal pid on BSD
- */
-if (setpgrp(-1, 100) < 0 && errno == ESRCH)
-	exit(0);
-exit(1);}
+
+; return 0; }
 EOF
-if { (eval echo configure:6309: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
-then
-  ac_cv_func_bsd_setpgrp=yes
+if { (eval echo configure:7474: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
-  rm -fr conftest*
-  ac_cv_func_bsd_setpgrp=no
-fi
-rm -fr conftest*
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
 fi
-
+rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_func_bsd_setpgrp" 1>&6
-if test $ac_cv_func_bsd_setpgrp = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_BSD_SETPGRP 1
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
-
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
-for ac_func in brk sbrk strerror nice memmove flock lockf fchdir statvfs quotactl
+done
+
+for ac_func in sync fsync fork wait4 waitid waitpid getrusage getrlimit setrlimit ulimit
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6333: checking for $ac_func" >&5
+echo "configure:7501: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6338 "configure"
+#line 7506 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6357,7 +7525,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6361: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7529: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6381,15 +7549,15 @@
 fi
 done
 
-for ac_func in getcwd shmat semget
+for ac_func in execl execle execv execve execvp
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6388: checking for $ac_func" >&5
+echo "configure:7556: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6393 "configure"
+#line 7561 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6412,7 +7580,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6416: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7584: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6436,15 +7604,15 @@
 fi
 done
 
-for ac_func in lstat readlink link rename mkfifo mknod
+for ac_func in gethostid gethostname getdomainname getpagesize getdtablesize
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6443: checking for $ac_func" >&5
+echo "configure:7611: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6448 "configure"
+#line 7616 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6467,7 +7635,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6471: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7639: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6491,15 +7659,15 @@
 fi
 done
 
-for ac_func in setreuid setresuid seteuid setuid
+for ac_func in gettimeofday settimeofday time stime
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6498: checking for $ac_func" >&5
+echo "configure:7666: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6503 "configure"
+#line 7671 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6522,7 +7690,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6526: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7694: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6546,15 +7714,15 @@
 fi
 done
 
-for ac_func in setregid setresgid setegid setgid
+for ac_func in poll select lchown times utimes
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6553: checking for $ac_func" >&5
+echo "configure:7721: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6558 "configure"
+#line 7726 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6577,7 +7745,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6581: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7749: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6601,15 +7769,15 @@
 fi
 done
 
-for ac_func in getpgid setpgid
+for ac_func in ecvt_r fcvt_r gcvt_r
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6608: checking for $ac_func" >&5
+echo "configure:7776: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6613 "configure"
+#line 7781 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6632,7 +7800,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6636: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7804: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6656,15 +7824,15 @@
 fi
 done
 
-for ac_func in getpgrp setpgrp
+for ac_func in econvert fconvert gconvert
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6663: checking for $ac_func" >&5
+echo "configure:7831: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6668 "configure"
+#line 7836 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6687,7 +7855,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6691: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7859: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6711,15 +7879,15 @@
 fi
 done
 
-for ac_func in getspnam getspwnam
+for ac_func in isinf isnan
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6718: checking for $ac_func" >&5
+echo "configure:7886: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6723 "configure"
+#line 7891 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6742,7 +7910,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6746: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7914: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6766,15 +7934,15 @@
 fi
 done
 
-for ac_func in sync fsync fork wait4 waitid waitpid getrusage
+for ac_func in rand drand48
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6773: checking for $ac_func" >&5
+echo "configure:7941: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6778 "configure"
+#line 7946 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6797,7 +7965,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6801: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7969: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6821,15 +7989,15 @@
 fi
 done
 
-for ac_func in gethostid gethostname getdomainname getpagesize
+for ac_func in setpriority DosSetPriority
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6828: checking for $ac_func" >&5
+echo "configure:7996: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6833 "configure"
+#line 8001 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6852,7 +8020,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6856: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8024: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6876,15 +8044,15 @@
 fi
 done
 
-for ac_func in poll select lchown times utimes
+for ac_func in DosAllocSharedMem
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6883: checking for $ac_func" >&5
+echo "configure:8051: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6888 "configure"
+#line 8056 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6907,7 +8075,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6911: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8079: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6931,15 +8099,15 @@
 fi
 done
 
-for ac_func in ecvt_r fcvt_r gcvt_r
+for ac_func in seekdir
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6938: checking for $ac_func" >&5
+echo "configure:8106: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6943 "configure"
+#line 8111 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -6962,7 +8130,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:6966: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8134: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -6986,15 +8154,15 @@
 fi
 done
 
-for ac_func in econvert fconvert gconvert
+for ac_func in strsignal str2sig sig2str
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:6993: checking for $ac_func" >&5
+echo "configure:8161: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6998 "configure"
+#line 8166 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7017,7 +8185,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7021: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8189: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7041,15 +8209,15 @@
 fi
 done
 
-for ac_func in isinf isnan
+for ac_func in killpg sigrelse sigprocmask sigsetmask sigset
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7048: checking for $ac_func" >&5
+echo "configure:8216: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7053 "configure"
+#line 8221 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7072,7 +8240,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7076: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8244: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7096,15 +8264,15 @@
 fi
 done
 
-for ac_func in rand drand48
+for ac_func in nanosleep usleep
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7103: checking for $ac_func" >&5
+echo "configure:8271: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7108 "configure"
+#line 8276 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7127,7 +8295,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7131: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8299: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7151,15 +8319,15 @@
 fi
 done
 
-for ac_func in setpriority DosSetPriority
+for ac_func in putenv setenv snprintf strcasecmp strdup
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7158: checking for $ac_func" >&5
+echo "configure:8326: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7163 "configure"
+#line 8331 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7182,7 +8350,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7186: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8354: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7206,15 +8374,15 @@
 fi
 done
 
-for ac_func in DosAllocSharedMem
+for ac_func in valloc
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7213: checking for $ac_func" >&5
+echo "configure:8381: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7218 "configure"
+#line 8386 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7237,7 +8405,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7241: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8409: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7261,15 +8429,15 @@
 fi
 done
 
-for ac_func in seekdir
+for ac_func in madvise mlock
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7268: checking for $ac_func" >&5
+echo "configure:8436: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7273 "configure"
+#line 8441 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7292,7 +8460,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7296: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8464: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7316,15 +8484,15 @@
 fi
 done
 
-for ac_func in strsignal str2sig sig2str
+for ac_func in chflags fchflags fflagstostr strtofflags
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7323: checking for $ac_func" >&5
+echo "configure:8491: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7328 "configure"
+#line 8496 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7347,7 +8515,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7351: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8519: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7371,70 +8539,123 @@
 fi
 done
 
-for ac_func in killpg sigrelse sigprocmask sigsetmask
-do
-echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7378: checking for $ac_func" >&5
-if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+
+echo $ac_n "checking for fseeko()""... $ac_c" 1>&6
+echo "configure:8545: checking for fseeko()" >&5
+if eval "test \"`echo '$''{'ac_cv_func_fseeko'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 8550 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+return !fseeko;
+; return 0; }
+EOF
+if { (eval echo configure:8557: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func_fseeko=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_func_fseeko=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_func_fseeko" 1>&6
+if test $ac_cv_func_fseeko = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_FSEEKO 1
+EOF
+
+fi
+echo $ac_n "checking for ftello()""... $ac_c" 1>&6
+echo "configure:8577: checking for ftello()" >&5
+if eval "test \"`echo '$''{'ac_cv_func_ftello'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7383 "configure"
+#line 8582 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+return !ftello;
+; return 0; }
+EOF
+if { (eval echo configure:8589: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_func_ftello=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_func_ftello=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_func_ftello" 1>&6
+if test $ac_cv_func_ftello = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_FTELLO 1
+EOF
+
+fi
+
+echo $ac_n "checking for rcmd in -lsocket""... $ac_c" 1>&6
+echo "configure:8610: checking for rcmd in -lsocket" >&5
+ac_lib_var=`echo socket'_'rcmd | sed 'y%./+-%__p_%'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-lsocket  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 8618 "configure"
 #include "confdefs.h"
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func(); below.  */
-#include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char $ac_func();
+char rcmd();
 
 int main() {
-
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
-choke me
-#else
-$ac_func();
-#endif
-
+rcmd()
 ; return 0; }
 EOF
-if { (eval echo configure:7406: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8629: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  eval "ac_cv_func_$ac_func=yes"
+  eval "ac_cv_lib_$ac_lib_var=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  eval "ac_cv_func_$ac_func=no"
+  eval "ac_cv_lib_$ac_lib_var=no"
 fi
 rm -f conftest*
-fi
+LIBS="$ac_save_LIBS"
 
-if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
-  cat >> confdefs.h <<EOF
-#define $ac_tr_func 1
-EOF
- 
+  lib_socket="-lsocket"
 else
   echo "$ac_t""no" 1>&6
 fi
-done
 
-for ac_func in nanosleep usleep
+ac_save_LIBS="$LIBS"
+LIBS="$LIBS $lib_socket"
+for ac_func in rcmd
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7433: checking for $ac_func" >&5
+echo "configure:8654: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7438 "configure"
+#line 8659 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7457,7 +8678,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7461: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8682: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7481,70 +8702,56 @@
 fi
 done
 
-for ac_func in putenv setenv snprintf strcasecmp
-do
-echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7488: checking for $ac_func" >&5
-if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+echo $ac_n "checking for inet_ntoa in -lnsl""... $ac_c" 1>&6
+echo "configure:8707: checking for inet_ntoa in -lnsl" >&5
+ac_lib_var=`echo nsl'_'inet_ntoa | sed 'y%./+-%__p_%'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  cat > conftest.$ac_ext <<EOF
-#line 7493 "configure"
+  ac_save_LIBS="$LIBS"
+LIBS="-lnsl  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 8715 "configure"
 #include "confdefs.h"
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func(); below.  */
-#include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char $ac_func();
+char inet_ntoa();
 
 int main() {
-
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
-choke me
-#else
-$ac_func();
-#endif
-
+inet_ntoa()
 ; return 0; }
 EOF
-if { (eval echo configure:7516: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8726: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  eval "ac_cv_func_$ac_func=yes"
+  eval "ac_cv_lib_$ac_lib_var=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  eval "ac_cv_func_$ac_func=no"
+  eval "ac_cv_lib_$ac_lib_var=no"
 fi
 rm -f conftest*
-fi
+LIBS="$ac_save_LIBS"
 
-if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
-  cat >> confdefs.h <<EOF
-#define $ac_tr_func 1
-EOF
- 
+  lib_nsl="-lnsl"
 else
   echo "$ac_t""no" 1>&6
 fi
-done
 
-for ac_func in valloc
+LIBS="$LIBS $lib_nsl"
+for ac_func in inet_ntoa
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7543: checking for $ac_func" >&5
+echo "configure:8750: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7548 "configure"
+#line 8755 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -7567,7 +8774,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7571: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8778: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7591,6 +8798,7 @@
 fi
 done
 
+LIBS="$ac_save_LIBS"
 
 # Check whether --enable-largefile or --disable-largefile was given.
 if test "${enable_largefile+set}" = set; then
@@ -7601,16 +8809,17 @@
    if test "$enable_largefile" != no; then
 
      echo $ac_n "checking for special C compiler options needed for large files""... $ac_c" 1>&6
-echo "configure:7605: checking for special C compiler options needed for large files" >&5
+echo "configure:8813: checking for special C compiler options needed for large files" >&5
 if eval "test \"`echo '$''{'ac_cv_sys_largefile_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_cv_sys_largefile_CC=no
+        largefile_cc_opt=""
         if test "$GCC" != yes; then
 	  # IRIX 6.2 and later do not support large files by default,
 	  # so use the C compiler's -n32 option if that helps.
 	  cat > conftest.$ac_ext <<EOF
-#line 7614 "configure"
+#line 8823 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
     /* Check that off_t can represent 2**63 - 1 correctly.
@@ -7626,7 +8835,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7630: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8839: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -7635,7 +8844,7 @@
   ac_save_CC="${CC-cc}"
 	     CC="$CC -n32"
 	     cat > conftest.$ac_ext <<EOF
-#line 7639 "configure"
+#line 8848 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
     /* Check that off_t can represent 2**63 - 1 correctly.
@@ -7651,7 +8860,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7655: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8864: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_sys_largefile_CC=' -n32'
 else
@@ -7668,16 +8877,17 @@
 echo "$ac_t""$ac_cv_sys_largefile_CC" 1>&6
      if test "$ac_cv_sys_largefile_CC" != no; then
        CC="$CC$ac_cv_sys_largefile_CC"
+       largefile_cc_opt="$ac_cv_sys_largefile_CC"
      fi
 
      echo $ac_n "checking for _FILE_OFFSET_BITS value needed for large files""... $ac_c" 1>&6
-echo "configure:7675: checking for _FILE_OFFSET_BITS value needed for large files" >&5
+echo "configure:8885: checking for _FILE_OFFSET_BITS value needed for large files" >&5
 if eval "test \"`echo '$''{'ac_cv_sys_file_offset_bits'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_cv_sys_file_offset_bits=no
       cat > conftest.$ac_ext <<EOF
-#line 7681 "configure"
+#line 8891 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
     /* Check that off_t can represent 2**63 - 1 correctly.
@@ -7693,14 +8903,14 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7697: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8907: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
   cat > conftest.$ac_ext <<EOF
-#line 7704 "configure"
+#line 8914 "configure"
 #include "confdefs.h"
 #define _FILE_OFFSET_BITS 64
 #include <sys/types.h>
@@ -7718,7 +8928,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7722: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8932: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_sys_file_offset_bits=64
 else
@@ -7738,13 +8948,13 @@
 
    fi
      echo $ac_n "checking for _LARGE_FILES value needed for large files""... $ac_c" 1>&6
-echo "configure:7742: checking for _LARGE_FILES value needed for large files" >&5
+echo "configure:8952: checking for _LARGE_FILES value needed for large files" >&5
 if eval "test \"`echo '$''{'ac_cv_sys_large_files'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_cv_sys_large_files=no
       cat > conftest.$ac_ext <<EOF
-#line 7748 "configure"
+#line 8958 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
     /* Check that off_t can represent 2**63 - 1 correctly.
@@ -7760,14 +8970,14 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7764: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8974: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
   cat > conftest.$ac_ext <<EOF
-#line 7771 "configure"
+#line 8981 "configure"
 #include "confdefs.h"
 #define _LARGE_FILES 1
 #include <sys/types.h>
@@ -7785,7 +8995,7 @@
 
 ; return 0; }
 EOF
-if { (eval echo configure:7789: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8999: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_sys_large_files=1
 else
@@ -7804,180 +9014,377 @@
 EOF
 
    fi
+     echo $ac_n "checking for _LARGEFILE_SOURCE value needed for large files""... $ac_c" 1>&6
+echo "configure:9019: checking for _LARGEFILE_SOURCE value needed for large files" >&5
+if eval "test \"`echo '$''{'ac_cv_sys_largefile_source'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_cv_sys_largefile_source=no
+      cat > conftest.$ac_ext <<EOF
+#line 9025 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+return !fseeko;
+; return 0; }
+EOF
+if { (eval echo configure:9032: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  :
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  cat > conftest.$ac_ext <<EOF
+#line 9039 "configure"
+#include "confdefs.h"
+#define _LARGEFILE_SOURCE 1
+#include <stdio.h>
+	   
+int main() {
+return !fseeko;
+; return 0; }
+EOF
+if { (eval echo configure:9048: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_sys_largefile_source=1
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+fi
+rm -f conftest*
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_sys_largefile_source" 1>&6
+   if test "$ac_cv_sys_largefile_source" != no; then
+     cat >> confdefs.h <<EOF
+#define _LARGEFILE_SOURCE $ac_cv_sys_largefile_source
+EOF
+
+   fi
    fi
   
-echo $ac_n "checking for _LARGEFILE_SOURCE value needed for large files""... $ac_c" 1>&6
-echo "configure:7811: checking for _LARGEFILE_SOURCE value needed for large files" >&5
-if eval "test \"`echo '$''{'ac_cv_sys_largefile_source'+set}'`\" = set"; then
+echo $ac_n "checking if system supports Large Files at all""... $ac_c" 1>&6
+echo "configure:9070: checking if system supports Large Files at all" >&5
+if eval "test \"`echo '$''{'ac_cv_largefiles'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 9075 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+#include <sys/types.h>
+int main() {
+
+/*
+ * Check that off_t can represent 2**63 - 1 correctly.
+ * We can't simply "#define LARGE_OFF_T 9223372036854775807",
+ * since some C++ compilers masquerading as C compilers
+ * incorrectly reject 9223372036854775807.
+ */
+#   define LARGE_OFF_T (((off_t) 1 << 62) - 1 + ((off_t) 1 << 62))
+    int off_t_is_large[(LARGE_OFF_T % 2147483629 == 721
+			&& LARGE_OFF_T % 2147483647 == 1)
+		       ? 1 : -1];
+return !fseeko;
+return !ftello;
+; return 0; }
+EOF
+if { (eval echo configure:9095: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_largefiles=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_largefiles=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_largefiles" 1>&6
+	if test $ac_cv_largefiles = yes; then
+		cat >> confdefs.h <<\EOF
+#define HAVE_LARGEFILES 1
+EOF
+
+	fi
+
+cat >> confdefs.h <<EOF
+#define HOST_ALIAS "$host_alias"
+EOF
+
+cat >> confdefs.h <<EOF
+#define HOST_SUB "$host"
+EOF
+
+cat >> confdefs.h <<EOF
+#define HOST_CPU "$host_cpu"
+EOF
+
+cat >> confdefs.h <<EOF
+#define HOST_VENDOR "$host_vendor"
+EOF
+
+cat >> confdefs.h <<EOF
+#define HOST_OS "$host_os"
+EOF
+
+
+
+echo $ac_n "checking for crypt in -lc""... $ac_c" 1>&6
+echo "configure:9138: checking for crypt in -lc" >&5
+ac_lib_var=`echo c'_'crypt | sed 'y%./+-%__p_%'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-lc  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 9146 "configure"
+#include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char crypt();
+
+int main() {
+crypt()
+; return 0; }
+EOF
+if { (eval echo configure:9157: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=yes"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
+fi
+rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  lib_crypt=""
+else
+  echo "$ac_t""no" 1>&6
+echo $ac_n "checking for crypt in -lcrypt""... $ac_c" 1>&6
+echo "configure:9176: checking for crypt in -lcrypt" >&5
+ac_lib_var=`echo crypt'_'crypt | sed 'y%./+-%__p_%'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-lcrypt  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 9184 "configure"
+#include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char crypt();
+
+int main() {
+crypt()
+; return 0; }
+EOF
+if { (eval echo configure:9195: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=yes"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
+fi
+rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  lib_crypt="-lcrypt"
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+fi
+
+
+if test $ac_cv_header_camlib_h = yes; then
+  scsi_lib=-lcam
+fi
+
+if test "$ac_cv_header_sys_acl_h" = yes; then
+
+  echo "checking for Posix Access Control List support" 1>&6
+echo "configure:9225: checking for Posix Access Control List support" >&5
+  echo $ac_n "checking for acl_get_file in -lacl""... $ac_c" 1>&6
+echo "configure:9227: checking for acl_get_file in -lacl" >&5
+ac_lib_var=`echo acl'_'acl_get_file | sed 'y%./+-%__p_%'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  ac_cv_sys_largefile_source=no
-      cat > conftest.$ac_ext <<EOF
-#line 7817 "configure"
-#include "confdefs.h"
-#include <stdio.h>
-int main() {
-return !fseeko;
-; return 0; }
-EOF
-if { (eval echo configure:7824: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  :
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  cat > conftest.$ac_ext <<EOF
-#line 7831 "configure"
+  ac_save_LIBS="$LIBS"
+LIBS="-lacl  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 9235 "configure"
 #include "confdefs.h"
-#define _LARGEFILE_SOURCE 1
-#include <stdio.h>
-	   
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char acl_get_file();
+
 int main() {
-return !fseeko;
+acl_get_file()
 ; return 0; }
 EOF
-if { (eval echo configure:7840: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9246: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_sys_largefile_source=1
+  eval "ac_cv_lib_$ac_lib_var=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
 fi
 rm -f conftest*
+LIBS="$ac_save_LIBS"
+
 fi
-rm -f conftest*
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  lib_acl="-lacl"
+else
+  echo "$ac_t""no" 1>&6
 fi
 
-echo "$ac_t""$ac_cv_sys_largefile_source" 1>&6
-   if test "$ac_cv_sys_largefile_source" != no; then
-     cat >> confdefs.h <<EOF
-#define _LARGEFILE_SOURCE $ac_cv_sys_largefile_source
-EOF
-
-   fi
-   # We used to try defining _XOPEN_SOURCE=500 too, to work around a bug
-   # in glibc 2.1.3, but that breaks too many other things.
-   # If you want fseeko and ftello with glibc, upgrade to a fixed glibc.
-
-   echo $ac_n "checking for fseeko""... $ac_c" 1>&6
-echo "configure:7864: checking for fseeko" >&5
-if eval "test \"`echo '$''{'ac_cv_func_fseeko'+set}'`\" = set"; then
+  echo $ac_n "checking for acl_get_file in -lpacl""... $ac_c" 1>&6
+echo "configure:9267: checking for acl_get_file in -lpacl" >&5
+ac_lib_var=`echo pacl'_'acl_get_file | sed 'y%./+-%__p_%'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  ac_cv_func_fseeko=no
-      cat > conftest.$ac_ext <<EOF
-#line 7870 "configure"
+  ac_save_LIBS="$LIBS"
+LIBS="-lpacl  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 9275 "configure"
 #include "confdefs.h"
-#include <stdio.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char acl_get_file();
+
 int main() {
-return fseeko && fseeko (stdin, 0, 0);
+acl_get_file()
 ; return 0; }
 EOF
-if { (eval echo configure:7877: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:9286: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_func_fseeko=yes
+  eval "ac_cv_lib_$ac_lib_var=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
 fi
 rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  lib_acl="-lpacl"
+else
+  echo "$ac_t""no" 1>&6
 fi
 
-echo "$ac_t""$ac_cv_func_fseeko" 1>&6
-   if test $ac_cv_func_fseeko != no; then
-     cat >> confdefs.h <<\EOF
-#define HAVE_FSEEKO 1
-EOF
 
-   fi
-echo $ac_n "checking if system supports Large Files at all""... $ac_c" 1>&6
-echo "configure:7895: checking if system supports Large Files at all" >&5
-if eval "test \"`echo '$''{'ac_cv_largefiles'+set}'`\" = set"; then
+  ac_save_LIBS="$LIBS"
+  LIBS="$LIBS $lib_acl"
+  for ac_func in acl_get_file acl_set_file acl_from_text acl_to_text acl_free acl_delete_def_file
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:9312: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7900 "configure"
+#line 9317 "configure"
 #include "confdefs.h"
-#include <stdio.h>
-#include <sys/types.h>
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
+
 int main() {
 
-/*
- * Check that off_t can represent 2**63 - 1 correctly.
- * We can't simply "#define LARGE_OFF_T 9223372036854775807",
- * since some C++ compilers masquerading as C compilers
- * incorrectly reject 9223372036854775807.
- */
-#   define LARGE_OFF_T (((off_t) 1 << 62) - 1 + ((off_t) 1 << 62))
-    int off_t_is_large[(LARGE_OFF_T % 2147483629 == 721
-			&& LARGE_OFF_T % 2147483647 == 1)
-		       ? 1 : -1];
-return !ftello;
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
 ; return 0; }
 EOF
-if { (eval echo configure:7919: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9340: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  ac_cv_largefiles=yes
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_largefiles=no
+  eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
 fi
 
-echo "$ac_t""$ac_cv_largefiles" 1>&6
-	if test $ac_cv_largefiles = yes; then
-		cat >> confdefs.h <<\EOF
-#define HAVE_LARGEFILES 1
-EOF
-
-	fi
-
-cat >> confdefs.h <<EOF
-#define HOST_ALIAS "$host_alias"
-EOF
-
-cat >> confdefs.h <<EOF
-#define HOST_SUB "$host"
-EOF
-
-cat >> confdefs.h <<EOF
-#define HOST_CPU "$host_cpu"
-EOF
-
-cat >> confdefs.h <<EOF
-#define HOST_VENDOR "$host_vendor"
-EOF
-
-cat >> confdefs.h <<EOF
-#define HOST_OS "$host_os"
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
 EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
 
+  LIBS="$ac_save_LIBS"
 
-
-echo $ac_n "checking for crypt in -lc""... $ac_c" 1>&6
-echo "configure:7962: checking for crypt in -lc" >&5
-ac_lib_var=`echo c'_'crypt | sed 'y%./+-%__p_%'`
+  echo "checking for Solaris Access Control List support" 1>&6
+echo "configure:9367: checking for Solaris Access Control List support" >&5
+  echo $ac_n "checking for acltotext in -lsec""... $ac_c" 1>&6
+echo "configure:9369: checking for acltotext in -lsec" >&5
+ac_lib_var=`echo sec'_'acltotext | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lc  $LIBS"
+LIBS="-lsec  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7970 "configure"
+#line 9377 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char crypt();
+char acltotext();
 
 int main() {
-crypt()
+acltotext()
 ; return 0; }
 EOF
-if { (eval echo configure:7981: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:9388: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7992,59 +9399,136 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  lib_crypt=""
+  lib_acl="-lsec"
 else
   echo "$ac_t""no" 1>&6
-echo $ac_n "checking for crypt in -lcrypt""... $ac_c" 1>&6
-echo "configure:8000: checking for crypt in -lcrypt" >&5
-ac_lib_var=`echo crypt'_'crypt | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+fi
+
+  ac_save_LIBS="$LIBS"
+  LIBS="$LIBS $lib_acl"
+  for ac_func in acl facl aclfromtext acltotext
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:9413: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-  ac_save_LIBS="$LIBS"
-LIBS="-lcrypt  $LIBS"
-cat > conftest.$ac_ext <<EOF
-#line 8008 "configure"
+  cat > conftest.$ac_ext <<EOF
+#line 9418 "configure"
 #include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char crypt();
+char $ac_func();
 
 int main() {
-crypt()
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
 ; return 0; }
 EOF
-if { (eval echo configure:8019: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:9441: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=yes"
+  eval "ac_cv_func_$ac_func=yes"
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=no"
+  eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
-LIBS="$ac_save_LIBS"
-
 fi
-if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  lib_crypt="-lcrypt"
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
+EOF
+ 
 else
   echo "$ac_t""no" 1>&6
 fi
+done
+
+  LIBS="$ac_save_LIBS"
+
+  echo "checking for HP-UX Access Control List support" 1>&6
+echo "configure:9468: checking for HP-UX Access Control List support" >&5
+  for ac_func in getacl fgetacl setacl fsetacl strtoacl acltostr cpacl fcpacl chownacl setaclentry fsetaclentry
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:9472: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 9477 "configure"
+#include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
+
+int main() {
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
+; return 0; }
+EOF
+if { (eval echo configure:9500: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
+fi
+rm -f conftest*
+fi
 
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
+EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
+done
 
 
-if test $ac_cv_header_camlib_h = yes; then
-  scsi_lib=-lcam
 fi
 
 
 
 
+
+
+
 trap '' 1 2 15
 cat > confcache <<\EOF
 # This file is a shell script that caches the results of configure
@@ -8187,8 +9671,11 @@
 s%@RANLIB@%$RANLIB%g
 s%@SET_MAKE@%$SET_MAKE%g
 s%@LIBOBJS@%$LIBOBJS%g
+s%@ALLOCA@%$ALLOCA%g
+s%@largefile_cc_opt@%$largefile_cc_opt%g
 s%@lib_crypt@%$lib_crypt%g
 s%@scsi_lib@%$scsi_lib%g
+s%@lib_acl@%$lib_acl%g
 
 CEOF
 EOF
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/configure.in cdrdao-1.1.5/scsilib/conf/configure.in
--- cdrdao-1.1.5.orig/scsilib/conf/configure.in	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/configure.in	2002-04-21 08:22:05.000000000 -0400
@@ -1,4 +1,4 @@
-dnl @(#)configure.in	1.28 01/02/23 Copyright 1998 J. Schilling
+dnl @(#)configure.in	1.48 02/04/21 Copyright 1998 J. Schilling
 dnl Process this file with autoconf to produce a configure script.
 AC_REVISION($Revision$)dnl
 
@@ -22,24 +22,36 @@
 AC_HEADER_STAT
 AC_HEADER_TIME
 AC_HEADER_SYS_WAIT
+dnl check whether select() needs sys/select.h
 AC_HEADER_SYS_SELECT
+dnl check whether select() needs sys/socket.h (BeOS)
+AC_HEADER_SELECT2
 AC_CHECK_HEADERS(varargs.h stdarg.h stdlib.h string.h strings.h unistd.h fcntl.h sys/file.h)
 AC_CHECK_HEADERS(getopt.h)
 AC_CHECK_HEADERS(limits.h)
 AC_CHECK_HEADERS(a.out.h aouthdr.h elf.h)
 AC_CHECK_HEADERS(malloc.h termios.h termio.h)
+AC_CHECK_HEADERS(pwd.h grp.h sys/acl.h acllib.h)
 AC_CHECK_HEADERS(shadow.h syslog.h)
 AC_CHECK_HEADERS(sys/time.h sys/times.h utime.h sys/utime.h sys/ioctl.h sys/filio.h sys/param.h sys/systeminfo.h)
+AC_CHECK_HEADERS(sys/syscall.h)
 AC_CHECK_HEADERS(mntent.h sys/mntent.h sys/mnttab.h sys/mount.h)
 AC_CHECK_HEADERS(wait.h sys/resource.h sys/procfs.h)
 AC_CHECK_HEADERS(sys/utsname.h sys/priocntl.h sys/rtpriocntl.h)
 AC_CHECK_HEADERS(sys/mtio.h sys/mman.h linux/pg.h camlib.h)
 AC_CHECK_HEADERS(sys/shm.h sys/ipc.h)
 AC_CHECK_HEADERS(sys/dkio.h sys/dklabel.h sun/dkio.h sun/dklabel.h)
+AC_CHECK_HEADERS(sys/types.h sys/stat.h types.h stat.h)
 AC_CHECK_HEADERS(poll.h sys/poll.h sys/select.h)
+AC_CHECK_HEADERS(netdb.h sys/socket.h)
 AC_CHECK_HEADERS(ieeefp.h fp.h)
 AC_CHECK_HEADERS(values.h float.h)
+AC_CHECK_HEADERS(arpa/inet.h)
 AC_CHECK_HEADERS(bsd/dev/scsireg.h)
+dnl Check for HP-UX sys/bsdtty.h (needed for TIOCGPGRP)
+AC_CHECK_HEADERS(sys/bsdtty.h)
+dnl Check for BeOS kernel definitions (e.g. B_PAGE_SIZE)
+AC_CHECK_HEADERS(OS.h)
 
 dnl from aclocal.m4 (uses AC_TRY_COMPILE)
 AC_HEADER_MAKEDEV
@@ -63,9 +75,11 @@
 AC_TYPE_LONGLONG
 AC_TYPE_PROTOTYPES
 AC_USER_MALLOC
+AC_DYN_ARRAYS
 
 AC_TYPE_UID_T
 AC_TYPE_SIZE_T
+AC_CHECK_TYPE(ssize_t, int)
 AC_TYPE_PID_T
 AC_TYPE_OFF_T
 AC_TYPE_MODE_T
@@ -73,6 +87,8 @@
 AC_CHECK_TYPE(caddr_t, char *)
 AC_CHECK_TYPE(daddr_t, long)
 AC_CHECK_TYPE(dev_t, unsigned short)
+AC_CHECK_TYPE(ino_t, unsigned long)
+AC_CHECK_TYPE(nlink_t, unsigned long)
 AC_TYPE_SOCKLEN_T
 
 dnl These types are present on all UNIX systems but should be avoided
@@ -117,6 +133,7 @@
 AC_STRUCT_ST_BLKSIZE
 AC_STRUCT_ST_BLOCKS
 AC_STRUCT_ST_RDEV
+AC_STRUCT_ST_FLAGS
 
 dnl Checks for library functions.
 AC_FUNC_WAIT3
@@ -131,6 +148,7 @@
 jsAC_FUNC_MMAP
 AC_MMAP_SIZEP
 AC_FUNC_SMMAP
+AC_FUNC_ALLOCA
 AC_FUNC_QUOTAIOCTL
 AC_FUNC_FCNTL_LOCKF
 AC_FUNC_UNAME
@@ -147,8 +165,10 @@
 AC_CHECK_FUNCS(getpgrp setpgrp)
 dnl			getspwnam() on HP-UX is in libsec.a
 AC_CHECK_FUNCS(getspnam getspwnam)
-AC_CHECK_FUNCS(sync fsync fork wait4 waitid waitpid getrusage)
-AC_CHECK_FUNCS(gethostid gethostname getdomainname getpagesize)
+AC_CHECK_FUNCS(sync fsync fork wait4 waitid waitpid getrusage getrlimit setrlimit ulimit)
+AC_CHECK_FUNCS(execl execle execv execve execvp)
+AC_CHECK_FUNCS(gethostid gethostname getdomainname getpagesize getdtablesize)
+AC_CHECK_FUNCS(gettimeofday settimeofday time stime)
 AC_CHECK_FUNCS(poll select lchown times utimes)
 dnl AC_CHECK_FUNCS(ecvt fcvt gcvt)
 AC_CHECK_FUNCS(ecvt_r fcvt_r gcvt_r)
@@ -159,16 +179,41 @@
 AC_CHECK_FUNCS(DosAllocSharedMem)
 AC_CHECK_FUNCS(seekdir)
 AC_CHECK_FUNCS(strsignal str2sig sig2str)
-AC_CHECK_FUNCS(killpg sigrelse sigprocmask sigsetmask)
+AC_CHECK_FUNCS(killpg sigrelse sigprocmask sigsetmask sigset)
 AC_CHECK_FUNCS(nanosleep usleep)
-AC_CHECK_FUNCS(putenv setenv snprintf strcasecmp)
+AC_CHECK_FUNCS(putenv setenv snprintf strcasecmp strdup)
 AC_CHECK_FUNCS(valloc)
+AC_CHECK_FUNCS(madvise mlock)
+AC_CHECK_FUNCS(chflags fchflags fflagstostr strtofflags)
+
+dnl Need to check this in default compilation mode to find out
+dnl whether this platform supports both functions by default too.
+dnl We cannot use the standard tests because they would find
+dnl that fseeko()/ftello() are present in small file mode on
+dnl Limnux while there is no prototype for these functions.
+AC_SMALL_FSEEKO
+AC_SMALL_FTELLO
+
+dnl ??? AC_CHECK_LIB(socket, socket, lib_socket="-lsocket")
+dnl
+AC_CHECK_LIB(socket, rcmd, lib_socket="-lsocket")
+ac_save_LIBS="$LIBS"
+LIBS="$LIBS $lib_socket"
+AC_CHECK_FUNCS(rcmd)
+AC_CHECK_LIB(nsl, inet_ntoa, lib_nsl="-lnsl")
+LIBS="$LIBS $lib_nsl"
+AC_CHECK_FUNCS(inet_ntoa)
+LIBS="$ac_save_LIBS"
 
 dnl Check for largefile support
 dnl Do this last to make sure that no large file definition
 dnl in confdefs.h will modify our results
 AC_SYS_LARGEFILE
-AC_FUNC_FSEEKO
+dnl Warning do not run this test. it interferes with the test
+dnl AC_CHECK_FUNCS(fseeko ftello) from above.
+dnl The test AC_HAVE_LARGEFILES will check whether ftello/fseeko
+dnl are available in Large File mode
+dnl AC_FUNC_FSEEKO
 AC_HAVE_LARGEFILES
 
 AC_DEFINE_UNQUOTED_STRING(HOST_ALIAS,$host_alias)
@@ -186,7 +231,33 @@
   scsi_lib=-lcam
 fi
 
+if test "$ac_cv_header_sys_acl_h" = yes; then
+
+  AC_CHECKING(for Posix Access Control List support)
+  AC_CHECK_LIB(acl, acl_get_file, lib_acl="-lacl")
+  AC_CHECK_LIB(pacl, acl_get_file, lib_acl="-lpacl")
+
+  ac_save_LIBS="$LIBS"
+  LIBS="$LIBS $lib_acl"
+  AC_CHECK_FUNCS(acl_get_file acl_set_file acl_from_text acl_to_text acl_free acl_delete_def_file)
+  LIBS="$ac_save_LIBS"
+
+  AC_CHECKING(for Solaris Access Control List support)
+  AC_CHECK_LIB(sec, acltotext, lib_acl="-lsec")
+  ac_save_LIBS="$LIBS"
+  LIBS="$LIBS $lib_acl"
+  AC_CHECK_FUNCS(acl facl aclfromtext acltotext)
+  LIBS="$ac_save_LIBS"
+
+  AC_CHECKING(for HP-UX Access Control List support)
+  AC_CHECK_FUNCS(getacl fgetacl setacl fsetacl strtoacl acltostr cpacl fcpacl chownacl setaclentry fsetaclentry)
+
+fi
+
+AC_SUBST(largefile_cc_opt)
+
 AC_SUBST(lib_crypt)
 AC_SUBST(scsi_lib)
+AC_SUBST(lib_acl)
 
 AC_OUTPUT(rules.cnf)
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/makeinc cdrdao-1.1.5/scsilib/conf/makeinc
--- cdrdao-1.1.5.orig/scsilib/conf/makeinc	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/makeinc	2000-11-19 12:47:39.000000000 -0500
@@ -17,7 +17,19 @@
 #	./RULES/sun4c-sunos-gcc.rul
 #
 ###########################################################################
-#@@C@@
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
 ###########################################################################
 MAILADDR=schilling@fokus.gmd.de
 
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/mkdep-sco.sh cdrdao-1.1.5/scsilib/conf/mkdep-sco.sh
--- cdrdao-1.1.5.orig/scsilib/conf/mkdep-sco.sh	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/mkdep-sco.sh	2001-11-08 11:14:35.000000000 -0500
@@ -1,5 +1,5 @@
 #!/bin/sh
-#ident "%W% %E% %Q%"
+#ident "@(#)mkdep-sco.sh	1.2 01/09/05 "
 ###########################################################################
 # Copyright 1999 by J. Schilling
 ###########################################################################
@@ -44,4 +44,4 @@
 
 OFILES=`echo "$FILES" | sed 's;\(.*\).c;\1.o;'`
 
-cc -H -E 2>&1 > /dev/null "$@" | grep -hv '^"' | sed -e "s;^;$OFILES: ;"
+cc -H -E 2>&1 > /dev/null "$@" | grep -hv '^"' | grep -hv '^UX:' | sed -e "s;^;$OFILES: ;"
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/rules.cnf.in cdrdao-1.1.5/scsilib/conf/rules.cnf.in
--- cdrdao-1.1.5.orig/scsilib/conf/rules.cnf.in	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/rules.cnf.in	2001-12-09 10:38:26.000000000 -0500
@@ -1,5 +1,9 @@
-# @(#)rules.cnf.in	1.2 01/03/04 Copyright 1998 J. Schilling
+# @(#)rules.cnf.in	1.4 01/12/09 Copyright 1998 J. Schilling
 
 EXEEXT= @EXEEXT@
+
+LARGEFILE_CC_OPT= @largefile_cc_opt@
+
 SCSILIB= @scsi_lib@
 LIB_CRYPT= @lib_crypt@
+LIB_ACL= @lib_acl@
diff -ruN cdrdao-1.1.5.orig/scsilib/conf/xconfig.h.in cdrdao-1.1.5/scsilib/conf/xconfig.h.in
--- cdrdao-1.1.5.orig/scsilib/conf/xconfig.h.in	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/conf/xconfig.h.in	2002-04-21 08:22:06.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)xconfig.h.in	1.30 01/04/12 Copyright 1998 J. Schilling */
+/* @(#)xconfig.h.in	1.50 02/04/21 Copyright 1998 J. Schilling */
 /*
  *	Dynamic autoconf C-include code.
  *
@@ -28,9 +28,14 @@
 #undef HAVE_SYS_DIR_H	/* to use BSD sys/dir.h */
 #undef HAVE_NDIR_H	/* to use ndir.h */
 #undef HAVE_SYS_NDIR_H	/* to use sys/ndir.h */
+#undef HAVE_ALLOCA_H	/* if alloca.h exists */
 #undef HAVE_MALLOC_H	/* if malloc.h exists */
 #undef HAVE_TERMIOS_H	/* to use POSIX termios.h */
 #undef HAVE_TERMIO_H	/* to use SVR4 termio.h */
+#undef HAVE_PWD_H	/* if pwd.h exists */
+#undef HAVE_GRP_H	/* if grp.h exists */
+#undef HAVE_SYS_ACL_H	/* to use <sys/acl.h> for ACL definitions */
+#undef HAVE_ACLLIB_H	/* if HP-UX <acllib.h> is present */
 #undef HAVE_SHADOW_H	/* if shadow.h exists */
 #undef HAVE_SYSLOG_H	/* if syslog.h exists */
 #undef HAVE_SYS_TIME_H	/* may include sys/time.h for struct timeval */
@@ -55,6 +60,7 @@
 #undef HAVE_SYS_UTSNAME_H	/* to use uname() */
 #undef HAVE_SYS_PRIOCNTL_H	/* to use SVr4 priocntl() instead of nice()/setpriority() */
 #undef HAVE_SYS_RTPRIOCNTL_H	/* if the system supports SVr4 real time classes */
+#undef HAVE_SYS_SYSCALL_H	/* to use syscall() */
 #undef HAVE_SYS_MTIO_H		/* to use mtio definitions from sys/mtio.h */
 #undef HAVE_SYS_MMAN_H		/* to use definitions for mmap()/madvise()... from sys/mman.h */
 #undef HAVE_SYS_SHM_H		/* to use definitions for shmget() ... from sys/shm.h */
@@ -65,10 +71,17 @@
 #undef HAVE_SYS_DKLABEL_H	/* if we may include sys/dklabel.h for disk label */
 #undef HAVE_SUN_DKIO_H		/* if we may include sun/dkio.h for disk ioctls */
 #undef HAVE_SUN_DKLABEL_H	/* if we may include sun/dklabel.h for disk label */
+#undef HAVE_SYS_TYPES_H		/* if we may include sys/types.h (the standard) */
+#undef HAVE_SYS_STAT_H		/* if we may include sys/stat.h (the standard) */
+#undef HAVE_TYPES_H		/* if we may include types.h (rare cases e.g. ATARI TOS) */
+#undef HAVE_STAT_H		/* if we may include stat.h (rare cases e.g. ATARI TOS) */
 #undef HAVE_POLL_H		/* if we may include poll.h to use poll() */
 #undef HAVE_SYS_POLL_H		/* if we may include sys/poll.h to use poll() */
 #undef HAVE_SYS_SELECT_H	/* if we may have sys/select.h nonstandard use for select() on some systems*/
 #undef NEED_SYS_SELECT_H	/* if we need sys/select.h to use select() (this is nonstandard) */
+#undef HAVE_NETDB_H		/* if we have netdb.h for get*by*() and rcmd() */
+#undef HAVE_SYS_SOCKET_H	/* if we have sys/socket.h for socket() */
+#undef NEED_SYS_SOCKET_H	/* if we need sys/socket.h to use select() (this is nonstandard) */
 #undef HAVE_LINUX_PG_H		/* if we may include linux/pg.h for PP ATAPI sypport */
 #undef HAVE_CAMLIB_H		/* if we may include camlib.h for CAM SCSI transport definitions */
 #undef HAVE_IEEEFP_H		/* if we may include ieeefp.h for finite()/isnand() */
@@ -80,7 +93,11 @@
 #undef HAVE_USG_STDIO		/* if we have USG derived STDIO */
 #undef HAVE_ERRNO_DEF		/* if we have errno definition in <errno.h> */
 #undef HAVE_VFORK_H		/* if we should include vfork.h for vfork() definitions */
+#undef HAVE_ARPA_INET_H		/* if we have arpa/inet.h (missing on BeOS) */
+				/* BeOS has inet_ntoa() in <netdb.h> */
 #undef HAVE_BSD_DEV_SCSIREG_H	/* if we have a NeXT Step compatible sg driver */
+#undef HAVE_SYS_BSDTTY_H	/* if we have sys/bsdtty.h on HP-UX for TIOCGPGRP */
+#undef HAVE_OS_H		/* if we have the BeOS kernel definitions in OS.h */
 
 /*
  * Convert to SCHILY name
@@ -108,6 +125,8 @@
  */
 #undef HAVE_STRERROR		/* strerror() is present in libc */
 #undef HAVE_MEMMOVE		/* memmove() is present in libc */
+#undef HAVE_MADVISE		/* madvise() is present in libc */
+#undef HAVE_MLOCK		/* mlock() is present in libc */
 #undef HAVE_MLOCKALL		/* working mlockall() is present in libc */
 #undef HAVE_MMAP		/* working mmap() is present in libc */
 #undef _MMAP_WITH_SIZEP		/* mmap() needs address of size parameter */
@@ -144,7 +163,15 @@
 #undef HAVE_GETHOSTNAME		/* gethostname() is present in libc */
 #undef HAVE_GETDOMAINNAME	/* getdomainname() is present in libc */
 #undef HAVE_GETPAGESIZE		/* getpagesize() is present in libc */
+#undef HAVE_GETDTABLESIZE	/* getdtablesize() is present in libc */
 #undef HAVE_GETRUSAGE		/* getrusage() is present in libc */
+#undef HAVE_GETRLIMIT		/* getrlimit() is present in libc */
+#undef HAVE_SETRLIMIT		/* setrlimit() is present in libc */
+#undef HAVE_ULIMIT		/* ulimit() is present in libc */
+#undef HAVE_GETTIMEOFDAY	/* gettimeofday() is present in libc */
+#undef HAVE_SETTIMEOFDAY	/* settimeofday() is present in libc */
+#undef HAVE_TIME		/* time() is present in libc */
+#undef HAVE_STIME		/* stime() is present in libc */
 #undef HAVE_POLL		/* poll() is present in libc */
 #undef HAVE_SELECT		/* select() is present in libc */
 #undef HAVE_LCHOWN		/* lchown() is present in libc */
@@ -187,6 +214,7 @@
 #undef HAVE_UNAME		/* uname() is present in libc */
 #undef HAVE_SNPRINTF		/* snprintf() is present in libc */
 #undef HAVE_STRCASECMP		/* strcasecmp() is present in libc */
+#undef HAVE_STRDUP		/* strdup() is present in libc */
 #undef HAVE_STRSIGNAL		/* strsignal() is present in libc */
 #undef HAVE_STR2SIG		/* str2sig() is present in libc */
 #undef HAVE_SIG2STR		/* sig2str() is present in libc */
@@ -194,13 +222,41 @@
 #undef HAVE_SIGRELSE		/* sigrelse() is present in libc */
 #undef HAVE_SIGPROCMASK		/* sigprocmask() is present in libc (POSIX) */
 #undef HAVE_SIGSETMASK		/* sigsetmask() is present in libc (BSD) */
+#undef HAVE_SIGSET		/* sigset() is present in libc (POSIX) */
 #undef HAVE_SYS_SIGLIST		/* char *sys_siglist[] is present in libc */
 #undef HAVE_NANOSLEEP		/* nanosleep() is present in libc */
 #undef HAVE_USLEEP		/* usleep() is present in libc */
 #undef HAVE_FORK		/* fork() is present in libc */
+#undef HAVE_EXECL		/* execl() is present in libc */
+#undef HAVE_EXECLE		/* execle() is present in libc */
+#undef HAVE_EXECV		/* execv() is present in libc */
+#undef HAVE_EXECVE		/* execve() is present in libc */
+#undef HAVE_EXECVP		/* execvp() is present in libc */
+#undef HAVE_ALLOCA		/* alloca() is present (else use malloc())*/
 #undef HAVE_VALLOC		/* valloc() is present in libc (else use malloc())*/
 #undef vfork
 
+#undef HAVE_CHFLAGS		/* chflags() is present in libc */
+#undef HAVE_FCHFLAGS		/* fchflags() is present in libc */
+#undef HAVE_FFLAGSTOSTR		/* fflagstostr() is present in libc */
+#undef HAVE_STRTOFFLAGS		/* strtofflags() is present in libc */
+
+/*
+ * Important:	This must be a result from a check _before_ the Large File test
+ *		has been run. It then tells us whether these functions are
+ *		available even when not in Large File mode.
+ *
+ *	Do not run the AC_FUNC_FSEEKO test from the GNU tar Large File test
+ *	siute. It will use the same cache names and interfere with our test.
+ *	Instead use the tests AC_SMALL_FSEEKO/AC_SMALL/STELLO and make sure
+ *	they are placed before the large file tests.
+ */
+#undef HAVE_FSEEKO		/* fseeko() is present in default compile mode */
+#undef HAVE_FTELLO		/* ftello() is present in default compile mode */
+
+#undef HAVE_RCMD		/* rcmd() is present in libc/libsocket */
+#undef HAVE_INET_NTOA		/* inet_ntoa() is present in libc/libsocket */
+
 #if	defined(HAVE_QUOTACTL) || defined(HAVE_QUOTAIOCTL)
 #	define HAVE_QUOTA	/* The system inludes quota */
 #endif
@@ -243,6 +299,7 @@
 #undef HAVE_ST_BLKSIZE		/* if struct stat contains st_blksize */
 #undef HAVE_ST_BLOCKS		/* if struct stat contains st_blocks */
 #undef HAVE_ST_RDEV		/* if struct stat contains st_rdev */
+#undef HAVE_ST_FLAGS		/* if struct stat contains st_flags */
 #undef STAT_MACROS_BROKEN	/* if the macros S_ISDIR, S_ISREG .. don't work */
 
 #undef DEV_MINOR_BITS		/* # if bits needed to hold minor device number */
@@ -278,7 +335,9 @@
 
 #undef const			/* Define to empty if const doesn't work */
 #undef uid_t			/* To be used if uid_t is not present  */
+#undef gid_t			/* To be used if gid_t is not present  */
 #undef size_t			/* To be used if size_t is not present */
+#undef ssize_t			/* To be used if ssize_t is not present */
 #undef pid_t			/* To be used if pid_t is not present  */
 #undef off_t			/* To be used if off_t is not present  */
 #undef mode_t			/* To be used if mode_t is not present */
@@ -286,6 +345,8 @@
 #undef caddr_t			/* To be used if caddr_t is not present */
 #undef daddr_t			/* To be used if daddr_t is not present */
 #undef dev_t			/* To be used if dev_t is not present */
+#undef ino_t			/* To be used if ino_t is not present */
+#undef nlink_t			/* To be used if nlink_t is not present */
 #undef socklen_t		/* To be used if socklen_t is not present */
 
 /*
@@ -335,10 +396,75 @@
 #endif	/* HAVE_LARGEFILES */
 #endif	/* USE_LARGEFILES */
 
+#ifdef USE_ACL			/* Enable/disable ACL support */
+/*
+ * POSIX ACL support
+ */
+#undef HAVE_ACL_GET_FILE	/* acl_get_file() function */
+#undef HAVE_ACL_SET_FILE	/* acl_set_file() function */
+#undef HAVE_ACL_FROM_TEXT	/* acl_from_text() function */
+#undef HAVE_ACL_TO_TEXT		/* acl_to_text() function */
+#undef HAVE_ACL_FREE		/* acl_free() function */
+#undef HAVE_ACL_DELETE_DEF_FILE	/* acl_delete_def_file() function */
+
+#if defined(HAVE_ACL_GET_FILE) && defined(HAVE_ACL_SET_FILE) && \
+    defined(HAVE_ACL_FROM_TEXT) && defined(HAVE_ACL_TO_TEXT) && \
+    defined(HAVE_ACL_FREE)
+#	define	HAVE_POSIX_ACL	1 /* POSIX ACL's present */
+#endif
+
+/*
+ * Sun ACL support.
+ * Note: unfortunately, HP-UX has an (undocumented) acl() function in libc.
+ */
+#undef HAVE_ACL			/* acl() function */
+#undef HAVE_FACL		/* facl() function */
+#undef HAVE_ACLFROMTEXT		/* aclfromtext() function */
+#undef HAVE_ACLTOTEXT		/* acltotext() function */
+
+#if defined(HAVE_ACL) && defined(HAVE_FACL) && \
+    defined(HAVE_ACLFROMTEXT) && defined(HAVE_ACLTOTEXT)
+#	define	HAVE_SUN_ACL	1 /* Sun ACL's present */
+#endif
+
+/*
+ * HP-UX ACL support.
+ * Note: unfortunately, HP-UX has an (undocumented) acl() function in libc.
+ */
+#undef HAVE_GETACL		/* getacl() function */
+#undef HAVE_FGETACL		/* fgetacl() function */
+#undef HAVE_SETACL		/* setacl() function */
+#undef HAVE_FSETACL		/* fsetacl() function */
+#undef HAVE_STRTOACL		/* strtoacl() function */
+#undef HAVE_ACLTOSTR		/* acltostr() function */
+#undef HAVE_CPACL		/* cpacl() function */
+#undef HAVE_FCPACL		/* fcpacl() function */
+#undef HAVE_CHOWNACL		/* chownacl() function */
+#undef HAVE_SETACLENTRY		/* setaclentry() function */
+#undef HAVE_FSETACLENTRY	/* fsetaclentry() function */
+
+#if defined(HAVE_GETACL) && defined(HAVE_FGETACL) && \
+    defined(HAVE_SETACL) && defined(HAVE_FSETACL) && \
+    defined(HAVE_STRTOACL) && defined(HAVE_ACLTOTEXT)
+#	define	HAVE_HP_ACL	1 /* HP-UX ACL's present */
+#endif
+
+/*
+ * Global definition whether ACL support is present.
+ * As HP-UX differs too much from other implementations, HAVE_HP_ACL is not
+ * included in HAVE_ANY_ACL.
+ */
+#if defined(HAVE_POSIX_ACL) || defined(HAVE_SUN_ACL)
+#	define	HAVE_ANY_ACL	1 /* Any ACL implementation present */
+#endif
+
+#endif	/* USE_ACL */
+
 /*
  * Misc CC / LD related stuff
  */
 #undef NO_USER_MALLOC		/* If we cannot define our own malloc()	*/
+#undef HAVE_DYN_ARRAYS		/* If the compiler allows dynamic sized arrays */
 
 /*
  * Strings that help to maintain OS/platform id's in C-programs
@@ -348,3 +474,21 @@
 #undef HOST_CPU			/* CPU part from HOST_SUB		*/
 #undef HOST_VENDOR		/* VENDOR part from HOST_SUB		*/
 #undef HOST_OS			/* CPU part from HOST_SUB		*/
+
+
+/*
+ * Begin restricted code for quality assurance.
+ *
+ * Warning: you are not allowed to include the #define below if you are not
+ * using the Schily makefile system or if you modified the autoconfiguration
+ * tests.
+ *
+ * If you only added other tests you are allowed to keep this #define.
+ *
+ * This restiction is introduced because this way, I hope that people
+ * contribute to the project instead of creating branches.
+ */
+#define	IS_SCHILY_XCONFIG
+/*
+ * End restricted code for quality assurance.
+ */
diff -ruN cdrdao-1.1.5.orig/scsilib/export/Makefile cdrdao-1.1.5/scsilib/export/Makefile
--- cdrdao-1.1.5.orig/scsilib/export/Makefile	2000-10-28 13:41:35.000000000 -0400
+++ cdrdao-1.1.5/scsilib/export/Makefile	1969-12-31 19:00:00.000000000 -0500
@@ -1,44 +0,0 @@
-#ident %W% %E% %Q%
-###########################################################################
-# Written 1999 by Andreas Mueller
-###########################################################################
-# Makefile for local dynamic configuration
-###########################################################################
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2, or (at your option)
-# any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; see the file COPYING.  If not, write to
-# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
-###########################################################################
-SRCROOT=	..
-RULESDIR=	RULES
-include		$(SRCROOT)/$(RULESDIR)/rules.top
-###########################################################################
-
-all: clobber
-	$(LN) -s $(SRCROOT)/include libschily
-	$(LN) -s $(SRCROOT)/libscg/scg scg
-	$(LN) -s $(SRCROOT)/incs/$(OARCH)/xconfig.h xconfig.h
-	$(LN) -s $(SRCROOT)/libs/$(OARCH)/libschily.a libschily.a
-	$(LN) -s $(SRCROOT)/libs/$(OARCH)/libscg.a libscg.a 
-	$(LN) -s $(SRCROOT)/libs/$(OARCH)/librscg.a librscg.a
-
-clobber:
-	$(RM_F) libschily scg xconfig.h libschily.a libscg.a librscg.a
-
-distclean: clobber
-
-OTHERTARGETS=	clean install ibins depend rmdep \
-		TAGS tags rmtarget relink
-
-$(OTHERTARGETS):
-	@echo "$@: nothing to make"
-
diff -ruN cdrdao-1.1.5.orig/scsilib/inc/align_test.c cdrdao-1.1.5/scsilib/inc/align_test.c
--- cdrdao-1.1.5.orig/scsilib/inc/align_test.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/inc/align_test.c	2001-10-29 12:47:30.000000000 -0500
@@ -1,7 +1,7 @@
-/* @(#)align_test.c	1.12 00/01/07 Copyright 1995 J. Schilling */
+/* @(#)align_test.c	1.14 01/10/29 Copyright 1995 J. Schilling */
 #ifndef	lint
 static	char sccsid[] =
-	"@(#)align_test.c	1.12 00/01/07 Copyright 1995 J. Schilling";
+	"@(#)align_test.c	1.14 01/10/29 Copyright 1995 J. Schilling";
 #endif
 /*
  *	Generate machine dependant align.h
@@ -180,7 +180,7 @@
 	buf_aligned = p;
 
 #ifdef	DEBUG
-	printf("buf: %lX %lX\n",
+	fprintf(stderr, "buf: 0x%lX 0x%lX\n",
 		(unsigned long)buf, (unsigned long)xalign(buf, 1024, 1023));
 #endif
 
@@ -333,7 +333,7 @@
 		}
 	}
 #ifdef	DEBUG
-	printf("i: %d tsize: %d\n", i, tsize);
+	fprintf(stderr, "i: %d tsize: %d\n", i, tsize);
 #endif
 	if (i == tsize)
 		return (i);
@@ -341,18 +341,18 @@
 	align = calign = i;
 	tcheck = speed_check(p, sfunc, i);
 #ifdef	DEBUG
-	printf("tcheck: %d\n", tcheck);
+	fprintf(stderr, "tcheck: %d\n", tcheck);
 #endif
 
 	for (i = calign*2; i <= tsize; i *= 2) {
 		t = speed_check(p, sfunc, i);
 #ifdef	DEBUG
-		printf("tcheck: %d t: %d i: %d\n", tcheck, t, i);
-		printf("tcheck - t: %d ... * 3: %d\n",  (tcheck - t), (tcheck - t) * 3);
+		fprintf(stderr, "tcheck: %d t: %d i: %d\n", tcheck, t, i);
+		fprintf(stderr, "tcheck - t: %d ... * 3: %d\n",  (tcheck - t), (tcheck - t) * 3);
 #endif
 		if (((tcheck - t) > 0) && ((tcheck - t) * 3) > tcheck) {
 #ifdef	DEBUG
-			printf("kleiner\n");
+			fprintf(stderr, "kleiner\n");
 #endif
 			align = i;
 			tcheck = t;
@@ -554,7 +554,7 @@
 		*pp = (char *)i;
 }
 
-#include <sys/times.h>
+#include <timedefs.h>
 LOCAL int
 speed_check(p, sfunc, n)
 	char	*p;
@@ -569,7 +569,7 @@
 	times(&tm2);
 
 #ifdef	DEBUG
-	printf("t1: %ld\n", (long) tm2.tms_utime-tm1.tms_utime);
+	fprintf(stderr, "t1: %ld\n", (long) tm2.tms_utime-tm1.tms_utime);
 #endif
 
 	return ((int) tm2.tms_utime-tm1.tms_utime);
diff -ruN cdrdao-1.1.5.orig/scsilib/include/btorder.h cdrdao-1.1.5/scsilib/include/btorder.h
--- cdrdao-1.1.5.orig/scsilib/include/btorder.h	2001-04-29 05:28:21.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/btorder.h	2001-12-09 18:54:27.000000000 -0500
@@ -1,6 +1,6 @@
-/* @(#)btorder.h	1.13 01/02/17 Copyright 1996 J. Schilling */
+/* @(#)btorder.h	1.15 01/12/09 Copyright 1996 J. Schilling */
 /*
- *	Definitions for Bitordering
+ *	Definitions for Bit and Byte ordering
  *
  *	Copyright (c) 1996 J. Schilling
  */
@@ -30,25 +30,56 @@
 #endif
 
 #ifndef _MCONFIG_H
-#include <mconfig.h>
+#include <mconfig.h>			/* load bit/byte-oder from xmconfig.h*/
 #endif
 
+/*
+ * Convert bit-order definitions from xconfig.h into our values
+ * and verify them.
+ */
 #if defined(HAVE_C_BITFIELDS)	&& \
-    defined(BITFIELDS_LTOH)		/* Use definition from xconfig.h */
+    defined(BITFIELDS_LTOH)
 #define	_BIT_FIELDS_LTOH
 #endif
 
 #if defined(HAVE_C_BITFIELDS)	&& \
-    defined(BITFIELDS_HTOL)		/* Use definition from xconfig.h */
+    defined(BITFIELDS_HTOL)
 #define	_BIT_FIELDS_HTOL
 #endif
 
 #if defined(HAVE_C_BITFIELDS)	&& \
-   !defined(BITFIELDS_HTOL)		/* Use definition from xconfig.h */
+   !defined(BITFIELDS_HTOL)
 #define	BITFIELDS_LTOH
 #define	_BIT_FIELDS_LTOH
 #endif
 
+#if	defined(_BIT_FIELDS_LTOH) && defined(_BIT_FIELDS_HTOL)
+/*
+ * #error will not work for all compilers (e.g. sunos4)
+ * The following line will abort compilation on all compilers
+ * if none of the above is defines. And that's  what we want.
+ */
+error  Only one of _BIT_FIELDS_LTOH or _BIT_FIELDS_HTOL may be defined
+#endif
+
+
+/*
+ * Convert byte-order definitions from xconfig.h into our values
+ * and verify them.
+ * Note that we cannot use the definitions _LITTLE_ENDIAN and _BIG_ENDIAN
+ * because they are used on IRIX-6.5 with different meaning.
+ */
+#if defined(HAVE_C_BIGENDIAN)	&& \
+   !defined(WORDS_BIGENDIAN)
+#define	WORDS_LITTLEENDIAN
+/*#define	_LITTLE_ENDIAN*/
+#endif
+
+#if defined(HAVE_C_BIGENDIAN)	&& \
+    defined(WORDS_BIGENDIAN)
+#undef	WORDS_LITTLEENDIAN
+/*#define	_BIG_ENDIAN*/
+#endif
 
 #if	defined(_BIT_FIELDS_LTOH) || defined(_BIT_FIELDS_HTOL)
 /*
@@ -59,7 +90,7 @@
  * Bitorder not yet known.
  */
 #	if defined(sun3) || defined(mc68000) || \
-           defined(sun4) || defined(__sparc) || defined(__sparc__) || defined(sparc) || \
+	   defined(sun4) || defined(__sparc) || defined(sparc) || \
 	   defined(__hppa) || defined(_ARCH_PPC) || defined(_IBMR2)
 #		define _BIT_FIELDS_HTOL
 #	endif
diff -ruN cdrdao-1.1.5.orig/scsilib/include/device.h cdrdao-1.1.5/scsilib/include/device.h
--- cdrdao-1.1.5.orig/scsilib/include/device.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/device.h	2001-10-27 09:29:04.000000000 -0400
@@ -1,9 +1,7 @@
-/* @(#)device.h	1.8 01/02/17 Copyright 1995 J. Schilling */
+/* @(#)device.h	1.10 01/10/27 Copyright 1995 J. Schilling */
 /*
  *	Generic header for users of major(), minor() and makedev()
  *
- *	NOTE: You need to include <sys/types.h> before <device.h>
- *
  *	Copyright (c) 1995 J. Schilling
  */
 /*
@@ -52,13 +50,19 @@
 #endif
 
 #ifdef MAJOR_IN_MKDEV
+#	ifndef	_INCL_SYS_MKDEV_H
 #	include <sys/mkdev.h>
+#	define	_INCL_SYS_MKDEV_H
+#	endif
 #	define _FOUND_MAJOR_
 #endif
 
 #ifndef _FOUND_MAJOR_
 #	ifdef MAJOR_IN_SYSMACROS
+#		ifndef	_INCL_SYS_SYSMACROS_H
 #		include <sys/sysmacros.h>
+#		define	_INCL_SYS_SYSMACROS_H
+#		endif
 #		define _FOUND_MAJOR_
 #	endif
 #endif
@@ -69,7 +73,10 @@
  */
 #ifndef _FOUND_MAJOR_
 #	if defined(hpux) || defined(__hpux__) || defined(__hpux)
+#		ifndef	_INCL_SYS_MKOD_H
 #		include <sys/mknod.h>
+#		define	_INCL_SYS_MKOD_H
+#		endif
 #		define _FOUND_MAJOR_
 #	endif
 #endif
diff -ruN cdrdao-1.1.5.orig/scsilib/include/dirdefs.h cdrdao-1.1.5/scsilib/include/dirdefs.h
--- cdrdao-1.1.5.orig/scsilib/include/dirdefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/dirdefs.h	2001-11-18 18:04:22.000000000 -0500
@@ -1,4 +1,4 @@
-/* @(#)dirdefs.h	1.11 01/02/17 Copyright 1987, 1998 J. Schilling */
+/* @(#)dirdefs.h	1.13 01/11/18 Copyright 1987, 1998 J. Schilling */
 /*
  *	Copyright (c) 1987, 1998 J. Schilling
  */
@@ -30,10 +30,17 @@
 #endif
 
 #ifdef JOS
+#	ifndef	_INCL_SYS_STYPES_H
 #	include <sys/stypes.h>
+#	define	_INCL_SYS_STYPES_H
+#	endif
+#	ifndef	_INCL_SYS_FILEDESC_H
 #	include <sys/filedesc.h>
+#	define	_INCL_SYS_FILEDESC_H
+#	endif
 #	define	NEED_READDIR
 #	define	DIRSIZE	30
+#	define	FOUND_DIRSIZE
 	typedef struct dirent {
 		char	name[DIRSIZE];
 		short	ino;
@@ -45,13 +52,28 @@
 #	include <sys/types.h>
 #	define	_INCL_SYS_TYPES_H
 #	endif
+#	ifndef	_INCL_SYS_STAT_H
 #	include <sys/stat.h>
+#	define	_INCL_SYS_STAT_H
+#	endif
+#	ifdef	HAVE_LIMITS_H
+#		ifndef	_INCL_LIMITS_H
+#		include	<limits.h>
+#		define	_INCL_LIMITS_H
+#		endif
+#	endif
 #	ifdef	HAVE_SYS_PARAM_H
+#		ifndef	_INCL_SYS_PARAM_H
 #		include	<sys/param.h>
+#		define	_INCL_SYS_PARAM_H
+#		endif
 #	endif
 
 #	ifdef	HAVE_DIRENT_H		/* This a POSIX compliant system */
+#		ifndef	_INCL_DIRENT_H
 #		include <dirent.h>
+#		define	_INCL_DIRENT_H
+#		endif
 #		define	DIR_NAMELEN(dirent)	strlen((dirent)->d_name)
 #		define	_FOUND_DIR_
 #	else				/* This is a Pre POSIX system	 */
@@ -60,17 +82,26 @@
 #	define	DIR_NAMELEN(dirent)	(dirent)->d_namlen
 
 #	if	defined(HAVE_SYS_DIR_H)
+#		ifndef	_INCL_SYS_DIR_H
 #		include <sys/dir.h>
+#		define	_INCL_SYS_DIR_H
+#		endif
 #		define	_FOUND_DIR_
 #	endif
 
 #	if	defined(HAVE_NDIR_H) && !defined(_FOUND_DIR_)
+#		ifndef	_INCL_NDIR_H
 #		include <ndir.h>
+#		define	_INCL_NDIR_H
+#		endif
 #		define	_FOUND_DIR_
 #	endif
 
 #	if	defined(HAVE_SYS_NDIR_H) && !defined(_FOUND_DIR_)
+#		ifndef	_INCL_SYS_NDIR_H
 #		include <sys/ndir.h>
+#		define	_INCL_SYS_NDIR_H
+#		endif
 #		define	_FOUND_DIR_
 #	endif
 #	endif	/* HAVE_DIRENT_H */
@@ -81,11 +112,16 @@
  */
 #	ifdef	MAXNAMELEN
 #		define	DIRSIZE		MAXNAMELEN	/* From sys/param.h  */
+#		define	FOUND_DIRSIZE
 #	else
 #	ifdef	MAXNAMLEN
 #		define	DIRSIZE		MAXNAMLEN	/* From dirent.h     */
+#		define	FOUND_DIRSIZE
 #	else
+#	ifdef	DIRSIZ
 #		define	DIRSIZE		DIRSIZ		/* From sys/dir.h    */
+#		define	FOUND_DIRSIZE
+#	endif
 #	endif
 #	endif
 #	else	/* !_FOUND_DIR_ */
@@ -98,6 +134,11 @@
 
 #ifdef	NEED_DIRENT
 
+#ifndef	FOUND_DIRSIZE
+#define	DIRSIZE		14	/* The old UNIX standard value */
+#define	FOUND_DIRSIZE
+#endif
+
 typedef struct dirent {
 	short	ino;
 	char	name[DIRSIZE];
diff -ruN cdrdao-1.1.5.orig/scsilib/include/fctldefs.h cdrdao-1.1.5/scsilib/include/fctldefs.h
--- cdrdao-1.1.5.orig/scsilib/include/fctldefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/fctldefs.h	2001-12-05 13:31:29.000000000 -0500
@@ -1,4 +1,4 @@
-/* @(#)fctldefs.h	1.8 00/12/17 Copyright 1996 J. Schilling */
+/* @(#)fctldefs.h	1.11 01/12/05 Copyright 1996 J. Schilling */
 /*
  *	Generic header for users of open(), creat() and chmod()
  *
@@ -27,23 +27,24 @@
 #include <mconfig.h>
 #endif
 
-#ifndef	_INCL_SYS_TYPES_H
-#include <sys/types.h>		/* Needed for sys/stat.h		*/
-#define	_INCL_SYS_TYPES_H
-#endif
-#ifndef	_INCL_SYS_STAT_H
-#include <sys/stat.h>		/* For 3rd arg of open() and chmod()	*/
-#define	_INCL_SYS_STAT_H
+#ifndef	_STATDEFS_H
+#include <statdefs.h>		/* For 3rd arg of open() and chmod()	*/
 #endif
 
 #ifdef	HAVE_SYS_FILE_H
 /*
  * Historical systems with flock() only need sys/file.h
  */
+#	ifndef	_INCL_SYS_FILE_H
 #	include <sys/file.h>
+#	define	_INCL_SYS_FILE_H
+#	endif
 #endif
 #ifdef	HAVE_FCNTL_H
+#	ifndef	_INCL_FCNTL_H
 #	include <fcntl.h>
+#	define	_INCL_FCNTL_H
+#endif
 #endif
 
 /*
@@ -65,6 +66,9 @@
 #ifndef	O_BINARY			/* Only present on DOS or similar */
 #	define	O_BINARY	0
 #endif
+#ifndef	O_NDELAY			/* This is undefined on BeOS :-( */
+#	define	O_NDELAY	0
+#endif
 
 #ifndef	O_ACCMODE
 #define	O_ACCMODE		(R_RDONLY|O_WRONLY|O_RDWR)
diff -ruN cdrdao-1.1.5.orig/scsilib/include/getcwd.h cdrdao-1.1.5/scsilib/include/getcwd.h
--- cdrdao-1.1.5.orig/scsilib/include/getcwd.h	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/include/getcwd.h	2001-07-15 09:11:21.000000000 -0400
@@ -0,0 +1,43 @@
+/* @(#)getcwd.h	1.3 01/07/15 Copyright 1998 J. Schilling */
+/*
+ *	Definitions for getcwd()
+ *
+ *	Copyright (c) 1998 J. Schilling
+ */
+/*
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; see the file COPYING.  If not, write to
+ * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+#ifndef	_GETCWD_H
+#define	_GETCWD_H
+
+#ifndef _MCONFIG_H
+#include <mconfig.h>
+#endif
+
+#ifdef JOS
+#	ifndef	_INCL_SYS_STYPES_H
+#	include <sys/stypes.h>
+#	define	_INCL_SYS_STYPES_H
+#	endif
+	extern char	*gwd();
+#	define		getcwd(b, len)	gwd(b)
+#else
+#	ifndef	HAVE_GETCWD
+#		define	getcwd(b, len)	getwd(b)
+#	endif
+#endif
+
+#endif	/* _GETCWD_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/intcvt.h cdrdao-1.1.5/scsilib/include/intcvt.h
--- cdrdao-1.1.5.orig/scsilib/include/intcvt.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/intcvt.h	2001-10-27 10:19:30.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)intcvt.h	1.1 99/10/18 Copyright 1986 J. Schilling */
+/* @(#)intcvt.h	1.2 01/10/27 Copyright 1986 J. Schilling */
 /*
  *	Definitions for conversion to/from integer data types of various size.
  *
@@ -23,6 +23,9 @@
 #ifndef	_INTCVT_H
 #define	_INTCVT_H
 
+#ifndef _MCONFIG_H
+#include <mconfig.h>
+#endif
 
 #define	i_to_2_byte(a, i)	(((Uchar *)(a))[0] = ((i) >> 8) & 0xFF,\
 				 ((Uchar *)(a))[1] = (i) & 0xFF)
diff -ruN cdrdao-1.1.5.orig/scsilib/include/jmpdefs.h cdrdao-1.1.5/scsilib/include/jmpdefs.h
--- cdrdao-1.1.5.orig/scsilib/include/jmpdefs.h	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/include/jmpdefs.h	2000-11-08 04:14:47.000000000 -0500
@@ -0,0 +1,38 @@
+/* @(#)jmpdefs.h	1.2 00/11/08 Copyright 1999 J. Schilling */
+/*
+ *	Definitions that help to handle a jmp_buf
+ *
+ *	Copyright (c) 1998 J. Schilling
+ */
+/*
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; see the file COPYING.  If not, write to
+ * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+#ifndef	_JMPDEFS_H
+#define	_JMPDEFS_H
+
+#ifdef	__cplusplus
+extern "C" {
+#endif
+
+typedef struct {
+	jmp_buf	jb;
+} jmps_t;
+
+#ifdef	__cplusplus
+}
+#endif
+
+#endif	/* _JMPDEFS_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/libport.h cdrdao-1.1.5/scsilib/include/libport.h
--- cdrdao-1.1.5.orig/scsilib/include/libport.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/libport.h	2001-11-28 16:51:20.000000000 -0500
@@ -1,4 +1,4 @@
-/* @(#)libport.h	1.4 00/11/08 Copyright 1995 J. Schilling */
+/* @(#)libport.h	1.5 01/11/28 Copyright 1995 J. Schilling */
 /*
  *	Copyright (c) 1995 J. Schilling
  */
@@ -54,6 +54,9 @@
 #ifndef	HAVE_GETDOMAINNAME
 extern	int		getdomainname	__PR((char *name, int namelen));
 #endif
+#ifndef	HAVE_GETPAGESIZE
+EXPORT	int		getpagesize	__PR((void));
+#endif
 #ifndef	HAVE_USLEEP
 extern	int		usleep		__PR((int usec));
 #endif
diff -ruN cdrdao-1.1.5.orig/scsilib/include/maxpath.h cdrdao-1.1.5/scsilib/include/maxpath.h
--- cdrdao-1.1.5.orig/scsilib/include/maxpath.h	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/include/maxpath.h	2001-11-18 18:04:22.000000000 -0500
@@ -0,0 +1,75 @@
+/* @(#)maxpath.h	1.4 01/11/18 Copyright 1985, 1995, 1998 J. Schilling */
+/*
+ *	Definitions for dealing with statically limitations on pathnames
+ *
+ *	Copyright (c) 1985, 1995, 1998 J. Schilling
+ */
+/*
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; see the file COPYING.  If not, write to
+ * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+#ifndef	_MAXPATH_H
+#define	_MAXPATH_H
+
+#ifndef	_DIRDEFS_H
+#include <dirdefs.h>			/* Includes mconfig.h if needed	     */
+#endif
+
+#ifdef	JOS
+#	define	MAXPATHNAME	128
+#	define	FOUND_MAXPATHNAME
+
+#	define	MAXFILENAME	30
+#	define	FOUND_MAXFILENAME
+#else
+
+#	ifdef	MAXPATHLEN
+#		define	MAXPATHNAME	MAXPATHLEN	/* From sys/param.h  */
+#		define	FOUND_MAXPATHNAME
+#	else
+#	ifdef	PATH_MAX
+#		define	MAXPATHNAME	PATH_MAX	/* From limits.h     */
+#		define	FOUND_MAXPATHNAME
+#	else
+#		define	MAXPATHNAME	256		/* Is there a limit? */
+#	endif
+#	endif
+
+/*
+ * Don't use defaults here to allow recognition of problems.
+ */
+#	ifdef	MAXNAMELEN
+#		define	MAXFILENAME	MAXNAMELEN	/* From sys/param.h  */
+#		define	FOUND_MAXFILENAME
+#	else
+#	ifdef	MAXNAMLEN
+#		define	MAXFILENAME	MAXNAMLEN	/* From dirent.h     */
+#		define	FOUND_MAXFILENAME
+#	else
+#	ifdef	DIRSIZ
+#		define	MAXFILENAME	DIRSIZ		/* From sys/dir.h    */
+#		define	FOUND_MAXFILENAME
+#	endif
+#	endif
+#	endif
+
+#if	!defined(FOUND_MAXFILENAME) && defined(FOUND_DIRSIZE)
+#	define	MAXFILENAME		DIRSIZE		/* From dirdefs.h    */
+#	define	FOUND_MAXFILENAME
+#endif
+
+#endif	/* JOS */
+
+#endif	/* _MAXPATH_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/mconfig.h cdrdao-1.1.5/scsilib/include/mconfig.h
--- cdrdao-1.1.5.orig/scsilib/include/mconfig.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/mconfig.h	2001-10-27 09:20:08.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)mconfig.h	1.38 00/12/04 Copyright 1995 J. Schilling */
+/* @(#)mconfig.h	1.39 01/10/27 Copyright 1995 J. Schilling */
 /*
  *	definitions for machine configuration
  *
@@ -32,6 +32,11 @@
 #define _MCONFIG_H
 
 /*
+ * Tell our users that this is a Schily SING compile environment.
+ */
+#define	IS_SCHILY
+
+/*
  * This hack that is needed as long as VMS has no POSIX shell.
  */
 #ifdef	VMS
@@ -254,7 +259,9 @@
 #define LOCK_UN         8       /* unlock */
 #endif
 
+#ifndef	_PROTOTYP_H
 #include <prototyp.h>
+#endif
 
 /*
  * gcc 2.x generally implements the long long type.
diff -ruN cdrdao-1.1.5.orig/scsilib/include/prototyp.h cdrdao-1.1.5/scsilib/include/prototyp.h
--- cdrdao-1.1.5.orig/scsilib/include/prototyp.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/prototyp.h	2001-10-27 08:57:06.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)prototyp.h	1.8 00/11/08 Copyright 1995 J. Schilling */
+/* @(#)prototyp.h	1.10 01/10/27 Copyright 1995 J. Schilling */
 /*
  *	Definitions for dealing with ANSI / KR C-Compilers
  *
@@ -20,6 +20,14 @@
  * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
  */
 
+/*
+ * mconfig.h includes prototype.h so we must do this include before we test
+ * for _PROTOTYP_H
+ */
+#ifndef _MCONFIG_H
+#include <mconfig.h>
+#endif
+
 #ifndef	_PROTOTYP_H
 #define	_PROTOTYP_H
 
@@ -38,11 +46,13 @@
 #	endif
 #endif	/* PROTOTYPES */
 
-#if	!defined(PROTOTYPES) && defined(__cplusplus)
+#if	!defined(PROTOTYPES) && (defined(__cplusplus) || defined(_MSC_VER))
 	/*
 	 * C++ always supports prototypes.
 	 * Define PROTOTYPES so we are not forced to make
 	 * a separtate autoconf run for C++
+	 *
+	 * Microsoft C has prototypes but does not define __STDC__
 	 */
 #	define	PROTOTYPES
 #endif
diff -ruN cdrdao-1.1.5.orig/scsilib/include/scg/scsidefs.h cdrdao-1.1.5/scsilib/include/scg/scsidefs.h
--- cdrdao-1.1.5.orig/scsilib/include/scg/scsidefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/scg/scsidefs.h	2001-09-27 12:01:31.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)scsidefs.h	1.24 01/02/23 Copyright 1988 J. Schilling */
+/* @(#)scsidefs.h	1.27 01/09/27 Copyright 1988 J. Schilling */
 /*
  *	Definitions for SCSI devices i.e. for error strings in scsierrs.c
  *
@@ -30,6 +30,12 @@
 /*
  * Disks
  */
+#ifdef	DEV_UNKNOWN
+/*
+ * True64 defines DEV_UNKNOWN in /usr/include/sys/devio.h as "UNKNOWN"
+ */
+#undef	DEV_UNKNOWN
+#endif
 #define	DEV_UNKNOWN		0
 #define	DEV_ACB40X0		1
 #define	DEV_ACB4000		2
@@ -73,6 +79,7 @@
 #define	DEV_MMC_CDR		502
 #define	DEV_MMC_CDRW		503
 #define	DEV_MMC_DVD		504
+#define	DEV_MMC_DVD_WR		505
 
 #define	DEV_CDD_521_OLD		510
 #define	DEV_CDD_521		511
@@ -80,6 +87,7 @@
 #define	DEV_PCD_600		513
 #define	DEV_CDD_2000		514
 #define	DEV_CDD_2600		515
+#define	DEV_TYUDEN_EW50		516
 #define	DEV_YAMAHA_CDR_100	520
 #define	DEV_YAMAHA_CDR_400	521
 #define	DEV_PLASMON_RF_4100	530
diff -ruN cdrdao-1.1.5.orig/scsilib/include/scg/scsireg.h cdrdao-1.1.5/scsilib/include/scg/scsireg.h
--- cdrdao-1.1.5.orig/scsilib/include/scg/scsireg.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/scg/scsireg.h	2001-10-30 17:12:05.000000000 -0500
@@ -1,4 +1,4 @@
-/* @(#)scsireg.h	1.24 00/11/07 Copyright 1987 J. Schilling */
+/* @(#)scsireg.h	1.26 01/10/30 Copyright 1987 J. Schilling */
 /*
  *	usefull definitions for dealing with CCS SCSI - devices
  *
@@ -772,14 +772,17 @@
 	Uchar	p_len;			/* 0x32 = 50 Bytes */
 	Ucbit	write_type	: 4;	/* Session write type (PACKET/TAO...)*/
 	Ucbit	test_write	: 1;	/* Do not actually write data	     */
-	Ucbit	res_2		: 3;
+	Ucbit	LS_V		: 1;	/* Link size valid		     */
+	Ucbit	BUFE		: 1;	/* Enable Bufunderrun free rec.	     */
+	Ucbit	res_2_7		: 1;
 	Ucbit	track_mode	: 4;	/* Track mode (Q-sub control nibble) */
 	Ucbit	copy		: 1;	/* 1st higher gen of copy prot track ~*/
 	Ucbit	fp		: 1;	/* Fixed packed (if in packet mode)  */
 	Ucbit	multi_session	: 2;	/* Multi session write type	     */
 	Ucbit	dbtype		: 4;	/* Data block type		     */
 	Ucbit	res_4		: 4;	/* Reserved			     */
-	Uchar	res_56[2];		/* Reserved			     */
+	Uchar	link_size;		/* Link Size (default is 7)	     */
+	Uchar	res_6;			/* Reserved			     */
 	Ucbit	host_appl_code	: 6;	/* Host application code of disk     */
 	Ucbit	res_7		: 2;	/* Reserved			     */
 	Uchar	session_format;		/* Session format (DA/CDI/XA)	     */
@@ -797,7 +800,9 @@
 struct cd_mode_page_05 {		/* write parameters */
 		MP_P_CODE;		/* parsave & pagecode */
 	Uchar	p_len;			/* 0x32 = 50 Bytes */
-	Ucbit	res_2		: 3;
+	Ucbit	res_2_7		: 1;
+	Ucbit	BUFE		: 1;	/* Enable Bufunderrun free rec.	     */
+	Ucbit	LS_V		: 1;	/* Link size valid		     */
 	Ucbit	test_write	: 1;	/* Do not actually write data	     */
 	Ucbit	write_type	: 4;	/* Session write type (PACKET/TAO...)*/
 	Ucbit	multi_session	: 2;	/* Multi session write type	     */
@@ -806,7 +811,8 @@
 	Ucbit	track_mode	: 4;	/* Track mode (Q-sub control nibble) */
 	Ucbit	res_4		: 4;	/* Reserved			     */
 	Ucbit	dbtype		: 4;	/* Data block type		     */
-	Uchar	res_56[2];		/* Reserved			     */
+	Uchar	link_size;		/* Link Size (default is 7)	     */
+	Uchar	res_6;			/* Reserved			     */
 	Ucbit	res_7		: 2;	/* Reserved			     */
 	Ucbit	host_appl_code	: 6;	/* Host application code of disk     */
 	Uchar	session_format;		/* Session format (DA/CDI/XA)	     */
@@ -847,7 +853,7 @@
 	Ucbit	mode_2_form_1	: 1;	/* Reads Mode-2 form 1 media (XA)    */
 	Ucbit	mode_2_form_2	: 1;	/* Reads Mode-2 form 2 media	     */
 	Ucbit	multi_session	: 1;	/* Reads multi-session media	     */
-	Ucbit	res_4		: 1;	/* Reserved			     */
+	Ucbit	BUF		: 1;	/* Supports Buffer under. free rec.  */
 	Ucbit	cd_da_supported	: 1;	/* Reads audio data with READ CD cmd */
 	Ucbit	cd_da_accurate	: 1;	/* READ CD data stream is accurate   */
 	Ucbit	rw_supported	: 1;	/* Reads R-W sub channel information */
@@ -903,7 +909,7 @@
 	Ucbit	test_write	: 1;	/* Supports emulation write	     */
 	Ucbit	cd_rw_write	: 1;	/* Supports writing CD-RW media	     */
 	Ucbit	cd_r_write	: 1;	/* Supports writing CD-R  media	     */
-	Ucbit	res_4		: 1;	/* Reserved			     */
+	Ucbit	BUF		: 1;	/* Supports Buffer under. free rec.  */
 	Ucbit	multi_session	: 1;	/* Reads multi-session media	     */
 	Ucbit	mode_2_form_2	: 1;	/* Reads Mode-2 form 2 media	     */
 	Ucbit	mode_2_form_1	: 1;	/* Reads Mode-2 form 1 media (XA)    */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/scg/scsitransp.h cdrdao-1.1.5/scsilib/include/scg/scsitransp.h
--- cdrdao-1.1.5.orig/scsilib/include/scg/scsitransp.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/scg/scsitransp.h	2002-05-04 14:42:40.000000000 -0400
@@ -1,24 +1,10 @@
-/* @(#)scsitransp.h	1.50 01/03/18 Copyright 1995 J. Schilling */
+/* @(#)scsitransp.h	1.51 02/05/04 Copyright 1995 J. Schilling */
 /*
  *	Definitions for commands that use functions from scsitransp.c
  *
  *	Copyright (c) 1995 J. Schilling
  */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
+/*@@C@@*/
 
 #ifndef	_SCG_SCSITRANSP_H
 #define	_SCG_SCSITRANSP_H
@@ -39,6 +25,8 @@
 #include <scg/scgops.h>
 #endif
 
+typedef	int	(*scg_cb_t)	__PR((void *));
+
 struct scg_scsi {
 	scg_ops_t *ops;		/* Ptr to low level SCSI transport ops	*/
 	int	fd;		/* File descriptor for next I/O		*/
@@ -74,6 +62,8 @@
 	char	*errptr;	/* Actual write pointer into errstr	*/
 	void	*errfile;	/* FILE to write errors to. NULL for not*/
 				/* writing and leaving errs in errstr	*/
+	scg_cb_t cb_fun;
+	void	*cb_arg;
 
 	struct scsi_inquiry *inq;
 	struct scsi_capacity *cap;
diff -ruN cdrdao-1.1.5.orig/scsilib/include/schily.h cdrdao-1.1.5/scsilib/include/schily.h
--- cdrdao-1.1.5.orig/scsilib/include/schily.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/schily.h	2002-03-01 05:37:22.000000000 -0500
@@ -1,4 +1,4 @@
-/* @(#)schily.h	1.39 01/02/23 Copyright 1985 J. Schilling */
+/* @(#)schily.h	1.47 02/03/01 Copyright 1985 J. Schilling */
 /*
  *	Definitions for libschily
  *
@@ -12,6 +12,8 @@
  *	string.h
  *	sys/types.h
  *
+ *	If you need stdio.h, you must include it before schily.h
+ *
  *	Copyright (c) 1985 J. Schilling
  */
 /*
@@ -55,6 +57,16 @@
 #	endif
 #endif
 
+#ifdef	__never_def__
+/*
+ * It turns out that we cannot use the folloginw definition because there are
+ * some platforms that do not behave application friendly. These are mainly
+ * BSD-4.4 based systems (which #undef a definition when size_t is available.
+ * We actually removed this code because of a problem with QNX Neutrino.
+ * For this reason, it is important not to include <sys/types.h> directly but
+ * via the Schily SING include files so we know whether it has been included
+ * before we come here.
+ */
 #if	defined(_SIZE_T)     || defined(_T_SIZE_) || defined(_T_SIZE) || \
 	defined(__SIZE_T)    || defined(_SIZE_T_) || \
 	defined(_GCC_SIZE_T) || defined(_SIZET_)  || \
@@ -64,6 +76,7 @@
 #	define	FOUND_SIZE_T	/* We already included a size_t definition */
 #endif
 #endif
+#endif	/* __never_def__ */
 
 #if	defined(HAVE_LARGEFILES)
 #	define	_fcons		_fcons64
@@ -92,6 +105,11 @@
 							char **));
 extern	int	fexecve __PR((const char *, FILE *, FILE *, FILE *,
 					char * const *, char * const *));
+extern	int	fspawnv __PR((FILE *, FILE *, FILE *, int, char * const *));
+extern	int	fspawnl __PR((FILE *, FILE *, FILE *,
+					const char *, const char *, ...));
+extern	int	fspawnv_nowait __PR((FILE *, FILE *, FILE *,
+					const char *, int, char *const*));
 extern	int	fgetline __PR((FILE *, char *, int));
 extern	int	fgetstr __PR((FILE *, char *, int));
 extern	void	file_raise __PR((FILE *, int));
@@ -115,20 +133,28 @@
 extern	int	ffilewrite __PR((FILE *, void *, int));
 extern	int	flush __PR((void));
 extern	int	fpipe __PR((FILE **));
-extern	int	fprintf __PR((FILE *, const char *, ...)) __printflike__(2, 3);
+/*extern	int	fprintf __PR((FILE *, const char *, ...)) __printflike__(2, 3);*/
 extern	int	getbroken __PR((FILE *, char *, char, char **, int));
 extern	int	ofindline __PR((FILE *, char, const char *, int,
 							char **, int));
 extern	int	peekc __PR((FILE *));
 
+#ifdef	__never_def__
+/*
+ * We cannot define this or we may get into problems with DOS based systems.
+ */
 extern	int	spawnv __PR((FILE *, FILE *, FILE *, int, char * const *));
 extern	int	spawnl __PR((FILE *, FILE *, FILE *,
 					const char *, const char *, ...));
 extern	int	spawnv_nowait __PR((FILE *, FILE *, FILE *,
 					const char *, int, char *const*));
+#endif	/* __never_def__m */
 #endif	/* EOF */
 
 extern	int	_niread __PR((int, void *, int));
+extern	int	_niwrite __PR((int, void *, int));
+extern	int	_nixread __PR((int, void *, int));
+extern	int	_nixwrite __PR((int, void *, int));
 extern	int	_openfd __PR((const char *, int));
 extern	int	on_comerr __PR((void (*fun)(int, void *), void *arg));
 /*PRINTFLIKE1*/
@@ -161,8 +187,10 @@
 extern	int	getfiles __PR((int *, char * const**, const char *));
 extern	char	*astoi __PR((const char *, int *));
 extern	char	*astol __PR((const char *, long *));
+extern	char	*astolb __PR((const char *, long *, int base));
 #ifdef	_UTYPES_H
 extern	char	*astoll __PR((const char *, Llong *));
+extern	char	*astollb __PR((const char *, Llong *, int base));
 #endif
 
 /*extern	void	handlecond __PR((const char *, SIGBLK *, int(*)(const char *, long, long), long));*/
@@ -174,7 +202,7 @@
 extern	unsigned char	*patlmatch __PR((const unsigned char *, const int *,
 					const unsigned char *, int, int, int, int[]));
 
-extern	int	printf __PR((const char *, ...)) __printflike__(1, 2);
+/*extern	int	printf __PR((const char *, ...)) __printflike__(1, 2);*/
 extern	char	*movebytes __PR((const void *, void *, int));
 
 extern	void	save_args __PR((int, char**));
@@ -188,7 +216,7 @@
 extern	char	*get_progname __PR((void));
 
 extern	void	setfp __PR((void * const *));
-extern	int	wait_chld __PR((int));
+extern	int	wait_chld __PR((int));		/* for fspawnv_nowait() */
 extern	int	geterrno __PR((void));
 extern	void	raisecond __PR((const char *, long));
 #ifdef	FOUND_SIZE_T
@@ -232,6 +260,7 @@
 extern	void	**getfp __PR((void));
 extern	int	flush_reg_windows __PR((int));
 extern	int	cmpbytes __PR((const void *, const void *, int));
+extern	int	cmpnullbytes	__PR((const void *, int));
 
 #ifdef	nonono
 #if	defined(HAVE_LARGEFILES)
@@ -262,7 +291,9 @@
 #endif
 
 #if defined(_JOS) || defined(JOS)
+#	ifndef	_JOS_IO_H
 #	include <jos_io.h>
+#	endif
 #endif
 
 #endif	/* _SCHILY_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/sigdefs.h cdrdao-1.1.5/scsilib/include/sigdefs.h
--- cdrdao-1.1.5.orig/scsilib/include/sigdefs.h	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/include/sigdefs.h	2002-01-19 14:24:46.000000000 -0500
@@ -0,0 +1,70 @@
+/* @(#)sigdefs.h	1.5 02/01/19 Copyright 1997 J. Schilling */
+/*
+ *	Signal abstraction for BSD/SVR4 signals
+ *
+ *	Copyright (c) 1997 J. Schilling
+ */
+/*
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; see the file COPYING.  If not, write to
+ * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+#ifndef	_SIGDEFS_H
+#define	_SIGDEFS_H
+
+#ifndef _MCONFIG_H
+#include <mconfig.h>
+#endif
+
+#ifdef	HAVE_SIGSET
+/*
+ * Try to by default use the function that sets up signal handlers in a way
+ * that does not reset the handler after it has been called.
+ */
+#define	signal		sigset
+#endif
+
+#ifdef	HAVE_SIGPROCMASK
+#define	block_sigs(a)	{ \
+				sigset_t	__new;	\
+							\
+				sigfillset(&__new);	\
+				sigprocmask(SIG_BLOCK, &__new, &a);\
+			}
+#define	unblock_sig(s)	{ \
+				sigset_t	__new;	\
+							\
+				sigemptyset(&__new);	\
+				sigaddset(&__new, (s));	\
+				sigprocmask(SIG_UNBLOCK, &__new, NULL);\
+			}
+#define	restore_sigs(a)	sigprocmask(SIG_SETMASK, &a, 0);
+
+#else	/* !HAVE_SIGPROCMASK */
+
+#define	sigset_t	int
+#define	block_sigs(a)	a = sigblock(0xFFFFFFFF)
+#define	restore_sigs(a)	sigsetmask(a);
+#define	unblock_sig(s)	{ \
+				int	__old, __new;	\
+							\
+				block_sigs(__old);	\
+				__new = sigmask(s);	\
+				__new = __old & ~__new;	\
+				sigsetmask(__new);	\
+			}
+
+#endif	/* HAVE_SIGPROCMASK */
+
+#endif	/* _SIGDEFS_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/standard.h cdrdao-1.1.5/scsilib/include/standard.h
--- cdrdao-1.1.5.orig/scsilib/include/standard.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/standard.h	2001-11-11 10:44:55.000000000 -0500
@@ -1,4 +1,4 @@
-/* @(#)standard.h	1.27 01/02/23 Copyright 1985 J. Schilling */
+/* @(#)standard.h	1.29 01/11/11 Copyright 1985 J. Schilling */
 /*
  *	standard definitions
  *
@@ -9,6 +9,8 @@
  *	stdlib.h	(better use stdxlib.h)
  *	unistd.h	(better use unixstd.h) needed LARGEFILE support
  *
+ *	If you need stdio.h, you must include it before standard.h
+ *
  *	Copyright (c) 1985 J. Schilling
  */
 /*
@@ -112,6 +114,16 @@
 #	endif
 #endif
 
+#ifdef	__never_def__
+/*
+ * It turns out that we cannot use the folloginw definition because there are
+ * some platforms that do not behave application friendly. These are mainly
+ * BSD-4.4 based systems (which #undef a definition when size_t is available.
+ * We actually removed this code because of a problem with QNX Neutrino.
+ * For this reason, it is important not to include <sys/types.h> directly but
+ * via the Schily SING include files so we know whether it has been included
+ * before we come here.
+ */
 #if	defined(_SIZE_T)     || defined(_T_SIZE_) || defined(_T_SIZE) || \
 	defined(__SIZE_T)    || defined(_SIZE_T_) || \
 	defined(_GCC_SIZE_T) || defined(_SIZET_)  || \
@@ -121,11 +133,20 @@
 #	define	FOUND_SIZE_T	/* We already included a size_t definition */
 #endif
 #endif
+#endif	/* __never_def__ */
 
 #if defined(_JOS) || defined(JOS)
+#	ifndef	_SCHILY_H
 #	include <schily.h>
+#	endif
+
+#	ifndef	_JOS_DEFS_H
 #	include <jos_defs.h>
+#	endif
+
+#	ifndef	_JOS_IO_H
 #	include <jos_io.h>
+#	endif
 #endif
 
 #endif	/* _STANDARD_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/statdefs.h cdrdao-1.1.5/scsilib/include/statdefs.h
--- cdrdao-1.1.5.orig/scsilib/include/statdefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/statdefs.h	2002-05-12 06:35:35.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)statdefs.h	1.2 01/01/18 Copyright 1998 J. Schilling */
+/* @(#)statdefs.h	1.7 02/05/12 Copyright 1998 J. Schilling */
 /*
  *	Definitions for stat() file mode
  *
@@ -27,6 +27,15 @@
 #include <mconfig.h>
 #endif
 
+#ifndef	_INCL_SYS_TYPES_H
+#include <sys/types.h>		/* Needed for sys/stat.h		*/
+#define	_INCL_SYS_TYPES_H
+#endif
+#ifndef	_INCL_SYS_STAT_H
+#include <sys/stat.h>		/* For S_IS* and S_IF*			*/
+#define	_INCL_SYS_STAT_H
+#endif
+
 /*
  * Apollo Domain/OS has a broken sys/stat.h that defines
  * S_IFIFO == S_IFSOCK and creates trouble if the constants
@@ -50,99 +59,224 @@
 #undef	S_ISSHAD			/* Solaris shadow inode	*/
 #undef	S_ISSOCK			/* UNIX domain socket	*/
 #undef	S_ISDOOR			/* Solaris DOOR		*/
+#undef	S_ISWHT				/* BSD whiteout		*/
+#undef	S_ISEVC				/* UNOS eventcount	*/
 #endif
 
-#ifndef	S_ISFIFO			/* Named pipe		*/
+#ifndef	S_ISFIFO			/* 1 Named pipe		*/
 #	ifdef	S_IFIFO
 #		define	S_ISFIFO(m)	(((m) & S_IFMT) == S_IFIFO)
 #	else
 #		define	S_ISFIFO(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISCHR				/* Character special	*/
+#ifndef	S_ISCHR				/* 2 Character special	*/
 #	ifdef	S_IFCHR
 #		define	S_ISCHR(m)	(((m) & S_IFMT) == S_IFCHR)
 #	else
 #		define	S_ISCHR(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISMPC				/* UNUSED multiplexed c	*/
+#ifndef	S_ISMPC				/* 3 UNUSED multiplexed char	*/
 #	ifdef	S_IFMPC
 #		define	S_ISMPC(m)	(((m) & S_IFMT) == S_IFMPC)
 #	else
 #		define	S_ISMPC(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISDIR				/* Directory		*/
+#ifndef	S_ISDIR				/* 4 Directory			*/
 #	ifdef	S_IFDIR
 #		define	S_ISDIR(m)	(((m) & S_IFMT) == S_IFDIR)
 #	else
 #		define	S_ISDIR(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISNAM				/* Named file (XENIX)	*/
+#ifndef	S_ISNAM				/* 5 Named file (XENIX)		*/
 #	ifdef	S_IFNAM
 #		define	S_ISNAM(m)	(((m) & S_IFMT) == S_IFNAM)
 #	else
 #		define	S_ISNAM(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISBLK				/* Block special	*/
+#ifndef	S_ISBLK				/* 6 Block special		*/
 #	ifdef	S_IFBLK
 #		define	S_ISBLK(m)	(((m) & S_IFMT) == S_IFBLK)
 #	else
 #		define	S_ISBLK(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISMPB				/* UNUSED multiplexed b	*/
+#ifndef	S_ISMPB				/* 7 UNUSED multiplexed block	*/
 #	ifdef	S_IFMPB
 #		define	S_ISMPB(m)	(((m) & S_IFMT) == S_IFMPB)
 #	else
 #		define	S_ISMPB(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISREG				/* Regular file		*/
+#ifndef	S_ISREG				/* 8 Regular file		*/
 #	ifdef	S_IFREG
 #		define	S_ISREG(m)	(((m) & S_IFMT) == S_IFREG)
 #	else
 #		define	S_ISREG(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISCNT				/* Contiguous file	*/
+#ifndef	S_ISCNT				/* 9 Contiguous file		*/
 #	ifdef	S_IFCNT
 #		define	S_ISCNT(m)	(((m) & S_IFMT) == S_IFCNT)
 #	else
 #		define	S_ISCNT(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISLNK				/* Symbolic link	*/
+#ifndef	S_ISLNK				/* 10 Symbolic link		*/
 #	ifdef	S_IFLNK
 #		define	S_ISLNK(m)	(((m) & S_IFMT) == S_IFLNK)
 #	else
 #		define	S_ISLNK(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISSHAD			/* Solaris shadow inode	*/
+#ifndef	S_ISSHAD			/* 11 Solaris shadow inode	*/
 #	ifdef	S_IFSHAD
 #		define	S_ISSHAD(m)	(((m) & S_IFMT) == S_IFSHAD)
 #	else
 #		define	S_ISSHAD(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISSOCK			/* UNIX domain socket	*/
+#ifndef	S_ISSOCK			/* 12 UNIX domain socket	*/
 #	ifdef	S_IFSOCK
 #		define	S_ISSOCK(m)	(((m) & S_IFMT) == S_IFSOCK)
 #	else
 #		define	S_ISSOCK(m)	(0)
 #	endif
 #endif
-#ifndef	S_ISDOOR			/* Solaris DOOR		*/
+#ifndef	S_ISDOOR			/* 13 Solaris DOOR		*/
 #	ifdef	S_IFDOOR
 #		define	S_ISDOOR(m)	(((m) & S_IFMT) == S_IFDOOR)
 #	else
 #		define	S_ISDOOR(m)	(0)
 #	endif
 #endif
+#ifndef	S_ISWHT				/* 14 BSD whiteout		*/
+#	ifdef	S_IFWHT
+#		define	S_ISWHT(m)	(((m) & S_IFMT) == S_ISWHT)
+#	else
+#		define	S_ISWHT(m)	(0)
+#	endif
+#endif
+#ifndef	S_IFEVC				/* 15 UNOS eventcount		*/
+#	ifdef	S_IFEVC
+#		define	S_ISEVC(m)	(((m) & S_IFMT) == S_IFEVC)
+#	else
+#		define	S_ISEVC(m)	(0)
+#	endif
+#endif
+
+#ifndef	S_TYPEISMQ
+/*
+ * XXX ??? where is a definition of a message queue ???
+ */
+#		define	S_TYPEISMQ(_stbuf)	(0)
+#endif
+#ifndef	S_TYPEISSEM
+#	ifdef	S_INSEM
+#		define	S_TYPEISSEM(_stbuf)	(S_ISNAM((_stbuf)->st_mode) && (_stbuf)->st_rdev == S_INSEM)
+#	else
+#		define	S_TYPEISSEM(_stbuf)	(0)
+#	endif
+#endif
+#ifndef	S_TYPEISSHM
+#	ifdef	S_INSHD
+#		define	S_TYPEISSHM(_stbuf)	(S_ISNAM((_stbuf)->st_mode) && (_stbuf)->st_rdev == S_INSHD)
+#	else
+#		define	S_TYPEISSHM(_stbuf)	(0)
+#	endif
+#endif
+
+/*
+ * Mode permission bits.
+ * UNIX V.7 has only	S_ISUID/S_ISGID/S_ISVTX and S_IREAD/S_IWRITE/S_IEXEC
+ */
+#ifndef	S_ISUID			/* Set-user-ID on execution */
+#define	S_ISUID	0		/* If it is not defined, it is not supported */
+#endif
+#ifndef	S_ISGID			/* Set-group-ID on execution */
+#define	S_ISGID	0		/* If it is not defined, it is not supported */
+#endif
+#ifndef	S_ISVTX			/* On directories, restricted deletion flag */
+#define	S_ISVTX	0		/* If it is not defined, it is not supported */
+#endif
+
+#ifndef	S_IRUSR			/* Read permission, owner */
+#ifdef	S_IREAD
+#define	S_IRUSR	S_IREAD		/* Needed on old UNIX systems */
+#else
+#define	S_IRUSR	0400
+#endif
+#endif
+#ifndef	S_IWUSR			/* Write permission, owner */
+#ifdef	S_IWRITE
+#define	S_IWUSR	S_IWRITE	/* Needed on old UNIX systems */
+#else
+#define	S_IWUSR	0200
+#endif
+#endif
+#ifndef	S_IXUSR			/* Execute/search permission, owner */
+#ifdef	S_IEXEC
+#define	S_IXUSR	S_IEXEC		/* Needed on old UNIX systems */
+#else
+#define	S_IXUSR	0100
+#endif
+#endif
+#ifndef	S_IRGRP			/* Read permission, group */
+#ifdef	S_IREAD
+#define	S_IRGRP	(S_IREAD >> 3)	/* Needed on old UNIX systems */
+#else
+#define	S_IRGRP	040
+#endif
+#endif
+#ifndef	S_IWGRP			/* Write permission, group */
+#ifdef	S_IWRITE
+#define	S_IWGRP	(S_IWRITE >> 3)	/* Needed on old UNIX systems */
+#else
+#define	S_IWGRP	020
+#endif
+#endif
+#ifndef	S_IXGRP			/* Execute/search permission, group */
+#ifdef	S_IEXEC
+#define	S_IXGRP	(S_IEXEC >> 3)	/* Needed on old UNIX systems */
+#else
+#define	S_IXGRP	010
+#endif
+#endif
+#ifndef	S_IROTH			/* Read permission, others */
+#ifdef	S_IREAD
+#define	S_IROTH	(S_IREAD >> 6)	/* Needed on old UNIX systems */
+#else
+#define	S_IROTH	004
+#endif
+#endif
+#ifndef	S_IWOTH			/* Write permission, others */
+#ifdef	S_IWRITE
+#define	S_IWOTH	(S_IWRITE >> 6)	/* Needed on old UNIX systems */
+#else
+#define	S_IWOTH	002
+#endif
+#endif
+#ifndef	S_IXOTH			/* Execute/search permission, others */
+#ifdef	S_IEXEC
+#define	S_IXOTH	(S_IEXEC >> 6)	/* Needed on old UNIX systems */
+#else
+#define	S_IXOTH	001
+#endif
+#endif
+
+#ifndef	S_IRWXU			/* Read, write, execute/search by owner */
+#define	S_IRWXU (S_IRUSR|S_IWUSR|S_IXUSR)
+#endif
+#ifndef	S_IRWXG			/* Read, write, execute/search by group */
+#define	S_IRWXG (S_IRGRP|S_IWGRP|S_IXGRP)
+#endif
+#ifndef	S_IRWXO			/* Read, write, execute/search by others */
+#define	S_IRWXO (S_IROTH|S_IWOTH|S_IXOTH)
+#endif
 
 #endif	/* _STATDEFS_H */
 
diff -ruN cdrdao-1.1.5.orig/scsilib/include/stdxlib.h cdrdao-1.1.5/scsilib/include/stdxlib.h
--- cdrdao-1.1.5.orig/scsilib/include/stdxlib.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/stdxlib.h	2001-07-15 09:11:21.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)stdxlib.h	1.3 01/02/19 Copyright 1996 J. Schilling */
+/* @(#)stdxlib.h	1.6 01/07/15 Copyright 1996 J. Schilling */
 /*
  *	Definitions for stdlib
  *
@@ -28,7 +28,10 @@
 #endif
 
 #ifdef	HAVE_STDLIB_H
+#ifndef	_INCL_STDLIB_H
 #include <stdlib.h>
+#define	_INCL_STDLIB_H
+#endif
 #else
 
 extern	char	*malloc();
@@ -38,4 +41,14 @@
 
 #endif	/* HAVE_STDLIB_H */
 
+#ifndef	EXIT_FAILURE
+#define	EXIT_FAILURE	1
+#endif
+#ifndef	EXIT_SUCCESS
+#define	EXIT_SUCCESS	0
+#endif
+#ifndef	RAND_MAX
+#define	RAND_MAX	32767
+#endif
+
 #endif	/* _STDXLIB_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/stkframe.h cdrdao-1.1.5/scsilib/include/stkframe.h
--- cdrdao-1.1.5.orig/scsilib/include/stkframe.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/stkframe.h	2001-10-27 10:19:30.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)stkframe.h	1.6 00/11/08 Copyright 1995 J. Schilling */
+/* @(#)stkframe.h	1.8 01/10/27 Copyright 1995 J. Schilling */
 /*
  * Common definitions for routines that parse the stack frame.
  *
@@ -25,18 +25,31 @@
 #ifndef _STKFRAME_H
 #define _STKFRAME_H
 
+#ifndef _MCONFIG_H
+#include <mconfig.h>
+#endif
+
 #if defined (sun) && (defined(SVR4) || defined(__SVR4) || defined(__SVR4__))
 #	ifdef	i386
 		/*
 		 * On Solaris 2.1 x86 sys/frame.h is not useful at all
 		 * On Solaris 2.4 x86 sys/frame.h is buggy (fr_savfp is int!!)
 		 */
+#		ifndef	_INCL_SYS_REG_H
 #		include <sys/reg.h>
+#		define	_INCL_SYS_REG_H
+#		endif
 #	endif
+#	ifndef	_INCL_SYS_FRAME_H
 #	include <sys/frame.h>
+#	define	_INCL_SYS_FRAME_H
+#	endif
 
 #elif	defined (sun)
+#	ifndef	_INCL_MACHINE_FRAME_H
 #	include <machine/frame.h>
+#	define	_INCL_MACHINE_FRAME_H
+#	endif
 #else
 
 #ifdef	__cplusplus
diff -ruN cdrdao-1.1.5.orig/scsilib/include/strdefs.h cdrdao-1.1.5/scsilib/include/strdefs.h
--- cdrdao-1.1.5.orig/scsilib/include/strdefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/strdefs.h	2001-11-09 05:09:30.000000000 -0500
@@ -1,4 +1,4 @@
-/* @(#)strdefs.h	1.3 00/11/08 Copyright 1996 J. Schilling */
+/* @(#)strdefs.h	1.6 01/11/09 Copyright 1996 J. Schilling */
 /*
  *	Definitions for strings
  *
@@ -27,8 +27,32 @@
 #include <mconfig.h>
 #endif
 
+#ifdef	__never_def
+/*
+ * It seems that IBM's AIX sometimes has problems when doing
+ * #include <string.h>
+ * #include <strings.h>
+ * So I moved the #include <strings.h> to the top. As the file strings.h
+ * only defines extern int bcmp(); extern void bcopy(); extern void bzero();
+ * extern char *index(); extern char *rindex(); and these functions should
+ * not be used in portable programs, I disabled the strings.h #include for now.
+ *
+ */
+#ifdef	HAVE_STRINGS_H
+#ifndef	_INCL_STRINGS_H
+#include <strings.h>
+#define	_INCL_STRINGS_H
+#endif
+#endif	/* HAVE_STRINGS_H */
+
+#endif	/*  __never_def */
+
+
 #ifdef	HAVE_STRING_H
+#ifndef	_INCL_STRING_H
 #include <string.h>
+#define	_INCL_STRING_H
+#endif
 #else	/* HAVE_STRING_H */
 
 #ifdef	__cplusplus
diff -ruN cdrdao-1.1.5.orig/scsilib/include/termcap.h cdrdao-1.1.5/scsilib/include/termcap.h
--- cdrdao-1.1.5.orig/scsilib/include/termcap.h	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/include/termcap.h	2000-11-29 09:29:01.000000000 -0500
@@ -0,0 +1,59 @@
+/* @(#)termcap.h	1.4 00/11/29 Copyright 1995 J. Schilling */
+/*
+ *	Copyright (c) 1995 J. Schilling
+ */
+/*
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; see the file COPYING.  If not, write to
+ * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+#ifndef	_TERMCAP_H
+#define	_TERMCAP_H
+
+#ifndef _MCONFIG_H
+#include <mconfig.h>
+#endif
+
+#ifdef	__cplusplus
+extern "C" {
+#endif
+
+/*
+ * Flags for tcsetflags()
+ */
+#define	TCF_NO_TC		0x0001	/* Don't follow tc= entries */
+#define	TCF_NO_SIZE		0x0002	/* Don't get actual ttysize (li#/co#)*/
+#define	TCF_NO_STRIP		0x0004	/* Don't strip down termcap buffer */
+
+extern	char	PC;		/* Pad character */
+extern	char	*BC;		/* Backspace if not "\b" from "bc" capability*/
+extern	char	*UP;		/* Cursor up string from "up" capability */
+extern	short	ospeed;		/* output speed coded as in ioctl */
+
+extern	int	tgetent		__PR((char* bp, char* name));
+extern	int	tcsetflags	__PR((int flags));
+extern	char*	tcgetbuf	__PR((void));
+extern	int	tgetnum		__PR((char* ent));
+extern	BOOL	tgetflag	__PR((char* ent));
+extern	char*	tgetstr		__PR((char* ent, char** array));
+extern	char*	tdecode		__PR((char* ep, char** array));
+
+extern	int	tputs		__PR((char *cp, int affcnt, int (*outc)(int c)));
+extern	char*	tgoto		__PR((char *cm, int destcol, int destline));
+
+#ifdef	__cplusplus
+}
+#endif
+
+#endif	/* _TERMCAP_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/timedefs.h cdrdao-1.1.5/scsilib/include/timedefs.h
--- cdrdao-1.1.5.orig/scsilib/include/timedefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/timedefs.h	2001-11-01 13:16:23.000000000 -0500
@@ -1,6 +1,8 @@
-/* @(#)timedefs.h	1.7 01/04/12 Copyright 1996 J. Schilling */
+/* @(#)timedefs.h	1.9 01/11/01 Copyright 1996 J. Schilling */
 /*
- *	Generic header for users of gettimeofday() ...
+ *	Generic header for users of time(), gettimeofday() ...
+ *
+ *	It includes definitions for time_t, struct timeval, ...
  *
  *	Copyright (c) 1996 J. Schilling
  */
@@ -27,14 +29,31 @@
 #include <mconfig.h>
 #endif
 
+#ifndef	_INCL_SYS_TYPES_H
+#include <sys/types.h>		/* Needed for time_t		*/
+#define	_INCL_SYS_TYPES_H
+#endif
+
 #ifdef	TIME_WITH_SYS_TIME
+#	ifndef	_INCL_SYS_TIME_H
 #	include <sys/time.h>
+#	define	_INCL_SYS_TIME_H
+#	endif
+#	ifndef	_INCL_TIME_H
 #	include <time.h>
+#	define	_INCL_TIME_H
+#	endif
 #else
 #ifdef	HAVE_SYS_TIME_H
+#	ifndef	_INCL_SYS_TIME_H
 #	include <sys/time.h>
+#	define	_INCL_SYS_TIME_H
+#	endif
 #else
+#	ifndef	_INCL_TIME_H
 #	include <time.h>
+#	define	_INCL_TIME_H
+#	endif
 #endif
 #endif
 
diff -ruN cdrdao-1.1.5.orig/scsilib/include/unixstd.h cdrdao-1.1.5/scsilib/include/unixstd.h
--- cdrdao-1.1.5.orig/scsilib/include/unixstd.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/unixstd.h	2001-10-27 10:23:10.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)unixstd.h	1.6 01/02/20 Copyright 1996 J. Schilling */
+/* @(#)unixstd.h	1.8 01/10/27 Copyright 1996 J. Schilling */
 /*
  *	Definitions for unix system interface
  *
@@ -33,7 +33,10 @@
 #include <sys/types.h>
 #define	_INCL_SYS_TYPES_H
 #endif
+#ifndef	_INCL_UNISTD_H
 #include <unistd.h>
+#define	_INCL_UNISTD_H
+#endif
 
 #ifndef	_SC_PAGESIZE
 #ifdef	_SC_PAGE_SIZE	/* HP/UX & OSF */
@@ -55,7 +58,9 @@
 
 #ifndef	STDIN_FILENO
 #	ifdef	JOS
+#		ifndef	_JOS_IO_H
 #		include <jos_io.h>
+#		endif
 #	else
 #		define	STDIN_FILENO	0
 #		define	STDOUT_FILENO	1
diff -ruN cdrdao-1.1.5.orig/scsilib/include/utimdefs.h cdrdao-1.1.5/scsilib/include/utimdefs.h
--- cdrdao-1.1.5.orig/scsilib/include/utimdefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/utimdefs.h	2001-10-27 10:23:09.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)utimdefs.h	1.1 01/02/17 Copyright 2001 J. Schilling */
+/* @(#)utimdefs.h	1.4 01/10/27 Copyright 2001 J. Schilling */
 /*
  *	Defines for utimes() / utime()
  *
@@ -23,20 +23,32 @@
 #ifndef	_UTIMDEFS_H
 #define	_UTIMDEFS_H
 
+#ifndef _MCONFIG_H
+#include <mconfig.h>
+#endif
+
 #ifndef	_INCL_SYS_TYPES_H
 #include <sys/types.h>
 #define	_INCL_SYS_TYPES_H
 #endif
 
 #ifdef	HAVE_UTIMES
+#ifndef _TIMEDEFS_H
 #include <timedefs.h>
 #endif
+#endif
 
 #ifdef	HAVE_UTIME_H
+#ifndef	_INCL_UTIME_H
 #include <utime.h>
+#define	_INCL_UTIME_H
+#endif
 #else
 #ifdef	HAVE_SYS_UTIME_H
+#ifndef	_INCL_SYS_UTIME_H
 #include <sys/utime.h>
+#define	_INCL_SYS_UTIME_H
+#endif
 #else
 struct utimbuf {
 	time_t	actime;
diff -ruN cdrdao-1.1.5.orig/scsilib/include/utypes.h cdrdao-1.1.5/scsilib/include/utypes.h
--- cdrdao-1.1.5.orig/scsilib/include/utypes.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/utypes.h	2002-05-08 12:24:24.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)utypes.h	1.5 99/07/31 Copyright 1997 J. Schilling */
+/* @(#)utypes.h	1.10 02/05/08 Copyright 1997 J. Schilling */
 /*
  *	Definitions for some user defined types
  *
@@ -27,6 +27,39 @@
 #include <mconfig.h>
 #endif
 
+/*
+ * Include limits.h for CHAR_BIT
+ */
+#ifdef	HAVE_LIMITS_H
+#ifndef	_INCL_LIMITS_H
+#include <limits.h>
+#define	_INCL_LIMITS_H
+#endif
+#endif
+
+#ifndef	CHAR_BIT
+#define	CHAR_BIT	8
+#endif
+
+/*
+ * These macros may not work on all platforms but as we depend
+ * on two's complement in many places, they do not reduce portability.
+ */
+#define	TYPE_ISSIGNED(t)	(((t)-1) < ((t)0))
+#define	TYPE_MSBVAL(t)		((t)( ~((t)0) << (sizeof(t)*CHAR_BIT - 1)))
+#define	TYPE_MINVAL(t)		(TYPE_ISSIGNED(t)			\
+				 ? TYPE_MSBVAL(t)			\
+				 : ((t)0))
+#define	TYPE_MAXVAL(t)		((t)( ~((t)0) - TYPE_MINVAL(t)))
+
+/*
+ * Let us include system defined types too.
+ */
+#ifndef	_INCL_SYS_TYPES_H
+#include <sys/types.h>
+#define	_INCL_SYS_TYPES_H
+#endif
+
 #ifdef	__CHAR_UNSIGNED__	/* GNU GCC define     (dynamic)	*/
 #ifndef CHAR_IS_UNSIGNED
 #define	CHAR_IS_UNSIGNED	/* Sing Schily define (static)	*/
@@ -57,11 +90,17 @@
 typedef	long long		Llong;
 typedef	unsigned long long	Ullong;
 
+#define	SIZEOF_LLONG		SIZEOF_LONG_LONG
+#define	SIZEOF_ULLONG		SIZEOF_UNSIGNED_LONG_LONG
+
 #else
 
 typedef	long			Llong;
 typedef	unsigned long		Ullong;
 
+#define	SIZEOF_LLONG		SIZEOF_LONG
+#define	SIZEOF_ULLONG		SIZEOF_UNSIGNED_LONG
+
 #endif
 
 /*
@@ -70,7 +109,7 @@
  * for packed bit fields. Define a pesical type to avoid warnings.
  * The packed attribute is honored wit unsigned int in this case too.
  */
-#ifdef	_AIX
+#if	defined(_AIX) && !defined(__GNUC__)
 
 typedef unsigned int	Ucbit;
 
@@ -90,7 +129,10 @@
  */
 
 #ifdef	HAVE_INTTYPES_H
+#	ifndef	_INCL_INTTYPES_H
 #	include <inttypes.h>
+#	define	_INCL_INTTYPES_H
+#	endif
 #	define	HAVE_INT64_T
 #	define	HAVE_UINT64_T
 
@@ -98,10 +140,12 @@
 #define	Int16_t			int16_t
 #define	Int32_t			int32_t
 #define	Int64_t			int64_t
+#define	Intmax_t		intmax_t
 #define	UInt8_t			uint8_t
 #define	UInt16_t		uint16_t
 #define	UInt32_t		uint32_t
 #define	UInt64_t		uint64_t
+#define	UIntmax_t		uintmax_t
 
 #define	Intptr_t		intptr_t
 #define	UIntptr_t		uintptr_t
@@ -183,6 +227,9 @@
 #endif
 #endif
 
+#define	Intmax_t	Llong
+#define	UIntmax_t	Ullong
+
 #if SIZEOF_CHAR_P == SIZEOF_UNSIGNED_INT
 	typedef		unsigned int	UIntptr_t;
 #else
@@ -195,4 +242,98 @@
 
 #endif	/* HAVE_INTTYPES_H */
 
+#ifndef	CHAR_MIN
+#define	CHAR_MIN	TYPE_MINVAL(char)
+#endif
+#ifndef	CHAR_MAX
+#define	CHAR_MAX	TYPE_MAXVAL(char)
+#endif
+#ifndef	UCHAR_MAX
+#define	UCHAR_MAX	TYPE_MAXVAL(unsigned char)
+#endif
+
+#ifndef	SHRT_MIN
+#define	SHRT_MIN	TYPE_MINVAL(short)
+#endif
+#ifndef	SHRT_MAX
+#define	SHRT_MAX	TYPE_MAXVAL(short)
+#endif
+#ifndef	USHRT_MAX
+#define	USHRT_MAX	TYPE_MAXVAL(unsigned short)
+#endif
+
+#ifndef	INT_MIN
+#define	INT_MIN		TYPE_MINVAL(int)
+#endif
+#ifndef	INT_MAX
+#define	INT_MAX		TYPE_MAXVAL(int)
+#endif
+#ifndef	UINT_MAX
+#define	UINT_MAX	TYPE_MAXVAL(unsigned int)
+#endif
+
+#ifndef	LONG_MIN
+#define	LONG_MIN	TYPE_MINVAL(long)
+#endif
+#ifndef	LONG_MAX
+#define	LONG_MAX	TYPE_MAXVAL(long)
+#endif
+#ifndef	ULONG_MAX
+#define	ULONG_MAX	TYPE_MAXVAL(unsigned long)
+#endif
+
+#ifndef	INT8_MIN
+#define	INT8_MIN	TYPE_MINVAL(Int8_t)
+#endif
+#ifndef	INT8_MAX
+#define	INT8_MAX	TYPE_MAXVAL(Int8_t)
+#endif
+#ifndef	UINT8_MAX
+#define	UINT8_MAX	TYPE_MAXVAL(UInt8_t)
+#endif
+
+#ifndef	INT16_MIN
+#define	INT16_MIN	TYPE_MINVAL(Int16_t)
+#endif
+#ifndef	INT16_MAX
+#define	INT16_MAX	TYPE_MAXVAL(Int16_t)
+#endif
+#ifndef	UINT16_MAX
+#define	UINT16_MAX	TYPE_MAXVAL(UInt16_t)
+#endif
+
+#ifndef	INT32_MIN
+#define	INT32_MIN	TYPE_MINVAL(Int32_t)
+#endif
+#ifndef	INT32_MAX
+#define	INT32_MAX	TYPE_MAXVAL(Int32_t)
+#endif
+#ifndef	UINT32_MAX
+#define	UINT32_MAX	TYPE_MAXVAL(UInt32_t)
+#endif
+
+#ifdef	HAVE_INT64_T
+#ifndef	INT64_MIN
+#define	INT64_MIN	TYPE_MINVAL(Int64_t)
+#endif
+#ifndef	INT64_MAX
+#define	INT64_MAX	TYPE_MAXVAL(Int64_t)
+#endif
+#endif
+#ifdef	HAVE_UINT64_T
+#ifndef	UINT64_MAX
+#define	UINT64_MAX	TYPE_MAXVAL(UInt64_t)
+#endif
+#endif
+
+#ifndef	INTMAX_MIN
+#define	INTMAX_MIN	TYPE_MINVAL(Intmax_t)
+#endif
+#ifndef	INTMAX_MAX
+#define	INTMAX_MAX	TYPE_MAXVAL(Intmax_t)
+#endif
+#ifndef	UINTMAX_MAX
+#define	UINTMAX_MAX	TYPE_MAXVAL(UIntmax_t)
+#endif
+
 #endif	/* _UTYPES_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/include/vadefs.h cdrdao-1.1.5/scsilib/include/vadefs.h
--- cdrdao-1.1.5.orig/scsilib/include/vadefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/vadefs.h	2001-07-15 09:11:21.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)vadefs.h	1.4 99/11/27 Copyright 1998 J. Schilling */
+/* @(#)vadefs.h	1.5 01/07/15 Copyright 1998 J. Schilling */
 /*
  *	Generic header for users of var args ...
  *
@@ -36,18 +36,30 @@
  * For ANSI C-compilers prefer stdarg.h
  */
 #	ifdef	HAVE_STDARG_H
+#		ifndef	_INCL_STDARG_H
 #		include <stdarg.h>
+#		define	_INCL_STDARG_H
+#		endif
 #	else
+#		ifndef	_INCL_VARARGS_H
 #		include <varargs.h>
+#		define	_INCL_VARARGS_H
+#		endif
 #	endif
 #else
 /*
  * For K&R C-compilers prefer varargs.h
  */
 #	ifdef	HAVE_VARARGS_H
+#		ifndef	_INCL_VARARGS_H
 #		include <varargs.h>
+#		define	_INCL_VARARGS_H
+#		endif
 #	else
+#		ifndef	_INCL_STDARG_H
 #		include <stdarg.h>
+#		define	_INCL_STDARG_H
+#		endif
 #	endif
 #endif
 
diff -ruN cdrdao-1.1.5.orig/scsilib/include/waitdefs.h cdrdao-1.1.5/scsilib/include/waitdefs.h
--- cdrdao-1.1.5.orig/scsilib/include/waitdefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/include/waitdefs.h	2001-07-15 09:11:22.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)waitdefs.h	1.8 00/11/08 Copyright 1995 J. Schilling */
+/* @(#)waitdefs.h	1.9 01/07/15 Copyright 1995 J. Schilling */
 /*
  *	Definitions to deal with various kinds of wait flavour
  *
@@ -28,14 +28,20 @@
 #endif
 
 #if	defined(HAVE_WAIT_H)
+#	ifndef	_INCL_WAIT_H
 #	include <wait.h>
+#	define	_INCL_WAIT_H
+#	endif
 #else
 /*
  * K&R Compiler doesn't like #elif
  */
 #	if	defined(HAVE_SYS_WAIT_H)	/* POSIX.1 compat sys/wait.h */
 #	undef	HAVE_UNION_WAIT			/* POSIX.1 doesn't use U_W   */
+#		ifndef	_INCL_SYS_WAIT_H
 #		include <sys/wait.h>
+#		define	_INCL_SYS_WAIT_H
+#		endif
 #	endif
 #endif
 
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/Makefile cdrdao-1.1.5/scsilib/lib/Makefile
--- cdrdao-1.1.5.orig/scsilib/lib/Makefile	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/Makefile	1969-12-31 19:00:00.000000000 -0500
@@ -1,13 +0,0 @@
-#ident "%W% %E% %Q%"
-###########################################################################
-SRCROOT=	..
-RULESDIR=	RULES
-include		$(SRCROOT)/$(RULESDIR)/rules.top
-###########################################################################
-
-#MK_FILES= libschily.mk libschily_p.mk shlschily.mk
-MK_FILES= libschily.mk
-
-###########################################################################
-include		$(SRCROOT)/$(RULESDIR)/rules.mks
-###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/Makefile.off cdrdao-1.1.5/scsilib/lib/Makefile.off
--- cdrdao-1.1.5.orig/scsilib/lib/Makefile.off	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/lib/Makefile.off	2001-05-01 16:32:26.000000000 -0400
@@ -0,0 +1,14 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Sample makefile for sub directory makes
+###########################################################################
+SRCROOT=	..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+include		Targetdirs
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.dir
+###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/Targets cdrdao-1.1.5/scsilib/lib/Targets
--- cdrdao-1.1.5.orig/scsilib/lib/Targets	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/Targets	1969-12-31 19:00:00.000000000 -0500
@@ -1,35 +0,0 @@
-CFILES_STDIO=	cvmod.c dat.c \
-		fcons.c \
-		fgetline.c \
-		fileopen.c \
-		fileread.c filewrite.c flag.c flush.c \
-		niread.c \
-		fcons64.c fileopen64.c
-
-#
-# Note: getfp.c must be before getav0.c
-# Otherwise getfp.o would be made as dependency of avoffset
-#
-
-CFILES_REST=	astoi.c astoll.c \
-		comerr.c \
-		cmpbytes.c \
-		error.c \
-		fconv.c \
-		fillbytes.c \
-		format.c \
-		getfp.c \
-		getdomainname.c gethostid.c gethostname.c \
-		getargs.c getav0.c geterrno.c \
-		jsprintf.c jssnprintf.c jssprintf.c \
-		match.c movebytes.c \
-		printf.c \
-		raisecond.c \
-		saveargs.c \
-		serrmsg.c \
-		seterrno.c \
-		sprintf.c \
-		streql.c swabbytes.c \
-		usleep.c
-
-CFILES=		$(CFILES_STDIO) $(CFILES_REST)
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/astoi.c cdrdao-1.1.5/scsilib/lib/astoi.c
--- cdrdao-1.1.5.orig/scsilib/lib/astoi.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/astoi.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,123 +0,0 @@
-/* @(#)astoi.c	1.6 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	astoi() converts a string to int
- *	astol() converts a string to long
- *
- *	Leading tabs and spaces are ignored.
- *	Both return pointer to the first char that has not been used.
- *	Caller must check if this means a bad conversion.
- *
- *	leading "+" is ignored
- *	leading "0"  makes conversion octal (base 8)
- *	leading "0x" makes conversion hex   (base 16)
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <standard.h>
-#include <schily.h>
-
-#define is_space(c)	 ((c) == ' ' || (c) == '\t')
-#define is_digit(c)	 ((c) >= '0' && (c) <= '9')
-#define is_hex(c)	(((c) >= 'a' && (c) <= 'f') || \
-			 ((c) >= 'A' && (c) <= 'F'))
-
-#define to_lower(c)	(((c) >= 'A' && (c) <= 'Z') ? (c) - 'A'+'a' : (c))
-
-#ifdef	notdef
-int atoi(s)
-	char	*s;
-{
-	long	l;
-
-	(void)astol(s, &l);
-	return (int) l;
-}
-
-long atol(s)
-	char	*s;
-{
-	long	l;
-
-	(void)astol(s, &l);
-	return l;
-}
-#endif
-
-char *astoi(s, i)
-	const char *s;
-	int *i;
-{
-	long l;
-	char *ret;
-
-	ret = astol(s, &l);
-	*i = l;
-	return(ret);
-}
-
-char *astol(s, l)
-	register const char *s;
-	long *l;
-{
-	int neg = 0;
-	register long ret = 0L;
-	register int base = 10;
-	register int digit;
-	register char c;
-	
-	while (is_space(*s))
-		s++;
-
-	if (*s == '+') {
-		s++;
-	} else if (*s == '-') {
-		s++;
-		neg++;
-	}
-
-	if (*s == '0') {
-		base = 8;
-		s++;
-		if (*s == 'x' || *s == 'X') {
-			s++;
-			base = 16;
-		}
-	}
-	for (;(c = *s) != 0; s++) {
-
-		if (is_digit(c)) {
-			digit = c - '0';
-		} else if (is_hex(c)) {
-			digit = to_lower(c) - 'a' + 10;
-		} else {
-			break;
-		}
-
-		if (digit < base) {
-			ret *= base;
-			ret += digit;
-		} else {
-			break;
-		}
-	}
-	if (neg)
-		ret = -ret;
-	*l = ret;
-	return ((char *)s);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/astoll.c cdrdao-1.1.5/scsilib/lib/astoll.c
--- cdrdao-1.1.5.orig/scsilib/lib/astoll.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/astoll.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,95 +0,0 @@
-/* @(#)astoll.c	1.1 00/12/03 Copyright 1985,2000 J. Schilling */
-/*
- *	astoll() converts a string to long long
- *
- *	Leading tabs and spaces are ignored.
- *	Both return pointer to the first char that has not been used.
- *	Caller must check if this means a bad conversion.
- *
- *	leading "+" is ignored
- *	leading "0"  makes conversion octal (base 8)
- *	leading "0x" makes conversion hex   (base 16)
- *
- *	Llong is silently reverted to long if the compiler does not
- *	support long long.
- *
- *	Copyright (c) 1985,2000 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <standard.h>
-#include <utypes.h>
-#include <schily.h>
-
-#define is_space(c)	 ((c) == ' ' || (c) == '\t')
-#define is_digit(c)	 ((c) >= '0' && (c) <= '9')
-#define is_hex(c)	(((c) >= 'a' && (c) <= 'f') || \
-			 ((c) >= 'A' && (c) <= 'F'))
-
-#define to_lower(c)	(((c) >= 'A' && (c) <= 'Z') ? (c) - 'A'+'a' : (c))
-
-char *astoll(s, l)
-	register const char *s;
-	Llong *l;
-{
-	int neg = 0;
-	register Llong ret = (Llong)0;
-	register int base = 10;
-	register int digit;
-	register char c;
-	
-	while (is_space(*s))
-		s++;
-
-	if (*s == '+') {
-		s++;
-	} else if (*s == '-') {
-		s++;
-		neg++;
-	}
-
-	if (*s == '0') {
-		base = 8;
-		s++;
-		if (*s == 'x' || *s == 'X') {
-			s++;
-			base = 16;
-		}
-	}
-	for (;(c = *s) != 0; s++) {
-
-		if (is_digit(c)) {
-			digit = c - '0';
-		} else if (is_hex(c)) {
-			digit = to_lower(c) - 'a' + 10;
-		} else {
-			break;
-		}
-
-		if (digit < base) {
-			ret *= base;
-			ret += digit;
-		} else {
-			break;
-		}
-	}
-	if (neg)
-		ret = -ret;
-	*l = ret;
-	return ((char *)s);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/cmpbytes.c cdrdao-1.1.5/scsilib/lib/cmpbytes.c
--- cdrdao-1.1.5.orig/scsilib/lib/cmpbytes.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/cmpbytes.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,103 +0,0 @@
-/* @(#)cmpbytes.c	1.13 00/05/07 Copyright 1988 J. Schilling */
-#ifndef lint
-static	char sccsid[] =
-	"@(#)cmpbytes.c	1.13 00/05/07 Copyright 1988 J. Schilling";
-#endif  /* lint */
-/*
- *	compare data
- *
- *	Copyright (c) 1988 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <standard.h>
-#include <align.h>
-#include <schily.h>
-
-#define	DO8(a)	a;a;a;a;a;a;a;a;
-
-int cmpbytes(fromp, top, cnt)
-	const void	*fromp;
-	const void	*top;
-	int		cnt;
-{
-	register const char	*from	= (char *)fromp;
-	register const char	*to	= (char *)top;
-	register int		n;
-
-	/*
-	 * If we change cnt to be unsigned, check for == instead of <=
-	 */
-	if ((n = cnt) <= 0)
-		return (cnt);
-
-	if (n >= (int)(8 * sizeof(long))) {
-		if (l2aligned(from, to)) {
-			register const long *froml = (const long *)from;
-			register const long *tol   = (const long *)to;
-			register int rem = n % (8 * sizeof (long));
-
-			n /= (8 * sizeof (long));
-			do {
-				DO8 (
-					if (*tol++ != *froml++)
-						break;
-				);
-			} while (--n > 0);
-
-			if (n > 0) {
-				--froml;
-				--tol;
-				to = (const char *)tol;
-				from = (const char *)froml;
-				goto ldiff;
-			}
-			to = (const char *)tol;
-			from = (const char *)froml;
-			n = rem;
-		}
-
-		if (n >= 8) {
-			n -= 8;
-			do {
-				DO8 (
-					if (*to++ != *from++)
-						goto cdiff;
-				);
-			} while ((n -= 8) >= 0);
-			n += 8;
-		}
-		if (n > 0) do {
-			if (*to++ != *from++)
-				goto cdiff;
-		} while (--n > 0);
-		return (cnt);
-	}
-	if (n > 0) do {
-		if (*to++ != *from++)
-			goto cdiff;
-	} while (--n > 0);
-	return (cnt);
-ldiff:
-	n = sizeof(long);
-	do {
-		if (*to++ != *from++)
-			goto cdiff;
-	} while (--n > 0);
-cdiff:
-	return (--from - (char *)fromp);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/comerr.c cdrdao-1.1.5/scsilib/lib/comerr.c
--- cdrdao-1.1.5.orig/scsilib/lib/comerr.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/comerr.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,211 +0,0 @@
-/* @(#)comerr.c	1.23 00/08/02 Copyright 1985 J. Schilling */
-/*
- *	Routines for printing command errors
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <stdio.h>
-#include <standard.h>
-#include <stdxlib.h>
-#include <vadefs.h>
-#include <strdefs.h>
-#include <schily.h>
-#ifndef	HAVE_STRERROR
-extern	char	*sys_errlist[];
-extern	int	sys_nerr;
-#endif
-
-EXPORT	int	on_comerr	__PR((void (*fun)(int, void *), void *arg));
-EXPORT	void	comerr		__PR((const char *, ...));
-EXPORT	void	comerrno	__PR((int, const char *, ...));
-EXPORT	int	errmsg		__PR((const char *, ...));
-EXPORT	int	errmsgno	__PR((int, const char *, ...));
-LOCAL	int	_comerr		__PR((int, int, const char *, va_list));
-EXPORT	void	comexit		__PR((int));
-EXPORT	char	*errmsgstr	__PR((int));
-
-typedef	struct ex {
-	struct ex *next;
-	void	(*func) __PR((int, void *));
-	void	*arg;
-} ex_t;
-
-LOCAL	ex_t	*exfuncs;
-
-EXPORT	int
-on_comerr(func, arg)
-	void	(*func) __PR((int, void *));
-	void	*arg;
-{
-	ex_t	*fp;
-
-	fp = malloc(sizeof(*fp));
-	if (fp == NULL)
-		return (-1);
-
-	fp->func = func;
-	fp->arg  = arg;
-	fp->next = exfuncs;
-	exfuncs = fp;
-	return (0);
-}
-
-/* VARARGS1 */
-#ifdef	PROTOTYPES
-void comerr(const char *msg, ...)
-#else
-void comerr(msg, va_alist)
-	char	*msg;
-	va_dcl
-#endif
-{
-	va_list	args;
-
-#ifdef	PROTOTYPES
-	va_start(args, msg);
-#else
-	va_start(args);
-#endif
-	(void)_comerr(TRUE, geterrno(), msg, args);
-	/* NOTREACHED */
-	va_end(args);
-}
-
-/* VARARGS2 */
-#ifdef	PROTOTYPES
-void comerrno(int err, const char *msg, ...)
-#else
-void comerrno(err, msg, va_alist)
-	int	err;
-	char	*msg;
-	va_dcl
-#endif
-{
-	va_list	args;
-
-#ifdef	PROTOTYPES
-	va_start(args, msg);
-#else
-	va_start(args);
-#endif
-	(void)_comerr(TRUE, err, msg, args);
-	/* NOTREACHED */
-	va_end(args);
-}
-
-/* VARARGS1 */
-#ifdef	PROTOTYPES
-int errmsg(const char *msg, ...)
-#else
-int errmsg(msg, va_alist)
-	char	*msg;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	ret;
-
-#ifdef	PROTOTYPES
-	va_start(args, msg);
-#else
-	va_start(args);
-#endif
-	ret = _comerr(FALSE, geterrno(), msg, args);
-	va_end(args);
-	return (ret);
-}
-
-/* VARARGS2 */
-#ifdef	PROTOTYPES
-int errmsgno(int err, const char *msg, ...)
-#else
-int errmsgno(err, msg, va_alist)
-	int	err;
-	char	*msg;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	ret;
-
-#ifdef	PROTOTYPES
-	va_start(args, msg);
-#else
-	va_start(args);
-#endif
-	ret = _comerr(FALSE, err, msg, args);
-	va_end(args);
-	return (ret);
-}
-
-LOCAL int _comerr(exflg, err, msg, args)
-	int		exflg;
-	int		err;
-	const char	*msg;
-	va_list		args;
-{
-	char	errbuf[20];
-	char	*errnam;
-	char	*prognam = get_progname();
-	
-	if (err < 0) {
-		error("%s: %r", prognam, msg, args);
-	} else {
-		errnam = errmsgstr(err);
-		if (errnam == NULL) {
-			(void)js_snprintf(errbuf, sizeof (errbuf),
-						"Error %d", err);
-			errnam = errbuf;
-		}
-		error("%s: %s. %r", prognam, errnam, msg, args);
-	}
-	if (exflg) {
-		comexit(err);
-		/* NOTREACHED */
-	}
-	return(err);
-}
-
-EXPORT void
-comexit(err)
-	int	err;
-{
-	while (exfuncs) {
-		(*exfuncs->func)(err, exfuncs->arg);
-		exfuncs = exfuncs->next;
-	}
-	exit(err);
-	/* NOTREACHED */
-}
-
-EXPORT char *
-errmsgstr(err)
-	int	err;
-{
-#ifdef	HAVE_STRERROR
-	return (strerror(err));
-#else
-	if (err < 0 || err >= sys_nerr) {
-		return (NULL);
-	} else {
-		return (sys_errlist[err]);
-	}
-#endif
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/cvt.c cdrdao-1.1.5/scsilib/lib/cvt.c
--- cdrdao-1.1.5.orig/scsilib/lib/cvt.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/cvt.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,241 +0,0 @@
-/* @(#)cvt.c	1.4 01/02/23 Copyright 1998 J. Schilling */
-/*
- *	Compatibility routines for 4.4BSD based C-libraries ecvt()/fcvt()
- *	and a working gcvt() that is needed on 4.4BSD and GNU libc systems.
- *
- *	On 4.4BSD, gcvt() is missing, the gcvt() implementation from GNU libc
- *	is not working correctly.
- *
- *	Neither __dtoa() nor [efg]cvt() are MT safe.
- *
- *	Copyright (c) 1998 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <stdxlib.h>
-#include <utypes.h>
-#include <standard.h>
-
-#ifdef	HAVE_DTOA	/* 4.4BSD floating point implementation */
-#ifdef	HAVE_DTOA_R
-extern	char *__dtoa	__PR((double value, int mode, int ndigit, int *decpt, int *sign, char **ep, char **resultp));
-#else
-extern	char *__dtoa	__PR((double value, int mode, int ndigit, int *decpt, int *sign, char **ep));
-#endif
-#endif
-
-#ifndef	HAVE_ECVT
-EXPORT	char *ecvt	__PR((double value, int ndigit, int *decpt, int *sign));
-#endif
-#ifndef	HAVE_FCVT
-EXPORT	char *fcvt	__PR((double value, int ndigit, int *decpt, int *sign));
-#endif
-#ifndef	HAVE_GCVT
-EXPORT	char *gcvt	__PR((double value, int ndigit, char *buf));
-#endif
-
-#if	!defined(HAVE_ECVT) && defined(HAVE_DTOA)
-#define	HAVE_ECVT
-char *
-ecvt(value, ndigit, decpt, sign)
-	double	value;
-	int	ndigit;
-	int	*decpt;
-	int	*sign;
-{
-static	Uint	bufsize;
-static	char	*buf;
-	char	*bufend;
-	char	*ep;
-	char	*bp;
-#ifdef	HAVE_DTOA_R
-static	char	*result;
-#endif
-
-#ifdef	HAVE_DTOA_R
-	if (result) {
-		free(result);
-		result = NULL;
-	}
-	bp = __dtoa(value, 2, ndigit, decpt, sign, &ep, &result);
-#else
-	bp = __dtoa(value, 2, ndigit, decpt, sign, &ep);
-#endif
-
-	if (value == 0.0) {
-		/*
-		 * Handle __dtoa()'s deviation from ecvt():
-		 * 0.0 is converted to "0" instead of 'ndigit' zeroes.
-		 * The string "0" is not allocated, so
-		 * we need to allocate buffer to hold 'ndigit' zeroes.
-		 */
-		if (bufsize < ndigit + 1) {
-			if (buf != (char *)0)
-				free(buf);
-			bufsize = ndigit + 1;
-			buf = malloc(bufsize);
-		}
-		ep = bp = buf;
-	}
-
-	/*
-	 * Fill up trailing zeroes suppressed by __dtoa()
-	 * From an internal __dtoa() comment:
-	 *	Sufficient space is allocated to the return value
-	 *	to hold the suppressed trailing zeros.
-	 */
-	for (bufend = &bp[ndigit]; ep < bufend; )
-		*ep++ = '0';
-	*ep = '\0';
-
-	return (bp);
-}
-#endif
-
-#if	!defined(HAVE_FCVT) && defined(HAVE_DTOA)
-#define	HAVE_FCVT
-char *
-fcvt(value, ndigit, decpt, sign)
-	double	value;
-	int	ndigit;
-	int	*decpt;
-	int	*sign;
-{
-static	Uint	bufsize;
-static	char	*buf;
-	char	*bufend;
-	char	*ep;
-	char	*bp;
-#ifdef	HAVE_DTOA_R
-static	char	*result;
-#endif
-
-#ifdef	HAVE_DTOA_R
-	if (result) {
-		free(result);
-		result = NULL;
-	}
-	bp = __dtoa(value, 3, ndigit, decpt, sign, &ep, &result);
-#else
-	bp = __dtoa(value, 3, ndigit, decpt, sign, &ep);
-#endif
-
-	if (value == 0.0) {
-		/*
-		 * Handle __dtoa()'s deviation from fcvt():
-		 * 0.0 is converted to "0" instead of 'ndigit' zeroes.
-		 * The string "0" is not allocated, so
-		 * we need to allocate buffer to hold 'ndigit' zeroes.
-		 */
-		if (bufsize < ndigit + 1) {
-			if (buf != (char *)0)
-				free(buf);
-			bufsize = ndigit + 1;
-			buf = malloc(bufsize);
-		}
-		ep = bp = buf;
-		*decpt = 0;
-	}
-
-	/*
-	 * Fill up trailing zeroes suppressed by __dtoa()
-	 * From an internal __dtoa() comment:
-	 *	Sufficient space is allocated to the return value
-	 *	to hold the suppressed trailing zeros.
-	 */
-	for (bufend = &bp[*decpt + ndigit]; ep < bufend; )
-		*ep++ = '0';
-	*ep = '\0';
-
-	return (bp);
-}
-#endif
-
-#ifndef	HAVE_GCVT
-#define	HAVE_GCVT
-char *
-gcvt(number, ndigit, buf)
-	double	number;
-	int	ndigit;
-	char	*buf;
-{
-		 int	sign;
-		 int	decpt;
-	register char	*b;
-	register char	*rs;
-	register int	i;
-
-	b = ecvt(number, ndigit, &decpt, &sign);
-	rs = buf;
-	if (sign)
-		*rs++ = '-';
-	for (i = ndigit-1; i > 0 && b[i] == '0'; i--)
-		ndigit--;
-#ifdef	V7_FLOATSTYLE
-	if ((decpt >= 0 && decpt-ndigit > 4) ||
-#else
-	if ((decpt >= 0 && decpt-ndigit > 0) ||
-#endif
-	    (decpt < 0 && decpt < -3)) {	/* e-format */
-		decpt--;
-		*rs++ = *b++;
-		*rs++ = '.';
-		for (i = 1; i < ndigit; i++)
-			*rs++ = *b++;
-		*rs++ = 'e';
-		if (decpt < 0) {
-			decpt = -decpt;
-			*rs++ = '-';
-		} else {
-			*rs++ = '+';
-		}
-		if (decpt >= 100) {
-			*rs++ = decpt / 100 + '0';
-			decpt %= 100;
-		}
-		*rs++ = decpt / 10 + '0';
-		*rs++ = decpt % 10 + '0';
-	} else {				/* f-format */
-		if (decpt <= 0) {
-			if (*b != '0') {
-#ifndef	V7_FLOATSTYLE
-				*rs++ = '0';
-#endif
-				*rs++ = '.';
-			}
-			while (decpt < 0) {
-				decpt++;
-				*rs++ = '0';
-			}
-		}
-		for (i = 1; i <= ndigit; i++) {
-			*rs++ = *b++;
-			if (i == decpt)
-				*rs++ = '.';
-		}
-		if (ndigit < decpt) {
-			while (ndigit++ < decpt)
-				*rs++ = '0';
-			*rs++ = '.';
-		}
-	}
-	if (rs[-1] == '.')
-		rs--;
-	*rs = '\0';
-	return (buf);
-}
-#endif
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/error.c cdrdao-1.1.5/scsilib/lib/error.c
--- cdrdao-1.1.5.orig/scsilib/lib/error.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/error.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,49 +0,0 @@
-/* @(#)error.c	1.12 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	fprintf() on standard error stdio stream
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <stdio.h>
-#include <standard.h>
-#include <vadefs.h>
-#include <schily.h>
-
-/* VARARGS1 */
-#ifdef	PROTOTYPES
-int error(const char *fmt, ...)
-#else
-int error(fmt, va_alist)
-	char	*fmt;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	ret;
-
-#ifdef	PROTOTYPES
-	va_start(args, fmt);
-#else
-	va_start(args);
-#endif
-	ret = js_fprintf(stderr, "%r", fmt, args);
-	va_end(args);
-	return (ret);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/fconv.c cdrdao-1.1.5/scsilib/lib/fconv.c
--- cdrdao-1.1.5.orig/scsilib/lib/fconv.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/fconv.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,264 +0,0 @@
-/* @(#)fconv.c	1.29 01/03/04 Copyright 1985 J. Schilling */
-/*
- *	Convert floating point numbers to strings for format.c
- *	Should rather use the MT-safe routines [efg]convert()
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>	/* <- may define NO_FLOATINGPOINT */
-#ifndef	NO_FLOATINGPOINT
-
-#include <stdxlib.h>
-#include <standard.h>
-#include <strdefs.h>
-#include <schily.h>
-
-#if	!defined(HAVE_STDLIB_H) || defined(HAVE_DTOA)
-extern	char	*ecvt __PR((double, int, int *, int *));
-extern	char	*fcvt __PR((double, int, int *, int *));
-#endif
-
-#if	defined(HAVE_ISNAN) && defined(HAVE_ISINF)
-/*
- * *BSD alike libc
- */
-#define	FOUND_ISXX
-#endif
-
-#include <math.h>
-
-#if	defined(HAVE_FP_H)  && !defined(FOUND_ISXX)
-/*
- * WAS:
- * #if	defined(__osf__) || defined(_IBMR2) || defined(_AIX)
- */
-/*
- * Moved before HAVE_IEEEFP_H for True64 due to a hint
- * from Bert De Knuydt <Bert.Deknuydt@esat.kuleuven.ac.be>
- *
- * True64 has both fp.h & ieeefp.h but the functions
- * isnand() & finite() seem to be erreneously not implemented
- * as a macro and the function lives in libm.
- * Let's hope that we will not get problems with the new order.
- */
-#include <fp.h> 
-#ifndef	isnan
-#define	isnan	IS_NAN
-#endif
-#ifndef	isinf
-#define	isinf	!FINITE
-/*#define	isinf	IS_INF*/
-#endif
-#define	FOUND_ISXX
-#endif 
-
-#if	defined(HAVE_IEEEFP_H) && !defined(FOUND_ISXX)
-/*
- * SVR4
- */
-#include <ieeefp.h>
-#define	isnan	isnand
-#define	isinf	!finite
-#define	FOUND_ISXX
-#endif
-
-/*
- * WAS:
- * #if	defined(__hpux) || defined(VMS) || defined(_SCO_DS) || defined(__QNX__)
- */
-#if	defined(__hpux)
-#undef	isnan
-#undef	isinf
-#endif
-
-#if	!defined(isnan) && !defined(HAVE_ISNAN)
-#define	isnan(val)	(0)
-#endif
-#if	!defined(isinf) && !defined(HAVE_ISINF)
-#define	isinf(val)	(0)
-#endif
-
-#if !defined(HAVE_ECVT) || !defined(HAVE_FCVT) || !defined(HAVE_GCVT)
-#include "cvt.c"
-#endif
-
-static	char	_nan[] = "(NaN)";
-static	char	_inf[] = "(Infinity)";
-
-static	int	_ferr __PR((char *, double));
-
-#ifdef	abs
-#	undef	abs
-#endif
-#define	abs(i)	((i) < 0 ? -(i) : (i))
-
-EXPORT int
-ftoes(s, val, fieldwidth, ndigits)
-	register	char 	*s;
-			double	val;
-	register	int	fieldwidth;
-	register	int	ndigits;
-{
-	register	char	*b;
-	register	char	*rs;
-	register	int	len;
-	register	int	rdecpt;
-			int 	decpt;
-			int	sign;
-
-	if ((len = _ferr(s, val)) > 0)
-		return len;
-	rs = s;
-#ifdef	V7_FLOATSTYLE
-	b = ecvt(val, ndigits, &decpt, &sign);
-	rdecpt = decpt;
-#else
-	b = ecvt(val, ndigits+1, &decpt, &sign);
-	rdecpt = decpt-1;
-#endif
-	len = ndigits + 6;			/* Punkt e +/- nnn */
-	if (sign)
-		len++;
-	if (fieldwidth > len)
-		while (fieldwidth-- > len)
-			*rs++ = ' ';
-	if (sign)
-		*rs++ = '-';
-#ifndef	V7_FLOATSTYLE
-	if (*b)
-		*rs++ = *b++;
-#endif
-	*rs++ = '.';
-	while (*b && ndigits-- > 0)
-		*rs++ = *b++;
-	*rs++ = 'e';
-	*rs++ = rdecpt >= 0 ? '+' : '-';
-	rdecpt = abs(rdecpt);
-#ifndef	V7_FLOATSTYLE
-	if (rdecpt >= 100)
-#endif
-	{
-		*rs++ = rdecpt / 100 + '0';
-		rdecpt %= 100;
-	}
-	*rs++ = rdecpt / 10 + '0';
-	*rs++ = rdecpt % 10 + '0';
-	*rs = '\0';
-	return rs - s;
-}
-
-/*
- * fcvt() from Cygwin32 is buggy.
- */
-#if	!defined(HAVE_FCVT) && defined(HAVE_ECVT)
-#define	USE_ECVT
-#endif
-
-EXPORT int
-ftofs(s, val, fieldwidth, ndigits)
-	register	char 	*s;
-			double	val;
-	register	int	fieldwidth;
-	register	int	ndigits;
-{
-	register	char	*b;
-	register	char	*rs;
-	register	int	len;
-	register	int	rdecpt;
-			int 	decpt;
-			int	sign;
-
-	if ((len = _ferr(s, val)) > 0)
-		return len;
-	rs = s;
-#ifdef	USE_ECVT
-	/*
-	 * Needed on systems with broken fcvt() implementation
-	 * (e.g. Cygwin32)
-	 */
-	b = ecvt(val, ndigits, &decpt, &sign);
-	/*
-	 * The next call is needed to force higher precision.
-	 */
-	if (decpt > 0)
-		b = ecvt(val, ndigits+decpt, &decpt, &sign);
-#else
-	b = fcvt(val, ndigits, &decpt, &sign);
-#endif
-	rdecpt = decpt;
-	len = rdecpt + ndigits + 1;
-	if (rdecpt < 0)
-		len -= rdecpt;
-	if (sign)
-		len++;
-	if (fieldwidth > len)
-		while (fieldwidth-- > len)
-			*rs++ = ' ';
-	if (sign)
-		*rs++ = '-';
-	if (rdecpt > 0) {
-		len = rdecpt;
-		while (*b && len-- > 0)
-			*rs++ = *b++;
-#ifdef	USE_ECVT
-		while (len-- > 0)
-			*rs++ = '0';
-#endif
-	}
-#ifndef	V7_FLOATSTYLE
-	else {
-		*rs++ = '0';
-	}
-#endif
-	*rs++ = '.';
-	if (rdecpt < 0) {
-		len = rdecpt;
-		while (len++ < 0 && ndigits-- > 0)
-			*rs++ = '0';
-	}
-	while (*b && ndigits-- > 0)
-		*rs++ = *b++;
-#ifdef	USE_ECVT
-	while (ndigits-- > 0)
-		*rs++ = '0';
-#endif
-	*rs = '\0';
-	return rs - s;
-}
-
-LOCAL int
-_ferr(s, val)
-	char	*s;
-	double	val;
-{
-	if (isnan(val)){
-		strcpy(s, _nan);
-		return (sizeof (_nan) - 1);
-	}
-
-	/*
-	 * Check first for NaN because finite() will return 1 on Nan too.
-	 */
-	if (isinf(val)){
-		strcpy(s, _inf);
-		return (sizeof (_inf) - 1);
-	}
-	return 0;
-}
-#endif	/* NO_FLOATINGPOINT */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/fillbytes.c cdrdao-1.1.5/scsilib/lib/fillbytes.c
--- cdrdao-1.1.5.orig/scsilib/lib/fillbytes.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/fillbytes.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,94 +0,0 @@
-/* @(#)fillbytes.c	1.11 00/05/07 Copyright 1987 J. Schilling */
-/*
- *	fill memory with data
- *
- *	Copyright (c) 1987 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <standard.h>
-#include <align.h>
-#include <schily.h>
-
-#define	DO8(a)	a;a;a;a;a;a;a;a;
-
-#define	cval	((char) lval)
-
-#ifdef	PROTOTYPES
-char *fillbytes(void *tov, int cnt, char val)
-#else
-char *fillbytes(tov, cnt, val)
-	void	*tov;
-	int	cnt;
-	char	val;
-#endif
-{
-	register char	*to = (char *)tov;
-	register int	n;
-	register long	lval;
-
-	/*
-	 * If we change cnt to be unsigned, check for == instead of <=
-	 */
-	if ((n = cnt) <= 0)
-		return (to);
-
-	lval = val & 0xFF;
-
-	while (!laligned(to)) {
-		*to++ = cval;
-		n--;
-	}
-
-	if (n >= (int)(8 * sizeof(long))) {
-		register int rem = n % (8 * sizeof (long));
-
-		lval |= (lval<<8);
-		lval |= (lval<<16);
-#if SIZE_LONG > SIZE_INT
-		lval |= (lval<<32);
-#endif
-
-		n /= (8 * sizeof (long));
-		{
-			register long *tol = (long *)to;
-
-			do {
-				DO8 (*tol++ = lval);
-			} while (--n > 0);
-
-			to = (char *)tol;
-		}
-		n = rem;
-
-		if (n >= 8) {
-			n -= 8;
-			do {
-				DO8 (*to++ = cval);
-			} while ((n -= 8) >= 0);
-			n += 8;
-		}
-		if (n > 0) do {
-			*to++ = cval;
-		} while (--n > 0);
-		return (to);
-	}
-	if (n > 0) do {
-		*to++ = cval;
-	} while (--n > 0);
-	return (to);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/format.c cdrdao-1.1.5/scsilib/lib/format.c
--- cdrdao-1.1.5.orig/scsilib/lib/format.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/format.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,894 +0,0 @@
-/* @(#)format.c	1.35 01/02/26 Copyright 1985 J. Schilling */
-/*
- *	format
- *	common code for printf fprintf & sprintf
- *
- *	allows recursive printf with "%r", used in:
- *	error, comerr, comerrno, errmsg, errmsgno and the like
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <vadefs.h>
-#include <strdefs.h>
-#include <stdxlib.h>
-#if	!defined(HAVE_STDLIB_H) || !defined(HAVE_GCVT)
-extern	char	*gcvt __PR((double, int, char *));
-#endif
-#include <standard.h>
-#include <utypes.h>
-#include <schily.h>
-
-/*
- * As Llong is currently a 'best effort' long long, we usually need to
- * include long long print formats.
- * This may go away, if we implement maxint_t formats.
- */
-#define	USE_LONGLONG
-
-#ifdef	NO_LONGLONG
-#undef	USE_LONGLONG
-#endif
-
-/*
- * Some CPU's (e.g. PDP-11) cannot do logical shifts.
- * They use rotate instead. Masking the low bits before,
- * makes rotate work too.
- */
-#define	allmask(t)	((unsigned t)~((unsigned t)0))
-#define	lowmask(t, x)	((unsigned t)~((unsigned t)((1 << (x))-1) ))
-#define	rshiftmask(t, s)((allmask(t) & lowmask(t, s)) >> (s))
-
-#define	CHARMASK	makemask(char)
-#define	SHORTMASK	makemask(short)
-#define	INTMASK		makemask(int)
-#define	LONGMASK	makemask(long)
-
-#ifdef	DIVLBYS
-extern	long	divlbys();
-extern	long	modlbys();
-#else
-#define	divlbys(val, base)	((val)/(base))
-#define	modlbys(val, base)	((val)%(base))
-#endif
-
-/*
- *	We use macros here to avoid the need to link to the international
- *	character routines.
- *	We don't need internationalization for our purpose.
- */
-#define	is_dig(c)	(((c) >= '0') && ((c) <= '9'))
-#define	is_cap(c)	((c) >= 'A' && (c) <= 'Z')
-#define	to_cap(c)	(is_cap(c) ? c : c - 'a' + 'A')
-#define	cap_ty(c)	(is_cap(c) ? 'L' : 'I')
-
-#ifdef	HAVE_LONGLONG
-typedef union {
-	Ullong	ll;
-	Ulong	l[2];
-	char	c[8];
-} quad_u;
-#endif
-
-typedef struct f_args {
-	void  (*outf)__PR((char,long));	/* Func from format(fun, arg)	*/
-	long	farg;			/* Arg from format (fun, arg)	*/
-	int	minusflag;		/* Fieldwidth is negative	*/
-	int	flags;			/* General flags (+-#)		*/
-	int	fldwidth;		/* Field width as in %3d	*/
-	int	signific;		/* Significant chars as in %.4d	*/
-	int	lzero;			/* Left '0' pad flag		*/
-	char	*buf;			/* Out print buffer		*/
-	char	*bufp;			/* Write ptr into buffer	*/
-	char	fillc;			/* Left fill char (' ' or '0')	*/
-	char	*prefix;		/* Prefix to print before buf	*/
-	int	prefixlen;		/* Len of prefix ('+','-','0x')	*/
-} f_args;
-
-#define	MINUSFLG	1	/* '-' flag */
-#define	PLUSFLG		2	/* '+' flag */
-#define	SPACEFLG	4	/* ' ' flag */
-#define	HASHFLG		8	/* '#' flag */
-
-LOCAL	void	prnum  __PR((Ulong, unsigned, f_args *));
-LOCAL	void	prdnum __PR((Ulong, f_args *));
-LOCAL	void	pronum __PR((Ulong, f_args *));
-LOCAL	void	prxnum __PR((Ulong, f_args *));
-LOCAL	void	prXnum __PR((Ulong, f_args *));
-#ifdef	USE_LONGLONG
-LOCAL	void	prlnum  __PR((Ullong, unsigned, f_args *));
-LOCAL	void	prldnum __PR((Ullong, f_args *));
-LOCAL	void	prlonum __PR((Ullong, f_args *));
-LOCAL	void	prlxnum __PR((Ullong, f_args *));
-LOCAL	void	prlXnum __PR((Ullong, f_args *));
-#endif
-LOCAL	int	prbuf  __PR((const char *, f_args *));
-LOCAL	int	prc    __PR((char, f_args *));
-LOCAL	int	prstring __PR((const char *, f_args *));
-
-
-#ifdef	PROTOTYPES
-EXPORT int format(	void (*fun)(char, long),
-			long farg,
-			const char *fmt,
-			va_list args)
-#else
-EXPORT int format(fun, farg, fmt, args)
-	register void	(*fun)();
-	register long	farg;
-	register char	*fmt;
-	va_list		args;
-#endif
-{
-	char buf[512];
-	const char *sfmt;
-	register int unsflag;
-	register long val;
-	register char type;
-	register char mode;
-	register char c;
-	int count;
-	int i;
-	short sh;
-	const char *str;
-	double dval;
-#ifdef	USE_LONGLONG
-	Llong llval = 0;
-#endif
-	Ulong res;
-	char *rfmt;
-	f_args	fa;
-
-	fa.outf = fun;
-	fa.farg = farg;
-	count = 0;
-	/*
-	 * Main loop over the format string.
-	 * Increment and check for end of string is made here.
-	 */
-	for(; *fmt != '\0'; fmt++) {
-		c = *fmt;
-		while (c != '%') {
-			if (c == '\0')
-				return (count);
-			(*fun)(c, farg);
-			c = *(++fmt);
-			count++;
-		}
-
-		/*
-		 * We reached a '%' sign.
-		 */
-		buf[0] = '\0';
-		fa.buf = fa.bufp = buf;
-		fa.minusflag = 0;
-		fa.flags = 0;
-		fa.fldwidth = 0;
-		fa.signific = -1;
-		fa.lzero = 0;
-		fa.fillc = ' ';
-		fa.prefixlen = 0;
-		sfmt = fmt;
-		unsflag = FALSE;
-	newflag:
-		switch (*(++fmt)) {
-
-		case '+':
-			fa.flags |= PLUSFLG;
-			goto newflag;
-
-		case '-':
-			fa.minusflag++;
-			goto newflag;
-
-		case ' ':
-			/*
-			 * If the space and the + flag are present,
-			 * the space flag will be ignored.
-			 */
-			fa.flags |= SPACEFLG;
-			goto newflag;
-
-		case '#':
-			fa.flags |= HASHFLG;
-			goto newflag;
-
-		case '0':
-			/*
-			 * '0' is a flag.
-			 */
-			fa.fillc = '0';
-			goto newflag;
-		}
-		if (*fmt == '*') {
-			fmt++;
-			fa.fldwidth = va_arg(args, int);
-			/*
-			 * A negative fieldwith is a minus flag with a
-			 * positive fieldwidth.
-			 */
-			if (fa.fldwidth < 0) {
-				fa.fldwidth = -fa.fldwidth;
-/*				fa.minusflag ^= 1;*/
-				fa.minusflag = 1;
-			}
-		} else while (c = *fmt, is_dig(c)) {
-			fa.fldwidth *= 10;
-			fa.fldwidth += c - '0';
-			fmt++;
-		}
-		if (*fmt == '.') {
-			fmt++;
-			fa.signific = 0;
-			if (*fmt == '*') {
-				fmt++;
-				fa.signific = va_arg(args, int);
-				if (fa.signific < 0)
-					fa.signific = 0;
-			} else while (c = *fmt, is_dig(c)) {
-				fa.signific *= 10;
-				fa.signific += c - '0';
-				fmt++;
-			}
-		}
-		if (strchr("UCSIL", *fmt)) {
-			/*
-			 * Enhancements to K&R and ANSI:
-			 *
-			 * got a type specifyer
-			 */
-			if (*fmt == 'U') {
-				fmt++;
-				unsflag = TRUE;
-			}
-			if (!strchr("CSILZODX", *fmt)) {
-				/*
-				 * Got only 'U'nsigned specifyer,
-				 * use default type and mode.
-				 */
-				type = 'I';
-				mode = 'D';
-				fmt--;
-			} else if (!strchr("CSIL", *fmt)) {
-				/*
-				 * no type, use default
-				 */
-				type = 'I';
-				mode = *fmt;
-			} else {
-				/*
-				 * got CSIL
-				 */
-				type = *fmt++;
-				if (!strchr("ZODX", mode = *fmt)) {
-					fmt--;
-					mode = 'D';/* default mode */
-				}
-			}
-		} else switch(*fmt) {
-
-		case 'h':
-			type = 'S';		/* convert to type */
-			goto getmode;
-
-		case 'l':
-			type = 'L';		/* convert to type */
-
-		getmode:
-			if (!strchr("udioxX", *(++fmt))) {
-#ifdef	USE_LONGLONG
-				if (*fmt == 'l') {
-					type = 'Q';
-					goto getmode;
-				}
-#endif
-				fmt--;
-				mode = 'D';
-			} else {
-				mode = *fmt;
-				if (mode != 'x')
-					mode = to_cap(mode);
-				if (mode == 'U')
-					unsflag = TRUE;
-				else if (mode == 'I')	/*XXX */
-					mode = 'D';
-			}
-			break;
-		case 'x':
-			mode = 'x';
-			goto havemode;
-		case 'u':
-			unsflag = TRUE;
-		case 'o': case 'O':
-		case 'd': case 'D':
-		case 'i': case 'I':
-		case 'X':
-		case 'z': case 'Z':
-			mode = to_cap(*fmt);
-		havemode:
-			type = cap_ty(*fmt);
-			if (mode == 'I')	/*XXX kann entfallen*/
-				mode = 'D';	/*wenn besseres uflg*/
-			break;
-		case 'p':
-			mode = 'P';
-			type = 'L';
-			break;
-
-		case '%':
-			count += prc('%', &fa);
-			continue;
-		case ' ':
-			count += prbuf("", &fa);
-			continue;
-		case 'c':
-			c = va_arg(args, int);
-			count += prc(c, &fa);
-			continue;
-		case 's':
-			str = va_arg(args, char *);
-			count += prstring(str, &fa);
-			continue;
-		case 'b':
-			str = va_arg(args, char *);
-			fa.signific = va_arg(args, int);
-			count += prstring(str, &fa);
-			continue;
-
-#ifndef	NO_FLOATINGPOINT
-		case 'e':
-			if (fa.signific == -1)
-				fa.signific = 6;
-			dval = va_arg(args, double);
-			ftoes(buf, dval, 0, fa.signific);
-			count += prbuf(buf, &fa);
-			continue;
-		case 'f':
-			if (fa.signific == -1)
-				fa.signific = 6;
-			dval = va_arg(args, double);
-			ftofs(buf, dval, 0, fa.signific);
-			count += prbuf(buf, &fa);
-			continue;
-		case 'g':
-			if (fa.signific == -1)
-				fa.signific = 6;
-			if (fa.signific == 0)
-				fa.signific = 1;
-			dval = va_arg(args, double);
-			gcvt(dval, fa.signific, buf);
-			count += prbuf(buf, &fa);
-			continue;
-#else
-#	ifdef	USE_FLOATINGARGS
-		case 'e':
-		case 'f':
-		case 'g':
-			dval = va_arg(args, double);
-			continue;
-#	endif
-#endif
-
-		case 'r':			/* recursive printf */
-		case 'R':			/* recursive printf */
-			rfmt  = va_arg(args, char *);
-			/*
-			 * I don't know any portable way to get an arbitrary
-			 * C object from a var arg list so I use a
-			 * system-specific routine __va_arg_list() that knows
-			 * if 'va_list' is an array. You will not be able to
-			 * assign the value of __va_arg_list() but it works
-			 * to be used as an argument of a function.
-			 * It is a requirement for recursive printf to be able
-			 * to use this function argument. If your system
-			 * defines va_list to be an array you need to know this
-			 * via autoconf or another mechanism.
-			 * It would be nice to have something like
-			 * __va_arg_list() in stdarg.h
-			 */
-			count += format(fun, farg, rfmt, __va_arg_list(args));
-			continue;
-
-		case 'n':
-			{
-				int	*ip = va_arg(args, int *);
-
-				*ip = count;
-			}
-			continue;
-
-		default:			/* Unknown '%' format */
-			sfmt++;			/* Dont't print '%'   */
-			count += fmt - sfmt;
-			while (sfmt < fmt)
-				(*fun)(*(sfmt++), farg);
-			if (*fmt == '\0') {
-				fmt--;
-				continue;
-			} else {
-				(*fun)(*fmt, farg);
-				count++;
-				continue;
-			}
-		}
-		/*
-		 * print numbers:
-		 * first prepare type 'C'har, 'S'hort, 'I'nt, or 'L'ong
-		 * or 'Q'ad
-		 */
-		switch(type) {
-
-		case 'C':
-			c = va_arg(args, int);
-			val = c;		/* extend sign here */
-			if (unsflag || mode != 'D')
-#ifdef	DO_MASK
-				val &= CHARMASK;
-#else
-				val = (unsigned char)val;
-#endif
-			break;
-		case 'S':
-			sh = va_arg(args, int);
-			val = sh;		/* extend sign here */
-			if (unsflag || mode != 'D')
-#ifdef	DO_MASK
-				val &= SHORTMASK;
-#else
-				val = (unsigned short)val;
-#endif
-			break;
-		case 'I':
-		default:
-			i = va_arg(args, int);
-			val = i;		/* extend sign here */
-			if (unsflag || mode != 'D')
-#ifdef	DO_MASK
-				val &= INTMASK;
-#else
-				val = (unsigned int)val;
-#endif
-			break;
-		case 'P':
-		case 'L':
-			val = va_arg(args, long);
-			break;
-#ifdef	USE_LONGLONG
-		case 'Q':
-			llval = va_arg(args, Llong);
-			val = llval != 0;
-			break;
-#endif
-		}
-
-		/*
-		 * Final print out, take care of mode:
-		 * mode is one of: 'O'ctal, 'D'ecimal, or he'X'
-		 * oder 'Z'weierdarstellung.
-		 */
-		fa.bufp = &buf[sizeof(buf)-1];
-		*--fa.bufp = '\0';
-
-		if (val == 0 && mode != 'D') {
-		printzero:
-			/*
-			 * Printing '0' with fieldwidth 0 results in no chars.
-			 */
-			fa.lzero = -1;
-			if (fa.signific >= 0)
-				fa.fillc = ' ';
-			count += prstring("0", &fa);
-			continue;
-		} else switch(mode) {
-
-		case 'D':
-#ifdef	USE_LONGLONG
-			if (type == 'Q') {
-				if (!unsflag && llval < 0) {
-					fa.prefix = "-";
-					fa.prefixlen = 1;
-					llval = -llval;
-				} else if (fa.flags & PLUSFLG) {
-					fa.prefix = "+";
-					fa.prefixlen = 1;
-				} else if (fa.flags & SPACEFLG) {
-					fa.prefix = " ";
-					fa.prefixlen = 1;
-				}
-				if (llval == 0)
-					goto printzero;
-				goto prunsigned;
-			}
-#endif
-			if (!unsflag && val < 0) {
-				fa.prefix = "-";
-				fa.prefixlen = 1;
-				val = -val;
-			} else if (fa.flags & PLUSFLG) {
-				fa.prefix = "+";
-				fa.prefixlen = 1;
-			} else if (fa.flags & SPACEFLG) {
-				fa.prefix = " ";
-				fa.prefixlen = 1;
-			}
-			if (val == 0)
-				goto printzero;
-		case 'U':
-			/* output a long unsigned decimal number */
-#ifdef	USE_LONGLONG
-		prunsigned:
-			if (type == 'Q')
-				prldnum(llval, &fa);
-			else
-#endif
-			prdnum(val, &fa);
-			break;
-		case 'O':
-			/* output a long octal number */
-			if (fa.flags & HASHFLG) {
-				fa.prefix = "0";
-				fa.prefixlen = 1;
-			}
-#ifdef	USE_LONGLONG
-			if (type == 'Q') {
-				prlonum(llval, &fa);
-			} else
-#endif
-			{
-				pronum(val & 07, &fa);
-				if ((res = (val>>3) & rshiftmask(long, 3)) != 0)
-					pronum(res, &fa);
-			}
-			break;
-		case 'p':
-		case 'x':
-			/* output a hex long */
-			if (fa.flags & HASHFLG) {
-				fa.prefix = "0x";
-				fa.prefixlen = 2;
-			}
-#ifdef	USE_LONGLONG
-			if (type == 'Q')
-				prlxnum(llval, &fa);
-			else
-#endif
-			{
-				prxnum(val & 0xF, &fa);
-				if ((res = (val>>4) & rshiftmask(long, 4)) != 0)
-					prxnum(res, &fa);
-			}
-			break;
-		case 'P':
-		case 'X':
-			/* output a hex long */
-			if (fa.flags & HASHFLG) {
-				fa.prefix = "0X";
-				fa.prefixlen = 2;
-			}
-#ifdef	USE_LONGLONG
-			if (type == 'Q')
-				prlXnum(llval, &fa);
-			else
-#endif
-			{
-				prXnum(val & 0xF, &fa);
-				if ((res = (val>>4) & rshiftmask(long, 4)) != 0)
-					prXnum(res, &fa);
-			}
-			break;
-		case 'Z':
-			/* output a binary long */
-#ifdef	USE_LONGLONG
-			if (type == 'Q')
-				prlnum(llval, 2, &fa);
-			else
-#endif
-			{
-				prnum(val & 0x1, 2, &fa);
-				if ((res = (val>>1) & rshiftmask(long, 1)) != 0)
-					prnum(res, 2, &fa);
-			}
-		}
-		fa.lzero = -1;
-		/*
-		 * If a precision (fielwidth) is specified
-		 * on diouXx conversions, the '0' flag is ignored.
-		 */
-		if (fa.signific >= 0)
-			fa.fillc = ' ';
-		count += prbuf(fa.bufp, &fa);
-	}
-	return (count);
-}
-
-/*
- * Routines to print (not negative) numbers in an arbitrary base
- */
-LOCAL	unsigned char	dtab[]  = "0123456789abcdef";
-LOCAL	unsigned char	udtab[] = "0123456789ABCDEF";
-
-LOCAL void prnum(val, base, fa)
-	register Ulong val;
-	register unsigned base;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = dtab[modlbys(val, base)];
-		val = divlbys(val, base);
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-LOCAL void prdnum(val, fa)
-	register Ulong val;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = dtab[modlbys(val, (unsigned)10)];
-		val = divlbys(val, (unsigned)10);
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-/*
- * We may need to use division here too (PDP-11, non two's complement ...)
- */
-LOCAL void pronum(val, fa)
-	register Ulong val;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = dtab[val & 7];
-		val >>= 3;
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-LOCAL void prxnum(val, fa)
-	register Ulong val;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = dtab[val & 15];
-		val >>= 4;
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-LOCAL void prXnum(val, fa)
-	register Ulong val;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = udtab[val & 15];
-		val >>= 4;
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-#ifdef	USE_LONGLONG
-LOCAL void prlnum(val, base, fa)
-	register Ullong val;
-	register unsigned base;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = dtab[modlbys(val, base)];
-		val = divlbys(val, base);
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-LOCAL void prldnum(val, fa)
-	register Ullong val;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = dtab[val % (unsigned)10];
-		val = val / (unsigned)10;
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-LOCAL void prlonum(val, fa)
-	register Ullong val;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = dtab[val & 7];
-		val >>= 3;
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-LOCAL void prlxnum(val, fa)
-	register Ullong val;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = dtab[val & 15];
-		val >>= 4;
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-LOCAL void prlXnum(val, fa)
-	register Ullong val;
-	f_args *fa;
-{
-	register char *p = fa->bufp;
-
-	do {
-		*--p = udtab[val & 15];
-		val >>= 4;
-	} while (val > 0);
-
-	fa->bufp = p;
-}
-
-#endif
-
-/*
- * Final buffer print out routine.
- */
-LOCAL int prbuf(s, fa)
-	register const char *s;
-	f_args *fa;
-{
-	register int diff;
-	register int rfillc;
-	register long arg			= fa->farg;
-	register void (*fun) __PR((char, long))	= fa->outf;
-	register int count;
-	register int lzero = 0;
-
-	count = strlen(s);
-
-	/*
-	 * lzero becomes the number of left fill chars needed to reach signific
-	 */
-	if (fa->lzero < 0 && count < fa->signific)
-		lzero = fa->signific - count;
-	count += lzero + fa->prefixlen;
-	diff = fa->fldwidth - count;
-	if (diff > 0)
-		count += diff;
-
-	if (fa->prefixlen && fa->fillc != ' ') {
-		while (*fa->prefix != '\0')
-			(*fun)(*fa->prefix++, arg);
-	}
-	if (!fa->minusflag) {
-		rfillc = fa->fillc;
-		while (--diff >= 0)
-			(*fun)(rfillc, arg);
-	}
-	if (fa->prefixlen && fa->fillc == ' ') {
-		while (*fa->prefix != '\0')
-			(*fun)(*fa->prefix++, arg);
-	}
-	if (lzero > 0) {
-		rfillc = '0';
-		while (--lzero >= 0)
-			(*fun)(rfillc, arg);
-	}
-	while (*s != '\0')
-		(*fun)(*s++, arg);
-	if (fa->minusflag) {
-		rfillc = ' ';
-		while (--diff >= 0)
-			(*fun)(rfillc, arg);
-	}
-	return (count);
-}
-
-/*
- * Print out one char, allowing prc('\0')
- * Similar to prbuf()
- */
-#ifdef	PROTOTYPES
-
-LOCAL int prc(char c, f_args *fa)
-
-#else
-LOCAL int prc(c, fa)
-	char	c;
-	f_args *fa;
-#endif
-{
-	register int diff;
-	register int rfillc;
-	register long arg			= fa->farg;
-	register void (*fun) __PR((char, long))	= fa->outf;
-	register int count;
-
-	count = 1;
-	diff = fa->fldwidth - 1;
-	if (diff > 0)
-		count += diff;
-
-	if (!fa->minusflag) {
-		rfillc = fa->fillc;
-		while (--diff >= 0)
-			(*fun)(rfillc, arg);
-	}
-	(*fun)(c, arg);
-	if (fa->minusflag) {
-		rfillc = ' ';
-		while (--diff >= 0)
-			(*fun)(rfillc, arg);
-	}
-	return (count);
-}
-
-/*
- * String output routine.
- * If fa->signific is >= 0, it uses only fa->signific chars.
- * If fa->signific is 0, print no characters.
- */
-LOCAL int prstring(s, fa)
-	register const char	*s;
-	f_args *fa;
-{
-	register char	*bp;
-	register int	signific;
-
-	if (s == NULL)
-		return (prbuf("(NULL POINTER)", fa));
-
-	if (fa->signific < 0)
-		return (prbuf(s, fa));
-
-	bp = fa->buf;
-	signific = fa->signific;
-
-	while (--signific >= 0 && *s != '\0')
-		*bp++ = *s++;
-	*bp = '\0';
-
-	return (prbuf(fa->buf, fa));
-}
-
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/getargs.c cdrdao-1.1.5/scsilib/lib/getargs.c
--- cdrdao-1.1.5.orig/scsilib/lib/getargs.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/getargs.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,772 +0,0 @@
-/* @(#)getargs.c	2.29 00/12/30 Copyright 1985, 1988, 1995 J. Schilling */
-#ifndef lint
-static	char sccsid[] =
-	"@(#)getargs.c	2.29 00/12/30 Copyright 1985, 1988, 1995 J. Schilling";
-#endif
-#define	NEW
-/*
- *	Copyright (c) 1985, 1988, 1995 J. Schilling
- *
- *	1.3.88	 Start implementation of release 2
- */
-/*
- *	Parse arguments on a command line.
- *	Format string specifier (appearing directly after flag name):
- *		''	BOOL
- *		'*'	string
- *		'?'	char
- *		'#'	number
- *		'&'	call function
- *		'+'	inctype		+++ NEU +++
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-/* LINTLIBRARY */
-#include <mconfig.h>
-#include <standard.h>
-#include <utypes.h>
-#include <getargs.h>
-#include <ctype.h>
-#include <vadefs.h>
-#include <strdefs.h>
-#include <schily.h>
-
-#define	NOARGS		  0	/* No more args			*/
-#define	NOTAFLAG	  1	/* Not a flag type argument	*/
-#define BADFLAG		(-1)	/* Not a valid flag argument	*/
-#define BADFMT		(-2)	/* Error in format string	*/
-#define NOTAFILE	(-3)	/* Seems to be a flag type arg	*/
-
-
-	int	_getargs __PR((int *, char *const **, const char *,
-							BOOL, va_list));
-LOCAL	int	dofile __PR((int *, char *const **, const char **));
-LOCAL	int	doflag __PR((int *, char *const **, const char *,
-						const char *, BOOL, va_list));
-LOCAL	int	dosflags __PR((const char *, const char *, BOOL, va_list));
-LOCAL	int	checkfmt __PR((const char *));
-LOCAL	int	checkeql __PR((const char *));
-
-LOCAL	va_list	va_dummy;
-
-LOCAL	char	fmtspecs[] = "#?*&+"; 
-
-#define	isfmtspec(c)		(strchr(fmtspecs, c) != NULL)
-
-/*---------------------------------------------------------------------------
-|
-|	get flags until a non flag type argument is reached
-|
-+---------------------------------------------------------------------------*/
-/* VARARGS3 */
-#ifdef	PROTOTYPES
-int getargs(int *pac, char *const **pav, const char *fmt, ...)
-#else
-int getargs(pac, pav, fmt, va_alist)
-	int	*pac;
-	char	**pav[];
-	char	*fmt;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	ret;
-
-#ifdef	PROTOTYPES
-	va_start(args, fmt);
-#else
-	va_start(args);
-#endif
-	ret = _getargs(pac, pav, fmt, TRUE, args);
-	va_end(args);
-	return (ret);
-}
-
-
-/*---------------------------------------------------------------------------
-|
-|	get all flags on the command line, do not stop on files
-|
-+---------------------------------------------------------------------------*/
-/* VARARGS3 */
-#ifdef	PROTOTYPES
-int getallargs(int *pac, char *const **pav, const char *fmt, ...)
-#else
-int getallargs(pac, pav, fmt, va_alist)
-	int	*pac;
-	char	**pav[];
-	char	*fmt;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	ret;
-
-#ifdef	PROTOTYPES
-	va_start(args, fmt);
-#else
-	va_start(args);
-#endif
-	for (;; (*pac)--, (*pav)++) {
-		if ((ret = _getargs(pac, pav, fmt, TRUE, args)) != NOTAFLAG)
-			break;
-	}
-	va_end(args);
-	return (ret);
-}
-
-
-/*---------------------------------------------------------------------------
-|
-|	get next non flag type argument (i.e. a file)
-|
-+---------------------------------------------------------------------------*/
-int getfiles(pac, pav, fmt)
-	int		*pac;
-	char *const	*pav[];
-	const char	*fmt;
-{
-	return (_getargs(pac, pav, fmt, FALSE, va_dummy));
-}
-
-
-/*---------------------------------------------------------------------------
-|
-|	check args until the next non flag type argmument is reached
-|	*pac is decremented, *pav is incremented so that the
-|	non flag type argument is at *pav[0]
-|
-|	return code:
-|		NOARGS		no more args
-|		NOTAFLAG	not a flag type argument
-|		BADFLAG		a non-matching flag type argument
-|		BADFMT		bad syntax in format string
-|
-|
-+---------------------------------------------------------------------------*/
-/*LOCAL*/ int _getargs(pac, pav, fmt, setargs, args)
-	register int		*pac;
-	register char	*const	**pav;
-		 const char	*fmt;
-		BOOL		setargs;
-		va_list		args;
-{
-	const	 char	*argp;
-		 int	ret;
-
-
-	for(; *pac > 0; (*pac)--, (*pav)++) {
-		argp = **pav;
-
-		ret = dofile(pac, pav, &argp);
-
-		if (ret != NOTAFILE)
-			return (ret);
-
-		ret = doflag(pac, pav, argp, fmt, setargs, args);
-
-		if (ret != NOTAFLAG)
-			return (ret);
-	}
-	return (NOARGS);
-}
-
-
-/*---------------------------------------------------------------------------
-|
-| check if *pargp is a file type argument
-|
-+---------------------------------------------------------------------------*/
-LOCAL int dofile(pac, pav, pargp)
-	register int		*pac;
-	register char *const	**pav;
-		 const char	**pargp;
-{
-	register const char	*argp = *pargp;
-
-
-	if (argp[0] == '-') {
-		/*
-		 * "-" is a special non flag type argument
-		 *     that usually means take stdin instead of a named file
-		 */
-		if (argp[1] == '\0')
-			return (NOTAFLAG);
-		/*
-		 * "--" is a prefix to take the next argument
-		 *	as non flag type argument
-		 * NOTE: Posix requires "--" to indicate the end of the
-		 *	 flags on the command line. But we are currently not
-		 *	 Posix.
-		 */
-		if (argp[1] == '-' && argp[2] == '\0') {
-			if (--(*pac) > 0) {
-				(*pav)++;
-				return (NOTAFLAG);
-			} else {
-				return (NOARGS);
-			}
-		}
-	}
-
-	/*
-	 * now check if it may be flag type argument
-	 * flag type arguments begin with a '-', a '+' or contain a '='
-	 * i.e. -flag +flag or flag=
-	 */
-	if (argp[0] != '-' && argp[0] != '+' && (!checkeql(argp)))
-		return (NOTAFLAG);
-
-	return (NOTAFILE);
-}
-
-
-/*---------------------------------------------------------------------------
-|
-|	compare argp with the format string
-|	if a match is found store the result a la scanf in one of the
-|	arguments pointed to in the va_list
-|
-|	If setargs is FALSE, only check arguments for getfiles()
-|	in this case, va_list may be a dummy arg.
-|
-+---------------------------------------------------------------------------*/
-LOCAL int doflag(pac, pav, argp, fmt, setargs, oargs)
-		int		*pac;
-		char	*const	**pav;
-	register const char	*argp;
-	register const char	*fmt;
-		BOOL		setargs;
-		va_list		oargs;
-{
-	char	argstr[2];
-	long	val;
-	Llong	llval;
-	int	singlecharflag	= 0;
-	BOOL	isspec;
-	BOOL	hasdash		= FALSE;
-	BOOL	doubledash	= FALSE;
-	BOOL	haseql		= checkeql(argp);
-	const char	*sargp;
-	const char	*sfmt	= fmt;
-	va_list	args;
-	char	*const	*spav	= *pav;
-	int		spac	= *pac;
-	void		*curarg	= (void *)0;
-
-	/*
-	 * flags beginning with '-' don't have to include the '-' in
-	 * the format string.
-	 * flags beginning with '+' have to include it in the format string.
-	 */
-	if (argp[0] == '-') {
-		argp++;
-		hasdash = TRUE;
-		/*
-		 * Implement legacy support for --longopt
-		 * If we find a double dash, we do not look for combinations
-		 * of boolean single char flags.
-		 */
-		if (argp[0] == '-') {
-			argp++;
-			doubledash = TRUE;
-			/*
-			 * Allow -- only for long options.
-			 */
-			if (argp[1] == '\0') {
-				return (BADFLAG);
-			}
-		}
-	}
-	sargp = argp;
-
-	/*
-	 * Initialize 'args' to the start of the argument list.
-	 * I don't know any portable way to copy an arbitrary
-	 * C object so I use a system-specific routine
-	 * (probably a macro) from stdarg.h.  (Remember that
-	 * if va_list is an array, 'args' will be a pointer
-	 * and '&args' won't be what I would need for memcpy.)
-	 * It is a system requirement for SVr4 compatibility
-	 * to be able to do this assgignement. If your system
-	 * defines va_list to be an array but does not define
-	 * va_copy() you are lost.
-	 * This is needed to make sure, that 'oargs' will not
-	 * be clobbered.
-	 */
-	va_copy(args, oargs);
-
-	if (setargs)
-		curarg = va_arg(args, void *);
-
-	/*
-	 * check if the first flag in format string is a singlechar flag
-	 */
-	if (fmt[1] == ',' || fmt[1] == '+' || fmt[1] == '\0')
-		singlecharflag++;
-	/*
-	 * check the whole format string for a match
-	 */
-	for(;;) {
-		for(;*fmt; fmt++,argp++) {
-			if (*fmt == '\\') {
-				/*
-				 * Allow "#?*&+" to appear inside a flag.
-				 * NOTE: they must be escaped by '\\' only
-				 *	 inside the the format string.
-				 */
-				fmt++;
-				isspec = FALSE;
-			} else {
-				isspec = isfmtspec(*fmt);
-			}
-			/*
-			 * If isspec is TRUE, the arg beeing checked starts
-			 * like a valid flag. Argp now points to the rest.
-			 */
-			if (isspec) {
-				/*
-				 * If *argp is '+' and we are on the
-				 * beginning of the arg that is currently
-				 * checked, this cannot be an inc type flag.
-				 */
-				if (*argp == '+' && argp == sargp)
-					continue;
-				/*
-				 * skip over to arg of flag
-				 */
-				if (*argp == '=') {
-					argp++;
-				} else if (*argp != '\0' && haseql) {
-					/*
-					 * Flag and arg are not separated by a
-					 * space.
-					 * Check here for:
-					 * xxxxx=yyyyy	match on '&'
-					 * Checked before:
-					 * abc=yyyyy	match on 'abc&'
-					 * 		or	 'abc*' 
-					 * 		or	 'abc#' 
-					 * We come here if 'argp' starts with
-					 * the same sequence as a valid flag
-					 * and contains an equal sign.
-					 * We have tested before if the text
-					 * before 'argp' matches exactly.
-					 * At this point we have no exact match
-					 * and we only allow to match
-					 * the special pattern '&'.
-					 * We need this e.g. for 'make'.
-					 * We allow any flag type argument to
-					 * match the format string "&" to set
-					 * up a function that handles all odd
-					 * stuff that getargs will not grok.
-					 * In addition, to allow getargs to be
-					 * used for CPP type flags we allow to
-					 * match -Dabc=xyz on 'D&'. Note that
-					 * Dabc=xyz will not match 'D&'.
-					 */
-					if ((!hasdash && argp != sargp) || *fmt != '&')
-						goto nextarg;
-				}
-				/*
-				 * *arpp == '\0' || !haseql
-				 * We come here if 'argp' starts with
-				 * the same sequence as a valid flag.
-				 * This will match on the following args:
-				 * -farg	match on 'f*'
-				 * -f12		match on 'f#'
-				 * +12		match on '+#'
-				 * -12		match on '#'
-				 * and all args that are separated from
-				 * their flags.
-				 * In the switch statement below, we check
-				 * if the text after 'argp' (if *argp != 0) or
-				 * the next arg is a valid arg for this flag.
- 				 */
-				break;
-			} else if (*fmt == *argp) {
-				if (argp[1] == '\0' &&
-				    (fmt[1] == '\0' || fmt[1] == ',')) {
-
-					if (setargs)
-						*((int *)curarg) = TRUE;
-
-
-					return (checkfmt(fmt));/* XXX */
-				}
-			} else {
-				/*
-				 * skip over to next format identifier
-				 * & reset arg pointer
-				 */
-			nextarg:
-				while (*fmt != ',' && *fmt != '\0') {
-					/* function has extra arg on stack */
-					if (*fmt == '&' && setargs)
-						curarg = va_arg(args, void *);
-					fmt++;
-				}
-				argp = sargp;
-				break;
-			}
-		}
-		switch(*fmt) {
-
-		case '\0':
-			/*
-			 * Boolean type has been tested before.
-			 */
-			if (singlecharflag && !doubledash &&
-			   (val = dosflags(sargp, sfmt, setargs, oargs)) !=
-								BADFLAG)
-				return (val);
-
-
-			return (BADFLAG);
-
-		case ',':
-			fmt++;
-			if (fmt[1] == ',' || fmt[1] == '+' || fmt[1] == '\0')
-				singlecharflag++;
-			if (setargs)
-				curarg = va_arg(args, void *);
-			continue;
-
-		case '*':
-			if (*argp == '\0') {
-				if (*pac > 1) {
-					(*pac)--;
-					(*pav)++;
-					argp = **pav;
-				} else {
-					return (BADFLAG);
-				}
-			}
-			if (setargs)
-				*((const char **)curarg) = argp;
-
-
-			return (checkfmt(fmt));
-
-		case '?':
-			/*
-			 * If more than one char arg, it
-			 * cannot be a character argument.
-			 */
-			if (argp[1] != '\0')
-				goto nextchance;
-			if (setargs)
-				*((char *)curarg) = *argp;
-
-
-			return (checkfmt(fmt));
-
-		case '+':
-			/*
-			 * inc type is similar to boolean,
-			 * there is no arg in argp to convert.
-			 */
-			if (*argp != '\0')
-				goto nextchance;
-			/*
-			 * If *fmt is '+' and we are on the beginning
-			 * of the format desciptor that is currently
-			 * checked, this cannot be an inc type flag.
-			 */
-			if (fmt == sfmt || fmt[-1] == ',')
-				goto nextchance;
-
-			if (fmt[1] == 'l' || fmt[1] == 'L') {
-				if (fmt[2] == 'l' || fmt[2] == 'L') {
-					if (setargs)
-						*((Llong *)curarg) += 1;
-					fmt += 2;
-				} else {
-					if (setargs)
-						*((long *)curarg) += 1;
-					fmt++;
-				}
-			} else if (fmt[1] == 's' || fmt[1] == 'S') {
-				if (setargs)
-					*((short *)curarg) += 1;
-				fmt++;
-			} else {
-				if (fmt[1] == 'i' || fmt[1] == 'I')
-					fmt++;
-				if (setargs)
-					*((int *)curarg) += 1;
-			}
-
-			argstr[0] = *fmt;
-			argstr[1] = '\0';
-
-			return (checkfmt(fmt));
-
-		case '#':
-			if (*argp == '\0') {
-				if (*pac > 1) {
-					(*pac)--;
-					(*pav)++;
-					argp = **pav;
-				} else {
-					return (BADFLAG);
-				}
-			}
-			if (*astoll(argp, &llval) != '\0') {
-				/*
-				 * arg is not a valid number!
-				 * go to next format in the format string
-				 * and check if arg matches any other type
-				 * in the format specs.
-				 */
-			nextchance:
-				while(*fmt != ',' && *fmt != '\0') {
-					if (*fmt == '&' && setargs)
-						curarg = va_arg(args, void *);
-					fmt++;
-				}
-				argp = sargp;
-				*pac = spac;
-				*pav = spav;
-				continue;
-			}
-			val = (long)llval;
-			if (fmt[1] == 'l' || fmt[1] == 'L') {
-				if (fmt[2] == 'l' || fmt[2] == 'L') {
-					if (setargs)
-						*((Llong *)curarg) = llval;
-					fmt += 2;
-				} else {
-					if (setargs)
-						*((long *)curarg) = val;
-					fmt++;
-				}
-			} else if (fmt[1] == 's' || fmt[1] == 'S') {
-				if (setargs)
-					*((short *)curarg) = (short)val;
-				fmt++;
-			} else {
-				if (fmt[1] == 'i' || fmt[1] == 'I')
-					fmt++;
-				if (setargs)
-					*((int *)curarg) = (int)val;
-			}
-			argstr[0] = *fmt;
-			argstr[1] = '\0';
-
-			return (checkfmt(fmt));
-
-		case '&':
-			if (*argp == '\0') {
-				if (*pac > 1) {
-					(*pac)--;
-					(*pav)++;
-					argp = **pav;
-				} else {
-					return (BADFLAG);
-				}
-			}
-
-			if ((val = checkfmt(fmt)) != NOTAFLAG)
-				return (val);
-
-			if (setargs) {
-				int	ret;
-				void	*funarg = va_arg(args, void *);
-
-				ret = ((*(getargfun)curarg) (argp, funarg));
-				if (ret != NOTAFILE)
-					return (ret);
-				fmt++;
-			} else {
-				return (val);
-			}
-			/*
-			 * Called function returns NOTAFILE: try next format.
-			 */
-		}
-	}
-}
-
-
-/*---------------------------------------------------------------------------
-|
-|	parse args for combined single char flags
-|
-+---------------------------------------------------------------------------*/
-typedef struct {
-	void	*curarg;
-	short	count;
-	char	c;
-	char	type;
-} sflags;
-
-LOCAL int dosflags(argp, fmt, setargs, oargs)
-	register const char	*argp;
-	register const char	*fmt;
-		BOOL		setargs;
-		va_list		oargs;
-{
-#define	MAXSF	32
-		 sflags	sf[MAXSF];
-		 va_list args;
-	register sflags	*rsf	= sf;
-	register int	nsf	= 0;
-	register const char *p	= argp;
-	register int	i;
-	register void	*curarg = (void *)0;
-
-	/*
-	 * Initialize 'args' to the start of the argument list.
-	 * I don't know any portable way to copy an arbitrary
-	 * C object so I use a system-specific routine
-	 * (probably a macro) from stdarg.h.  (Remember that
-	 * if va_list is an array, 'args' will be a pointer
-	 * and '&args' won't be what I would need for memcpy.)
-	 * It is a system requirement for SVr4 compatibility
-	 * to be able to do this assgignement. If your system
-	 * defines va_list to be an array but does not define
-	 * va_copy() you are lost.
-	 * This is needed to make sure, that 'oargs' will not
-	 * be clobbered.
-	 */
-	va_copy(args, oargs);
-
-	if (setargs)
-		curarg = va_arg(args, void *);
-
-	while (*p) {
-		for (i=0; i < nsf; i++) {
-			if (rsf[i].c == *p)
-				break;
-		}
-		if (i >= MAXSF)
-			return (BADFLAG);
-		if (i == nsf) {
-			rsf[i].curarg = (void *)0;
-			rsf[i].count = 0;
-			rsf[i].c = *p;
-			rsf[i].type = (char)-1;
-			nsf++;
-		}
-		rsf[i].count++;
-		p++;
-	}
-
-	while (*fmt) {
-		if (!isfmtspec(*fmt) &&
-		    (fmt[1] == ',' || fmt[1] == '+' || fmt[1] == '\0') &&
-		     strchr(argp, *fmt)) {
-			for (i=0; i < nsf; i++) {
-				if (rsf[i].c == *fmt) {
-					if (fmt[1] == '+') {
-						fmt++;
-						if (fmt[1] == ',' ||
-						    fmt[1] == '\0') {
-							rsf[i].type = 'i';
-						} else if ((fmt[1] == 'l' ||
-							    fmt[1] == 'L') &&
-							   (fmt[2] == 'l' ||
-							    fmt[2] == 'L')) {
-							rsf[i].type = 'Q';
-							fmt++;
-						} else {
-							rsf[i].type = fmt[1];
-						}
-					} else {
-						rsf[i].type = fmt[1];
-					}
-					rsf[i].curarg = curarg;
-					break;
-				}
-			}
-		}
-		while (*fmt != ',' && *fmt != '\0') {
-			/* function has extra arg on stack */
-			if (*fmt == '&' && setargs)
-				curarg = va_arg(args, void *);
-			fmt++;
-		}
-		if (*fmt != '\0')
-			fmt++;
-
-		if (setargs)
-			curarg = va_arg(args, void *);
-	}
-	for (i=0; i < nsf; i++) {
-		if (rsf[i].type == (char)-1)
-			return (BADFLAG);
-		if (rsf[i].curarg) {
-			if (rsf[i].type == ',' || rsf[i].type == '\0') {
-				*((int *)rsf[i].curarg) = TRUE;
-			} else if (rsf[i].type == 'i' || rsf[i].type == 'I') {
-				*((int *)rsf[i].curarg) += rsf[i].count;
-			} else if (rsf[i].type == 'l' || rsf[i].type == 'L') {
-				*((long *)rsf[i].curarg) += rsf[i].count;
-			} else if (rsf[i].type == 'Q') {
-				*((Llong *)rsf[i].curarg) += rsf[i].count;
-			} else if (rsf[i].type == 's' || rsf[i].type == 'S') {
-				*((short *)rsf[i].curarg) += rsf[i].count;
-			} else {
-				return (BADFLAG);
-			}
-		}
-	}
-	return (NOTAFLAG);
-}
-
-/*---------------------------------------------------------------------------
-|
-|	If the next format character is a comma or the string delimiter,
-|	there are no invalid format specifiers. Return success.
-|	Otherwise raise the getarg_bad_format condition.
-|
-+---------------------------------------------------------------------------*/
-LOCAL int checkfmt(fmt)
-	const char	*fmt;
-{
-	char	c;
-
-	c = *(++fmt);	/* non constant expression */
-
-
-	if (c == ',' || c == '\0') {
-		return (NOTAFLAG);
-	} else {
-		raisecond("getarg_bad_format", (long)fmt);
-		return (BADFMT);
-	}
-}
-
-/*---------------------------------------------------------------------------
-|
-|	Parse the string as long as valid characters can be found.
-|	Valid flag identifiers are chosen from the set of
-|	alphanumeric characters, '-' and '_'.
-|	If the next character is an equal sign the string
-|	contains a valid flag identifier.
-|
-+---------------------------------------------------------------------------*/
-static int checkeql(str)
-	register const char *str;
-{
-	register unsigned char c;
-
-	for (c = (unsigned char)*str;
-				isalnum(c) || c == '_' || c == '-'; c = *str++)
-		;
-	return (c == '=');
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/getav0.c cdrdao-1.1.5/scsilib/lib/getav0.c
--- cdrdao-1.1.5.orig/scsilib/lib/getav0.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/getav0.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,111 +0,0 @@
-/* @(#)getav0.c	1.10 00/05/07 Copyright 1985 J. Schilling */
-#ifndef lint
-static	char sccsid[] =
-	"@(#)getav0.c	1.10 00/05/07 Copyright 1985 J. Schilling";
-#endif
-/*
- *	Get arg vector by scanning the stack
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <sigblk.h>
-#include <avoffset.h>
-#include <standard.h>
-#include <schily.h>
-
-#if	!defined(AV_OFFSET) || !defined(FP_INDIR)
-#	ifdef	HAVE_SCANSTACK
-#	undef	HAVE_SCANSTACK
-#	endif
-#endif
-#ifdef	NO_SCANSTACK
-#	ifdef	HAVE_SCANSTACK
-#	undef	HAVE_SCANSTACK
-#	endif
-#endif
-
-#ifdef	HAVE_SCANSTACK
-
-#include <stkframe.h>
-
-#define	is_even(p)	((((long)(p)) & 1) == 0)
-#define	even(p)		(((long)(p)) & ~1L)
-#ifdef	__future__
-#define	even(p)		(((long)(p)) - 1)/* will this work with 64 bit ?? */
-#endif
-
-char **getavp()
-{
-	register struct frame *fp;
-	register struct frame *ofp;
-		 char	**av;
-#if	FP_INDIR > 0
-	register int	i = 0;
-#endif
-
-	ofp = fp = (struct frame *)getfp();
-	while (fp) {
-
-#if	FP_INDIR > 0
-		i++;
-#endif
-		ofp = fp;
-		if (!is_even(fp->fr_savfp)) {
-			fp = (struct frame *)even(fp->fr_savfp);
-			fp = (struct frame *)((SIGBLK *)fp)->sb_savfp;
-			continue;
-		}
-		fp = fp->fr_savfp;
-	}
-
-#if	FP_INDIR > 0
-	i -= FP_INDIR;
-        ofp = fp = (struct frame *)getfp();
-	while (fp) {
-		if (--i < 0)
-			break;
-		ofp = fp;
-		if (!is_even(fp->fr_savfp)) {
-			fp = (struct frame *)even(fp->fr_savfp);
-			fp = (struct frame *)((SIGBLK *)fp)->sb_savfp;
-			continue;
-		}
-		fp = fp->fr_savfp;
-	}
-#endif
-
-        av = (char **)ofp + AV_OFFSET;	/* aus avoffset.h */
-					/* (wird generiert mit av_offset) */
-	return (av);
-}
-
-char *getav0()
-{
-	return (getavp()[0]);
-}
-
-#else
-
-char *getav0()
-{
-	return ("???");
-}
-
-#endif	/* HAVE_SCANSTACK */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/getdomainname.c cdrdao-1.1.5/scsilib/lib/getdomainname.c
--- cdrdao-1.1.5.orig/scsilib/lib/getdomainname.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/getdomainname.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,49 +0,0 @@
-/* @(#)getdomainname.c	1.13 99/08/30 Copyright 1995 J. Schilling */
-#ifndef lint
-static	char sccsid[] =
-	"@(#)getdomainname.c	1.13 99/08/30 Copyright 1995 J. Schilling";
-#endif
-/*
- *	Copyright (c) 1995 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <standard.h>
-#include <stdxlib.h>
-#ifdef	HAVE_SYS_SYSTEMINFO_H
-#include <sys/systeminfo.h>
-#endif
-#include <libport.h>
-
-#ifndef	HAVE_GETDOMAINNAME
-EXPORT	int	getdomainname	__PR((char *name, int namelen));
-#endif
-
-
-#if	!defined(HAVE_GETDOMAINNAME) && defined(SI_SRPC_DOMAIN)
-
-EXPORT int
-getdomainname(name, namelen)
-	char	*name;
-	int	namelen;
-{
-	if (sysinfo(SI_SRPC_DOMAIN, name, namelen) < 0)
-		return (-1);
-	return (0);
-}
-#endif
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/geterrno.c cdrdao-1.1.5/scsilib/lib/geterrno.c
--- cdrdao-1.1.5.orig/scsilib/lib/geterrno.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/geterrno.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,38 +0,0 @@
-/* @(#)geterrno.c	1.8 00/08/14 Copyright 1985 J. Schilling */
-/*
- *	Get error number
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <errno.h>
-#include <standard.h>
-#include <schily.h>
-
-#ifndef	HAVE_ERRNO_DEF
-extern	int	errno;
-#endif
-
-#ifdef	geterrno
-#undef	geterrno
-#endif
-
-int geterrno()
-{
-	return (errno);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/getfp.c cdrdao-1.1.5/scsilib/lib/getfp.c
--- cdrdao-1.1.5.orig/scsilib/lib/getfp.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/getfp.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,66 +0,0 @@
-/* @(#)getfp.c	1.10 00/05/07 Copyright 1988 J. Schilling */
-/*
- *	Get frame pointer
- *
- *	Copyright (c) 1988 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <standard.h>
-#include <schily.h>
-
-#ifdef	NO_SCANSTACK
-#	ifdef	HAVE_SCANSTACK
-#	undef	HAVE_SCANSTACK
-#	endif
-#endif
-
-#ifdef	HAVE_SCANSTACK
-#include <stkframe.h>
-
-#define	MAXWINDOWS	32
-#define	NWINDOWS	7
-
-#if defined(sparc) && defined(__GNUC__)
-#	define	IDX		3	/* some strange things on sparc gcc */
-#else
-#	define	IDX		1
-#endif
-
-void **getfp()
-{
-		long	**dummy[1];
-	static	int	idx = IDX;	/* fool optimizer in c compiler */
-
-#ifdef	sparc
-	flush_reg_windows(MAXWINDOWS-2);
-#endif
-	return ((void **)((struct frame *)&dummy[idx])->fr_savfp);
-}
-
-#ifdef	sparc
-int flush_reg_windows(n)
-	int	n;
-{
-	if (--n > 0)
-		flush_reg_windows(n);
-	return (0);
-}
-#endif
-
-#endif	/* HAVE_SCANSTACK */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/gethostid.c cdrdao-1.1.5/scsilib/lib/gethostid.c
--- cdrdao-1.1.5.orig/scsilib/lib/gethostid.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/gethostid.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,70 +0,0 @@
-/* @(#)gethostid.c	1.14 01/03/04 Copyright 1995 J. Schilling */
-#ifndef lint
-static	char sccsid[] =
-	"@(#)gethostid.c	1.14 01/03/04 Copyright 1995 J. Schilling";
-#endif
-/*
- *	Copyright (c) 1995 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <standard.h>
-#include <stdxlib.h>
-#include <utypes.h>
-#ifdef	HAVE_SYS_SYSTEMINFO_H
-#include <sys/systeminfo.h>
-#endif
-#include <libport.h>
-
-#ifndef	HAVE_GETHOSTID
-EXPORT	long	gethostid	__PR((void));
-#endif
-
-
-#if	!defined(HAVE_GETHOSTID)
-
-#if	defined(SI_HW_SERIAL)
-
-EXPORT long
-gethostid()
-{
-	long	id;
-
-	char	hbuf[257];
-	sysinfo(SI_HW_SERIAL, hbuf, sizeof(hbuf));
-	id = atoi(hbuf);
-	return (id);
-}
-#else
-
-#include <errno.h>
-EXPORT long
-gethostid()
-{
-	long	id = -1L;
-
-#ifdef	ENOSYS
-	seterrno(ENOSYS);
-#else
-	seterrno(EINVAL);
-#endif
-	return (id);
-}
-#endif
-
-#endif
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/gethostname.c cdrdao-1.1.5/scsilib/lib/gethostname.c
--- cdrdao-1.1.5.orig/scsilib/lib/gethostname.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/gethostname.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,50 +0,0 @@
-/* @(#)gethostname.c	1.14 00/08/26 Copyright 1995 J. Schilling */
-#ifndef lint
-static	char sccsid[] =
-	"@(#)gethostname.c	1.14 00/08/26 Copyright 1995 J. Schilling";
-#endif
-/*
- *	Copyright (c) 1995 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <standard.h>
-#include <stdxlib.h>
-#ifdef	HAVE_SYS_SYSTEMINFO_H
-#include <sys/systeminfo.h>
-#endif
-#include <libport.h>
-
-#ifndef	HAVE_GETHOSTNAME
-EXPORT	int	gethostname	__PR((char *name, int namelen));
-
-
-#ifdef	SI_HOSTNAME
-
-EXPORT int
-gethostname(name, namelen)
-	char	*name;
-	int	namelen;
-{
-	if (sysinfo(SI_HOSTNAME, name, namelen) < 0)
-		return (-1);
-	return (0);
-}
-#endif
-
-#endif	/* HAVE_GETHOSTNAME */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/jsprintf.c cdrdao-1.1.5/scsilib/lib/jsprintf.c
--- cdrdao-1.1.5.orig/scsilib/lib/jsprintf.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/jsprintf.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,122 +0,0 @@
-/* @(#)jsprintf.c	1.13 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <stdio.h>
-#include <vadefs.h>
-#include <standard.h>
-#include <schily.h>
-
-#define BFSIZ	256
-
-typedef struct {
-	short	cnt;
-	char	*ptr;
-	char	buf[BFSIZ];
-	int	count;
-	FILE	*f;
-} *BUF, _BUF;
-
-LOCAL	void	_bflush		__PR((BUF));
-LOCAL	void	_bput		__PR((char, long));
-EXPORT	int	js_fprintf	__PR((FILE *, const char *, ...));
-EXPORT	int	js_printf	__PR((const char *, ...));
-
-LOCAL void _bflush (bp)
-	register BUF	bp;
-{
-	bp->count += bp->ptr - bp->buf;
-	if (filewrite (bp->f, bp->buf, bp->ptr - bp->buf) < 0)
-		bp->count = EOF;
-	bp->ptr = bp->buf;
-	bp->cnt = BFSIZ;
-}
-
-#ifdef	PROTOTYPES
-LOCAL void _bput (char c, long l)
-#else
-LOCAL void _bput (c, l)
-		char	c;
-		long	l;
-#endif
-{ 
-	register BUF	bp = (BUF)l;
-
-	*bp->ptr++ = c;
-	if (--bp->cnt <= 0)
-		_bflush (bp);
-}
-
-/* VARARGS2 */
-#ifdef	PROTOTYPES
-EXPORT int js_printf(const char *form, ...)
-#else
-EXPORT int js_printf(form, va_alist)
-	char	*form;
-	va_dcl
-#endif
-{
-	va_list	args;
-	_BUF	bb;
-
-	bb.ptr = bb.buf;
-	bb.cnt = BFSIZ;
-	bb.count = 0;
-	bb.f = stdout;
-#ifdef	PROTOTYPES
-	va_start(args, form);
-#else
-	va_start(args);
-#endif
-	format(_bput, (long)&bb, form, args);
-	va_end(args);
-	if (bb.cnt < BFSIZ)
-		_bflush (&bb);
-	return (bb.count);
-}
-
-/* VARARGS3 */
-#ifdef	PROTOTYPES
-EXPORT int js_fprintf(FILE *file, const char *form, ...)
-#else
-EXPORT int js_fprintf(file, form, va_alist)
-	FILE	*file;
-	char	*form;
-	va_dcl
-#endif
-{
-	va_list	args;
-	_BUF	bb;
-
-	bb.ptr = bb.buf;
-	bb.cnt = BFSIZ;
-	bb.count = 0;
-	bb.f = file;
-#ifdef	PROTOTYPES
-	va_start(args, form);
-#else
-	va_start(args);
-#endif
-	format(_bput, (long)&bb, form, args);
-	va_end(args);
-	if (bb.cnt < BFSIZ)
-		_bflush (&bb);
-	return (bb.count);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/jssnprintf.c cdrdao-1.1.5/scsilib/lib/jssnprintf.c
--- cdrdao-1.1.5.orig/scsilib/lib/jssnprintf.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/jssnprintf.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,86 +0,0 @@
-/* @(#)jssnprintf.c	1.6 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <sys/types.h>		/* Try to get size_t	*/
-#include <stdio.h>		/* Try again for size_t	*/
-#include <stdxlib.h>		/* Try again for size_t	*/
-#include <vadefs.h>
-#include <standard.h>
-#include <schily.h>
-
-EXPORT	int js_snprintf __PR((char *, size_t maxcnt, const char *, ...));
-
-typedef struct {
-	char	*ptr;
-	int	count;
-} *BUF, _BUF;
-
-#ifdef	PROTOTYPES
-static void _cput(char c, long l)
-#else
-static void _cput(c, l)
-	char	c;
-	long	l;
-#endif
-{
-	register BUF	bp = (BUF)l;
-
-	if (--bp->count > 0) {
-		*bp->ptr++ = c;
-	} else {
-		/*
-		 * Make sure that there will never be a negative overflow.
-		 */
-		bp->count++;
-	}
-}
-
-/* VARARGS2 */
-#ifdef	PROTOTYPES
-int js_snprintf(char *buf, size_t maxcnt, const char *form, ...)
-#else
-int js_snprintf(buf, maxcnt, form, va_alist)
-	char	*buf;
-	unsigned maxcnt;
-	char	*form;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	cnt;
-	_BUF	bb;
-
-	bb.ptr = buf;
-	bb.count = maxcnt;
-
-#ifdef	PROTOTYPES
-	va_start(args, form);
-#else
-	va_start(args);
-#endif
-	cnt = format(_cput, (long)&bb, form,  args);
-	va_end(args);
-	*(bb.ptr) = '\0';
-	if (bb.count <= 0)
-		return (-1);
-
-	return (cnt);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/jssprintf.c cdrdao-1.1.5/scsilib/lib/jssprintf.c
--- cdrdao-1.1.5.orig/scsilib/lib/jssprintf.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/jssprintf.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,66 +0,0 @@
-/* @(#)jssprintf.c	1.14 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <vadefs.h>
-#include <standard.h>
-#include <schily.h>
-
-/*
- * Do not include stdio.h, BSD systems define sprintf the wrong way!
- */
-EXPORT	int js_sprintf __PR((char *, const char *, ...));
-
-#ifdef	PROTOTYPES
-static void _cput(char c, long ba)
-#else
-static void _cput(c, ba)
-	char	c;
-	long	ba;
-#endif
-{
-	*(*(char **) ba)++ = c;
-}
-
-/* VARARGS2 */
-#ifdef	PROTOTYPES
-int js_sprintf(char *buf, const char *form, ...)
-#else
-int js_sprintf(buf, form, va_alist)
-	char	*buf;
-	char	*form;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	cnt;
-	char	*bp = buf;
-
-#ifdef	PROTOTYPES
-	va_start(args, form);
-#else
-	va_start(args);
-#endif
-	cnt = format(_cput, (long)&bp, form,  args);
-	va_end(args);
-	*bp = '\0';
-
-	return (cnt);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/libschily.mk cdrdao-1.1.5/scsilib/lib/libschily.mk
--- cdrdao-1.1.5.orig/scsilib/lib/libschily.mk	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/libschily.mk	1969-12-31 19:00:00.000000000 -0500
@@ -1,18 +0,0 @@
-#ident @(#)libschily.mk	1.2 00/02/10 
-###########################################################################
-SRCROOT=	..
-RULESDIR=	RULES
-include		$(SRCROOT)/$(RULESDIR)/rules.top
-###########################################################################
-
-.SEARCHLIST:	. $(ARCHDIR) stdio $(ARCHDIR)
-VPATH=		.:stdio:$(ARCHDIR)
-INSDIR=		lib
-TARGETLIB=	schily
-CPPOPTS +=	-Istdio
-include		Targets
-LIBS=		
-
-###########################################################################
-include		$(SRCROOT)/$(RULESDIR)/rules.lib
-###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/libschily_p.mk cdrdao-1.1.5/scsilib/lib/libschily_p.mk
--- cdrdao-1.1.5.orig/scsilib/lib/libschily_p.mk	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/libschily_p.mk	1969-12-31 19:00:00.000000000 -0500
@@ -1,20 +0,0 @@
-#ident @(#)libschily_p.mk	1.2 00/02/10 
-###########################################################################
-SRCROOT=	..
-RULESDIR=	RULES
-include		$(SRCROOT)/$(RULESDIR)/rules.top
-###########################################################################
-
-SUBARCHDIR=	/profiled
-.SEARCHLIST:	. $(ARCHDIR) stdio $(ARCHDIR)
-VPATH=		.:stdio:$(ARCHDIR)
-INSDIR=		lib
-TARGETLIB=	schily_p
-CPPOPTS +=	-Istdio
-COPTS +=	$(COPTGPROF)
-include		Targets
-LIBS=		
-
-###########################################################################
-include		$(SRCROOT)/$(RULESDIR)/rules.lib
-###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/match.c cdrdao-1.1.5/scsilib/lib/match.c
--- cdrdao-1.1.5.orig/scsilib/lib/match.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/match.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,448 +0,0 @@
-/* @(#)match.c	1.18 00/11/12 Copyright 1985 J. Schilling */
-#include <standard.h>
-#include <patmatch.h>
-/*
- *	Pattern matching functions
- *
- *	Copyright (c) 1985,1995 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-/*
- *	The pattern matching functions below are based on the algorithm
- *	presented by Martin Richards in:
- *
- *	"A Compact Function for Regular Expression Pattern Matching", 
- *	Software-Practice and Experience, Vol. 9, 527-534 (1979)
- *
- *	Several changes have been made to the original source which has been
- *	written in BCPL:
- *
- *	'/'	is replaced by	'!'		(to allow UNIX filenames)
- *	'(',')' are replaced by	'{', '}'
- *	'\''	is replaced by	'\\'		(UNIX compatible quote)
- *
- *	Character classes have been added to allow "[<character list>]"
- *	to be used.
- *	Start of line '^' and end of line '$' have been added.
- */
-
-#ifdef	__LINE_MATCH
-#define	opatmatch	opatlmatch
-#define	patmatch	patlmatch
-#endif
-
-#define	ENDSTATE	(-1)
-typedef	unsigned char	Uchar;
-
-/*---------------------------------------------------------------------------
-|
-|	The Interpreter
-|
-+---------------------------------------------------------------------------*/
-
-
-/*
- *	put adds a new state to the active list
- */
-#define put(ret, state, sp, n)	{		\
-	register int *lstate	= state;	\
-	register int *lsp	= sp;		\
-	register int ln		= n;		\
-						\
-	while (lstate < lsp) {			\
-		if (*lstate++ == ln) {		\
-			ret = lsp;		\
-			lsp = 0;		\
-			break;			\
-		}				\
-	}					\
-	if (lsp) {				\
-		*lstate++ = ln;			\
-		ret = lstate;			\
-	}					\
-}
-
-
-/*
- *	match a character in class
- */
-#define in_class(found, pat, c)	{			\
-	register const Uchar	*lpat	= pat;		\
-	register int		lc	= c;		\
-	int	lo_bound;				\
-	int	hi_bound;				\
-							\
-	found = FALSE;					\
-							\
-	if (*lpat == NOT) {				\
-		lpat++;					\
-		found = TRUE;				\
-	}						\
-	while (*lpat != RCLASS) {			\
-		if (*lpat == QUOTE)			\
-			lpat++;				\
-		lo_bound = *lpat++;			\
-		if (*lpat == RANGE) {			\
-			lpat++;				\
-			if (*lpat == QUOTE)		\
-				lpat++;			\
-			hi_bound = *lpat++;		\
-		} else {				\
-			hi_bound = lo_bound;		\
-		}					\
-		if (lo_bound <= lc && lc <= hi_bound) {	\
-			found = !found;			\
-			break;				\
-		}					\
-	}						\
-}
-
-/*
- *	opatmatch - the old external interpreter interface.
- *
- *	Trys to match a string beginning at offset
- *	against the compiled pattern.
- */
-Uchar *opatmatch(pat, aux, str, soff, slen, alt)
-	const Uchar	*pat;
-	const int	*aux;
-	const Uchar	*str;
-	int		soff;
-	int		slen;
-	int		alt;
-{
-	int		state[MAXPAT];
-
-	return (patmatch(pat, aux, str, soff, slen, alt, state));
-}
-
-/*
- *	patmatch - the external interpreter interface.
- *
- *	Trys to match a string beginning at offset
- *	against the compiled pattern.
- */
-Uchar *patmatch(pat, aux, str, soff, slen, alt, state)
-	const Uchar	*pat;
-	const int	*aux;
-	const Uchar	*str;
-	int		soff;
-	int		slen;
-	int		alt;
-	int		state[];
-{
-	register int	*sp;
-	register int	*n;
-	register int	*i;
-	register int	p;
-	register int	q, s, k;
-	int		c;
-	const Uchar	*lastp = (Uchar *)NULL;
-
-#ifdef	__LINE_MATCH
-for( ;soff <= slen; soff++) {
-#endif
-
-	sp = state;
-	put(sp, state, state, 0);
-	if (alt != ENDSTATE)
-		put(sp, state, sp, alt);
-
-	for(s = soff; ; s++) {
-		/*
-		 * next char from input string
-		 */
-		if (s >= slen)
-			c = 0;
-		else
-			c = str[s];
-		/*
-		 * first complete the closure
-		 */
-		for(n = state; n < sp;) {
-			p = *n++;		/* next state number */
-			if (p == ENDSTATE)
-				continue;
-			q = aux[p];		/* get next state for pat */
-			k = pat[p];		/* get next char from pat */
-			switch (k) {
-
-			case REP:
-				put(sp, state, sp, p+1);
-			case NIL:		/* NIL matches always */
-			case STAR:
-				put(sp, state, sp, q);
-				break;
-			case LBRACK:		/* alternations */
-			case ALT:
-				put(sp, state, sp, p+1);
-				if (q != ENDSTATE)
-					put(sp, state, sp, q);
-				break;
-			case START:
-				if (s == 0)
-					put(sp, state, sp, q);
-				break;
-			case END:
-				if (c == '\0')
-					put(sp, state, sp, q);
-				break;
-			}
-		}
-
-		for (i = state; i < sp;) {
-			if (*i++ == ENDSTATE) {
-				lastp = &str[s];
-				break;
-			}
-		}
-		if (c == 0)
-			return ((Uchar *)lastp);
-
-		/*
-		 * now try to match next character
-		 */
-		n = sp;
-		sp = state;
-		for(i = sp; i < n;) {
-			p = *i++;		/* next active state number */
-			if (p == ENDSTATE)
-				continue;
-			k = pat[p];
-			switch (k) {
-
-			case ALT:
-			case REP:
-			case NIL:
-			case LBRACK:
-			case START:
-			case END:
-				continue;
-			case LCLASS:
-				in_class(q, &pat[p+1], c);
-				if (!q)
-					continue;
-				break;
-			case STAR:
-				put(sp, state, sp, p);
-				continue;
-			case QUOTE:
-				k = pat[p+1];
-			default:
-				if (k != c)
-					continue;
-			case ANY:
-				break;
-			}
-			put(sp, state, sp, aux[p]);
-		}
-		if (sp == state) {		/* if no new states return */
-#ifdef	__LINE_MATCH
-
-			if (lastp || (soff == slen - 1))
-				return ((Uchar *)lastp);
-			else
-				break;
-#else
-			return ((Uchar *)lastp);
-#endif
-		}
-	}
-#ifdef	__LINE_MATCH
-   }
-   return ((Uchar *)lastp);
-#endif
-}
-
-
-#ifndef	__LINE_MATCH
-/*---------------------------------------------------------------------------
-|
-|	The Compiler
-|
-+---------------------------------------------------------------------------*/
-
-typedef	struct args {
-	const Uchar	*pattern;
-	int		*aux;
-	int		patp;
-	int		length;
-	Uchar		Ch;
-} arg_t;
-
-static	void	nextitem __PR((arg_t *));
-static	int	prim	 __PR((arg_t *));
-static	int	exp	 __PR((arg_t *, int *));
-static	void	setexits __PR((int *, int, int));
-static	int	join	 __PR((int *, int, int));
-	
-/*
- *	'read' the next character from pattern
- */
-#define	rch(ap)						\
-{							\
-	if (++(ap)->patp >= (ap)->length)		\
-		(ap)->Ch = 0;				\
-	else						\
-		(ap)->Ch = (ap)->pattern[(ap)->patp];	\
-}
-
-/*
- *	get the next item from pattern
- */
-static void nextitem(ap)
-	arg_t	*ap;
-{
-	if (ap->Ch == QUOTE)
-		rch(ap);
-	rch(ap);
-}
-
-/*
- *	parse a primary
- */
-static int prim(ap)
-	arg_t	*ap;
-{
-	int	a  = ap->patp;
-	int	op = ap->Ch;
-	int	t;
-
-	nextitem(ap);
-	switch (op) {
-
-	case '\0':
-	case ALT:
-	case RBRACK:
-		return (ENDSTATE);
-	case LCLASS:
-		while (ap->Ch != RCLASS && ap->Ch != '\0')
-			nextitem(ap);
-		if (ap->Ch == '\0')
-			return (ENDSTATE);
-		nextitem(ap);
-		break;
-	case REP:
-		t = prim(ap);
-		if (t == ENDSTATE)
-			return (ENDSTATE);
-		setexits(ap->aux, t, a);
-		break;
-	case LBRACK:
-		a = exp(ap, &ap->aux[a]);
-		if (a == ENDSTATE || ap->Ch != RBRACK)
-			return (ENDSTATE);
-		nextitem(ap);
-		break;
-	}
-	return (a);
-}
-
-/*
- *	parse an expression (a sequence of primaries)
- */
-static int exp(ap, altp)
-	arg_t	*ap;
-	int	*altp;
-{
-	int	exits = ENDSTATE;
-	int	a;
-	int	*aux = ap->aux;
-	Uchar	Ch;
-
-	for(;;) {
-		a = prim(ap);
-		Ch = ap->Ch;
-		if (Ch == ALT || Ch == RBRACK || Ch == '\0') {
-			exits = join(aux, exits, a);
-			if (Ch != ALT)
-				return (exits);
-			*altp = ap->patp;
-			altp = &aux[ap->patp];
-			nextitem(ap);
-		} else
-			setexits(aux, a, ap->patp);
-	}
-}
-
-/*
- *	set all exits in a list to a specified value
- */
-static void setexits(aux, list, val)
-	int	*aux;
-	int	list;
-	int	val;
-{
-	int	a;
-
-	while (list != ENDSTATE) {
-		a = aux[list];
-		aux[list] = val;
-		list = a;
-	}
-}
-
-/*
- *	concatenate two lists
- */
-static int join(aux, a, b)
-	int	*aux;
-	int	a;
-	int	b;
-{
-	int	t;
-
-	if (a == ENDSTATE)
-		return (b);
-	t = a;
-	while (aux[t] != ENDSTATE)
-		t = aux[t];
-	aux[t] = b;
-	return (a);
-}
-
-/*
- *	patcompile - the external compiler interface.
- *
- *	The pattern is compiled into the aux array.
- *	Return value on success, is the outermost alternate which is != 0.
- *	Error is indicated by return of 0.
- */
-int patcompile(pat, len, aux)
-	const Uchar	*pat;
-	int		len;
-	int		*aux;
-{
-	arg_t	a;
-	int	alt = ENDSTATE;
-	int	i;
-
-	a.pattern = pat;
-	a.length  = len;
-	a.aux     = aux;
-	a.patp    = -1;
-
-	for(i = 0; i < len; i++)
-		aux[i] = ENDSTATE;
-	rch(&a);
-	i = exp(&a, &alt);
-	if (i == ENDSTATE)
-		return (0);
-	setexits(aux, i, ENDSTATE);
-	return (alt);
-}
-#endif	/* LMATCH */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/movebytes.c cdrdao-1.1.5/scsilib/lib/movebytes.c
--- cdrdao-1.1.5.orig/scsilib/lib/movebytes.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/movebytes.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,124 +0,0 @@
-/* @(#)movebytes.c	1.12 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	move data
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <standard.h>
-#include <align.h>
-#include <schily.h>
-
-#define	DO8(a)	a;a;a;a;a;a;a;a;
-
-char *movebytes(fromv, tov, cnt)
-	const void	*fromv;
-	void		*tov;
-	int		cnt;
-{
-	register const char	*from	= fromv;
-	register char		*to	= tov;
-	register int		n;
-
-	/*
-	 * If we change cnt to be unsigned, check for == instead of <=
-	 */
-	if ((n = cnt) <= 0)
-		return (to);
-
-	if (from >= to) {
-		/*
-		 * source is on higher adresses than destination:
-		 *	move bytes forwards
-		 */
-		if (n >= (int)(8 * sizeof(long))) {
-			if (l2aligned(from, to)) {
-				register const long *froml = (const long *)from;
-				register long *tol = (long *)to;
-				register int rem = n % (8 * sizeof (long));
-			
-				n /= (8 * sizeof (long));
-				do {
-					DO8 (*tol++ = *froml++);
-				} while (--n > 0);
-
-				from = (const char *)froml;
-				to = (char *)tol;
-				n = rem;
-			}
-
-			if (n >= 8) {
-				n -= 8;
-				do {
-					DO8 (*to++ = *from++);
-				} while ((n -= 8) >= 0);
-				n += 8;
-			}
-
-			if (n > 0) do {
-				*to++ = *from++;
-			} while (--n > 0);
-			return (to);
-		}
-		if (n > 0) do {
-			*to++ = *from++;
-		} while (--n > 0);
-		return (to);
-	} else {
-		char *ep;
-
-		/*
-		 * source is on lower adresses than destination:
-		 *	move bytes backwards
-		 */
-		to += n;
-		from += n;
-		ep = to;
-		if (n >= (int)(8 * sizeof(long))) {
-			if (l2aligned(from, to)) {
-				register const long *froml = (const long *)from;
-				register long *tol = (long *)to;
-				register int rem = n % (8 * sizeof (long));
-
-				n /= (8 * sizeof (long));
-				do {
-					DO8 (*--tol = *--froml);
-				} while (--n > 0);
-
-				from = (const char *)froml;
-				to = (char *)tol;
-				n = rem;
-			}
-			if (n >= 8) {
-				n -= 8;
-				do {
-					DO8 (*--to = *--from);
-				} while ((n -= 8) >= 0);
-				n += 8;
-			}
-			if (n > 0) do {
-				*--to = *--from;
-			} while (--n > 0);
-			return (ep);
-		}
-		if (n > 0) do {
-			*--to = *--from;
-		} while (--n > 0);
-		return (ep);
-	}
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/printf.c cdrdao-1.1.5/scsilib/lib/printf.c
--- cdrdao-1.1.5.orig/scsilib/lib/printf.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/printf.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,120 +0,0 @@
-/* @(#)printf.c	1.12 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <stdio.h>
-#include <vadefs.h>
-#include <standard.h>
-#include <schily.h>
-
-#define BFSIZ	256
-
-typedef struct {
-	short	cnt;
-	char	*ptr;
-	char	buf[BFSIZ];
-	int	count;
-	FILE	*f;
-} *BUF, _BUF;
-
-LOCAL void _bflush	__PR((BUF));
-LOCAL void _bput	__PR((char, long));
-
-LOCAL void _bflush (bp)
-	register BUF	bp;
-{
-	bp->count += bp->ptr - bp->buf;
-	if (filewrite (bp->f, bp->buf, bp->ptr - bp->buf) < 0)
-		bp->count = EOF;
-	bp->ptr = bp->buf;
-	bp->cnt = BFSIZ;
-}
-
-#ifdef	PROTOTYPES
-LOCAL void _bput (char c, long l)
-#else
-LOCAL void _bput (c, l)
-		char	c;
-		long	l;
-#endif
-{ 
-	register BUF	bp = (BUF)l;
-
-	*bp->ptr++ = c;
-	if (--bp->cnt <= 0)
-		_bflush (bp);
-}
-
-/* VARARGS2 */
-#ifdef	PROTOTYPES
-EXPORT int printf(const char *form, ...)
-#else
-EXPORT int printf(form, va_alist)
-	char	*form;
-	va_dcl
-#endif
-{
-	va_list	args;
-	_BUF	bb;
-
-	bb.ptr = bb.buf;
-	bb.cnt = BFSIZ;
-	bb.count = 0;
-	bb.f = stdout;
-#ifdef	PROTOTYPES
-	va_start(args, form);
-#else
-	va_start(args);
-#endif
-	format(_bput, (long)&bb, form, args);
-	va_end(args);
-	if (bb.cnt < BFSIZ)
-		_bflush (&bb);
-	return (bb.count);
-}
-
-/* VARARGS3 */
-#ifdef	PROTOTYPES
-EXPORT int fprintf(FILE *file, const char *form, ...)
-#else
-EXPORT int fprintf(file, form, va_alist)
-	FILE	*file;
-	char	*form;
-	va_dcl
-#endif
-{
-	va_list	args;
-	_BUF	bb;
-
-	bb.ptr = bb.buf;
-	bb.cnt = BFSIZ;
-	bb.count = 0;
-	bb.f = file;
-#ifdef	PROTOTYPES
-	va_start(args, form);
-#else
-	va_start(args);
-#endif
-	format(_bput, (long)&bb, form, args);
-	va_end(args);
-	if (bb.cnt < BFSIZ)
-		_bflush (&bb);
-	return (bb.count);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/raisecond.c cdrdao-1.1.5/scsilib/lib/raisecond.c
--- cdrdao-1.1.5.orig/scsilib/lib/raisecond.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/raisecond.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,158 +0,0 @@
-/* @(#)raisecond.c	1.12 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	raise a condition (software signal)
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-/*
- *	Check for installed condition handlers.
- *	If a handler is found, the function is called with the appropriate args.
- *	If no handler is found or no handler signals success,
- *	the program will be aborted.
- *
- *	Copyright (c) 1985 J. Schilling
- */
-#include <mconfig.h>
-#include <stdio.h>
-#include <standard.h>
-#include <sigblk.h>
-#include <unixstd.h>
-#include <stdxlib.h>
-#include <strdefs.h>
-#include <avoffset.h>
-#include <schily.h>
-
-#if	!defined(AV_OFFSET) || !defined(FP_INDIR)
-#	ifdef	HAVE_SCANSTACK
-#	undef	HAVE_SCANSTACK
-#	endif
-#endif
-#ifdef	NO_SCANSTACK
-#	ifdef	HAVE_SCANSTACK
-#	undef	HAVE_SCANSTACK
-#	endif
-#endif
-
-/*
- * Macros to print to stderr without stdio, to avoid screwing up.
- */
-#ifndef	STDERR_FILENO
-#define	STDERR_FILENO	2
-#endif
-#define	eprints(a)	(void)write(STDERR_FILENO, (a), sizeof(a)-1)
-#define	eprintl(a)	(void)write(STDERR_FILENO, (a), strlen(a))
-
-#define	is_even(p)	((((long)(p)) & 1) == 0)
-#define	even(p)		(((long)(p)) & ~1L)
-#ifdef	__future__
-#define	even(p)		(((long)(p)) - 1)/* will this work with 64 bit ?? */
-#endif
-
-
-LOCAL	void raiseabort  __PR((const char *));
-
-#ifdef	HAVE_SCANSTACK
-
-#include <stkframe.h>
-
-LOCAL	BOOL framehandle __PR((SIGBLK *, const char *, const char *, long));
-
-/*
- *	Loop through the chain of procedure frames on the stack.
- *
- *	Frame pointers normally have even values.
- *	Frame pointers of procedures with an installed handler are marked odd.
- *	The even base value, in this case actually points to a SIGBLK which
- *	holds the saved "real" frame pointer.
- *	The SIGBLK mentioned above may me the start of a chain of SIGBLK's,
- *	containing different handlers.
- */
-void raisecond(signame, arg2)
-	const char	*signame;
-	long		arg2;
-{
-	register struct frame *fp = (struct frame *)getfp();
-
-	for(; fp; fp = (struct frame *)fp->fr_savfp) {
-		if (is_even(fp))
-			continue;
-		fp = (struct frame *)even(fp);	/* really is (SIGBLK *) */
-
-		if (framehandle((SIGBLK *)fp, signame, signame, arg2))
-			return;
-		else if (framehandle((SIGBLK *)fp, "any_other", signame, arg2))
-			return;
-		fp = (struct frame *)((SIGBLK *)fp)->sb_savfp;
-	}
-	/*
-	 * No matching handler that signals success found.
-	 * Print error message and abort.
-	 */
-	raiseabort(signame);
-	/* NOTREACHED */
-}
-
-/*
- *	Loop through the handler chain for a procedure frame.
- *
- *	If no handler with matching name is found, return FALSE,
- *	otherwise the first handler with matching name is called.
- *	The return value in the latter case depends on the called function.
- */
-LOCAL BOOL framehandle(sp, handlename, signame, arg2)
-	register SIGBLK *sp;
-	const char	*handlename;
-	const char	*signame;
-	long		arg2;
-{
-	for(; sp; sp = sp->sb_signext) {
-		if (streql(sp->sb_signame, handlename)) {
-			if (sp->sb_sigfun == NULL) {	/* deactivated */
-				return (FALSE);
-			} else {
-				return (*sp->sb_sigfun)(signame,
-							sp->sb_sigarg, arg2);
-			}
-		}
-	}
-	return (FALSE);
-}
-
-#else	/* HAVE_SCANSTACK */
-
-void raisecond(signame, arg2)
-	const char	*signame;
-	long		arg2;
-{
-	/*
-	 * Print error message and abort.
-	 */
-	raiseabort(signame);
-	/* NOTREACHED */
-}
-
-#endif	/* HAVE_SCANSTACK */
-
-LOCAL void raiseabort(signame)
-	const	char	*signame;
-{
-	eprints("Condition not caught: "); eprintl(signame); eprints(".\n");
-#ifndef	HAVE_SCANSTACK
-	eprints("Raisecond: not implemented.\n");
-#endif
-	abort();
-	/* NOTREACHED */
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/saveargs.c cdrdao-1.1.5/scsilib/lib/saveargs.c
--- cdrdao-1.1.5.orig/scsilib/lib/saveargs.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/saveargs.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,119 +0,0 @@
-/* @(#)saveargs.c	1.9 00/05/07 Copyright 1995 J. Schilling */
-/* save argc, argv for command error printing routines */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <standard.h>
-#include <strdefs.h>
-#include <stdxlib.h>
-#include <avoffset.h>
-#include <schily.h>
-
-#if	!defined(AV_OFFSET) || !defined(FP_INDIR)
-#	ifdef	HAVE_SCANSTACK
-#	undef	HAVE_SCANSTACK
-#	endif
-#endif
-#ifdef	NO_SCANSTACK
-#	ifdef	HAVE_SCANSTACK
-#	undef	HAVE_SCANSTACK
-#	endif
-#endif
-
-static	int	ac_saved;
-static	char	**av_saved;
-static	char	*av0_saved;
-static	char	*progname_saved;
-
-static	char	av0_sp[32];	/* av0 space, avoid malloc() in most cases */
-static	char	prn_sp[32];	/* name space, avoid malloc() in most cases */
-static	char	dfl_str[] = "?";
-
-void save_args(ac, av)
-	int	ac;
-	char	*av[];
-{
-	int	slen;
-
-	ac_saved = ac;
-	av_saved = av;
-
-	if (av0_saved && av0_saved != av0_sp)
-		free(av0_saved);
-
-	slen = strlen(av[0]) + 1;
-
-	if (slen <= (int)sizeof(av0_sp))
-		av0_saved = av0_sp;
-	else
-		av0_saved = malloc(slen);
-
-	if (av0_saved)
-		strcpy(av0_saved, av[0]);
-}
-
-int saved_ac()
-{
-	return (ac_saved);
-}
-
-char **saved_av()
-{
-	return (av_saved);
-}
-
-char *saved_av0()
-{
-	return (av0_saved);
-}
-
-void set_progname(name)
-	const char	*name;
-{
-	int	slen;
-
-	if (progname_saved && progname_saved != prn_sp)
-		free(progname_saved);
-
-	slen = strlen(name) + 1;
-
-	if (slen <= sizeof(prn_sp))
-		progname_saved = prn_sp;
-	else
-		progname_saved = malloc(slen);
-
-	if (progname_saved)
-		strcpy(progname_saved, name);
-}
-
-char *get_progname()
-{
-#ifdef	HAVE_SCANSTACK
-	char	*progname;
-#endif
-
-	if (progname_saved)
-		return (progname_saved);
-	if (av0_saved)
-		return (av0_saved);
-#ifdef	HAVE_SCANSTACK
-	progname = getav0();		/* scan stack to get argv[0] */
-	if (progname)
-		return (progname);
-#endif
-	return (dfl_str);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/serrmsg.c cdrdao-1.1.5/scsilib/lib/serrmsg.c
--- cdrdao-1.1.5.orig/scsilib/lib/serrmsg.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/serrmsg.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,116 +0,0 @@
-/* @(#)serrmsg.c	1.1 00/08/03 Copyright 1985,2000 J. Schilling */
-/*
- *	Routines for printing command errors
- *
- *	Copyright (c) 1985,2000 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <stdio.h>
-#include <standard.h>
-#include <stdxlib.h>
-#include <vadefs.h>
-#include <strdefs.h>
-#include <schily.h>
-#ifndef	HAVE_STRERROR
-extern	char	*sys_errlist[];
-extern	int	sys_nerr;
-#endif
-
-EXPORT	int	serrmsg		__PR((char *buf, size_t maxcnt, const char *, ...));
-EXPORT	int	serrmsgno	__PR((int, char *buf, size_t maxcnt, const char *, ...));
-LOCAL	int	_serrmsg	__PR((int, char *buf, size_t maxcnt, const char *, va_list));
-
-/* VARARGS1 */
-EXPORT int
-#ifdef	PROTOTYPES
-serrmsg(char *buf, size_t maxcnt, const char *msg, ...)
-#else
-serrmsg(buf, maxcnt, msg, va_alist)
-	char	*buf;
-	size_t	maxcnt;
-	char	*msg;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	ret;
-
-#ifdef	PROTOTYPES
-	va_start(args, msg);
-#else
-	va_start(args);
-#endif
-	ret = _serrmsg(geterrno(), buf, maxcnt, msg, args);
-	va_end(args);
-	return (ret);
-}
-
-/* VARARGS2 */
-#ifdef	PROTOTYPES
-EXPORT int
-serrmsgno(int err, char *buf, size_t maxcnt, const char *msg, ...)
-#else
-serrmsgno(err, buf, maxcnt, msg, va_alist)
-	int	err;
-	char	*buf;
-	size_t	maxcnt;
-	char	*msg;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	ret;
-
-#ifdef	PROTOTYPES
-	va_start(args, msg);
-#else
-	va_start(args);
-#endif
-	ret = _serrmsg(err, buf, maxcnt, msg, args);
-	va_end(args);
-	return (ret);
-}
-
-LOCAL int
-_serrmsg(err, buf, maxcnt, msg, args)
-	int		err;
-	char		*buf;
-	size_t		maxcnt;
-	const char	*msg;
-	va_list		args;
-{
-	int	ret;
-	char	errbuf[20];
-	char	*errnam;
-	char	*prognam = get_progname();
-	
-	if (err < 0) {
-		ret = js_snprintf(buf, maxcnt, "%s: %r", prognam, msg, args);
-	} else {
-		errnam = errmsgstr(err);
-		if (errnam == NULL) {
-			(void)js_snprintf(errbuf, sizeof (errbuf),
-						"Error %d", err);
-			errnam = errbuf;
-		}
-		ret = js_snprintf(buf, maxcnt,
-				"%s: %s. %r", prognam, errnam, msg, args);
-	}
-	return (ret);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/seterrno.c cdrdao-1.1.5/scsilib/lib/seterrno.c
--- cdrdao-1.1.5.orig/scsilib/lib/seterrno.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/seterrno.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,42 +0,0 @@
-/* @(#)seterrno.c	1.7 01/03/04 Copyright 1985 J. Schilling */
-/*
- *	Set error number
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <standard.h>
-#include <errno.h>
-#include <schily.h>
-
-#ifndef	HAVE_ERRNO_DEF
-extern	int	errno;
-#endif
-
-#ifdef	seterrno
-#undef	seterrno
-#endif
-
-int seterrno(err)
-	int	err;
-{
-	int	old = errno;
-
-	errno = err;
-	return (old);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/shlschily.mk cdrdao-1.1.5/scsilib/lib/shlschily.mk
--- cdrdao-1.1.5.orig/scsilib/lib/shlschily.mk	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/shlschily.mk	1969-12-31 19:00:00.000000000 -0500
@@ -1,20 +0,0 @@
-#ident @(#)shlschily.mk	1.2 00/02/10 
-###########################################################################
-SRCROOT=	..
-RULESDIR=	RULES
-CCOM=		cc
-include		$(SRCROOT)/$(RULESDIR)/rules.top
-###########################################################################
-
-SUBARCHDIR=	/pic
-.SEARCHLIST:	. $(ARCHDIR) stdio $(ARCHDIR)
-VPATH=		.:stdio:$(ARCHDIR)
-INSDIR=		lib
-TARGETLIB=	schily
-CPPOPTS +=	-Istdio
-include		Targets
-LIBS=		
-
-###########################################################################
-include		$(SRCROOT)/$(RULESDIR)/rules.shl
-###########################################################################
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/sprintf.c cdrdao-1.1.5/scsilib/lib/sprintf.c
--- cdrdao-1.1.5.orig/scsilib/lib/sprintf.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/sprintf.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,66 +0,0 @@
-/* @(#)sprintf.c	1.13 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <vadefs.h>
-#include <standard.h>
-#include <schily.h>
-
-/*
- * Do not include stdio.h, BSD systems define sprintf the wrong way!
- */
-EXPORT	int sprintf __PR((char *, const char *, ...));
-
-#ifdef	PROTOTYPES
-static void _cput(char c, long ba)
-#else
-static void _cput(c, ba)
-	char	c;
-	long	ba;
-#endif
-{
-	*(*(char **) ba)++ = c;
-}
-
-/* VARARGS2 */
-#ifdef	PROTOTYPES
-int sprintf(char *buf, const char *form, ...)
-#else
-int sprintf(buf, form, va_alist)
-	char	*buf;
-	char	*form;
-	va_dcl
-#endif
-{
-	va_list	args;
-	int	cnt;
-	char	*bp = buf;
-
-#ifdef	PROTOTYPES
-	va_start(args, form);
-#else
-	va_start(args);
-#endif
-	cnt = format(_cput, (long)&bp, form,  args);
-	va_end(args);
-	*bp = '\0';
-
-	return (cnt);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/cvmod.c cdrdao-1.1.5/scsilib/lib/stdio/cvmod.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/cvmod.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/cvmod.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,63 +0,0 @@
-/* @(#)cvmod.c	2.7 00/12/03 Copyright 1986, 1995 J. Schilling */
-/*
- *	Copyright (c) 1986, 1995 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-
-#ifndef	O_BINARY
-#define	O_BINARY	0
-#endif
-#ifndef	O_LARGEFILE
-#define	O_LARGEFILE	0
-#endif
-
-EXPORT int
-_cvmod(mode, omode, flag)
-	const char	*mode;
-	int		*omode;
-	int		*flag;
-{
-	while (*mode){
-		switch (*mode) {
-		
-		case 'r':   *omode |= O_RDONLY;	*flag |= FI_READ;	break;
-		case 'w':   *omode |= O_WRONLY;	*flag |= FI_WRITE;	break;
-		case 'e':   *omode |= O_EXCL;				break;
-		case 'c':   *omode |= O_CREAT;	*flag |= FI_CREATE;	break;
-		case 't':   *omode |= O_TRUNC;	*flag |= FI_TRUNC;	break;
-		case 'a':   *omode |= O_APPEND;	*flag |= FI_APPEND;	break;
-		case 'u':			*flag |= FI_UNBUF;	break;
-			/* dummy on UNIX */
-		case 'b':   *omode |= O_BINARY; *flag |= FI_BINARY;	break;
-			/*
-			 * XXX do we need this ?
-			 * XXX May this be a problem?
-			 */
-		case 'l':   *omode |= O_LARGEFILE;			break;
-		default:    raisecond(_badmode, 0L);
-			    return 0;
-		}
-		mode++;
-	}
-	if (*flag & FI_READ && *flag & FI_WRITE) {
-		*omode &= ~(O_RDONLY|O_WRONLY);
-		*omode |= O_RDWR;
-	}
-	return 1;
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/dat.c cdrdao-1.1.5/scsilib/lib/stdio/dat.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/dat.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/dat.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,23 +0,0 @@
-/* @(#)dat.c	1.2 96/02/04 Copyright 1986 J. Schilling */
-/*
- *	Copyright (c) 1986 J. Schilling
- */
-/* This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA. 
- */
-
-char	_badfile[]	= "bad_file";
-char	_badmode[]	= "bad_file_mode";
-char	_badop[]	= "bad_file_op";
-
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/fcons.c cdrdao-1.1.5/scsilib/lib/stdio/fcons.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/fcons.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/fcons.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,73 +0,0 @@
-/* @(#)fcons.c	2.12 00/12/04 Copyright 1986, 1995 J. Schilling */
-/*
- *	Copyright (c) 1986, 1995  J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-
-/*
- * XXX We need to switch to fseeko()/ftello() sometime in the future.
- * XXX See io.h hack.
- */
-
-LOCAL	char	*fmtab[] = {
-			"",	/* 0	FI_NONE				*/
-			"r",	/* 1	FI_READ				*/
-			"w",	/* 2	FI_WRITE		**1)	*/
-			"r+",	/* 3	FI_READ  | FI_WRITE		*/
-			"b",	/* 4	FI_NONE  | FI_BINARY		*/
-			"rb",	/* 5	FI_READ  | FI_BINARY		*/
-			"wb",	/* 6	FI_WRITE | FI_BINARY	**1)	*/
-			"r+b",	/* 7	FI_READ  | FI_WRITE | FI_BINARY	*/
-		};
-/*
- * NOTES:
- *	1)	fdopen() guarantees not to create/trunc files in this case
- *
- *	"w"	will create/trunc files with fopen()
- *	"a"	will create files with fopen()
- */
-
-
-EXPORT FILE *
-_fcons(fd, f, flag)
-	register FILE	*fd;
-		 int	f;
-		 int	flag;
-{
-	int	my_gflag = _io_glflag;
-
-	if (fd == (FILE *)NULL)
-		fd = fdopen(f, fmtab[flag&(FI_READ|FI_WRITE|FI_BINARY)]);
-
-	if (fd != (FILE *)NULL) {
-		if (flag & FI_APPEND) {
-			(void) fseek(fd, (off_t)0, SEEK_END);
-		}
-		if (flag & FI_UNBUF) {
-			setbuf(fd, NULL);
-			my_gflag |= _IOUNBUF;
-		}
-		set_my_flag(fd, my_gflag); /* must clear it if fd is reused */
-		return (fd);
-	}
-	if (flag & FI_CLOSE)
-		close(f);
-
-	return ((FILE *) NULL);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/fcons64.c cdrdao-1.1.5/scsilib/lib/stdio/fcons64.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/fcons64.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/fcons64.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,30 +0,0 @@
-/* @(#)fcons64.c	1.5 00/12/28 Copyright 2000 J. Schilling */
-/*
- *	Copyright (c) 2000 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#define	USE_LARGEFILES
-
-#include "io.h"
-
-/*#if	_LFS_LARGEFILE*/
-#ifdef	HAVE_LARGEFILES
-
-#include "fcons.c"
-
-#endif
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/fgetline.c cdrdao-1.1.5/scsilib/lib/stdio/fgetline.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/fgetline.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/fgetline.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,72 +0,0 @@
-/* @(#)fgetline.c	1.5 00/12/03 Copyright 1986 J. Schilling */
-/*
- *	Copyright (c) 1986 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-
-/*
- * XXX should we check if HAVE_USG_STDIO is defined and
- * XXX use something line memccpy to speed things up ???
- */
-
-EXPORT int
-fgetline(f, buf, len)
-	register	FILE	*f;
-			char	*buf;
-	register	int	len;
-{
-	register int	c	= '\0';
-	register char	*bp	= buf;
-	register int	nl	= '\n';
-
-	down2(f, _IOREAD, _IORW);
-
-	for(;;) {
-		if((c = getc(f)) < 0)
-			break;
-		if(c == nl)
-			break;
-		if (--len > 0) {
-			*bp++ = c;
-		} else {
-			/*
-			 * Read up to end of line
-			 */
-			while ((c = getc(f)) >= 0 && c != nl)
-				;
-			break;
-		}
-	}
-	*bp = '\0';
-	/*
-	 * If buffer is empty and we hit EOF, return EOF
-	 */
-	if(c < 0 && bp == buf)
-		return (c);
-
-	return (bp - buf);
-}
-
-EXPORT int
-getline(buf, len)
-	char	*buf;
-	int	len;
-{
-	return (fgetline(stdin, buf, len));
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/fileopen.c cdrdao-1.1.5/scsilib/lib/stdio/fileopen.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/fileopen.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/fileopen.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,39 +0,0 @@
-/* @(#)fileopen.c	1.8 00/12/03 Copyright 1986, 1995 J. Schilling */
-/*
- *	Copyright (c) 1986, 1995 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-
-EXPORT FILE *
-fileopen (name, mode)
-	const char	*name;
-	const char	*mode;
-{
-	int	ret;
-	int	omode = 0;
-	int	flag = 0;
-
-	if (!_cvmod (mode, &omode, &flag))
-		return (FILE *) NULL;
-
-	if ((ret = _openfd(name, omode)) < 0)
-		return (FILE *) NULL;
-
-	return _fcons ((FILE *)0, ret, flag);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/fileopen64.c cdrdao-1.1.5/scsilib/lib/stdio/fileopen64.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/fileopen64.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/fileopen64.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,30 +0,0 @@
-/* @(#)fileopen64.c	1.5 00/12/28 Copyright 2000 J. Schilling */
-/*
- *	Copyright (c) 2000 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#define	USE_LARGEFILES
-
-#include "io.h"
-
-/*#if	_LFS_LARGEFILE*/
-#ifdef	HAVE_LARGEFILES
-
-#include "fileopen.c"
-
-#endif
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/fileread.c cdrdao-1.1.5/scsilib/lib/stdio/fileread.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/fileread.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/fileread.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,94 +0,0 @@
-/* @(#)fileread.c	1.12 01/02/17 Copyright 1986 J. Schilling */
-/*
- *	Copyright (c) 1986 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-
-static	char	_readerr[]	= "file_read_err";
-
-#ifdef	HAVE_USG_STDIO
-
-EXPORT int
-fileread(f, buf, len)
-	register FILE	*f;
-	void	*buf;
-	int	len;
-{
-	int	cnt;
-	register int	n;
-
-	down2(f, _IOREAD, _IORW);
-
-	if (f->_flag & _IONBF){
-		cnt = _niread (fileno(f), buf, len);
-		if (cnt < 0) {
-			f->_flag |= _IOERR;
-			if (!(my_flag(f) & _IONORAISE))
-				raisecond(_readerr, 0L);
-		}
-		if (cnt == 0 && len)
-			f->_flag |= _IOEOF;
-		return cnt;
-	}
-	cnt = 0;
-	while (len > 0) {
-		if (f->_cnt <= 0){
-			if (usg_filbuf(f) == EOF)
-				break;
-			f->_cnt++;
-			f->_ptr--;
-		}
-		n = f->_cnt >= len ? len : f->_cnt;
-		buf = (void *)movebytes (f->_ptr, buf, n);
-		f->_ptr += n;
-		f->_cnt -= n;
-		cnt += n;
-		len -= n;
-	}
-	if (!ferror(f))
-		return cnt;
-	if (!(my_flag(f) & _IONORAISE))
-		raisecond(_readerr, 0L);
-	return -1;
-}
-
-#else
-
-EXPORT int
-fileread(f, buf, len)
-	register FILE	*f;
-	void	*buf;
-	int	len;
-{
-	int	cnt;
-
-	down2(f, _IOREAD, _IORW);
-
-	if (my_flag(f) & _IOUNBUF)
-		return _niread(fileno(f), buf, len);
-	cnt = fread(buf, 1, len, f);
-
-	if (!ferror(f))
-		return cnt;
-	if (!(my_flag(f) & _IONORAISE))
-		raisecond(_readerr, 0L);
-	return -1;
-}
-
-#endif	/* HAVE_USG_STDIO */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/filewrite.c cdrdao-1.1.5/scsilib/lib/stdio/filewrite.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/filewrite.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/filewrite.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,96 +0,0 @@
-/* @(#)filewrite.c	1.12 01/02/17 Copyright 1986 J. Schilling */
-/*
- *	Copyright (c) 1986 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-
-static	char	_writeerr[]	= "file_write_err";
-
-#ifdef	HAVE_USG_STDIO
-
-EXPORT int
-filewrite (f, vbuf, len)
-	register FILE	*f;
-	void	*vbuf;
-	int	len;
-{
-	register int	n;
-	int	cnt;
-	char		*buf = vbuf;
-
-	down2(f, _IOWRT, _IORW);
-
-	if (f->_flag & _IONBF){
-		cnt = write (fileno(f), buf, len);
-		if (cnt < 0){
-			f->_flag |= _IOERR;
-			if (!(my_flag(f) & _IONORAISE))
-				raisecond(_writeerr, 0L);
-		}
-		return cnt;
-	}
-	cnt = 0;
-	while (len > 0) {
-		if (f->_cnt <= 0){
-			if (usg_flsbuf((unsigned char) *buf++, f) == EOF)
-				break;
-			cnt++;
-			if (--len == 0)
-				break;
-		}
-		if ((n = f->_cnt >= len ? len : f->_cnt) > 0) {
-			f->_ptr = (unsigned char *)movebytes (buf, f->_ptr, n);
-			buf += n;
-			f->_cnt -= n;
-			cnt += n;
-			len -= n;
-		}
-	}
-	if (!ferror(f))
-		return cnt;
-	if (!(my_flag(f) & _IONORAISE))
-	raisecond(_writeerr, 0L);
-	return -1;
-}
-
-#else
-
-EXPORT int
-filewrite (f, vbuf, len)
-	register FILE	*f;
-	void	*vbuf;
-	int	len;
-{
-	int	cnt;
-	char		*buf = vbuf;
-
-	down2(f, _IOWRT, _IORW);
-
-	if (my_flag(f) & _IOUNBUF)
-		return write(fileno(f), buf, len);
-	cnt = fwrite(buf, 1, len, f);
-
-	if (!ferror(f))
-		return cnt;
-	if (!(my_flag(f) & _IONORAISE))
-	raisecond(_writeerr, 0L);
-	return -1;
-}
-
-#endif	/* HAVE_USG_STDIO */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/flag.c cdrdao-1.1.5/scsilib/lib/stdio/flag.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/flag.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/flag.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,131 +0,0 @@
-/* @(#)flag.c	2.7 00/12/03 Copyright 1986 J. Schilling */
-/*
- *	Copyright (c) 1986 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-#include <stdxlib.h>
-
-#ifdef	DO_MYFLAG
-
-#define	FL_INIT	10
-
-int	_io_glflag;		/* global default flag */
-int	_fl_inc = 10;		/* increment for expanding flag struct */
-int	_fl_max = FL_INIT;	/* max fd currently in _io_myfl */
-_io_fl	_io_smyfl[FL_INIT];	/* initial static space */
-_io_fl	*_io_myfl = _io_smyfl;	/* init to static space */
-
-LOCAL int _more_flags	__PR((FILE * ));
-
-LOCAL int
-_more_flags(fp)
-	FILE	*fp;
-{
-	register int	f = fileno(fp);
-	register int	n = _fl_max;
-	register _io_fl	*np;
-
-	while (n <= f)
-		n += _fl_inc;
-
-	if (_io_myfl == _io_smyfl) {
-		np = (_io_fl *) malloc(n * sizeof(*np));
-		fillbytes(np, n * sizeof(*np), '\0');
-		movebytes(_io_smyfl, np, sizeof(_io_smyfl)/sizeof(*np));
-	} else {
-		np = (_io_fl *) realloc(_io_myfl, n * sizeof(*np));
-		if (np)
-			fillbytes(&np[_fl_max], (n-_fl_max)*sizeof(*np), '\0');
-	}
-	if (np) {
-		_io_myfl = np;
-		_fl_max = n;
-		return (_io_get_my_flag(fp));
-	} else {
-		return (_IONORAISE);
-	}
-}
-
-EXPORT int
-_io_get_my_flag(fp)
-	register FILE	*fp;
-{
-	register int	f = fileno(fp);
-	register _io_fl	*fl;
-
-	if (f >= _fl_max)
-		return (_more_flags(fp));
-
-	fl = &_io_myfl[f];
-
-	if (fl->fl_io == 0 || fl->fl_io == fp)
-		return (fl->fl_flags);
-
-	while (fl && fl->fl_io != fp)
-		fl = fl->fl_next;
-
-	if (fl == 0)
-		return (0);
-
-	return (fl->fl_flags);
-}
-
-EXPORT void
-_io_set_my_flag(fp, flag)
-	FILE	*fp;
-	int	flag;
-{
-	register int	f = fileno(fp);
-	register _io_fl	*fl;
-	register _io_fl	*fl2;
-
-	if (f >= _fl_max)
-		(void) _more_flags(fp);
-
-	fl = &_io_myfl[f];
-
-	if (fl->fl_io != (FILE *)0) {
-		fl2 = fl;
-
-		while (fl && fl->fl_io != fp)
-			fl = fl->fl_next;
-		if (fl == 0) {
-			if ((fl = (_io_fl *) malloc(sizeof(*fl))) == 0)
-				return;
-			fl->fl_next = fl2->fl_next;
-			fl2->fl_next = fl;
-		}
-	}
-	fl->fl_io = fp;
-	fl->fl_flags = flag;
-}
-
-EXPORT void
-_io_add_my_flag(fp, flag)
-	FILE	*fp;
-	int	flag;
-{
-	int	oflag = _io_get_my_flag(fp);
-
-	oflag |= flag;
-
-	_io_set_my_flag(fp, oflag);
-}
-
-#endif	/* DO_MYFLAG */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/flush.c cdrdao-1.1.5/scsilib/lib/stdio/flush.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/flush.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/flush.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,27 +0,0 @@
-/* @(#)flush.c	1.6 00/12/03 Copyright 1986 J. Schilling */
-/*
- *	Copyright (c) 1986 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-
-EXPORT int
-flush()
-{
-	return (fflush(stdout));
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/io.h cdrdao-1.1.5/scsilib/lib/stdio/io.h
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/io.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/io.h	1969-12-31 19:00:00.000000000 -0500
@@ -1,216 +0,0 @@
-/* @(#)io.h	2.16 01/02/17 Copyright 1986, 1995 J. Schilling */
-/*
- *	Copyright (c) 1986, 1995 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#ifndef	_STDIO_IO_H
-#define	_STDIO_IO_H
-
-#include <mconfig.h>
-#include <stdio.h>
-#include <standard.h>
-#include <unixstd.h>
-#include <fctldefs.h>
-#include <schily.h>
-
-#ifdef	NO_USG_STDIO
-#	ifdef	HAVE_USG_STDIO
-#		undef	HAVE_USG_STDIO
-#	endif
-#endif
-
-/*#if	_LFS_LARGEFILE*/
-#ifdef	HAVE_LARGEFILES
-/*
- * XXX Hack until fseeko()/ftello() are available everywhere or until
- * XXX we know a secure way to let autoconf ckeck for fseeko()/ftello()
- * XXX without defining FILE_OFFSETBITS to 64 in confdefs.h
- */
-#	define	fseek	fseeko
-#	define	ftell	ftello
-#endif
-
-/*
- * speed things up...
- */
-#ifndef	_OPENFD_SRC
-#ifdef	_openfd
-#undef	_openfd
-#endif
-#define	_openfd(name, omode)	(open(name, omode, 0666))
-#endif
-
-#define	DO_MYFLAG		/* use local flags */
-
-/*
- * Flags used during fileopen(), ... by _fcons()/ _cvmod()
- */
-#define	FI_NONE		0x0000	/* no flags defined */
-
-#define	FI_READ		0x0001	/* open for reading */
-#define	FI_WRITE	0x0002	/* open for writing */
-#define	FI_BINARY	0x0004	/* open in binary mode */
-
-#define	FI_CREATE	0x0010	/* create if nessecary */
-#define	FI_TRUNC	0x0020	/* truncate file on open */
-#define	FI_APPEND	0x0040	/* append on each write */
-#define	FI_UNBUF	0x0080	/* dont't buffer io */
-#define	FI_CLOSE	0x1000	/* close file on error */
-
-/*
- * local flags
- */
-#define	_IONORAISE	01	/* do no raisecond() on errors */
-#define	_IOUNBUF	02	/* do unbuffered i/o */
-
-#ifdef	DO_MYFLAG
-
-struct _io_flags {
-	FILE	*fl_io;		/* file pointer */
-	struct _io_flags	/* pointer to next struct */
-		*fl_next;	/* if more file pointer to same fd */
-	int	fl_flags;	/* my flags */
-};
-
-typedef	struct _io_flags _io_fl;
-
-extern	int	_io_glflag;	/* global default flag */
-extern	_io_fl	*_io_myfl;	/* array of structs to hold my flags */
-extern	int	_fl_max;	/* max fd currently in _io_myfl */
-
-/*
- *	if fileno > max
- *		expand
- *	else if map[fileno].pointer == 0
- *		return 0
- *	else if map[fileno].pointer == p
- *		return map[fileno].flags
- *	else
- *		search list
- */
-#define	flp(p)		(&_io_myfl[fileno(p)])
-
-#ifdef	MY_FLAG_IS_MACRO
-#define	my_flag(p)	((int)fileno(p) >= _fl_max ?			\
-				_io_get_my_flag(p) :			\
-			((flp(p)->fl_io == 0 || flp(p)->fl_io == p) ?	\
-				flp(p)->fl_flags :			\
-				_io_get_my_flag(p)))
-#else
-#define	my_flag(p)	_io_get_my_flag(p)
-#endif
-
-#define	set_my_flag(p,v) _io_set_my_flag(p, v)
-#define	add_my_flag(p,v) _io_add_my_flag(p, v)
-
-extern	int	_io_get_my_flag __PR((FILE *));
-extern	void	_io_set_my_flag __PR((FILE *, int));
-extern	void	_io_add_my_flag __PR((FILE *, int));
-
-#else	/* DO_MYFLAG */
-
-#define	my_flag(p)		_IONORAISE	/* Always noraise */
-#define	set_my_flag(p,v)			/* Ignore */
-#define	add_my_flag(p,v)			/* Ignore */
-
-#endif	/* DO_MYFLAG */
-
-#ifdef	HAVE_USG_STDIO
-
-/*
- * Use the right filbuf()/flsbuf() function.
- */
-#ifdef	HAVE___FILBUF
-#	define	usg_filbuf(fp)		__filbuf(fp)
-#	define	usg_flsbuf(c, fp)	__flsbuf(c, fp)
-/*
- * Define prototypes to verify if our interface is right
- */
-extern	int	__filbuf		__PR((FILE *));
-/*extern	int	__flsbuf		__PR(());*/
-#else
-#	ifdef	HAVE__FILBUF
-#	define	usg_filbuf(fp)		_filbuf(fp)
-#	define	usg_flsbuf(c, fp)	_flsbuf(c, fp)
-/*
- * Define prototypes to verify if our interface is right
- */
-extern	int	_filbuf			__PR((FILE *));
-/*extern	int	_flsbuf			__PR(());*/
-#	else
-/*
- * no filbuf() but this will not happen on USG_STDIO systems.
- */
-#	endif
-#endif
-/*
- * Do not check this because flsbuf()'s 1st parameter may be 
- * int			SunOS
- * unsigned int		Apollo
- * unsigned char	HP-UX-11
- *
- * Note that the interface is now checked by autoconf.
- */
-/*extern	int	_flsbuf	__PR((int, FILE *));*/
-#else
-/*
- * If we are on a non USG system we cannot down file pointers
- */
-#undef	DO_DOWN
-#endif
-
-#ifndef	DO_DOWN
-/*
- *	No stream checking
- */
-#define	down(f)
-#define	down1(f,fl1)
-#define	down2(f,fl1,fl2)
-#else
-/*
- *	Do stream checking (works only on USG stdio)
- *
- *	New version of USG stdio.
- *	_iob[] holds only a small amount of pointers.
- *	Aditional space is allocated.
- *	We may check only if the file pointer is != NULL
- *	and if iop->_flag refers to a stream with appropriate modes.
- *	If _iob[] gets expanded by malloc() we cannot check upper bound.
- */
-#define down(f)		((f) == 0 || (f)->_flag==0 ? \
-				(raisecond(_badfile, 0L),(FILE *)0) : (f))
-
-#define down1(f,fl1)	((f) == 0 || (f)->_flag==0 ? \
-					(raisecond(_badfile, 0L),(FILE *)0) : \
-				(((f)->_flag & fl1) != fl1 ? \
-					(raisecond(_badop, 0L),FILE *)0) : \
-					(f)))
-
-#define down2(f,fl1,fl2)((f) == 0 || (f)->_flag==0 ? \
-				(raisecond(_badfile, 0L),(FILE *)0) : \
-			(((f)->_flag & fl1) != fl1 && \
-			 ((f)->_flag & fl2) != fl2 ? \
-				(raisecond(_badop, 0L),(FILE *)0) : \
-				(f)))
-#endif	/* DO_DOWN */
-
-extern	char	_badfile[];
-extern	char	_badmode[];
-extern	char	_badop[];
-
-#endif	/* _STDIO_IO_H */
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/stdio/niread.c cdrdao-1.1.5/scsilib/lib/stdio/niread.c
--- cdrdao-1.1.5.orig/scsilib/lib/stdio/niread.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/stdio/niread.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,35 +0,0 @@
-/* @(#)niread.c	1.8 00/12/03 Copyright 1986 J. Schilling */
-/*
- *	Copyright (c) 1986 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include "io.h"
-#include <errno.h>
-
-EXPORT int 
-_niread(f, buf, count)
-	int	f;
-	void	*buf;
-	int	count;
-{
-	int ret;
- 
-	while((ret = read(f, buf, count)) < 0 && geterrno() == EINTR)
-		;
-	return(ret);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/streql.c cdrdao-1.1.5/scsilib/lib/streql.c
--- cdrdao-1.1.5.orig/scsilib/lib/streql.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/streql.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,41 +0,0 @@
-/* @(#)streql.c	1.6 00/05/07 Copyright 1985 J. Schilling */
-/*
- *	Check if two strings are equal
- *
- *	Copyright (c) 1985 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <standard.h>
-#include <schily.h>
-
-int streql(a, b)
-	const char	*a;
-	const char	*b;
-{
-	register const char	*s1 = a;
-	register const char	*s2 = b;
-
-	if (s1 == NULL || s2 ==  NULL)
-		return (FALSE);
-
-	while (*s1 == *s2++)
-		if (*s1++ == '\0')
-			return (TRUE);
-
-	return (FALSE);
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/swabbytes.c cdrdao-1.1.5/scsilib/lib/swabbytes.c
--- cdrdao-1.1.5.orig/scsilib/lib/swabbytes.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/swabbytes.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,43 +0,0 @@
-/* @(#)swabbytes.c	1.5 00/05/07 Copyright 1988 J. Schilling */
-/*
- *	swab bytes in memory
- *
- *	Copyright (c) 1988 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <standard.h>
-#include <schily.h>
-
-#define	DO8(a)	a;a;a;a;a;a;a;a;
-
-void swabbytes(vp, cnt)
-		 void	*vp;
-	register int	cnt;
-{
-	register char	*bp = (char *)vp;
-	register char	c;
-
-	cnt /= 2;	/* even count only */
-	while ((cnt -= 8) >= 0) {
-		DO8(c = *bp++; bp[-1] = *bp; *bp++ = c;);
-	}
-	cnt += 8;
-	while (--cnt >= 0) {
-		c = *bp++; bp[-1] = *bp; *bp++ = c;
-	}
-}
diff -ruN cdrdao-1.1.5.orig/scsilib/lib/usleep.c cdrdao-1.1.5/scsilib/lib/usleep.c
--- cdrdao-1.1.5.orig/scsilib/lib/usleep.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/lib/usleep.c	1969-12-31 19:00:00.000000000 -0500
@@ -1,132 +0,0 @@
-/* @(#)usleep.c	1.15 01/01/07 Copyright 1995 J. Schilling */
-#ifndef lint
-static	char sccsid[] =
-	"@(#)usleep.c	1.15 01/01/07 Copyright 1995 J. Schilling";
-#endif
-/*
- *	Copyright (c) 1995 J. Schilling
- */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-#include <mconfig.h>
-#include <standard.h>
-#include <stdxlib.h>
-#include <timedefs.h>
-#ifdef	HAVE_POLL_H
-#	include <poll.h>
-#else
-#	ifdef	HAVE_SYS_POLL_H
-#	include <sys/poll.h>
-#	endif
-#endif
-#ifdef	HAVE_SYS_SYSTEMINFO_H
-#include <sys/systeminfo.h>
-#endif
-#include <libport.h>
-
-/*
- * SCO has a usleep() prototype in unistd.h
- * So we put this prototype before the #undef HAVE_USLEEP
- */
-#ifndef	HAVE_USLEEP
-EXPORT	int	usleep		__PR((int usec));
-#endif
-
-#ifdef	OPENSERVER
-/*
- * Don't use the usleep() from libc on SCO's OPENSERVER.
- * It will kill our processes with SIGALRM.
- */
-#undef	HAVE_USLEEP
-#endif
-
-#ifdef apollo
-/*
- * Apollo sys5.3 usleep is broken.  Define a version based on time_$wait.
- */
-#include <apollo/base.h>
-#include <apollo/time.h>
-#undef HAVE_USLEEP
-#endif
-
-#if	!defined(HAVE_USLEEP)
-
-EXPORT int
-usleep(usec)
-	int	usec;
-{
-#if defined(apollo)
-	/*
-	 * Need to check apollo before HAVE_SELECT, because Apollo has select,
-	 * but it's time wait feature is also broken :-(
-	 */
-#define HAVE_USLEEP
-	/*
-	 * XXX Do these vars need to be static on Domain/OS ???
-	 */
-	static time_$clock_t	DomainDelay;
-	static status_$t	DomainStatus;
-
-	/*
-	 * DomainDelay is a 48 bit value that defines how many 4uS periods to
-	 * delay.  Since the input value range is 32 bits, the upper 16 bits of
-	 * DomainDelay must be zero.  So we just divide the input value by 4 to
-	 * determine how many "ticks" to wait
-	 */
-	DomainDelay.c2.high16 = 0;
-	DomainDelay.c2.low32 = usec / 4;
-	time_$wait (time_$relative, DomainDelay, &DomainStatus);
-#endif	/* Apollo */
-
-#if	defined(HAVE_SELECT) && !defined(HAVE_USLEEP)
-#define	HAVE_USLEEP
-
-	struct timeval tv;
-	tv.tv_sec = usec / 1000000;
-	tv.tv_usec = usec % 1000000;
-	select(0, 0, 0, 0, &tv);
-#endif
-
-#if	defined(HAVE_POLL) && !defined(HAVE_USLEEP)
-#define	HAVE_USLEEP
-
-	if (poll(0, 0, usec/1000) < 0)
-		comerr("poll delay failed.\n");
-
-#endif
-
-#if	defined(HAVE_NANOSLEEP) && !defined(HAVE_USLEEP)
-#define	HAVE_USLEEP
-
-	struct timespec ts;
-
-	ts.tv_sec = usec / 1000000;
-	ts.tv_nsec = (usec % 1000000) * 1000;
-
-	nanosleep(&ts, 0);
-#endif
-
-
-#if	!defined(HAVE_USLEEP)
-#define	HAVE_USLEEP
-
-	sleep((usec+500000)/1000000);
-#endif
-
-	return (0);
-}
-#endif
diff -ruN cdrdao-1.1.5.orig/scsilib/librscg/scsi-remote.c cdrdao-1.1.5/scsilib/librscg/scsi-remote.c
--- cdrdao-1.1.5.orig/scsilib/librscg/scsi-remote.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/librscg/scsi-remote.c	2001-11-11 11:53:43.000000000 -0500
@@ -1,9 +1,8 @@
 #define	USE_REMOTE
-#ifdef	USE_REMOTE
-/* @(#)scsi-remote.c	1.3 00/09/10 Copyright 1990,2000 J. Schilling */
+/* @(#)scsi-remote.c	1.8 01/11/11 Copyright 1990,2000-2001 J. Schilling */
 #ifndef lint
 static	char __sccsid[] =
-	"@(#)scsi-remote.c	1.3 00/09/10 Copyright 1990,2000 J. Schilling";
+	"@(#)scsi-remote.c	1.8 01/11/11 Copyright 1990,2000-2001 J. Schilling";
 #endif
 /*
  *	Remote SCSI user level command transport routines
@@ -14,7 +13,7 @@
  *	Choose your name instead of "schily" and make clear that the version
  *	string is related to a modified source.
  *
- *	Copyright (c) 1990,2000 J. Schilling
+ *	Copyright (c) 1990,2000-2001 J. Schilling
  */
 /*
  * This program is free software; you can redistribute it and/or modify
@@ -33,6 +32,12 @@
  */
 
 #include <mconfig.h>
+
+#if !defined(HAVE_NETDB_H) || !defined(HAVE_RCMD)
+#undef	USE_REMOTE				/* There is no rcmd() */
+#endif
+
+#ifdef	USE_REMOTE
 #include <stdio.h>
 #include <sys/types.h>
 #include <fctldefs.h>
@@ -63,7 +68,7 @@
 /*extern	BOOL	debug;*/
 LOCAL	BOOL	debug = 1;
 
-LOCAL	char	_scg_trans_version[] = "remote-1.3";	/* The version for remote SCSI	*/
+LOCAL	char	_scg_trans_version[] = "remote-1.8";	/* The version for remote SCSI	*/
 LOCAL	char	_scg_auth_schily[]	= "schily";	/* The author for this module	*/
 
 LOCAL	int	scgo_rsend		__PR((SCSI *scgp));
@@ -79,6 +84,11 @@
 LOCAL	int	scgo_risatapi		__PR((SCSI *scgp));
 LOCAL	int	scgo_rreset		__PR((SCSI *scgp, int what));
 
+/*
+ * XXX We should rethink the fd parameter now that we introduced
+ * XXX the rscsirchar() function and most access of remfd is done
+ * XXX via scglocal(scgp)->remfd.
+ */
 LOCAL	void	rscsiabrt		__PR((int sig));
 LOCAL	int	rscsigetconn		__PR((SCSI *scgp, char* host));
 LOCAL	char	*rscsiversion		__PR((SCSI *scgp, int fd, int what));
@@ -93,6 +103,8 @@
 LOCAL	int	rscsiisatapi		__PR((SCSI *scgp, int fd));
 LOCAL	int	rscsireset		__PR((SCSI *scgp, int fd, int what));
 LOCAL	int	rscsiscmd		__PR((SCSI *scgp, int fd, struct scg_cmd *sp));
+LOCAL	int	rscsifillrbuf		__PR((SCSI *scgp));
+LOCAL	int	rscsirchar		__PR((SCSI *scgp, char *cp));
 LOCAL	int	rscsireadbuf		__PR((SCSI *scgp, int fd, char *buf, int count));
 LOCAL	void	rscsivoidarg		__PR((SCSI *scgp, int fd, int count));
 LOCAL	int	rscsicmd		__PR((SCSI *scgp, int fd, char* name, char* cbuf));
@@ -104,8 +116,13 @@
 
 /*--------------------------------------------------------------------------*/
 
+#define	READBUF_SIZE	128
+
 struct scg_local {
 	int	remfd;
+	char	readbuf[READBUF_SIZE];
+	char	*readbptr;
+	int	readbcnt;
 	BOOL	isopen;
 	int	rsize;
 	int	wsize;
@@ -114,6 +131,7 @@
 	char	*v_sccs_id;
 };
 
+
 #define scglocal(p)	((struct scg_local *)((p)->local))
 
 scg_ops_t remote_ops = {
@@ -221,6 +239,8 @@
 		if (scgp->local == NULL)
 			return (0);
 		scglocal(scgp)->remfd = -1;
+		scglocal(scgp)->readbptr = scglocal(scgp)->readbuf;
+		scglocal(scgp)->readbcnt = 0;
 		scglocal(scgp)->isopen = FALSE;
 		scglocal(scgp)->rsize = 0;
 		scglocal(scgp)->wsize = 0;
@@ -474,7 +494,7 @@
 	} else {
 		name = pw->pw_name;
 	}
-	if (scgp->debug)
+	if (scgp->debug > 0)
 		errmsgno(EX_BAD, "locuser: '%s' rscsiuser: '%s' host: '%s'\n",
 						pw->pw_name, name, host);
 	rscsipeer = host;
@@ -576,7 +596,7 @@
 	}
 	if (size > scglocal(scgp)->wsize) {
 		scglocal(scgp)->wsize = size;
-		if (scgp->debug)
+		if (scgp->debug > 0)
 			errmsgno(EX_BAD, "sndsize: %d\n", size);
 	}
 #endif
@@ -588,7 +608,7 @@
 	}
 	if (size > scglocal(scgp)->rsize) {
 		scglocal(scgp)->rsize = size;
-		if (scgp->debug)
+		if (scgp->debug > 0)
 			errmsgno(EX_BAD, "rcvsize: %d\n", size);
 	}
 #endif
@@ -690,11 +710,11 @@
 		}
 	}
 	errno = 0;
-	if (write(fd, cbuf, ret) != ret)
+	if (_nixwrite(fd, cbuf, ret) != ret)
 		rscsiaborted(scgp, fd);
 	
 	if (amt > 0) {
-		if (write(fd, sp->addr, amt) != amt)
+		if (_nixwrite(fd, sp->addr, amt) != amt)
 			rscsiaborted(scgp, fd);
 	}
 
@@ -724,6 +744,31 @@
 }
 
 LOCAL int
+rscsifillrbuf(scgp)
+	SCSI	*scgp;
+{
+	scglocal(scgp)->readbptr = scglocal(scgp)->readbuf;
+
+	return (scglocal(scgp)->readbcnt =
+			_niread(scglocal(scgp)->remfd,
+			     scglocal(scgp)->readbuf, READBUF_SIZE));
+}
+
+LOCAL int
+rscsirchar(scgp, cp)
+	SCSI	*scgp;
+	char	*cp;
+{
+	if (--(scglocal(scgp)->readbcnt) < 0) {
+		if (rscsifillrbuf(scgp) <= 0)
+			return (scglocal(scgp)->readbcnt);
+		--(scglocal(scgp)->readbcnt);
+	}
+	*cp = *(scglocal(scgp)->readbptr)++;
+	return (1);
+}
+
+LOCAL int
 rscsireadbuf(scgp, fd, buf, count)
 	SCSI	*scgp;
 	int	fd;
@@ -734,8 +779,17 @@
 	register int	amt = 0;
 	register int	cnt;
 
+	if (scglocal(scgp)->readbcnt > 0) {
+		cnt = scglocal(scgp)->readbcnt;
+		if (cnt > n)
+			cnt = n;
+		movebytes(scglocal(scgp)->readbptr, buf, cnt);
+		scglocal(scgp)->readbptr += cnt;
+		scglocal(scgp)->readbcnt -= cnt;
+		amt += cnt;
+	}
 	while (amt < n) {
-		if ((cnt = read(fd, &buf[amt], n - amt)) <= 0) {
+		if ((cnt = _niread(fd, &buf[amt], n - amt)) <= 0) {
 			return (rscsiaborted(scgp, fd));
 		}
 		amt += cnt;
@@ -782,7 +836,7 @@
 	int	buflen = strlen(cbuf);
 
 	errno = 0;
-	if (write(fd, cbuf, buflen) != buflen)
+	if (_nixwrite(fd, cbuf, buflen) != buflen)
 		rscsiaborted(scgp, fd);
 }
 
@@ -796,7 +850,7 @@
 	register char	*cp;
 
 	for (cp = line; cp < &line[count]; cp++) {
-		if (read(fd, cp, 1) != 1)
+		if (rscsirchar(scgp, cp) != 1)
 			return (rscsiaborted(scgp, fd));
 
 		if (*cp == '\n') {
@@ -852,7 +906,7 @@
 			rscsireadbuf(scgp, fd, scgp->errstr, count);
 			rscsivoidarg(scgp, fd, voidsize);
 		}
-		if (scgp->debug)
+		if (scgp->debug > 0)
 			errmsgno(number, "Remote status(%s): %d '%s'.\n",
 							name, number, cbuf);
 		errno = number;
@@ -860,7 +914,7 @@
 	}
 	if (code != 'A') {
 		/* XXX Hier kommt evt Command not found ... */
-		if (scgp->debug)
+		if (scgp->debug > 0)
 			errmsgno(EX_BAD, "Protocol error (got %s).\n", cbuf);
 		return (rscsiaborted(scgp, fd));
 	}
@@ -872,7 +926,7 @@
 	SCSI	*scgp;
 	int	fd;
 {
-	if ((scgp && scgp->debug) || debug)
+	if ((scgp && scgp->debug > 0) || debug)
 		errmsgno(EX_BAD, "Lost connection to remote host ??\n");
 	/* if fd >= 0 */
 	/* close file */
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scg/scsidefs.h cdrdao-1.1.5/scsilib/libscg/scg/scsidefs.h
--- cdrdao-1.1.5.orig/scsilib/libscg/scg/scsidefs.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scg/scsidefs.h	2001-09-27 12:01:31.000000000 -0400
@@ -1,4 +1,4 @@
-/* @(#)scsidefs.h	1.24 01/02/23 Copyright 1988 J. Schilling */
+/* @(#)scsidefs.h	1.27 01/09/27 Copyright 1988 J. Schilling */
 /*
  *	Definitions for SCSI devices i.e. for error strings in scsierrs.c
  *
@@ -30,6 +30,12 @@
 /*
  * Disks
  */
+#ifdef	DEV_UNKNOWN
+/*
+ * True64 defines DEV_UNKNOWN in /usr/include/sys/devio.h as "UNKNOWN"
+ */
+#undef	DEV_UNKNOWN
+#endif
 #define	DEV_UNKNOWN		0
 #define	DEV_ACB40X0		1
 #define	DEV_ACB4000		2
@@ -73,6 +79,7 @@
 #define	DEV_MMC_CDR		502
 #define	DEV_MMC_CDRW		503
 #define	DEV_MMC_DVD		504
+#define	DEV_MMC_DVD_WR		505
 
 #define	DEV_CDD_521_OLD		510
 #define	DEV_CDD_521		511
@@ -80,6 +87,7 @@
 #define	DEV_PCD_600		513
 #define	DEV_CDD_2000		514
 #define	DEV_CDD_2600		515
+#define	DEV_TYUDEN_EW50		516
 #define	DEV_YAMAHA_CDR_100	520
 #define	DEV_YAMAHA_CDR_400	521
 #define	DEV_PLASMON_RF_4100	530
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scg/scsireg.h cdrdao-1.1.5/scsilib/libscg/scg/scsireg.h
--- cdrdao-1.1.5.orig/scsilib/libscg/scg/scsireg.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scg/scsireg.h	2001-10-30 17:12:05.000000000 -0500
@@ -1,4 +1,4 @@
-/* @(#)scsireg.h	1.24 00/11/07 Copyright 1987 J. Schilling */
+/* @(#)scsireg.h	1.26 01/10/30 Copyright 1987 J. Schilling */
 /*
  *	usefull definitions for dealing with CCS SCSI - devices
  *
@@ -772,14 +772,17 @@
 	Uchar	p_len;			/* 0x32 = 50 Bytes */
 	Ucbit	write_type	: 4;	/* Session write type (PACKET/TAO...)*/
 	Ucbit	test_write	: 1;	/* Do not actually write data	     */
-	Ucbit	res_2		: 3;
+	Ucbit	LS_V		: 1;	/* Link size valid		     */
+	Ucbit	BUFE		: 1;	/* Enable Bufunderrun free rec.	     */
+	Ucbit	res_2_7		: 1;
 	Ucbit	track_mode	: 4;	/* Track mode (Q-sub control nibble) */
 	Ucbit	copy		: 1;	/* 1st higher gen of copy prot track ~*/
 	Ucbit	fp		: 1;	/* Fixed packed (if in packet mode)  */
 	Ucbit	multi_session	: 2;	/* Multi session write type	     */
 	Ucbit	dbtype		: 4;	/* Data block type		     */
 	Ucbit	res_4		: 4;	/* Reserved			     */
-	Uchar	res_56[2];		/* Reserved			     */
+	Uchar	link_size;		/* Link Size (default is 7)	     */
+	Uchar	res_6;			/* Reserved			     */
 	Ucbit	host_appl_code	: 6;	/* Host application code of disk     */
 	Ucbit	res_7		: 2;	/* Reserved			     */
 	Uchar	session_format;		/* Session format (DA/CDI/XA)	     */
@@ -797,7 +800,9 @@
 struct cd_mode_page_05 {		/* write parameters */
 		MP_P_CODE;		/* parsave & pagecode */
 	Uchar	p_len;			/* 0x32 = 50 Bytes */
-	Ucbit	res_2		: 3;
+	Ucbit	res_2_7		: 1;
+	Ucbit	BUFE		: 1;	/* Enable Bufunderrun free rec.	     */
+	Ucbit	LS_V		: 1;	/* Link size valid		     */
 	Ucbit	test_write	: 1;	/* Do not actually write data	     */
 	Ucbit	write_type	: 4;	/* Session write type (PACKET/TAO...)*/
 	Ucbit	multi_session	: 2;	/* Multi session write type	     */
@@ -806,7 +811,8 @@
 	Ucbit	track_mode	: 4;	/* Track mode (Q-sub control nibble) */
 	Ucbit	res_4		: 4;	/* Reserved			     */
 	Ucbit	dbtype		: 4;	/* Data block type		     */
-	Uchar	res_56[2];		/* Reserved			     */
+	Uchar	link_size;		/* Link Size (default is 7)	     */
+	Uchar	res_6;			/* Reserved			     */
 	Ucbit	res_7		: 2;	/* Reserved			     */
 	Ucbit	host_appl_code	: 6;	/* Host application code of disk     */
 	Uchar	session_format;		/* Session format (DA/CDI/XA)	     */
@@ -847,7 +853,7 @@
 	Ucbit	mode_2_form_1	: 1;	/* Reads Mode-2 form 1 media (XA)    */
 	Ucbit	mode_2_form_2	: 1;	/* Reads Mode-2 form 2 media	     */
 	Ucbit	multi_session	: 1;	/* Reads multi-session media	     */
-	Ucbit	res_4		: 1;	/* Reserved			     */
+	Ucbit	BUF		: 1;	/* Supports Buffer under. free rec.  */
 	Ucbit	cd_da_supported	: 1;	/* Reads audio data with READ CD cmd */
 	Ucbit	cd_da_accurate	: 1;	/* READ CD data stream is accurate   */
 	Ucbit	rw_supported	: 1;	/* Reads R-W sub channel information */
@@ -903,7 +909,7 @@
 	Ucbit	test_write	: 1;	/* Supports emulation write	     */
 	Ucbit	cd_rw_write	: 1;	/* Supports writing CD-RW media	     */
 	Ucbit	cd_r_write	: 1;	/* Supports writing CD-R  media	     */
-	Ucbit	res_4		: 1;	/* Reserved			     */
+	Ucbit	BUF		: 1;	/* Supports Buffer under. free rec.  */
 	Ucbit	multi_session	: 1;	/* Reads multi-session media	     */
 	Ucbit	mode_2_form_2	: 1;	/* Reads Mode-2 form 2 media	     */
 	Ucbit	mode_2_form_1	: 1;	/* Reads Mode-2 form 1 media (XA)    */
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scg/scsitransp.h cdrdao-1.1.5/scsilib/libscg/scg/scsitransp.h
--- cdrdao-1.1.5.orig/scsilib/libscg/scg/scsitransp.h	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scg/scsitransp.h	2002-05-04 14:42:40.000000000 -0400
@@ -1,24 +1,10 @@
-/* @(#)scsitransp.h	1.50 01/03/18 Copyright 1995 J. Schilling */
+/* @(#)scsitransp.h	1.51 02/05/04 Copyright 1995 J. Schilling */
 /*
  *	Definitions for commands that use functions from scsitransp.c
  *
  *	Copyright (c) 1995 J. Schilling
  */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
+/*@@C@@*/
 
 #ifndef	_SCG_SCSITRANSP_H
 #define	_SCG_SCSITRANSP_H
@@ -39,6 +25,8 @@
 #include <scg/scgops.h>
 #endif
 
+typedef	int	(*scg_cb_t)	__PR((void *));
+
 struct scg_scsi {
 	scg_ops_t *ops;		/* Ptr to low level SCSI transport ops	*/
 	int	fd;		/* File descriptor for next I/O		*/
@@ -74,6 +62,8 @@
 	char	*errptr;	/* Actual write pointer into errstr	*/
 	void	*errfile;	/* FILE to write errors to. NULL for not*/
 				/* writing and leaving errs in errstr	*/
+	scg_cb_t cb_fun;
+	void	*cb_arg;
 
 	struct scsi_inquiry *inq;
 	struct scsi_capacity *cap;
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsi-amigaos.c cdrdao-1.1.5/scsilib/libscg/scsi-amigaos.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsi-amigaos.c	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/libscg/scsi-amigaos.c	2001-12-02 09:37:37.000000000 -0500
@@ -0,0 +1,469 @@
+/* @(#)scsi-amigaos.c	1.2 01/12/02 Copyright 1997,2000,2001 J. Schilling */
+#ifndef lint
+static	char __sccsid[] =
+	"@(#)scsi-amigaos.c	1.2 01/12/02 Copyright 1997,2000,2001 J. Schilling";
+#endif
+/*
+ *	Interface for the AmigaOS generic SCSI implementation.
+ *
+ *	Warning: you may change this source, but if you do that
+ *	you need to change the _scg_version and _scg_auth* string below.
+ *	You may not return "schily" for an SCG_AUTHOR request anymore.
+ *	Choose your name instead of "schily" and make clear that the version
+ *	string is related to a modified source.
+ *
+ *	Copyright (c) 1997, 2000, 2001 J. Schilling
+ *	AmigaOS support code written by T. Langer
+ */
+/*
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; see the file COPYING.  If not, write to
+ * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+#define	BOOL	int
+
+#include <exec/ports.h>
+#include <exec/io.h>
+#include <devices/scsidisk.h>
+#include <exec/semaphores.h>
+#include <exec/memory.h>
+#include <clib/exec_protos.h>
+#include <clib/alib_protos.h>
+
+/*
+ *	Warning: you may change this source, but if you do that
+ *	you need to change the _scg_version and _scg_auth* string below.
+ *	You may not return "schily" for an SCG_AUTHOR request anymore.
+ *	Choose your name instead of "schily" and make clear that the version
+ *	string is related to a modified source.
+ */
+LOCAL	char	_scg_trans_version[] = "scsi-amigaos.c-1.2";	/* The version for this transport */
+LOCAL	char	_scg_auth[] = "T. Langer";
+
+#define	MAX_SCG		2	/* Max # of SCSI controllers */
+#define	MAX_TGT		8
+#define	MAX_LUN		8
+
+struct	scg_local {
+	struct IOStdReq *scgfiles[MAX_SCG][MAX_TGT][MAX_LUN];
+};
+
+#define	scglocal(p)	((struct scg_local *)((p)->local))
+
+#define MAX_DMA_AMIGAOS (64*1024)
+
+LOCAL struct IOStdReq	*open_amiga_scsi __PR((char *dev, int busno, int tgt, int tlun, char *errstr));
+
+/*
+ * Return version information for the low level SCSI transport code.
+ * This has been introduced to make it easier to trace down problems
+ * in applications.
+ */
+LOCAL char *
+scgo_version(scgp, what)
+	SCSI	*scgp;
+	int	what;
+{
+	if (scgp != (SCSI *)0) {
+		switch (what) {
+
+		case SCG_VERSION:
+			return (_scg_trans_version);
+		/*
+		 * If you changed this source, you are not allowed to
+		 * return "schily" for the SCG_AUTHOR request.
+		 */
+		case SCG_AUTHOR:
+/*			return (_scg_auth_schily);*/
+			return (_scg_auth);
+		case SCG_SCCS_ID:
+			return (__sccsid);
+		}
+	}
+	return ((char *)0);
+}
+
+LOCAL int
+scgo_open(scgp, device)
+	SCSI	*scgp;
+	char	*device;
+{
+		 int	busno	= scg_scsibus(scgp);
+		 int	tgt	= scg_target(scgp);
+		 int	tlun	= scg_lun(scgp);
+	register int	f;
+	register int	b;
+	register int	t;
+	register int	l;
+	register int	nopen = 0;
+	register struct IOStdReq *ioreq;
+	char            devname[64] = "scsi.device";
+
+	if (busno >= MAX_SCG || tgt >= MAX_TGT || tlun >= MAX_LUN) {
+		errno = EINVAL;
+		if (scgp->errstr) {
+			js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+				"Illegal value for busno, target or lun '%d,%d,%d'",
+				busno, tgt, tlun);
+		}
+		return (-1);
+	}
+	if (scgp->local == NULL) {
+		scgp->local = malloc(sizeof(struct scg_local));
+		if (scgp->local == NULL)
+			return (0);
+
+		for (b = 0; b < MAX_SCG; b++) {
+			for (t = 0; t < MAX_TGT; t++) {
+				for (l = 0; l < MAX_LUN; l++) {
+					scglocal(scgp)->scgfiles[b][t][l] = (struct IOStdReq *)-1;
+				}
+			}
+		}
+	}
+	if (device == NULL || *device == '\0') {
+		device = devname;
+	}
+	if (tlun < 0) {
+		tlun = 0;
+	}
+ /* cdrecord [-scanbus] dev=b,t,l | cdrecord [-scanbus] dev=xxx.device:b,t,l */
+	if (busno >= 0 && tgt >= 0 && tlun >= 0) {
+		ioreq = open_amiga_scsi(device, busno, tgt, tlun, scgp->errstr);
+		if (ioreq != NULL) {
+			scglocal(scgp)->scgfiles[busno][tgt][tlun] = ioreq;
+			nopen++;;
+		}
+	}
+ /* cdrecord -scanbus  | crederord -scanbus dev=xxxx.device */
+	else {
+		for (b = 0; b < MAX_SCG; b++) {
+			for (t = 0; t < MAX_TGT; t++) {
+				for (l = 0; l < MAX_LUN; l++) {
+					ioreq = open_amiga_scsi(device, b, t, l, scgp->errstr);
+
+					if (ioreq != NULL) {
+						scglocal(scgp)->scgfiles[b][t][l] = ioreq;
+						nopen++;
+					}
+				}
+			}
+		}
+	}
+	return (nopen);
+}
+
+LOCAL struct IOStdReq *
+open_amiga_scsi(dev, busno, tgt, tlun, errstr)
+	char	*dev;
+	int	busno;
+	int	tgt;
+	int	tlun;
+	char	*errstr;
+{
+	register struct IOStdReq *ioreq = NULL;
+	register int    f;
+	ULONG           unit = (100 * busno) + (10 * tlun) + tgt;
+	struct MsgPort *Port;
+
+	Port = CreatePort(NULL, 0);
+	if (Port != NULL) {
+		ioreq = CreateStdIO(Port);
+		if (ioreq != NULL) {
+			f = OpenDevice(dev, unit, (struct IORequest *) ioreq, 0L);
+			if (f != 0) {
+				if (errstr) {
+					js_snprintf(errstr, SCSI_ERRSTR_SIZE,
+						"Cannot open '%s'",
+						dev);
+				}
+				DeleteStdIO(ioreq);
+				DeletePort(Port);
+				ioreq = NULL;
+			}
+		} else {
+			if (errstr) {
+				js_snprintf(errstr, SCSI_ERRSTR_SIZE,
+					"Cannot create IOReq");
+			}
+			DeletePort(Port);
+		}
+	} else {
+		if (errstr) {
+			js_snprintf(errstr, SCSI_ERRSTR_SIZE,
+				"Cannot open Message Port");
+		}
+	}
+	return (ioreq);
+}
+
+
+LOCAL int
+scgo_close(SCSI * scgp)
+{
+	register struct IOStdReq *ioreq;
+	register int    b;
+	register int    t;
+	register int    l;
+
+	if (scgp->local == NULL)
+		return (-1);
+
+	for (b = 0; b < MAX_SCG; b++) {
+		for (t = 0; t < MAX_TGT; t++) {
+			for (l = 0; l < MAX_LUN; l++) {
+				ioreq = scglocal(scgp)->scgfiles[b][t][l];
+				if (ioreq != (struct IOStdReq *)-1) {
+					ULONG           unit = (100 * b) + (10 * l) + t;
+
+					if (scgp->debug)
+						printf("closing device unit %d\n", unit);
+					CloseDevice((struct IORequest *) ioreq);
+					DeleteStdIO(ioreq);
+					DeletePort(ioreq->io_Message.mn_ReplyPort);
+					scglocal(scgp)->scgfiles[b][t][l] = (struct IOStdReq *)-1;
+				}
+			}
+		}
+	}
+	return (0);
+}
+
+LOCAL long
+scgo_maxdma(scgp, amt)
+	SCSI	*scgp;
+	long	amt;
+{
+	return (MAX_DMA_AMIGAOS);
+}
+
+LOCAL void *
+scgo_getbuf(scgp, amt)
+	SCSI	*scgp;
+	long	amt;
+{
+	if (scgp->debug > 0) {
+		js_fprintf((FILE *)scgp->errfile,
+			"scgo_getbuf: %ld bytes\n", amt);
+	}
+	scgp->bufbase = valloc((size_t)(amt));
+	return (scgp->bufbase);
+}
+
+LOCAL void
+scgo_freebuf(scgp)
+	SCSI	*scgp;
+{
+	if (scgp->bufbase)
+		free(scgp->bufbase);
+	scgp->bufbase = NULL;
+}
+
+LOCAL BOOL
+scgo_havebus(scgp, busno)
+	SCSI	*scgp;
+	int	busno;
+{
+	register int	t;
+	register int	l;
+
+	if (busno < 0 || busno >= MAX_SCG)
+		return (FALSE);
+
+	if (scgp->local == NULL)
+		return (FALSE);
+
+	for (t=0; t < MAX_TGT; t++) {
+		for (l=0; l < MAX_LUN ; l++)
+			if (scglocal(scgp)->scgfiles[busno][t][l] != (struct IOStdReq *)-1)
+				return (TRUE);
+	}
+	return (FALSE);
+}
+
+LOCAL int
+scgo_fileno(scgp, busno, tgt, tlun)
+	SCSI	*scgp;
+	int	busno;
+	int	tgt;
+	int	tlun;
+{
+	if (busno < 0 || busno >= MAX_SCG ||
+	    tgt < 0 || tgt >= MAX_TGT ||
+	    tlun < 0 || tlun >= MAX_LUN)
+		return (-1);
+
+	if (scgp->local == NULL)
+		return (-1);
+
+	return ((int)scglocal(scgp)->scgfiles[busno][tgt][tlun]);
+}
+
+LOCAL int
+scgo_initiator_id(scgp)
+	SCSI           *scgp;
+{
+	return (-1);
+}
+
+LOCAL int
+scgo_isatapi(scgp)
+	SCSI	*scgp;
+
+{
+	return (FALSE);
+}
+
+LOCAL int
+scgo_reset(scgp, what)
+	SCSI	*scgp;
+	int	what;
+{
+	/* XXX synchronous reset command - is this wise? */
+	errno = EINVAL;
+	return (-1);
+}
+
+LOCAL int
+scgo_send(scgp)
+	SCSI		*scgp;
+{
+	char		senseData[SCG_MAX_SENSE];
+	register struct IOStdReq *ioreq = (struct IOStdReq *) scgp->fd;
+	struct SCSICmd	Cmd;
+	int		ret = 0;
+	struct scg_cmd	*sp = scgp->scmd;
+
+	sp->error = SCG_NO_ERROR;
+	sp->sense_count = 0;
+	sp->u_scb.cmd_scb[0] = 0;
+	sp->resid = 0;
+
+	if (ioreq == (struct IOStdReq *)-1) {
+		sp->error = SCG_FATAL;
+		return (0);
+	}
+	ioreq->io_Length = sizeof(struct SCSICmd);
+	ioreq->io_Data = &Cmd;
+	ioreq->io_Command = HD_SCSICMD;
+
+	Cmd.scsi_Flags = SCSIF_AUTOSENSE;
+	if (sp->flags & SCG_RECV_DATA)
+		Cmd.scsi_Flags |= SCSIF_READ;
+	else if (sp->size > 0)
+		Cmd.scsi_Flags |= SCSIF_WRITE;
+
+	Cmd.scsi_Command = malloc(sp->cdb_len);
+	movebytes(sp->cdb.cmd_cdb, Cmd.scsi_Command, sp->cdb_len);
+	Cmd.scsi_CmdLength = sp->cdb_len;
+	Cmd.scsi_Data = (void *) sp->addr;
+	Cmd.scsi_Length = sp->size;
+	Cmd.scsi_Actual = 0;
+
+	Cmd.scsi_SenseData = senseData;
+	fillbytes(Cmd.scsi_SenseData, sizeof(senseData), '\0');
+	if (sp->sense_len > sizeof(senseData))
+		Cmd.scsi_SenseLength = sizeof(senseData);
+	else if (sp->sense_len < 0)
+		Cmd.scsi_SenseLength = 0;
+	else
+		Cmd.scsi_SenseLength = sp->sense_len;
+	Cmd.scsi_SenseActual = 0;
+	Cmd.scsi_Status = 0;
+
+	if (DoIO((struct IORequest *) ioreq) != 0) {
+		if (Cmd.scsi_Status == 0) {
+			ret = -1;
+			sp->ux_errno = geterrno();
+			if (sp->ux_errno == 0)
+				sp->ux_errno = EIO;
+
+			if (sp->ux_errno != ENOTTY)
+				ret = 0;
+		}
+	}
+
+	fillbytes(&sp->scb, sizeof(sp->scb), '\0');
+	fillbytes(&sp->u_sense.cmd_sense, sizeof(sp->u_sense.cmd_sense), '\0');
+	sp->resid = Cmd.scsi_Length - Cmd.scsi_Actual;
+	sp->sense_count = Cmd.scsi_SenseActual;
+	if (sp->sense_count > SCG_MAX_SENSE)
+		sp->sense_count = SCG_MAX_SENSE;
+	movebytes(Cmd.scsi_SenseData, sp->u_sense.cmd_sense, sp->sense_count);
+	sp->u_scb.cmd_scb[0] = Cmd.scsi_Status;
+
+	switch (ioreq->io_Error) {
+
+	case 0:
+		sp->error = SCG_NO_ERROR;
+		break;
+
+	case HFERR_BadStatus:
+		/*
+		 * status and/or sense error
+		 */
+		sp->ux_errno = EIO;
+		sp->error = SCG_NO_ERROR;
+		break;
+
+	case HFERR_DMA:
+		/*
+		 * DMA error
+		 */
+		sp->resid = sp->size;
+		sp->error = SCG_RETRYABLE;
+		break;
+
+	case HFERR_SelTimeout:
+		/*
+		 * Select timed out
+		 */
+		sp->error = SCG_FATAL;
+		break;
+
+	/* XXX was ist hier zu tun ? */
+
+	case HFERR_SelfUnit:
+		/*
+		 * cannot issue SCSI command to self
+		 */
+/* XXX try to select our HBA ??? */
+		sp->error = SCG_FATAL;
+		break;
+
+	case HFERR_Phase:
+		/*
+		 * illegal or unexpected SCSI phase
+		 */
+		sp->error = SCG_RETRYABLE;
+		break;
+
+	case HFERR_Parity:
+		/*
+		 * SCSI parity error
+		 */
+		sp->error = SCG_RETRYABLE;
+		break;
+
+	default:
+		/* XXX was kann sonst noch passieren? */
+		sp->error = SCG_FATAL;
+		break;
+	}
+
+	if (Cmd.scsi_Command != NULL) {
+		free(Cmd.scsi_Command);
+	}
+	return (ret);
+}
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsi-beos.c cdrdao-1.1.5/scsilib/libscg/scsi-beos.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsi-beos.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scsi-beos.c	2001-12-02 09:42:54.000000000 -0500
@@ -1,7 +1,7 @@
-/* @(#)scsi-beos.c	1.19 01/03/18 Copyright 1998 J. Schilling */
+/* @(#)scsi-beos.c	1.20 01/12/02 Copyright 1998 J. Schilling */
 #ifndef lint
 static	char __sccsid[] =
-	"@(#)scsi-beos.c	1.19 01/03/18 Copyright 1998 J. Schilling";
+	"@(#)scsi-beos.c	1.20 01/12/02 Copyright 1998 J. Schilling";
 #endif
 /*
  *	Interface for the BeOS user-land raw SCSI implementation.
@@ -35,6 +35,28 @@
  * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
  */
 
+
+/*
+ *	Warning: you may change this source, but if you do that
+ *	you need to change the _scg_version and _scg_auth* string below.
+ *	You may not return "schily" for an SCG_AUTHOR request anymore.
+ *	Choose your name instead of "schily" and make clear that the version
+ *	string is related to a modified source.
+ */
+LOCAL	char	_scg_trans_version[] = "scsi-beos.c-1.20";	/* The version for this transport*/
+
+/*
+ * There are also defines for:
+ *	B_BEOS_VERSION_4
+ *	B_BEOS_VERSION_4_5
+ *
+ * in BeOS 5
+ */
+#ifndef	B_BEOS_VERSION_5
+/*
+ * New BeOS seems to include <be/kernel/OS.h> from device/scsi.h
+ */
+
 /* nasty hack to avoid broken def of bool in SupportDefs.h */
 #define _SUPPORT_DEFS_H
 
@@ -49,15 +71,6 @@
 #include <Errors.h>
 
 
-/*
- *	Warning: you may change this source, but if you do that
- *	you need to change the _scg_version and _scg_auth* string below.
- *	You may not return "schily" for an SCG_AUTHOR request anymore.
- *	Choose your name instead of "schily" and make clear that the version
- *	string is related to a modified source.
- */
-LOCAL	char	_scg_trans_version[] = "scsi-beos.c-1.19";	/* The version for this transport*/
-
 /*-------------------------------------------------------------*/
 /*----- Shorthand type formats --------------------------------*/
 
@@ -95,6 +108,7 @@
 typedef unsigned short			unichar;
 
 
+
 /*-------------------------------------------------------------*/
 /*----- Descriptive formats -----------------------------------*/
 typedef int32					status_t;
@@ -104,6 +118,8 @@
 
 /* end nasty hack */
 
+#endif	/* ! B_BEOS_VERSION_5 */
+
 
 #include <stdlib.h>
 #include <stdio.h>
@@ -340,7 +356,7 @@
 
 	if (scgp->debug > 0) {
 		error("SEND(%d): cmd %02x, cdb = %d, data = %d, sense = %d\n",
-			f, rdc.command[0], rdc.command_length,
+			scgp->fd, rdc.command[0], rdc.command_length,
 			rdc.data_length, rdc.sense_data_length);
 	}
 	e = ioctl(scgp->fd, B_RAW_DEVICE_COMMAND, &rdc, sizeof(rdc));
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsi-linux-pg.c cdrdao-1.1.5/scsilib/libscg/scsi-linux-pg.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsi-linux-pg.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scsi-linux-pg.c	2001-10-07 14:27:16.000000000 -0400
@@ -1,7 +1,7 @@
-/* @(#)scsi-linux-pg.c	1.39 01/03/18 Copyright 1997 J. Schilling */
+/* @(#)scsi-linux-pg.c	1.40 01/10/07 Copyright 1997 J. Schilling */
 #ifndef lint
 static	char ___sccsid[] =
-	"@(#)scsi-linux-pg.c	1.39 01/03/18 Copyright 1997 J. Schilling";
+	"@(#)scsi-linux-pg.c	1.40 01/10/07 Copyright 1997 J. Schilling";
 #endif
 /*
  *	Interface for the Linux PARIDE implementation.
@@ -48,7 +48,7 @@
  *	Choose your name instead of "schily" and make clear that the version
  *	string is related to a modified source.
  */
-LOCAL	char	_scg_trans_version_pg[] = "scsi-linux-pg.c-1.39";	/* The version for this transport*/
+LOCAL	char	_scg_trans_version_pg[] = "scsi-linux-pg.c-1.40";	/* The version for this transport*/
 
 #ifdef	USE_PG_ONLY
 
@@ -209,12 +209,29 @@
 		for(tgt=0;tgt<MAX_TGT;tgt++) {
 			js_snprintf(devname, sizeof(devname), "/dev/pg%d", tgt);
 			f = open(devname, 2);
-			if (f >= 0) {
+			if (f < 0) {
+				/*
+				 * Set up error string but let us clear it later
+				 * if at least one open succeeded.
+				 */
+				if (scgp->errstr)
+					js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+							"Cannot open '/dev/pg*'");
+				if (errno != ENOENT && errno != ENXIO && errno != ENODEV) {
+					if (scgp->errstr)
+						js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+							"Cannot open '%s'", devname);
+					return (0);
+				}
+			} else {
 				scglocal(scgp)->scgfiles[scglocal(scgp)->pgbus][tgt][tlun] = f;
 				nopen++;
 			}
 		}
 	}
+	if (nopen > 0 && scgp->errstr)
+		scgp->errstr[0] = '\0';
+
 openbydev:
 	if (device != NULL && *device != '\0') {
 		char	*p;
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsi-linux-sg.c cdrdao-1.1.5/scsilib/libscg/scsi-linux-sg.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsi-linux-sg.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scsi-linux-sg.c	2002-03-15 05:02:01.000000000 -0500
@@ -1,7 +1,7 @@
-/* @(#)scsi-linux-sg.c	1.66 01/04/20 Copyright 1997 J. Schilling */
+/* %Z%%M%	%I% %E% Copyright 1997 J. Schilling */
 #ifndef lint
 static	char __sccsid[] =
-	"@(#)scsi-linux-sg.c	1.66 01/04/20 Copyright 1997 J. Schilling";
+	"%Z%%M%	%I% %E% Copyright 1997 J. Schilling";
 #endif
 /*
  *	Interface for Linux generic SCSI implementation (sg).
@@ -40,6 +40,16 @@
  *	string is related to a modified source.
  *
  *	Copyright (c) 1997 J. Schilling
+ *
+ *	Thanks to Alexander Kern <alex.kern@gmx.de> for the idea and first
+ *	code fragments for supporting the CDROM_SEND_PACKET ioctl() from
+ *	the cdrom.c kernel driver. Please note that this interface in prociple
+ *	is completely unneeded but the Linux kernel is just a cluster of
+ *	code and does not support planned orthogonal interface systems.
+ *	For this reason we need CDROM_SEND_PACKET in order to work around a
+ *	bug in the linux kernel that prevents to use PCATA drives because
+ *	the kernel panics if you try to put ide-scsi on top of the PCATA
+ *	driver.
  */
 /*
  * This program is free software; you can redistribute it and/or modify
@@ -80,6 +90,13 @@
 
 #include "scsi/sg.h"
 
+#undef sense			/* conflict in struct cdrom_generic_command */
+#include <linux/cdrom.h>
+
+#if	defined(CDROM_PACKET_SIZE) && defined(CDROM_SEND_PACKET)
+#define	USE_ATA
+#endif
+
 /*
  *	Warning: you may change this source, but if you do that
  *	you need to change the _scg_version and _scg_auth* string below.
@@ -87,7 +104,35 @@
  *	Choose your name instead of "schily" and make clear that the version
  *	string is related to a modified source.
  */
-LOCAL	char	_scg_trans_version[] = "scsi-linux-sg.c-1.66";	/* The version for this transport*/
+LOCAL	char	_scg_trans_version[] = "%M%-%I%";	/* The version for this transport*/
+#ifdef	USE_ATA
+LOCAL	char	_scg_atrans_version[] = "atapi-%I%";	/* The version for ATAPI	*/
+
+LOCAL	int	scgo_aopen	__PR((SCSI *scgp, char *device));
+LOCAL	int	scgo_aclose	__PR((SCSI *scgp));
+LOCAL	long	scgo_amaxdma	__PR((SCSI *scgp, long amt));
+LOCAL	BOOL	scgo_ahavebus	__PR((SCSI *scgp, int));
+LOCAL	int	scgo_afileno	__PR((SCSI *scgp, int, int, int));
+LOCAL	int	scgo_ainitiator_id __PR((SCSI *scgp));
+LOCAL	int	scgo_aisatapi	__PR((SCSI *scgp));
+LOCAL	int	scgo_areset	__PR((SCSI *scgp, int what));
+LOCAL	int	scgo_asend	__PR((SCSI *scgp));
+
+LOCAL scg_ops_t ata_ops = {
+	scgo_asend,
+	scgo_version,		/* Shared with SG driver */
+	scgo_aopen,
+	scgo_aclose,
+	scgo_amaxdma,
+	scgo_getbuf,		/* Shared with SG driver */
+	scgo_freebuf,		/* Shared with SG driver */
+	scgo_ahavebus,
+	scgo_afileno,
+	scgo_ainitiator_id,
+	scgo_aisatapi,
+	scgo_areset,
+};
+#endif	/* USE_ATA */
 
 #ifndef	SCSI_IOCTL_GET_BUS_NUMBER
 #define SCSI_IOCTL_GET_BUS_NUMBER 0x5386
@@ -133,6 +178,14 @@
 #define	MAX_TGT		16
 #define	MAX_LUN		8
 
+#ifdef	USE_ATA
+typedef struct {
+	unsigned char   typ:4;
+	unsigned char   host:8;
+	unsigned char   bus:4;
+}               __buscookies;
+#endif
+
 struct scg_local {
 	int	scgfile;		/* Used for SG_GET_BUFSIZE ioctl()*/
 	short	scgfiles[MAX_SCG][MAX_TGT][MAX_LUN];
@@ -144,6 +197,12 @@
 	long	xbufsize;
 	char	*xbuf;
 	char	*SCSIbuf;
+
+#ifdef	USE_ATA
+/* # of virtual buses (schilly_host number) */
+#define	MAX_SCHILLY_HOSTS	MAX_SCG
+	__buscookies	bc[MAX_SCHILLY_HOSTS];
+#endif
 };
 #define scglocal(p)	((struct scg_local *)((p)->local)) 
 
@@ -208,6 +267,10 @@
 		switch (what) {
 
 		case SCG_VERSION:
+#ifdef	USE_ATA
+			if (scgp->ops == &ata_ops)
+				return (_scg_atrans_version);
+#endif
 			return (_scg_trans_version);
 		/*
 		 * If you changed this source, you are not allowed to
@@ -260,6 +323,14 @@
 				busno, tgt, tlun);
 		return (-1);
 	}
+	if (device != NULL && *device != '\0') {
+#ifdef	USE_ATA
+		if (strncmp(device, "ATAPI", 5) == 0) {
+			scgp->ops = &ata_ops;
+			return (SCGO_OPEN(scgp, device));
+		}
+#endif
+	}
 
 	if (scgp->local == NULL) {
 		scgp->local = malloc(sizeof(struct scg_local));
@@ -291,6 +362,13 @@
 		js_snprintf(devname, sizeof(devname), "/dev/sg%d", i);
 		f = open(devname, 2);
 		if (f < 0) {
+			/*
+			 * Set up error string but let us clear it later
+			 * if at least one open succeeded.
+			 */
+			if (scgp->errstr)
+				js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+							"Cannot open '/dev/sg*'");
 			if (errno != ENOENT && errno != ENXIO && errno != ENODEV) {
 				if (scgp->errstr)
 					js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
@@ -304,14 +382,24 @@
 				nopen++;
 		}
 	}
+	if (nopen > 0 && scgp->errstr)
+		scgp->errstr[0] = '\0';
+		
 	if (nopen == 0) for (i=0; i <= 25; i++) {
 		js_snprintf(devname, sizeof(devname), "/dev/sg%c", i+'a');
 		f = open(devname, 2);
 		if (f < 0) {
+			/*
+			 * Set up error string but let us clear it later
+			 * if at least one open succeeded.
+			 */
+			if (scgp->errstr)
+				js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+							"Cannot open '/dev/sg*'");
 			if (errno != ENOENT && errno != ENXIO && errno != ENODEV) {
 				if (scgp->errstr)
 					js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
-						"Cannot open '%s'", devname);
+							"Cannot open '%s'", devname);
 				return (0);
 			}
 		} else {
@@ -321,13 +409,21 @@
 				nopen++;
 		}
 	}
+	if (nopen > 0 && scgp->errstr)
+		scgp->errstr[0] = '\0';
+
 openbydev:
 	if (device != NULL && *device != '\0') {
 		f = open(device, 2);
-		if (f < 0 && errno == ENOENT)
-			goto openpg;
+/*		if (f < 0 && errno == ENOENT)*/
+/*			goto openpg;*/
 
 		if (f < 0) {
+			/*
+			 * The pg driver has the same rules to decide whether
+			 * to use openbydev. If we cannot open the device, it
+			 * makes no sense to try the /dev/pg* driver.
+			 */
 			if (scgp->errstr)
 				js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
 					"Cannot open '%s'",
@@ -337,6 +433,9 @@
 
 		if (!sg_mapdev(scgp, f, &busno, &tgt, &tlun, 0, 0)) {
 			close(f);
+			/*
+			 * If sg_mapdev() failes, this may be /dev/pg* device.
+			 */
 			goto openpg;
 		}
 
@@ -925,6 +1024,7 @@
 	struct scg_cmd	*sp = scgp->scmd;
 	int		ret;
 	sg_io_hdr_t	sg_io;
+	struct timeval	to;
 
 	if (scgp->fd < 0) {
 		sp->error = SCG_FATAL;
@@ -1031,8 +1131,20 @@
 			break;
 
 	default:
+		to.tv_sec = sp->timeout;
+		to.tv_usec = 500000;
+		__scg_times(scgp);
+
+		if (scgp->cmdstop->tv_sec < to.tv_sec ||
+		    (scgp->cmdstop->tv_sec == to.tv_sec &&
+			scgp->cmdstop->tv_usec < to.tv_usec)) {
+
+			sp->ux_errno = 0;
+			sp->error = SCG_TIMEOUT;	/* a timeout */
+		} else {
 			sp->error = SCG_RETRYABLE;
-			break;
+		}
+		break;
 	}
 	if (sp->error && sp->ux_errno == 0)
 		sp->ux_errno = EIO;
@@ -1333,3 +1445,1086 @@
 		sg_settimeout(f, scgp->deftimeout);
 	return 0;
 }
+
+/*--------------------------------------------------------------------------*/
+#ifdef	USE_ATA
+
+#define HOST_EMPTY	0xF
+#define HOST_SCSI	0x0
+#define HOST_IDE	0x1
+#define HOST_USB	0x2
+#define HOST_IEEE1389	0x3
+#define HOST_PARALLEL	0x4
+#define HOST_OTHER	0xE
+
+
+#define typlocal(p, schillybus)		scglocal(p)->bc[schillybus].typ
+#define hostlocal(p, schillybus)	scglocal(p)->bc[schillybus].host
+#define buslocal(p, schillybus)		scglocal(p)->bc[schillybus].bus
+
+#define MAX_DMA_ATA (131072)	/* EINVAL (hart) ENOMEM (weich) bei mehr ... */
+				/* Bei fehlerhaftem Sense Pointer kommt EFAULT */
+
+LOCAL int scgo_send		__PR((SCSI * scgp));
+LOCAL BOOL sg_amapdev		__PR((SCSI * scgp, int f, char *device, int *bus,
+					int *target, int *lun));
+LOCAL BOOL sg_amapdev_scsi	__PR((SCSI * scgp, int f, int *busp, int *tgtp,
+					int *lunp, int *chanp, int *inop));
+LOCAL int scgo_aget_first_free_shillybus __PR((SCSI * scgp, int subsystem,
+					int host, int bus));
+LOCAL int scgo_amerge		__PR((char *path, char *readedlink,
+					char *buffer, int buflen));
+
+/* uncomment this when you will get a debug file #define DEBUG */
+#ifdef DEBUG
+#define LOGFILE "cdrom-linux.log"
+#define log(a)	sglog a
+
+LOCAL	void	sglog		__PR((const char *fmt, ...));
+
+#include <vadefs.h>
+
+/* VARARGS1 */
+#ifdef	PROTOTYPES
+LOCAL void	sglog(const char *fmt, ...)
+#else
+LOCAL void	error(fmt, va_alist)
+	char	*fmt;
+	va_dcl
+#endif
+{
+	va_list	args;
+	FILE	*f	 = fopen(LOGFILE, "a");
+
+	if (f == NULL) return;
+
+#ifdef	PROTOTYPES
+	va_start(args, fmt);
+#else
+	va_start(args);
+#endif
+	js_fprintf(f, "%r", fmt, args);
+	va_end(args);
+	fclose(f);
+}
+#else
+#define log(a)
+#endif	/* DEBUG */
+
+LOCAL	int	scan_internal __PR((SCSI * scgp, int *fatal));
+
+LOCAL int
+scgo_aopen(scgp, device)
+	SCSI	*scgp;
+	char	*device;
+{
+	int	bus = scg_scsibus(scgp);
+	int	target = scg_target(scgp);
+	int	lun = scg_lun(scgp);
+
+	register int	f;
+	register int	b;
+	register int	t;
+	register int	l;
+		 int	nopen = 0;
+
+	if (scgp->overbose)
+		error("Warning: Using ATA Packet interface.\n");
+	if (scgp->overbose) {
+		error("Warning: The related libscg interface code is in pre alpha.\n");
+		error("Warning: There may be fatal problems.\n");
+	}
+
+device = NULL;
+	log(("\n<<<<<<<<<<<<<<<<  LOGGING ON >>>>>>>>>>>>>>>>>\n"));
+	if (bus >= MAX_SCHILLY_HOSTS || target >= MAX_TGT || lun >= MAX_LUN) {
+		errno = EINVAL;
+		if (scgp->errstr)
+			js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+				"Illegal value for bus, target or lun '%d,%d,%d'",
+				bus, target, lun);
+
+		return (-1);
+	}
+	/* initialisation */
+	if (scgp->local == NULL) {
+		scgp->local = malloc(sizeof(struct scg_local));
+		if (scgp->local == NULL) {
+			return (0);
+		}
+		scglocal(scgp)->scgfile = -1;
+		scglocal(scgp)->SCSIbuf = (char *) -1;
+		scglocal(scgp)->pack_id = 5;
+		scglocal(scgp)->drvers = -1;
+		scglocal(scgp)->isold = -1;
+		scglocal(scgp)->xbufsize = 0L;
+		scglocal(scgp)->xbuf = NULL;
+
+		for (b = 0; b < MAX_SCHILLY_HOSTS; b++) {
+			typlocal(scgp, b) = HOST_EMPTY;
+			for (t = 0; t < MAX_TGT; t++) {
+				for (l = 0; l < MAX_LUN; l++)
+					scglocal(scgp)->scgfiles[b][t][l] = (short) -1;
+			}
+		}
+	}
+	/* initialisation done */
+
+	/* if not scanning */
+	if ((device != NULL && *device != '\0') || (bus == -2 && target == -2))
+		goto openbydev;
+
+	if (scan_internal(scgp, &nopen)) {
+		if (scgp->errstr)
+			js_printf(scgp->errstr, "INFO: scan_internal(...) failed");
+		return (-1);
+	}
+	return (nopen);
+
+openbydev:
+	if (scgp->debug > 3) {
+		js_fprintf((FILE *) scgp->errfile, "INFO: do scgo_open openbydev");
+	}
+	if (device != NULL && *device != '\0') {
+		int	schilly_bus,
+			starget,
+			slun;
+
+		f = open(device, O_RDONLY | O_NONBLOCK);
+
+		if (f < 0) {
+			if (scgp->errstr)
+				js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+					"Cannot open '%s'", device);
+			return (0);
+		}
+		if (sg_amapdev(scgp, f, device, &schilly_bus, &starget, &slun)) {
+			scg_settarget(scgp, schilly_bus, starget, slun);
+			return (++nopen);
+		}
+	}
+	return (nopen);
+}
+
+LOCAL int
+scan_internal(scgp, nopen)
+	SCSI	*scgp;
+	int	*nopen;
+{
+	int	i,
+		f;
+	int	schilly_bus,
+		target,
+		lun;
+	char	device[128];
+	BOOL	DEVFS = TRUE;	/* try always with devfs
+				   unfortunatelly the solution with test of existing
+				   of '/dev/.devfsd' don't work, because it root.root 700
+				   and i don't like run suid root
+				 */
+
+	if (DEVFS) {
+		for (i = 0;; i++) {
+			sprintf(device, "/dev/cdroms/cdrom%i", i);
+			if ((f = open(device, O_RDONLY | O_NONBLOCK)) < 0) {
+				if (errno != ENOENT && errno != ENXIO && errno != ENODEV && errno != EACCES) {
+					if (scgp->debug > 4) {
+						js_fprintf((FILE *) scgp->errfile,
+						"try open(%s) return %i, errno %i, cancel\n", device, f, errno);
+					}
+					return (-2);
+				} else if (errno == ENOENT || errno == ENODEV) {
+					if (scgp->debug > 4) {
+						js_fprintf((FILE *) scgp->errfile,
+						"try open(%s) return %i, errno %i\n", device, f, errno);
+					}
+					if (0 == i) {
+						DEVFS = FALSE;
+						if (scgp->debug > 4) {
+							js_fprintf((FILE *) scgp->errfile,
+							"DEVFS not detected, continue with old dev\n");
+						}
+					}
+					break;
+				}
+				if (scgp->debug > 4) {
+					if (errno == EACCES) {
+						js_fprintf((FILE *) scgp->errfile,
+						"errno (EACCESS), you have'nt right for device, referenced by %s \n", device);
+					}
+					js_fprintf((FILE *) scgp->errfile,
+					"try open(%s) return %i, errno %i, try next cdrom\n", device, f, errno);
+				}
+			} else {
+				if (scgp->debug > 4) {
+					js_fprintf((FILE *) scgp->errfile,
+					"try open(%s) return %i errno %i do sg_mapdev(...)\n", device, f, errno);
+				}
+				if (sg_amapdev(scgp, f, device, &schilly_bus, &target, &lun)) {
+					(++(*nopen));
+				} else {
+					close(f);
+				}
+			}
+		}
+	}
+	if (!DEVFS) {
+		/* for /dev/sr0 - /dev/sr? */
+		for (i = 0;; i++) {
+			sprintf(device, "/dev/sr%i", i);
+			if ((f = open(device, O_RDONLY | O_NONBLOCK)) < 0) {
+				if (errno != ENOENT && errno != ENXIO && errno != ENODEV && errno != EACCES) {
+					if (scgp->debug > 4) {
+						js_fprintf((FILE *) scgp->errfile,
+						"try open(%s) return %i, errno %i, cancel\n", device, f, errno);
+					}
+					return (-2);
+				} else if (errno == ENOENT || errno == ENODEV) {
+					break;
+				}
+			} else {
+				if (sg_amapdev(scgp, f, device, &schilly_bus, &target, &lun)) {
+					(++(*nopen));
+				} else {
+					close(f);
+				}
+			}
+		}
+
+		/* for /dev/hda - /dev/hdh */
+		for (i = 'a'; i <= 'h'; i++) {
+			sprintf(device, "/dev/hd%c", i);
+			if ((f = open(device, O_RDONLY | O_NONBLOCK)) < 0) {
+				if (errno != ENOENT && errno != ENXIO && errno != EACCES) {
+					if (scgp->debug > 4) {
+						js_fprintf((FILE *) scgp->errfile, "try open(%s) return %i, errno %i, cancel\n", device, f, errno);
+					}
+					return (-2);
+				} else if (errno == ENOENT || errno == ENODEV) {
+					break;
+				}
+			} else {
+				/* ugly hack, make better, when you can. Alex */
+				if (0 > ioctl(f, CDROM_DRIVE_STATUS, CDSL_CURRENT)) {
+					if (scgp->debug > 4) {
+						js_fprintf((FILE *) scgp->errfile, "%s is not a cdrom, skip\n", device);
+					}
+					close(f);
+				} else if (sg_amapdev(scgp, f, device, &schilly_bus, &target, &lun)) {
+					(++(*nopen));
+				} else {
+					close(f);
+				}
+			}
+		}
+	}
+	return (0);
+}
+
+LOCAL int
+scgo_aclose(scgp)
+	SCSI	*scgp;
+{
+	register int	f;
+	register int	h;
+	register int	t;
+	register int	l;
+
+	if (scgp->local == NULL)
+		return (-1);
+
+	for (h = 0; h < MAX_SCHILLY_HOSTS; h++) {
+		typlocal(scgp, h) = (HOST_EMPTY);
+		for (t = 0; t < MAX_TGT; t++) {
+			for (l = 0; l < MAX_LUN; l++) {
+				f = scglocal(scgp)->scgfiles[h][t][l];
+				if (f >= 0)
+					close(f);
+				scglocal(scgp)->scgfiles[h][t][l] = (short) -1;
+			}
+		}
+	}
+
+	if (scglocal(scgp)->xbuf != NULL) {
+		free(scglocal(scgp)->xbuf);
+		scglocal(scgp)->xbufsize = 0L;
+		scglocal(scgp)->xbuf = NULL;
+	}
+	log(("<<<<<<<<<<<<<<<<  LOGGING OFF >>>>>>>>>>>>>>>>>\n\n"));
+	return (0);
+}
+
+LOCAL int
+scgo_aget_first_free_shillybus(scgp, subsystem, host, bus)
+	SCSI	*scgp;
+	int	subsystem;
+	int	host;
+	int	bus;
+{
+	int	first_free_schilly_bus;
+
+	for (first_free_schilly_bus = 0;
+			first_free_schilly_bus < MAX_SCHILLY_HOSTS;
+						first_free_schilly_bus++) {
+
+		if (typlocal(scgp, first_free_schilly_bus) == HOST_EMPTY ||
+		   (typlocal(scgp, first_free_schilly_bus) == subsystem &&
+		    hostlocal(scgp, first_free_schilly_bus) == host &&
+		    buslocal(scgp, first_free_schilly_bus) == bus))
+			break;
+	}
+
+	if (first_free_schilly_bus >= MAX_SCHILLY_HOSTS) {
+		errmsgno(EX_BAD, "ERROR: in scgo_get_first_free_shillybus(...). Too much CDROMs, more as %i",
+			MAX_SCHILLY_HOSTS);
+		errmsgno(EX_BAD, "Increase MAX_SCHILLY_HOSTS in cdrom-linux.c and recompile again!");
+		return (-1);
+	}
+	return (first_free_schilly_bus);
+}
+
+LOCAL int
+scgo_amerge(path, readedlink, buffer, buflen)
+	char	*path;
+	char	*readedlink;
+	char	*buffer;
+	int	buflen;
+{
+	char	*aa;
+
+#define TOKEN_ARRAY		20
+#define LAST_CHAR(x)		(x)[strlen((x))-1]
+#define ONE_CHAR_BACK(x)	(x)[strlen((x))-1] = '\0'
+	char	*ppa[TOKEN_ARRAY];
+	char	*pa;
+
+	int	i;
+	int	len;
+	char	seps[] = "/";
+	char	*last_slash;
+
+	if (!path || !readedlink || !buffer)
+		return -(EINVAL);
+
+	if ('/' == readedlink[0]) {
+		aa = (char *) malloc(strlen(readedlink) + 1);
+		if (!aa)
+			return -(ENOMEM);
+
+		strcpy(aa, readedlink);
+	} else {
+		aa = (char *) malloc(strlen(path) + strlen(readedlink) + 1);
+		if (!aa)
+			return -(ENOMEM);
+
+		strcpy(aa, path);
+		if (LAST_CHAR(aa) == '/') {
+			ONE_CHAR_BACK(aa);
+		}
+		last_slash = strrchr(aa, '/');
+		if (last_slash == NULL)
+			strcpy(aa, "/");
+		else
+			*(++last_slash) = '\0';
+		strcat(aa, readedlink);
+	}
+	memset(ppa, 0x00, sizeof(ppa));
+
+	for (i = 0, pa = strtok(aa, seps);
+		i < TOKEN_ARRAY && pa != NULL;
+		++i, pa = strtok(NULL, seps)) {
+		ppa[i] = pa;
+	}
+
+	if (i == TOKEN_ARRAY) {
+		free(aa);
+		return -(ENOMEM);
+	}
+	for (i = 0; i < TOKEN_ARRAY && ppa[i]; i++) {
+		if (strcmp(ppa[i], "..") == 0) {
+			ppa[i] = NULL;
+			if (i > 1)
+				ppa[i - 1] = NULL;
+		}
+	}
+
+	/* dry run */
+	len = 0;
+	for (i = 0; i < TOKEN_ARRAY; i++) {
+		if (ppa[i]) {
+			len += 1;
+			len += strlen(ppa[i]);
+		}
+	}
+	if (0 == len)
+		len = 1;
+
+	if (len + 1 <= buflen) {
+		strcpy(buffer, "");
+		for (i = 0; i < TOKEN_ARRAY; i++) {
+			if (ppa[i]) {
+				strcat(buffer, "/");
+				strcat(buffer, ppa[i]);
+			}
+		}
+
+		if (strlen(buffer) == 0)
+			strcpy(buffer, "/");
+	}
+	free(aa);
+
+	return (len + 1);
+}
+
+/*
+ *	/dev/cdroms/cdrom0	first CD-ROM
+ *	/dev/cdroms/cdrom1	second CD-ROM
+ *
+ *
+ *	SCSI Devices
+ *
+ *	To uniquely identify any SCSI device requires the following information:
+ *
+ *	controller	(host adapter)
+ *	bus		(SCSI channel)
+ *	target		(SCSI ID)
+ *	unit		(Logical Unit Number)
+ *
+ *	All SCSI devices are placed under /dev/scsi (assuming devfs is mounted on /dev).
+ *	Hence, a SCSI device with the following parameters:
+ *		c=1,b=2,t=3,u=4 would appear as:
+ *
+ *		/dev/scsi/host1/bus2/target3/lun4	device directory
+ *
+ *	Inside this directory, a number of device entries may be created,
+ *	depending on which SCSI device-type drivers were installed.
+ *
+ *	See the section on the disc naming scheme to see what entries
+ *	the SCSI disc driver creates.
+ *
+ *	See the section on the tape naming scheme to see what entries
+ *	the SCSI tape driver creates.
+ *
+ *	The SCSI CD-ROM driver creates:  cd
+ *	The SCSI generic driver creates: generic
+ *
+ *	IDE Devices
+ *
+ *	To uniquely identify any IDE device requires the following information:
+ *
+ *	controller
+ *	bus		(0/1 aka. primary/secondary)
+ *	target		(0/1 aka. master/slave)
+ *	unit
+ *
+ *	All IDE devices are placed under /dev/ide, and uses a similar
+ *	naming scheme to the SCSI subsystem.
+ *
+ *
+ *	Example /dev/cdroms/cdrom0 ->  /dev/scsi/host1/bus2/target3/lun4/cd
+ *	Example /dev/cdroms/cdrom1 ->  /dev/ide/host1/bus0/target1/lun4/cd
+ *
+ */
+LOCAL BOOL
+sg_amapdev(scgp, f, device, schillybus, target, lun)
+	SCSI	*scgp;
+	int	f;
+	char	*device;
+	int	*schillybus;
+	int	*target;
+	int	*lun;
+{
+	struct host {
+		char	host[4];
+		char	host_no;
+	};
+	struct bus {
+		char	bus[3];
+		char	bus_no;
+	};
+	struct target {
+		char	target[6];
+		char	target_no;
+	};
+	struct lun {
+		char	lun[3];
+		char	lun_no;
+	};
+
+	int	h,
+		b,
+		t,
+		l;
+
+#define TOKEN_DEV		"dev"
+#define TOKEN_SUBSYSTEM_SCSI	"scsi"
+#define TOKEN_SUBSYSTEM_IDE	"ide"
+#define TOKEN_HOST		"host"
+#define TOKEN_BUS		"bus"
+#define TOKEN_TARGET		"target"
+#define TOKEN_LUN		"lun"
+#define TOKEN_CD		"cd"
+
+#define ID_TOKEN_DEV		0
+#define ID_TOKEN_SUBSYSTEM	1
+#define ID_TOKEN_HOST		2
+#define ID_TOKEN_BUS		3
+#define ID_TOKEN_TARGET		4
+#define ID_TOKEN_LUN		5
+#define ID_TOKEN_CD		6
+#define ID_TOKEN_LAST		ID_TOKEN_CD
+#define ID_TOKEN_MAX		ID_TOKEN_LAST + 2
+#define CHARTOINT(x)		(abs(atoi(&x)))
+
+	char		*token[ID_TOKEN_MAX],
+			*seps = "/";
+	int		i,
+			result;
+	struct stat	buf;
+
+#ifndef MAX_PATH
+#define MAX_PATH 260
+#endif
+#define LOCAL_MAX_PATH MAX_PATH
+	char		tmp[LOCAL_MAX_PATH],
+			tmp1[LOCAL_MAX_PATH];
+	int		first_free_schilly_bus;
+	int		subsystem = HOST_EMPTY;
+
+	/* old DEV */
+	typedef struct {
+		char		prefix[2];
+		char		device;
+	} old_dev;
+	/* strtok need char* instead of const char* */
+	result = stat(device, &buf);
+	if (result || !S_ISBLK(buf.st_mode))
+		return (FALSE);
+
+	result = lstat(device, &buf);
+	if (!result && S_ISLNK(buf.st_mode)) {
+		result = readlink(device, tmp, LOCAL_MAX_PATH);
+		if (result > 0 && result < LOCAL_MAX_PATH) {
+			tmp[result] = '\0';
+
+			result = scgo_amerge(device, tmp, tmp1, LOCAL_MAX_PATH);
+			if (result > 0 && result < LOCAL_MAX_PATH) {
+				tmp1[result] = '\0';
+				strcpy(tmp, tmp1);
+			} else {
+				errmsgno(EX_BAD, "ERROR: by link merging! base %s link %s, result of merging %i\n",
+					device, tmp, result);
+				return (FALSE);
+			}
+		} else {
+			errmsgno(EX_BAD, "ERROR: by link reading! link %s, result of readlink %i\n",
+				device, result);
+			return (FALSE);
+		}
+	} else {
+		strncpy(tmp, device, sizeof(tmp));
+	}
+	if (scgp->debug > 3) {
+		js_fprintf((FILE *) scgp->errfile, "INFO: %s -> %s\n", device, tmp);
+	}
+	memset(token, 0x00, sizeof(token));
+	i = 0;
+	token[i] = strtok(tmp, seps);
+	while (token[i] != NULL && (++i) && i < ID_TOKEN_MAX) {
+		token[i] = strtok(NULL, seps);
+	}
+
+	if (i == ID_TOKEN_MAX ||
+		!(token[ID_TOKEN_DEV]) ||
+		strcmp(token[ID_TOKEN_DEV], TOKEN_DEV)) {
+
+		errmsgno(EX_BAD, "ERROR: unknow format\n");
+		errmsgno(EX_BAD, "EXAMPLE: /dev/scsi/host1/bus2/target3/lun4/cd\n");
+		errmsgno(EX_BAD, "EXAMPLE: /dev/ide/host0/bus0/target1/lun0/cd\n");
+		errmsgno(EX_BAD, "EXAMPLE: /dev/hda or /dev/sr0\n");
+		return (FALSE);
+	}
+	if (!(strcmp(token[ID_TOKEN_SUBSYSTEM], TOKEN_SUBSYSTEM_SCSI))
+		|| !(strcmp(token[ID_TOKEN_SUBSYSTEM], TOKEN_SUBSYSTEM_IDE))) {
+		h = CHARTOINT(((struct host *) token[ID_TOKEN_HOST])->host_no);
+		b = CHARTOINT(((struct bus *) token[ID_TOKEN_BUS])->bus_no);
+		t = CHARTOINT(((struct target *) token[ID_TOKEN_TARGET])->target_no);
+		l = CHARTOINT(((struct lun *) token[ID_TOKEN_LUN])->lun_no);
+#ifdef PARANOID
+		if (strncmp(token[ID_TOKEN_HOST], TOKEN_HOST, strlen(TOKEN_HOST))) {
+			log(("ERROR: invalid host specified\n"));
+			return (FALSE);
+		}
+		if (strncmp(token[ID_TOKEN_BUS], TOKEN_BUS, strlen(TOKEN_BUS))) {
+			log(("ERROR: invalid bus specified\n"));
+			return (FALSE);
+		}
+		if (strncmp(token[ID_TOKEN_TARGET], TOKEN_TARGET, strlen(TOKEN_TARGET))) {
+			log(("ERROR: invalid target specified\n"));
+			return (FALSE);
+		}
+		if (strncmp(token[ID_TOKEN_LUN], TOKEN_LUN, strlen(TOKEN_LUN))) {
+			log(("ERROR: invalid lun specified\n"));
+			return (FALSE);
+		}
+		if (!(strcmp(token[ID_TOKEN_SUBSYSTEM], TOKEN_SUBSYSTEM_IDE))) {
+			if (b > 1 || t > 1) {
+				log(("ERROR: invalid bus or target for IDE specified\n"));
+				return (FALSE);
+			}
+		}
+#endif	/* PARANOID */
+
+		if (!(strcmp(token[ID_TOKEN_SUBSYSTEM], TOKEN_SUBSYSTEM_IDE))) {
+			subsystem = HOST_IDE;
+		} else if (!(strcmp(token[ID_TOKEN_SUBSYSTEM], TOKEN_SUBSYSTEM_SCSI))) {
+			subsystem = HOST_SCSI;
+		} else {
+			subsystem = HOST_OTHER;
+		}
+	} else if (!token[ID_TOKEN_HOST] &&
+		strlen(token[ID_TOKEN_SUBSYSTEM]) == sizeof(old_dev)) {
+		char	j;
+
+		old_dev	*pDev = (old_dev *) token[ID_TOKEN_SUBSYSTEM];
+
+		if (!strncmp(pDev->prefix, "hd", 2)) {
+			j = pDev->device - ('a');
+
+			subsystem = HOST_IDE;
+			h = j / 4;
+			b = (j % 4) / 2;
+			t = (j % 4) % 2;
+			l = 0;
+		} else if (!strncmp(pDev->prefix, "sr", 2)) {
+/*
+			if(pDev->device >= '0' && pDev->device <= '9')
+				j = pDev->device - ('0');
+			else
+				j = pDev->device - ('a');
+
+
+			h = j / 4;
+			b = (j % 4) / 2;
+			t = (j % 4) % 2;
+			l = 0;
+*/
+			/* other solution, with ioctl */
+			int	Chan,
+				Ino,
+				Bus,
+				Target,
+				Lun;
+
+			subsystem = HOST_SCSI;
+			sg_amapdev_scsi(scgp, f, &Bus, &Target, &Lun, &Chan, &Ino);
+
+			/* For old kernels try to make the best guess. */
+			/*
+				int	n;
+				Ino |= Chan << 8;
+				n = sg_mapbus(scgp, Bus, Ino);
+				if (Bus == -1) {
+					Bus = n;
+					if (scgp->debug > 0) {
+						js_fprintf((FILE *)scgp->errfile,
+							"SCSI Bus: %d (mapped from %d)\n",
+							Bus, Ino);
+					}
+				} 
+				It is me too high ;-()
+			*/
+			h = Ino;
+			b = Chan;
+			t = Target;
+			l = Lun;
+		} else {
+			errmsgno(EX_BAD, "ERROR: unknow subsystem (%s) in (%s)\n",
+				token[ID_TOKEN_SUBSYSTEM], device);
+			return (FALSE);
+		}
+	} else {
+		errmsgno(EX_BAD, "ERROR: unknow subsystem (%s) in (%s)\n",
+			token[ID_TOKEN_SUBSYSTEM], device);
+		return (FALSE);
+	}
+
+	if (scgp->verbose)
+		js_printf(scgp->errstr, "INFO: subsystem %s: h %i, b %i, t %i, l %i\n",
+			token[ID_TOKEN_SUBSYSTEM], h, b, t, l);
+
+	first_free_schilly_bus = scgo_aget_first_free_shillybus(scgp, subsystem, h, b);
+	if (-1 == first_free_schilly_bus) {
+		return (FALSE);
+	}
+	if (scglocal(scgp)->scgfiles[first_free_schilly_bus][t][l] != (-1)) {
+		errmsgno(EX_BAD, "ERROR: this cdrom is already mapped %s(%d,%d,%d)\n",
+			device, first_free_schilly_bus, t, l);
+		return (FALSE);
+	} else {
+		scglocal(scgp)->scgfiles[first_free_schilly_bus][t][l] = f;
+		typlocal(scgp, first_free_schilly_bus) = subsystem;
+		hostlocal(scgp, first_free_schilly_bus) = h;
+		buslocal(scgp, first_free_schilly_bus) = b;
+		*schillybus = first_free_schilly_bus;
+		*target = t;
+		*lun = l;
+
+		if (scgp->debug > 1) {
+			js_fprintf((FILE *) scgp->errfile,
+				"INFO: /dev/%s, (host%d/bus%d/target%d/lun%d) will be mapped on the schilly bus No %d (%d,%d,%d)\n",
+				token[ID_TOKEN_SUBSYSTEM], h, b, t, l, first_free_schilly_bus, first_free_schilly_bus, t, l);
+		}
+	}
+	return (TRUE);
+}
+
+LOCAL BOOL
+sg_amapdev_scsi(scgp, f, busp, tgtp, lunp, chanp, inop)
+	SCSI	*scgp;
+	int	f;
+	int	*busp;
+	int	*tgtp;
+	int	*lunp;
+	int	*chanp;
+	int	*inop;
+{
+	struct sg_id {
+		long	l1;	/* target | lun << 8 | channel << 16 | low_ino << 24 */
+		long	l2;	/* Unique id */
+	} sg_id;
+	int	Chan;
+	int	Ino;
+	int	Bus;
+	int	Target;
+	int	Lun;
+
+	if (ioctl(f, SCSI_IOCTL_GET_IDLUN, &sg_id))
+		return (FALSE);
+
+	if (scgp->debug > 0) {
+		js_fprintf((FILE *) scgp->errfile, "INFO: l1: 0x%lX l2: 0x%lX\n", sg_id.l1, sg_id.l2);
+	}
+	if (ioctl(f, SCSI_IOCTL_GET_BUS_NUMBER, &Bus) < 0) {
+		Bus = -1;
+	}
+	Target = sg_id.l1 & 0xFF;
+	Lun = (sg_id.l1 >> 8) & 0xFF;
+	Chan = (sg_id.l1 >> 16) & 0xFF;
+	Ino = (sg_id.l1 >> 24) & 0xFF;
+	if (scgp->debug > 0) {
+		js_fprintf((FILE *) scgp->errfile, "INFO: Bus: %d Target: %d Lun: %d Chan: %d Ino: %d\n",
+			Bus, Target, Lun, Chan, Ino);
+	}
+	*busp = Bus;
+	*tgtp = Target;
+	*lunp = Lun;
+	if (chanp)
+		*chanp = Chan;
+	if (inop)
+		*inop = Ino;
+	return (TRUE);
+}
+
+LOCAL long
+scgo_amaxdma(scgp, amt)
+	SCSI	*scgp;
+	long	amt;
+{
+	/*
+	 * EINVAL (hart) ENOMEM (weich) bei mehr ...
+	 * Bei fehlerhaftem Sense Pointer kommt EFAULT
+	 */
+	return (MAX_DMA_ATA);
+}
+
+LOCAL BOOL
+scgo_ahavebus(scgp, busno)
+	SCSI	*scgp;
+	int	busno;
+{
+	register int	t;
+	register int	l;
+
+	if (busno < 0 || busno >= MAX_SCHILLY_HOSTS)
+		return (FALSE);
+
+	if (scgp->local == NULL)
+		return (FALSE);
+
+	for (t = 0; t < MAX_TGT; t++) {
+		for (l = 0; l < MAX_LUN; l++)
+			if (scglocal(scgp)->scgfiles[busno][t][l] >= 0)
+				return (TRUE);
+	}
+	return (FALSE);
+}
+
+LOCAL int
+scgo_afileno(scgp, busno, tgt, tlun)
+	SCSI	*scgp;
+	int	busno;
+	int	tgt;
+	int	tlun;
+{
+	if (busno < 0 || busno >= MAX_SCHILLY_HOSTS ||
+		tgt < 0 || tgt >= MAX_TGT ||
+		tlun < 0 || tlun >= MAX_LUN)
+		return (-1);
+
+	if (scgp->local == NULL)
+		return (-1);
+
+	return ((int) scglocal(scgp)->scgfiles[busno][tgt][tlun]);
+}
+
+LOCAL int
+scgo_ainitiator_id(scgp)
+	SCSI	*scgp;
+{
+	js_printf(scgp->errstr, "NOT IMPELEMENTED: scgo_initiator_id\n");
+	return (-1);
+}
+
+LOCAL int
+scgo_aisatapi(scgp)
+	SCSI	*scgp;
+{
+	int schillybus = scgp->addr.scsibus;
+	int typ = typlocal(scgp, schillybus);
+	if(typ == HOST_EMPTY)
+		return (-1);
+	if(typ != HOST_SCSI)
+		return (1);
+	else
+		return (0);
+}
+
+LOCAL int
+scgo_areset(scgp, what)
+	SCSI	*scgp;
+	int	what;
+{
+	if (what == SCG_RESET_NOP)
+		return (0);
+
+	if (what == SCG_RESET_TGT || what == SCG_RESET_BUS)
+		return (ioctl(what, CDROMRESET));
+
+	return (-1);
+}
+
+LOCAL int
+scgo_asend(scgp)
+	SCSI	*scgp;
+{
+	struct scg_cmd	*sp = scgp->scmd;
+	int		ret,
+			i;
+	struct cdrom_generic_command sg_cgc;
+	struct request_sense sense_cgc;
+
+#ifdef DEBUG
+	char		tmp_send[340],
+			tmp_read[340],
+			tmp_sense[340],
+			tmp1[30];
+	int		j;
+	char		*p;
+#endif
+
+	if (scgp->fd < 0) {
+		sp->error = SCG_FATAL;
+		sp->ux_errno = EIO;
+		return (0);
+	}
+	if (sp->cdb_len > CDROM_PACKET_SIZE) {
+		sp->error = SCG_FATAL;
+		sp->ux_errno = EIO;
+		return (0);
+	}
+	/* initialize */
+	fillbytes((caddr_t) & sg_cgc, sizeof(sg_cgc), '\0');
+	fillbytes((caddr_t) & sense_cgc, sizeof(sense_cgc), '\0');
+
+	if (sp->flags & SCG_RECV_DATA) {
+		sg_cgc.data_direction = CGC_DATA_READ;
+	} else if (sp->size > 0) {
+		sg_cgc.data_direction = CGC_DATA_WRITE;
+	} else {
+		sg_cgc.data_direction = CGC_DATA_NONE;
+	}
+#if LINUX_VERSION_CODE >= 0x020403
+	if (sp->flags & SCG_SILENT) {
+		sg_cgc.quiet = 1;
+	}
+#endif
+	for (i = 0; i < sp->cdb_len; i++) {
+		sg_cgc.cmd[i] = sp->cdb.cmd_cdb[i];
+	}
+
+	sg_cgc.buflen = sp->size;
+	sg_cgc.buffer = sp->addr;
+
+	if (sp->sense_len > sizeof(sense_cgc))
+		sense_cgc.add_sense_len = sizeof(sense_cgc) - 8;
+	else
+		sense_cgc.add_sense_len = sp->sense_len - 8;
+
+	sg_cgc.sense = &sense_cgc;
+#if LINUX_VERSION_CODE >= 0x020403
+	sg_cgc.timeout = sp->timeout * 1000;
+#endif
+#ifdef DEBUG
+	strcpy(tmp_send, "send cmd:\n");
+	for (j = 0; j < sp->cdb_len; j++) {
+		sprintf(tmp1, " %02X", sp->cdb.cmd_cdb[j]);
+		strcat(tmp_send, tmp1);
+	}
+	strcat(tmp_send, "\n");
+
+	if (sg_cgc.data_direction == CGC_DATA_WRITE) {
+		int	z;
+
+		sprintf(tmp1, "data_write: %i bytes\n", sp->size);
+		strcat(tmp_send, tmp1);
+		for (j = 0, z = 1; j < 80 && j < sp->size; j++, z++) {
+			if (z > 16) {
+				z = 1;
+				strcat(tmp_send, "\n");
+			}
+			sprintf(tmp1, " %02X", (unsigned char) (sp->addr[j]));
+			strcat(tmp_send, tmp1);
+		}
+		strcat(tmp_send, "\n");
+
+		if (sp->size > 80) {
+			strcat(tmp_send, "...\n");
+		}
+	}
+#endif	/* DEBUG */
+	if ((ret = ioctl(scgp->fd, CDROM_SEND_PACKET, &sg_cgc)) < 0)
+		sp->ux_errno = geterrno();
+
+	if (ret < 0 && scgp->debug > 4) {
+		js_fprintf((FILE *) scgp->errfile,
+			"ioctl(CDROM_SEND_PACKET) ret: %d\n", ret);
+	}
+	/*
+	 * copy scsi data back
+	 */
+	if (sp->flags & SCG_RECV_DATA && ((void *) sp->addr != (void *) sg_cgc.buffer)) {
+		memcpy(sp->addr, sg_cgc.buffer, (sp->size < sg_cgc.buflen) ? sp->size : sg_cgc.buflen);
+		if (sg_cgc.buflen > sp->size)
+			sp->resid = sg_cgc.buflen - sp->size;
+	}
+	sp->error = SCG_NO_ERROR;
+#ifdef DEBUG
+	if (ret < 0) {
+		switch (sp->ux_errno) {
+		case ENOTTY:
+			p = "ENOTTY";
+			break;
+		case EINVAL:
+			p = "EINVAL";
+			break;
+		case ENXIO:
+			p = "ENXIO";
+			break;
+		case EACCES:
+			p = "EACCES";
+			break;
+		case EIO:
+			p = "EIO";
+			break;
+		case ENOMEDIUM:
+			p = "ENOMEDIUM";
+			break;
+		case EDRIVE_CANT_DO_THIS:
+			p = "EDRIVE_CANT_DO_THIS";
+			break;
+		default:
+			p = "UNKNOW";
+		};
+		log(("%s", tmp_send));
+		log(("ERROR: returns %i errno %i(%s)\n", ret, sp->ux_errno, p));
+	}
+#endif	/* DEBUG */
+	if (ret < 0) {
+		/*
+		 * Check if SCSI command cound not be send at all.
+		 * Linux usually returns EINVAL for an unknoen ioctl.
+		 * In case somebody from the Linux kernel team learns that the
+		 * corect errno would be ENOTTY, we check for this errno too.
+		*/
+		if ((sp->ux_errno == ENOTTY || sp->ux_errno == EINVAL)) {
+			return (-1);
+		}
+		if (sp->ux_errno == ENXIO ||
+			sp->ux_errno == EINVAL || sp->ux_errno == EACCES) {
+			return (-1);
+		}
+	} else if (ret == 0) {
+#ifdef DEBUG
+		if (sg_cgc.data_direction == CGC_DATA_READ) {
+			int	z;
+
+			sprintf(tmp_read, "data_read: %i bytes\n", sp->size);
+			for (j = 0, z = 1; j < 80 && j < sp->size; j++, z++) {
+				if (z > 16) {
+					z = 1;
+					strcat(tmp_read, "\n");
+				}
+				sprintf(tmp1, " %02X", (unsigned char) (sp->addr[j]));
+				strcat(tmp_read, tmp1);
+			}
+			strcat(tmp_read, "\n");
+			if (sp->size > 80) {
+				strcat(tmp_read, "...\n");
+			}
+		}
+#endif	/* DEBUG */
+	}
+	/*
+	 * copy sense back
+	 */
+	if (ret < 0 && sg_cgc.sense->error_code) {
+		sp->sense_count = sense_cgc.add_sense_len + 8;
+#ifdef DEBUG
+		sprintf(tmp_sense, "sense_data: Laenge %i\n", sp->sense_count);
+		for (j = 0; j < sp->sense_count; j++) {
+			sprintf(tmp1, " %02X", (((unsigned char *) (&sense_cgc))[j]));
+			strcat(tmp_sense, tmp1);
+		}
+		log(("%s\n", tmp_sense));
+
+		sprintf(tmp_sense, "sense_data: error code 0x%02X, sense key 0x%02X,"
+			" additional length %i, ASC 0x%02X, ASCQ 0x%02X\n",
+			sg_cgc.sense->error_code, sg_cgc.sense->sense_key,
+			sg_cgc.sense->add_sense_len, sg_cgc.sense->asc,
+			sg_cgc.sense->ascq);
+
+		log(("%s\n", tmp_sense));
+#endif	/* DEBUG */
+		memcpy(sp->u_sense.cmd_sense, /* (caddr_t) */ &sense_cgc, SCG_MAX_SENSE);
+		sp->u_scb.cmd_scb[0] = ST_CHK_COND;
+
+		switch (sg_cgc.sense->sense_key) {
+		case SC_UNIT_ATTENTION:
+		case SC_NOT_READY:
+			sp->error = SCG_RETRYABLE;	/* may be BUS_BUSY */
+			sp->u_scb.cmd_scb[0] |= ST_BUSY;
+			break;
+		case SC_ILLEGAL_REQUEST:
+			break;
+		default:
+			break;
+		}
+	} else {
+		sp->u_scb.cmd_scb[0] = 0x00;
+	}
+
+	sp->resid = 0;
+	return (0);
+}
+#endif	/* USE_ATA */
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsi-mac-iokit.c cdrdao-1.1.5/scsilib/libscg/scsi-mac-iokit.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsi-mac-iokit.c	1969-12-31 19:00:00.000000000 -0500
+++ cdrdao-1.1.5/scsilib/libscg/scsi-mac-iokit.c	2001-10-29 13:12:29.000000000 -0500
@@ -0,0 +1,524 @@
+/* @(#)scsi-mac-iokit.c	1.3 01/10/29 Copyright 1997,2001 J. Schilling */
+#ifndef lint
+static	char __sccsid[] =
+	"@(#)scsi-mac-iokit.c	1.3 01/10/29 Copyright 1997,2001 J. Schilling";
+#endif
+/*
+ *	Interface to the Darwin IOKit SCSI drivers
+ *
+ *	Notes: Uses the IOKit/scsi-commands/SCSITaskLib interface
+ *
+ *	As of October 2001, this interface does not support SCSI parallel bus
+ *	(old-fashioned SCSI). It does support ATAPI, Firewire, and USB.
+ *
+ *	First version done by Constantine Sapuntzakis <csapuntz@Stanford.EDU>
+ *
+ *	Warning: you may change this source, but if you do that
+ *	you need to change the _scg_version and _scg_auth* string below.
+ *	You may not return "schily" for an SCG_AUTHOR request anymore.
+ *	Choose your name instead of "schily" and make clear that the version
+ *	string is related to a modified source.
+ *
+ *	Copyright (c) 1997,2001 J. Schilling
+ */
+/*
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; see the file COPYING.  If not, write to
+ * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+/*
+ *	Warning: you may change this source, but if you do that
+ *	you need to change the _scg_version and _scg_auth* string below.
+ *	You may not return "schily" for an SCG_AUTHOR request anymore.
+ *	Choose your name instead of "schily" and make clear that the version
+ *	string is related to a modified source.
+ */
+LOCAL	char	_scg_trans_version[] = "scsi-mac-iokit.c-1.3";	/* The version for this transport*/
+
+#define	MAX_SCG		16	/* Max # of SCSI controllers */
+#define	MAX_TGT		16
+#define	MAX_LUN		8
+
+#include <statdefs.h>
+#include <mach/mach.h>
+#include <Carbon/Carbon.h>
+#include <IOKit/IOKitLib.h>
+#include <IOKit/IOCFPlugIn.h>
+#include <IOKit/scsi-commands/SCSITaskLib.h>
+#include <mach/mach_error.h>
+
+struct scg_local {
+        MMCDeviceInterface **mmcDeviceInterface;
+        SCSITaskDeviceInterface **scsiTaskDeviceInterface;
+	mach_port_t  masterPort;
+};
+#define scglocal(p)	((struct scg_local *)((p)->local)) 
+
+#define	MAX_DMA_NEXT	(32*1024)
+#if 0
+#define	MAX_DMA_NEXT	(64*1024)	/* Check if this is not too big */
+#endif
+
+/*
+ * Return version information for the low level SCSI transport code.
+ * This has been introduced to make it easier to trace down problems
+ * in applications.
+ */
+LOCAL char *
+scgo_version(scgp, what)
+	SCSI	*scgp;
+	int	what;
+{
+	if (scgp != (SCSI *)0) {
+		switch (what) {
+
+		case SCG_VERSION:
+			return (_scg_trans_version);
+		/*
+		 * If you changed this source, you are not allowed to
+		 * return "schily" for the SCG_AUTHOR request.
+		 */
+		case SCG_AUTHOR:
+			return ("csapuntz");
+		case SCG_SCCS_ID:
+			return (__sccsid);
+		}
+	}
+	return ((char *)0);
+}
+
+
+/*
+ * Valid Device names:
+ *    IOCompactDiscServices
+ *    IODVDServices
+ *    IOSCSIPeripheralDeviceNub
+ * 
+ * Also a / and a number can be appended to refer to something
+ * more than the first device (e.g. IOCompactDiscServices/5 for the 5th
+ * compact disc attached)
+ */
+LOCAL int
+scgo_open(scgp, device)
+	SCSI	*scgp;
+	char	*device;
+{
+	mach_port_t masterPort = NULL;
+	io_iterator_t scsiObjectIterator = NULL;
+	IOReturn ioReturnValue = kIOReturnSuccess;
+	CFMutableDictionaryRef dict = NULL;
+	io_object_t scsiDevice = NULL;
+	HRESULT plugInResult;
+	IOCFPlugInInterface **plugInInterface = NULL;
+	MMCDeviceInterface **mmcDeviceInterface = NULL;
+	SCSITaskDeviceInterface **scsiTaskDeviceInterface = NULL;
+	SInt32 score = 0;
+	int err = -1;
+	char *realdevice = NULL, *tmp;
+	int driveidx = 1, idx = 1;
+	
+	if (device == NULL) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "Please specify a device name (e.g. IOCompactDiscServices,0)");
+		goto out;
+	}
+
+	realdevice = tmp = strdup(device);
+	tmp = strchr(tmp, '/');
+	if (tmp != NULL) {
+		*tmp++ = '\0';
+		driveidx = atoi(tmp);
+	}
+
+	if (scgp->local == NULL) {
+	        scgp->local = malloc(sizeof(struct scg_local));
+	        if (scgp->local == NULL)
+	                goto out;
+	}
+
+	ioReturnValue = IOMasterPort(bootstrap_port, &masterPort);
+
+	if (ioReturnValue != kIOReturnSuccess) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "Couldn't get a master IOKit port. Error %d",
+			    ioReturnValue);
+		goto out;
+	}
+
+	dict = IOServiceMatching(realdevice);
+	if (dict == NULL) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "Couldn't create dictionary for searching");
+		goto out;
+	}
+
+	ioReturnValue = IOServiceGetMatchingServices(masterPort, dict,
+						     &scsiObjectIterator);
+	dict = NULL;
+
+	if (scsiObjectIterator == NULL ||
+	    (ioReturnValue != kIOReturnSuccess)) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "No matching device %s found.", device);
+		goto out;
+	}
+
+	if (driveidx <= 0)
+	        driveidx = 1;
+
+	idx = 1;
+	while ((scsiDevice = IOIteratorNext(scsiObjectIterator)) != NULL) {
+		if (idx == driveidx)
+			break;
+		IOObjectRelease(scsiDevice);
+		scsiDevice = NULL;
+		idx++;
+	}
+
+	if (scsiDevice == NULL) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "No matching device found. Iterator failed.");
+		goto out;
+	}
+
+	ioReturnValue = IOCreatePlugInInterfaceForService(scsiDevice,
+		        kIOMMCDeviceUserClientTypeID,
+		        kIOCFPlugInInterfaceID,
+			&plugInInterface, &score);
+	if (ioReturnValue != kIOReturnSuccess) {
+		goto try_generic;
+	}
+
+	plugInResult = (*plugInInterface)->QueryInterface(plugInInterface,
+					    CFUUIDGetUUIDBytes(kIOMMCDeviceInterfaceID),
+							  (LPVOID)&mmcDeviceInterface);
+	if (plugInResult != KERN_SUCCESS) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "Unable to get MMC Interface: 0x%lX",
+			    (long)plugInResult);
+
+		goto out;
+	}
+
+	scsiTaskDeviceInterface = (*mmcDeviceInterface)->GetSCSITaskDeviceInterface(mmcDeviceInterface);
+	if (scsiTaskDeviceInterface == NULL) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "Failed to get taskDeviceInterface");
+		goto out;
+	}
+
+	goto init;
+
+ try_generic:	
+	ioReturnValue = IOCreatePlugInInterfaceForService(scsiDevice,
+		        kIOSCSITaskDeviceUserClientTypeID,
+		        kIOCFPlugInInterfaceID,
+			&plugInInterface, &score);
+	if (ioReturnValue != kIOReturnSuccess) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "Unable to get plugin Interface: %x", 
+			    ioReturnValue);
+		goto out;
+	}
+
+	plugInResult = (*plugInInterface)->QueryInterface(plugInInterface,
+			    CFUUIDGetUUIDBytes(kIOSCSITaskDeviceInterfaceID),
+					   (LPVOID)&scsiTaskDeviceInterface);
+
+	if (plugInResult != KERN_SUCCESS) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "Unable to get generic Interface: 0x%lX",
+			    (long)plugInResult);
+
+		goto out;
+	}
+
+	
+ init:
+	ioReturnValue = (*scsiTaskDeviceInterface)->ObtainExclusiveAccess(scsiTaskDeviceInterface);
+	if (ioReturnValue != kIOReturnSuccess) {
+		js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			    "Unable to get exclusive access to device");
+		goto out;	  
+	}
+
+	if (mmcDeviceInterface) {
+		(*mmcDeviceInterface)->AddRef(mmcDeviceInterface);
+	}
+	(*scsiTaskDeviceInterface)->AddRef(scsiTaskDeviceInterface);
+	scglocal(scgp)->mmcDeviceInterface = mmcDeviceInterface;
+	scglocal(scgp)->scsiTaskDeviceInterface = scsiTaskDeviceInterface;
+	scglocal(scgp)->masterPort = masterPort;
+	scg_settarget(scgp, 0, 0, 0);
+	err = 1;
+
+out:
+	if (scsiTaskDeviceInterface != NULL) {
+		(*scsiTaskDeviceInterface)->Release(scsiTaskDeviceInterface);
+	}
+
+	if (plugInInterface != NULL) {
+		(*plugInInterface)->Release(plugInInterface);
+	}
+	
+	if (scsiDevice != NULL) {
+		IOObjectRelease(scsiDevice);
+	}
+
+	if (scsiObjectIterator != NULL) {
+		IOObjectRelease(scsiObjectIterator);
+	}
+
+	if (err < 0) {
+		if (scgp->local) {
+			free(scgp->local);
+			scgp->local = NULL;
+		}
+
+		if (masterPort) {
+			mach_port_deallocate(mach_task_self(), masterPort);
+		}
+	}
+
+	if (dict != NULL) {
+		CFRelease(dict);
+	}
+
+	if (realdevice != NULL) {
+		free(realdevice);
+	}
+	return (err);
+}
+
+LOCAL int
+scgo_close(scgp)
+	SCSI	*scgp;
+{
+        SCSITaskDeviceInterface **sc;
+	MMCDeviceInterface **mmc;
+
+	if (scgp->local == NULL)
+		return (-1);
+
+	sc = scglocal(scgp)->scsiTaskDeviceInterface;
+	(*sc)->ReleaseExclusiveAccess(sc);
+	(*sc)->Release(sc);
+	scglocal(scgp)->scsiTaskDeviceInterface = NULL;
+
+	mmc = scglocal(scgp)->mmcDeviceInterface;
+	if (mmc != NULL)
+		(*mmc)->Release(mmc);
+
+	mach_port_deallocate(mach_task_self(), scglocal(scgp)->masterPort);
+			
+	free (scgp->local);
+	scgp->local = NULL;
+
+	return (0);
+}
+
+LOCAL long
+scgo_maxdma(scgp, amt)
+	SCSI	*scgp;
+	long	amt;
+{
+	long maxdma = MAX_DMA_NEXT;
+#ifdef	SGIOCMAXDMA
+	int  m;
+
+	if (ioctl(scglocal(scgp)->scgfile, SGIOCMAXDMA, &m) >= 0) {
+		maxdma = m;
+		if (scgp->debug > 0) {
+			js_fprintf((FILE *)scgp->errfile,
+				"maxdma: %d\n", maxdma);
+		}
+	}
+#endif
+	return (maxdma);
+}
+
+LOCAL void *
+scgo_getbuf(scgp, amt)
+	SCSI	*scgp;
+	long	amt;
+{
+	if (scgp->debug > 0) {
+		js_fprintf((FILE *)scgp->errfile,
+			"scgo_getbuf: %ld bytes\n", amt);
+	}
+	scgp->bufbase = malloc((size_t)(amt));
+	return (scgp->bufbase);
+}
+
+LOCAL void
+scgo_freebuf(scgp)
+	SCSI	*scgp;
+{
+	if (scgp->bufbase)
+		free(scgp->bufbase);
+	scgp->bufbase = NULL;
+}
+
+LOCAL BOOL
+scgo_havebus(scgp, busno)
+	SCSI	*scgp;
+	int	busno;
+{
+        return (FALSE);
+}
+
+LOCAL int
+scgo_fileno(scgp, busno, tgt, tlun)
+	SCSI	*scgp;
+	int	busno;
+	int	tgt;
+	int	tlun;
+{
+        return (-1);
+}
+
+LOCAL int
+scgo_initiator_id(scgp)
+	SCSI	*scgp;
+{
+	return (-1);
+}
+
+LOCAL int
+scgo_isatapi(scgp)
+	SCSI	*scgp;
+
+{
+	return (FALSE);
+}
+
+LOCAL int
+scgo_reset(scgp, what)
+	SCSI	*scgp;
+	int	what;
+{
+	if (what == SCG_RESET_NOP)
+		return (0);
+	if (what != SCG_RESET_BUS) {
+		errno = EINVAL;
+		return (-1);
+	}
+	
+	errno = 0;
+	return (-1);
+}
+
+LOCAL int
+scgo_send(scgp)
+	SCSI		*scgp;
+{
+        struct scg_cmd	*sp = scgp->scmd;
+        SCSITaskDeviceInterface **sc = NULL;
+	SCSITaskInterface **cmd = NULL;
+	IOVirtualRange iov;
+	SCSI_Sense_Data senseData;
+	SCSITaskStatus status;
+	UInt64 bytesTransferred;
+	IOReturn ioReturnValue;
+	int ret = 0;
+
+	if (scgp->local == NULL) {
+		return (-1);
+	}
+
+	sc = scglocal(scgp)->scsiTaskDeviceInterface;
+
+	cmd = (*sc)->CreateSCSITask(sc);
+	if (cmd == NULL) {
+	       js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			   "Failed to create SCSI task");
+	       ret = -1;
+
+  	     sp->error = SCG_FATAL;
+	     sp->ux_errno = EIO;
+	     goto out;
+	}
+
+
+	iov.address = (IOVirtualAddress) sp->addr;
+	iov.length = sp->size;
+
+	ioReturnValue = (*cmd)->SetCommandDescriptorBlock(cmd, sp->cdb.cmd_cdb, sp->cdb_len);
+	if (ioReturnValue != kIOReturnSuccess) {
+	       js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			   "SetCommandDescriptorBlock failed with status %x", ioReturnValue);
+	       ret = -1;
+	       goto out;
+	}
+
+	ioReturnValue = (*cmd)->SetScatterGatherEntries(cmd, &iov, 1, sp->size,
+					(sp->flags & SCG_RECV_DATA) ? 
+					kSCSIDataTransfer_FromTargetToInitiator :
+					kSCSIDataTransfer_FromInitiatorToTarget);
+	if (ioReturnValue != kIOReturnSuccess) {
+	       js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			   "SetScatterGatherEntries failed with status %x", ioReturnValue);
+	       ret = -1;
+	       goto out;
+	}
+
+	ioReturnValue = (*cmd)->SetTimeoutDuration(cmd, sp->timeout * 1000);
+	if (ioReturnValue != kIOReturnSuccess) {
+	       js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			   "SetTimeoutDuration failed with status %x", ioReturnValue);
+	       ret = -1;
+	       goto out;
+	}
+
+	memset(&senseData, 0, sizeof(senseData));
+
+	ioReturnValue = (*cmd)->ExecuteTaskSync(cmd,
+				&senseData, &status, &bytesTransferred);
+
+	sp->resid = sp->size - bytesTransferred;
+	sp->error = SCG_NO_ERROR;
+
+	if (ioReturnValue != kIOReturnSuccess) {	
+	       js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
+			   "Command execution failed with status %x", ioReturnValue);
+	       sp->error = SCG_RETRYABLE;
+	       ret = -1;
+	       goto out;	  
+	}
+
+	memset(&sp->scb, 0, sizeof(sp->scb));
+	memset(&sp->u_sense.cmd_sense, 0, sizeof(sp->u_sense.cmd_sense));
+	if (senseData.VALID_RESPONSE_CODE != 0) {
+	  sp->sense_count = kSenseDefaultSize;
+	  memmove(&sp->u_sense.cmd_sense, &senseData, kSenseDefaultSize);
+	}
+
+	sp->u_scb.cmd_scb[0] = status;
+
+	/* ??? */
+	if (status == kSCSITaskStatus_No_Status) {
+	  sp->error = SCG_RETRYABLE;
+	  ret = -1;
+	  goto out;
+	}
+
+ out:
+	if (cmd != NULL) {
+   	      (*cmd)->Release(cmd);
+	}
+
+	return (ret);
+}
+
+
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsi-openserver.c cdrdao-1.1.5/scsilib/libscg/scsi-openserver.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsi-openserver.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scsi-openserver.c	2002-02-10 06:43:09.000000000 -0500
@@ -1,7 +1,7 @@
-/* @(#)scsi-openserver.c	1.28 01/03/18 Copyright 1998 J. Schilling, Santa Cruz Operation */
+/* @(#)scsi-openserver.c	1.29 02/02/10 Copyright 1998 J. Schilling, Santa Cruz Operation */
 #ifndef lint
 static	char __sccsid[] =
-	"@(#)scsi-openserver.c	1.28 01/03/18 Copyright 1998 J. Schilling, Santa Cruz Operation";
+	"@(#)scsi-openserver.c	1.29 02/02/10 Copyright 1998 J. Schilling, Santa Cruz Operation";
 #endif
 /*
  *	Interface for the SCO SCSI implementation.
@@ -41,37 +41,95 @@
  *	Choose your name instead of "schily" and make clear that the version
  *	string is related to a modified source.
  */
-LOCAL	char	_scg_trans_version[] = "scsi-openserver.c-1.28";	/* The version for this transport*/
+LOCAL	char	_scg_trans_version[] = "scsi-openserver.c-1.29";	/* The version for this transport*/
 
 #define	MAX_SCG		16		/* Max # of cdrom devices */
 #define	MAX_TGT		16		/* Not really needed      */
 #define	MAX_LUN		8		/* Not really needed      */
 
-#define	MAX_DMA		(32*1024)	/* Maybe even more ???    */
-#define	MAXPATH	       256			/* max length of devicepath  */
-#define MAXLINE		80			/* max length of input line  */
-#define MAXSCSI		99			/* max number of mscsi lines */
-#define	MAXDRVN		10			/* max length of drivername  */
+#define	MAX_DMA		(64*1024)
+
+#define	MAXPATH	       256		/* max length of devicepath  */
+#define MAXLINE		80		/* max length of input line  */
+#define MAXSCSI		99		/* max number of mscsi lines */
+#define	MAXDRVN		10		/* max length of drivername  */
 
 #define DEV_DIR		"/tmp"
 #define	DEV_NAME	"scg.s%1dt%1dl%1d"
 
-		/* We will only deal with disks, cdroms and tapes !	*/
-		/* Sflp devices (floptical) 21Mb scsi floppy devices	*/
-		/* will be ignored. Hmm, I can't remember that I ever 	*/
-		/* have seen one ;^)					*/
-
-#define	DEV_ROOT	"/dev/rdsk/0s0"
-#define DEV_SDSK	"/dev/rdsk/%ds0"
-#define DEV_SROM	"/dev/rcd%d"
+/* ---------------------------------------------------------------------
+** We will only deal with cdroms by default! Only if you set a specific
+** environment variable, we will scan "all" devices !
+** Set LIBSCG_SCAN_ALL to any value to enable access to all your SCSI
+** devices.
+**
+** The upcoming support for USB will be for USB 1.1, so as this is not
+** tested yet, we will currently ignore drives connect to the USB stack
+** (usbha controller) regardless of having set LIBSCG_SCAN_ALL or not!
+*/
+
+#define	DEV_ROOT	"/dev/dsk/0s0"
+
+#define	DEV_SDSK	"/dev/rdsk/%ds0"
+#define	DEV_SROM	"/dev/rcd%d"
 #define	DEV_STP		"/dev/xStp%d"
+#define	DEV_SFLP	"/dev/rdsk/fp%dh"
 
 #define	SCAN_DEV	"%s%s%d%d%d%d"
 
 #define	SCSI_CFG	"/etc/sconf -r"		/* no. of configured devices  */
 #define	SCSI_DEV	"/etc/sconf -g %d"	/* read line 'n' of mscsi tbl */
 
-#define	DRV_ATAPI	"wd"
+#define	DRV_ATAPI	"wd"		/* SCO OpenServer IDE driver 	*/
+#define	DRV_USB		"usbha"		/* SCO OpenServer USB driver 	*/
+#define	DRV_NOHA	"noha"		/* IDE/ATAPI device configured,
+					** but missing !	
+					*/
+
+#define	T_DISK		"Sdsk"		/* SCO OpenServer SCSI disk 	*/
+#define	T_CDROM		"Srom"		/* SCO OpenServer SCSI cdrom 	*/
+#define	T_TAPE		"Stp"		/* SCO OpenServer SCSI tape 	*/
+#define	T_FLOPPY	"Sflp"		/* SCO OpenServer SCSI floppy 	*/
+
+
+/* ---------------------------------------------------------------------
+** Environment variables to control certain functionality
+*/
+
+#define	SCAN_ALL	"LIBSCG_SCAN_ALL"	/* enable access for all devices */
+#define	SCSI_USER_CMD	"LIBSCG_SCSIUSERCMD"	/* use old SCSIUSERCMD ioctl() */
+#define	DMA_OVERRIDE	"LIBSCG_MAX_DMA"	/* override MAX_DMA value */
+#define	ENABLE_USB	"LIBSCG_ENABLE_USB"	/* enable access of USB devices */
+
+LOCAL	int	scan_all    = 0;	/* don't scan all devices by default */
+LOCAL	int	scsiusercmd = 0; 	/* use SCSIUSERCMD2 ioctl by default */
+LOCAL	int	enable_usb  = 0;	/* don't scan USB devices by default */
+LOCAL	long	max_dma     = MAX_DMA;	/* use MAX_DMA DMA buffer by default */
+
+
+/* ---------------------------------------------------------------------
+** There are two scsi passthrough ioctl() on SCO OpenServer 5.0.[45],
+** while there is only one available on SCO OpenServer 5.0.[02].
+**
+** The SCSIUSERCMD ioctl is available on all OpenServer 5
+**
+** The SCSIUSERCMD2 ioctl which executes the usercmd and reads the sense
+** in one go, is only available from 5.0.4 onwards.
+**
+** By default we will use the SCSIUSERCMD2 ioctl(), in order to execute
+** the SCSIUSERCMD ioctl() instead set the environment variable
+** LIBSCG_SCSIUSERCMD to any value. Using the olderSCSIUSERCMD ioctl() will
+** if the SCSI commands returns a CHECK CONDITION status, run a seperate
+** REQUEST_SENSE command immediately. But we need to remember that in a
+** multi-tasking environment, there might be other code which has accessed
+** the device in between these two steps and therefore the sense code
+** is no longer valid !!!
+**
+** NOTE: There are problems with the usage of AHA 154X controllers
+** and SCSIUSERCMD2 such as nonsense (weird) output on cdrecord -scanbus
+**
+*/
+
 
 typedef struct scg2sdi {
 
@@ -100,7 +158,7 @@
 struct scg_local {
 	short	scgfiles[MAX_SCG][MAX_TGT][MAX_LUN];
 };
-#define scglocal(p)	((struct scg_local *)((p)->local)) 
+#define	scglocal(p)	((struct scg_local *)((p)->local))
 
 LOCAL	int	sort_mscsi	__PR((const void *l1, const void *l2));
 LOCAL	int	openserver_init	__PR((SCSI *scgp));
@@ -109,20 +167,20 @@
 
 /* -------------------------------------------------------------------------
 ** SCO OpenServer does not have a generic scsi device driver, which can
-** be used to access any configured scsi device. 
-**
-** But we can use the "Srom" scsi peripherial driver (for CD-ROM devices) 
-** etc. to send SCSIUSERCMD2's to any target device controlled by the 
+** be used to access any configured scsi device. But we can use the "Sxxx"
+** scsi peripherial drivers passthrough ioctl() (SCSIUSERCMD / SCSIUSERCMD2)
+** to send scsi user comands to any target device controlled by the
 ** corresponding target driver.
 **
-** This pass-through implementation for libscg currently allows to 
+** This passthrough implementation for libscg currently allows to
 ** handle the following devices classes:
 **
 **	1. DISK		handled by Sdsk
 **	2. CD-ROM	handled by Srom
 **	3. TAPES	handled by Stp
+**	4. FLOPPY	handled by Sflp
 **
-** NOTE: The libscg OpenServer passthrough routines have changed with 
+** NOTE: The libscg OpenServer passthrough routines have changed with
 **       cdrecord-1.8 to enable the -scanbus option. Therefore the
 **	 addressing scheme is now the same as used on many other platforms
 **	 like Solaris, Linux etc.
@@ -216,25 +274,27 @@
 ** routines.
 **
 ** NOTE: One problem is currently still not solved ! If you don't
-**       have a media in your CD-ROM/CD-Writer we are not able to 
-**       do an open() and therefore will set the drive to be not 
+**       have a media in your CD-ROM/CD-Writer we are not able to
+**       do an open() and therefore will set the drive to be not
 **       available (valid=0).
 **
-**       This will for example cause cdrecord to not list the drive 
+**       This will for example cause cdrecord to not list the drive
 **	 in the -scanbus output.
 **
 */
 
-LOCAL int 
+LOCAL int
 openserver_init(scgp)
 	SCSI	*scgp;
 {
 	FILE		*cmd;
 	int		nscg  = -1, lhba  = -1, lbus = -1;
-	int		nSrom = -1, nSdsk = -1, nStp = -1;
+	int		nSrom = -1, nSdsk = -1, nStp = -1, nSflp = -1;
 	int		atapi, fd, nopen = 0;
 	int		pos = 0, len = 0, nlm = 0;
 	int		s = 0, t = 0, l = 0;
+	int		ide_rootdisk = 0;
+	long		dma_override = 0;
 	int		mscsi;
 	char		sconf[MAXLINE];
 	char		lines[MAXLINE];
@@ -248,15 +308,45 @@
 	for (s = 0; s < MAX_SCG; s++) {
 		for (t = 0; t < MAX_TGT; t++) {
 			for (l = 0; l < MAX_LUN ; l++) {
-			  sdidevs[s][t][l].valid  =  0;
-			  sdidevs[s][t][l].open   = -1;
-			  sdidevs[s][t][l].atapi  = -1;
-			  sdidevs[s][t][l].fd     = -1;
-			  sdidevs[s][t][l].lmscsi = -1;
+				sdidevs[s][t][l].valid  =  0;
+				sdidevs[s][t][l].open   = -1;
+				sdidevs[s][t][l].atapi  = -1;
+				sdidevs[s][t][l].fd     = -1;
+				sdidevs[s][t][l].lmscsi = -1;
 			}
 		}
 	}
 
+	/* Check whether we want to use the older SCSIUSERCMD ioctl() */
+
+	if (getenv(SCSI_USER_CMD) != NULL) {
+		scsiusercmd = 1;
+	}
+
+	/*
+	 * Check whether we want to scan all devices
+	 */
+	if (getenv(SCAN_ALL) != NULL) {
+		scan_all = 1;
+	}
+
+	/*
+	 * Check whether we want to use USB devices
+	 */
+	if (getenv(ENABLE_USB) != NULL) {
+		enable_usb = 1;
+	}
+
+	/*
+	 * Check whether we want to override the MAX_DMA value
+	 */
+	if (getenv(DMA_OVERRIDE) != NULL) {
+		dma_override = atol(getenv(DMA_OVERRIDE));
+		if ((dma_override >= 1) && (dma_override <= (256)))
+			max_dma = dma_override * 1024;
+	}
+
+
 	/* read sconf -r and get number of kernel mscsi lines ! */
 
 	evsave = environ;
@@ -295,7 +385,6 @@
 		return (-1);
 	}
 
-
 	for (l = 0; l < nlm; l++) {
 
 		/* initialize cmtbl entry */
@@ -329,7 +418,7 @@
 		}
 		environ = evsave;
 
-		if (fgets(lines, MAXLINE, cmd) == NULL) 
+		if (fgets(lines, MAXLINE, cmd) == NULL)
 			break;
 
 		if (pclose(cmd) == -1) {
@@ -340,36 +429,41 @@
 			return (-1);
 		}
 
-		sscanf(lines, SCAN_DEV,  cmtbl[l].typ, 
+		sscanf(lines, SCAN_DEV,  cmtbl[l].typ,
 					 cmtbl[l].drv,
-					&cmtbl[l].hba, 
-					&cmtbl[l].bus, 
-					&cmtbl[l].tgt, 
+					&cmtbl[l].hba,
+					&cmtbl[l].bus,
+					&cmtbl[l].tgt,
 					&cmtbl[l].lun);
 
-		if ( strstr(cmtbl[l].typ, "Sdsk") != NULL ){
+		if ( strstr(cmtbl[l].typ, T_DISK) != NULL ) {
 			js_snprintf(cmtbl[l].dev,  sizeof(cmtbl[l].dev),
 					DEV_SDSK, ++nSdsk);
 		}
 
-		if ( strstr(cmtbl[l].typ, "Srom") != NULL ){
+		if ( strstr(cmtbl[l].typ, T_CDROM) != NULL ) {
 			js_snprintf(cmtbl[l].dev,  sizeof(cmtbl[l].dev),
 					DEV_SROM, ++nSrom);
 		}
 
-		if ( strstr(cmtbl[l].typ, "Stp") != NULL ){
+		if ( strstr(cmtbl[l].typ, T_TAPE) != NULL ) {
 			js_snprintf(cmtbl[l].dev, sizeof(cmtbl[l].dev),
 					DEV_STP, ++nStp);
 		}
 
+		if ( strstr(cmtbl[l].typ, T_FLOPPY) != NULL ) {
+			js_snprintf(cmtbl[l].dev, sizeof(cmtbl[l].dev),
+					DEV_SFLP, ++nSflp);
+		}
+
 		if (scgp->debug > 0) {
 			js_fprintf((FILE *)scgp->errfile,
-				"%-4s = %5s(%d,%d,%d,%d) -> %s\n", 
-				cmtbl[l].typ, 
-				cmtbl[l].drv, 
-				cmtbl[l].hba, 
-				cmtbl[l].bus, 
-				cmtbl[l].tgt, 
+				"%-4s = %5s(%d,%d,%d,%d) -> %s\n",
+				cmtbl[l].typ,
+				cmtbl[l].drv,
+				cmtbl[l].hba,
+				cmtbl[l].bus,
+				cmtbl[l].tgt,
 				cmtbl[l].lun,
 				cmtbl[l].dev);
 		}
@@ -381,6 +475,7 @@
 		js_fprintf((FILE *)scgp->errfile, "%2d DISK  \n", nSdsk + 1);
 		js_fprintf((FILE *)scgp->errfile, "%2d CD-ROM\n", nSrom + 1);
 		js_fprintf((FILE *)scgp->errfile, "%2d TAPE  \n", nStp  + 1);
+		js_fprintf((FILE *)scgp->errfile, "%2d FLOPPY\n", nSflp + 1);
 		js_fprintf((FILE *)scgp->errfile, "-------------------- \n");
 	}
 
@@ -391,33 +486,48 @@
 	if (scgp->debug > 0) {
 		for (l = 0; l < nlm; l++)
 		js_fprintf((FILE *)scgp->errfile,
-			"%-4s = %5s(%d,%d,%d,%d) -> %s\n", 
-			cmtbl[l].typ, 
-			cmtbl[l].drv, 
-			cmtbl[l].hba, 
-			cmtbl[l].bus, 
-			cmtbl[l].tgt, 
+			"%-4s = %5s(%d,%d,%d,%d) -> %s\n",
+			cmtbl[l].typ,
+			cmtbl[l].drv,
+			cmtbl[l].hba,
+			cmtbl[l].bus,
+			cmtbl[l].tgt,
 			cmtbl[l].lun,
 			cmtbl[l].dev);
 		js_fprintf((FILE *)scgp->errfile, "-------------------- \n");
 	}
 
+	/* find root disk controller to make it scg 0     	*/
 
+	/* if we have disk(s) found in the mscsi table, we still
+	** don't know if the rootdisk is among these, there can
+	** be a IDE rootdisk as well, but it's not listed in
+	** the mscsi table.
+	*/
 
-	/* find root disk controller to make it scg 0     	*/
+	t = 0;
+	if (nSdsk > 0) {
+		for (l = 0; l < nlm; l++)
+			if (strcmp(cmtbl[l].dev, DEV_ROOT) == 0)
+				t = l;
+	} else {
 
-	for (l = 0; l < nlm; l++)
-		if (strcmp(cmtbl[l].dev, DEV_ROOT) == 0)
-			t = l;
+		/* we haven't found a disk in mscsi, so we definitely
+		** have an IDE disk on a wd adapter as IDE disks are
+		** not listed as SCSI disks in the kernel mscsi table
+		*/
 
+		ide_rootdisk = 1;
 
-	if (scgp->debug > 0) {
+	}
+
+	if (!(ide_rootdisk) && (scgp->debug > 0)) {
 		js_fprintf((FILE *)scgp->errfile,
-			"root = %5s(%d,%d,%d,%d) -> %s\n", 
-			cmtbl[t].drv, 
-			cmtbl[t].hba, 
-			cmtbl[t].bus, 
-			cmtbl[t].tgt, 
+			"root = %5s(%d,%d,%d,%d) -> %s\n",
+			cmtbl[t].drv,
+			cmtbl[t].hba,
+			cmtbl[t].bus,
+			cmtbl[t].tgt,
 			cmtbl[t].lun,
 			cmtbl[t].dev);
 		js_fprintf((FILE *)scgp->errfile, "-------------------- \n");
@@ -446,24 +556,41 @@
 		} else {
 			cmtbl[s].scg = nscg;
 		}
-		sdidevs[cmtbl[s].scg][cmtbl[s].tgt][cmtbl[s].lun].valid  = 1;
 		sdidevs[cmtbl[s].scg][cmtbl[s].tgt][cmtbl[s].lun].open   = 0;
 
-		if (strcmp(cmtbl[s].drv, DRV_ATAPI) == 0) 
+		/* check whether we want to open all devices or it's a CDROM */
+
+		if ((scan_all) || (strcmp(cmtbl[s].typ, T_CDROM) == 0))
+			sdidevs[cmtbl[s].scg][cmtbl[s].tgt][cmtbl[s].lun].valid = 1;
+
+		/* check whether we have an IDE/ATAPI device */
+
+		if (strcmp(cmtbl[s].drv, DRV_ATAPI) == 0)
 			sdidevs[cmtbl[s].scg][cmtbl[s].tgt][cmtbl[s].lun].atapi = 1;
 
+		/* don't open a USB device if enable_usb is not set */
+
+		if (strcmp(cmtbl[s].drv, DRV_USB) == 0)
+			sdidevs[cmtbl[s].scg][cmtbl[s].tgt][cmtbl[s].lun].valid = enable_usb;
+
+		/* don't open a IDE/ATAPI device which is missing but configured */
+
+		if (strcmp(cmtbl[s].drv, DRV_NOHA) == 0)
+			sdidevs[cmtbl[s].scg][cmtbl[s].tgt][cmtbl[s].lun].valid = 0;
+
+
 		sdidevs[cmtbl[s].scg][cmtbl[s].tgt][cmtbl[s].lun].lmscsi = s;
 
 	}
 
 
-	/* open all device nodes */
+	/* open all yet valid device nodes */
 
 	for (s = 0; s < MAX_SCG; s++) {
 		for (t = 0; t < MAX_TGT; t++) {
 			for (l = 0; l < MAX_LUN ; l++) {
 
-			  if ( sdidevs[s][t][l].valid == 0) 
+			  if ( sdidevs[s][t][l].valid == 0)
 			  	continue;
 
 			  /* Open pass-through device node */
@@ -476,20 +603,32 @@
 	** NOTE: If we can't open the device, we will set the device invalid!
 	** ------------------------------------------------------------------
 	*/
-
-				if ((fd = open(dname, O_RDONLY | O_NONBLOCK)) < 0) {
+				errno = 0;
+				if ((fd = open(dname, (O_RDONLY | O_NONBLOCK))) < 0) {
 					sdidevs[s][t][l].valid = 0;
+					if (scgp->debug > 0) {
+						js_fprintf((FILE *)scgp->errfile,
+							"%5s(%d,%d,%d,%d) -> %s open() failed: errno = %d (%s)\n",
+							cmtbl[mscsi].drv,
+							cmtbl[mscsi].hba,
+							cmtbl[mscsi].bus,
+							cmtbl[mscsi].tgt,
+							cmtbl[mscsi].lun,
+							cmtbl[mscsi].dev,
+							errno,
+							strerror(errno));
+					}
 					continue;
 				}
 
 				if (scgp->debug > 0) {
 					js_fprintf((FILE *)scgp->errfile,
-						"%d,%d,%d => %5s(%d,%d,%d,%d) -> %d : %s \n", 
+						"%d,%d,%d => %5s(%d,%d,%d,%d) -> %d : %s \n",
 						s, t, l,
-						cmtbl[mscsi].drv, 
-						cmtbl[mscsi].hba, 
-						cmtbl[mscsi].bus, 
-						cmtbl[mscsi].tgt, 
+						cmtbl[mscsi].drv,
+						cmtbl[mscsi].hba,
+						cmtbl[mscsi].bus,
+						cmtbl[mscsi].tgt,
 						cmtbl[mscsi].lun,
 						cmtbl[mscsi].scg,
 						cmtbl[mscsi].dev);
@@ -553,7 +692,7 @@
 			js_snprintf(scgp->errstr, SCSI_ERRSTR_SIZE,
 			"Open by 'devname' no longer supported on this OS");
 		return (-1);
-	} 
+	}
 
 	return ( openserver_init(scgp) );
 
@@ -595,7 +734,7 @@
 	SCSI	*scgp;
 	long	amt;
 {
-	return (MAX_DMA);
+	return (max_dma);
 }
 
 
@@ -668,12 +807,12 @@
 {
 	return (-1);
 
-	/* We don't know the initiator ID yet, but we can if we parse the 
-	** output of the command 'cat /dev/string/cfg | grep "%adapter"'  
+	/* We don't know the initiator ID yet, but we can if we parse the
+	** output of the command 'cat /dev/string/cfg | grep "%adapter"'
 	**
-	** Sample line:                                                   
+	** Sample line:
 	**
- 	**   %adapter 0xE800-0xE8FF 11 - type=alad ha=0 bus=0 id=7 fts=sto  
+ 	**   %adapter 0xE800-0xE8FF 11 - type=alad ha=0 bus=0 id=7 fts=sto
 	**
 	** This tells us that the alad controller 0 has an id of 7 !
 	** The parsing should be done in openserver_init().
@@ -738,6 +877,7 @@
 		scg->sense_count = sco->sense_len;
 
 	scg->resid = 0;
+
 	scg->u_scb.cmd_scb[0] = sco->cmd.target_sts;
 
 }
@@ -758,42 +898,121 @@
 	}
 
 	memset(&scsi_cmd, 0, sizeof(scsi_cmd));
-	memset(sense_buf,  0, sizeof(sense_buf));
+	memset(sense_buf, 0, sizeof(sense_buf));
 	scsi_cmd.sense_ptr = sense_buf;
 	scsi_cmd.sense_len = sizeof(sense_buf);
 	cp_scg2sco(&scsi_cmd, sp);
 
 	errno = 0;
+	sp->ux_errno = 0;
+	sp->error = SCG_NO_ERROR;
 	for (;;) {
-		int	ioctlStatus;
+		int		ioctlStatus;
+		struct scsicmd	s_cmd;
+
+		if (scsiusercmd) {	/* Use SCSIUSERCMD ioctl() */
+			if (scgp->debug > 1) {
+				js_fprintf((FILE *)scgp->errfile, "calling SCSIUSERCMD ioctl()\n");
+			}
 
-		if ((ioctlStatus = ioctl(scgp->fd, SCSIUSERCMD2, &scsi_cmd)) < 0) {
-			if (errno == EINTR)
-				continue;
+			if ((ioctlStatus = ioctl(scgp->fd, SCSIUSERCMD, &(scsi_cmd.cmd))) < 0) {
+				if (scgp->debug > 1) {
+					js_fprintf((FILE *)scgp->errfile, "returning from SCSIUSERCMD ioctl()\n");
+				}
+				if (errno == EINTR)
+					continue;
 
+				cp_sco2scg(&scsi_cmd, sp);
+				sp->ux_errno = errno;
+				if (errno == 0)
+					sp->ux_errno = EIO;
+				sp->error    = SCG_RETRYABLE;
+
+				return (0);
+			}
+
+			if (scgp->debug > 1) {
+				js_fprintf((FILE *)scgp->errfile, "returning from SCSIUSERCMD ioctl()\n");
+			}
 			cp_sco2scg(&scsi_cmd, sp);
 			sp->ux_errno = errno;
-			if (errno == 0)
-				sp->ux_errno = EIO;
-			sp->error    = SCG_RETRYABLE;
 
-			return (0);
-		}
-		break;
-	}
+			if (scsi_cmd.cmd.target_sts & 0x02) { /* Check Condition & get Sense */
 
-	cp_sco2scg(&scsi_cmd, sp);
-	sp->ux_errno = errno;
-	if (scsi_cmd.cmd.target_sts & 0x02) {
-		if (errno == 0)
-			sp->ux_errno = EIO;
-		sp->error    = SCG_RETRYABLE;
-	} else {
-		sp->error    = SCG_NO_ERROR;
+				if (sp->sense_len > SCG_MAX_SENSE)
+					sp->sense_len = SCG_MAX_SENSE;
+
+				memset((caddr_t)&s_cmd, 0, sizeof(s_cmd));
+
+				s_cmd.data_ptr  = (caddr_t) sp->u_sense.cmd_sense;
+				s_cmd.data_len  = sp->sense_len;
+				s_cmd.is_write  = 0;
+				s_cmd.cdb[0]    = SC_REQUEST_SENSE;
+
+				while (((ioctlStatus = ioctl(scgp->fd, SCSIUSERCMD, &s_cmd)) < 0)
+				       && (errno == EINTR));
+
+				sp->sense_count = sp->sense_len;
+				sp->ux_errno    = errno;
+
+				if (errno == 0)
+					sp->ux_errno = EIO;
+				sp->error = SCG_NO_ERROR;
+			}
+
+			if (scgp->debug > 0) {
+				if (errno != 0)
+					js_fprintf((FILE *)scgp->errfile, "ux_errno: %d (%s) \n", sp->ux_errno, strerror(sp->ux_errno) );
+				if (sp->u_scb.cmd_scb[0] != 0)
+					js_fprintf((FILE *)scgp->errfile, "tgt_stat: %d \n", sp->u_scb.cmd_scb[0] );
+			}
+			break;
+
+		} else {		/* Use SCSIUSERCMD2 ioctl() */
+			if (scgp->debug > 1) {
+				js_fprintf((FILE *)scgp->errfile, "calling SCSIUSERCMD2 ioctl()\n");
+			}
+
+			if ((ioctlStatus = ioctl(scgp->fd, SCSIUSERCMD2, &scsi_cmd)) < 0) {
+				if (scgp->debug > 1) {
+					js_fprintf((FILE *)scgp->errfile, "returning from SCSIUSERCMD2 ioctl()\n");
+				}
+				if (errno == EINTR)
+					continue;
+
+				cp_sco2scg(&scsi_cmd, sp);
+				sp->ux_errno = errno;
+				if (errno == 0)
+					sp->ux_errno = EIO;
+				sp->error    = SCG_RETRYABLE;
+
+				return (0);
+			}
+			if (scgp->debug > 1) {
+				js_fprintf((FILE *)scgp->errfile, "returning from SCSIUSERCMD2 ioctl()\n");
+			}
+
+			cp_sco2scg(&scsi_cmd, sp);
+			sp->ux_errno = errno;
+
+			if (scsi_cmd.cmd.target_sts & 0x02) { /* Check Condition */
+				if (errno == 0)
+					sp->ux_errno = EIO;
+				sp->error    = SCG_NO_ERROR;
+			}
+
+			if (scgp->debug > 0) {
+				if (errno != 0)
+					js_fprintf((FILE *)scgp->errfile, "ux_errno: %d (%s) \n", sp->ux_errno, strerror(sp->ux_errno) );
+				if (sp->u_scb.cmd_scb[0] != 0)
+					js_fprintf((FILE *)scgp->errfile, "tgt_stat: %d \n", sp->u_scb.cmd_scb[0] );
+			}
+			break;
+
+		}
 	}
 
-	return 0;
+	return (0);
 }
 
-
 #define	sense	u_sense.Sense
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsi-sun.c cdrdao-1.1.5/scsilib/libscg/scsi-sun.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsi-sun.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scsi-sun.c	2001-09-13 07:31:24.000000000 -0400
@@ -1,7 +1,7 @@
-/* @(#)scsi-sun.c	1.69 01/03/18 Copyright 1988,1995,2000 J. Schilling */
+/* @(#)scsi-sun.c	1.70 01/09/13 Copyright 1988,1995,2000 J. Schilling */
 #ifndef lint
 static	char __sccsid[] =
-	"@(#)scsi-sun.c	1.69 01/03/18 Copyright 1988,1995,2000 J. Schilling";
+	"@(#)scsi-sun.c	1.70 01/09/13 Copyright 1988,1995,2000 J. Schilling";
 #endif
 /*
  *	SCSI user level command transport routines for
@@ -57,8 +57,8 @@
 #	define	USE_USCSI
 #endif
 
-LOCAL	char	_scg_trans_version[] = "scg-1.69";	/* The version for /dev/scg	*/
-LOCAL	char	_scg_utrans_version[] = "uscsi-1.69";	/* The version for USCSI	*/
+LOCAL	char	_scg_trans_version[] = "scg-1.70";	/* The version for /dev/scg	*/
+LOCAL	char	_scg_utrans_version[] = "uscsi-1.70";	/* The version for USCSI	*/
 
 #ifdef	USE_USCSI
 LOCAL	int	scgo_uopen	__PR((SCSI *scgp, char *device));
@@ -669,6 +669,13 @@
 			}
 		}
 	}
+	/*
+	 * The Sun tape driver does not support to retrieve the max DMA count.
+	 * Use the knwoledge about default DMA sizes in this case.
+	 */
+	if (maxdma < 0)
+		maxdma = scgo_maxdma(scgp, amt);
+
 	return (maxdma);
 }
 
@@ -808,7 +815,19 @@
 		js_fprintf((FILE *)scgp->errfile, "uscsi_rqlen:     %d\n", req.uscsi_rqlen);
 		js_fprintf((FILE *)scgp->errfile, "uscsi_rqstatus:  0x%x\n", req.uscsi_rqstatus);
 		js_fprintf((FILE *)scgp->errfile, "uscsi_rqresid:   %d\n", req.uscsi_rqresid);
-		js_fprintf((FILE *)scgp->errfile, "uscsi_rqbuf:     0x%lx\n", (long)req.uscsi_rqbuf);
+		js_fprintf((FILE *)scgp->errfile, "uscsi_rqbuf ptr: 0x%lx\n", (long)req.uscsi_rqbuf);
+		js_fprintf((FILE *)scgp->errfile, "uscsi_rqbuf:     ");
+		if (req.uscsi_rqbuf != NULL && req.uscsi_rqlen > req.uscsi_rqresid) {
+			int	i;
+			int	len = req.uscsi_rqlen - req.uscsi_rqresid;
+
+			for (i = 0; i < len; i++) {
+				js_fprintf((FILE *)scgp->errfile, "0x%02X ", ((char *)req.uscsi_rqbuf)[i]);
+			}		
+			js_fprintf((FILE *)scgp->errfile, "\n");
+		} else {
+			js_fprintf((FILE *)scgp->errfile, "<data not available>\n");
+		}
 	}
 	if (ret < 0) {
 		sp->ux_errno = geterrno();
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsierrs.c cdrdao-1.1.5/scsilib/libscg/scsierrs.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsierrs.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scsierrs.c	2002-04-16 12:20:42.000000000 -0400
@@ -1,7 +1,7 @@
-/* @(#)scsierrs.c	2.26 00/08/19 Copyright 1987-1996 J. Schilling */
+/* @(#)scsierrs.c	2.28 02/04/16 Copyright 1987-1996 J. Schilling */
 #ifndef lint
 static	char sccsid[] =
-	"@(#)scsierrs.c	2.26 00/08/19 Copyright 1987-1996 J. Schilling";
+	"@(#)scsierrs.c	2.28 02/04/16 Copyright 1987-1996 J. Schilling";
 #endif
 /*
  *	Error printing for scsitransp.c
@@ -27,6 +27,7 @@
 #include <mconfig.h>
 
 #include <stdio.h>
+#include <unixstd.h>	/* for sys/types.h needed in schily.h for sprintf() */
 #include <standard.h>
 #include <schily.h>
 
@@ -113,6 +114,11 @@
 	"\004\006logical unit not ready, recalculation in progress",	/* 04 06 */
 	"\004\007logical unit not ready, operation in progress",/* 04 07 */
 	"\004\010logical unit not ready, long write in progress",	/* 04 08 */
+	"\004\011logical unit not ready, self-test in progress",/* 04 09 */
+	"\004\012asymmetric access code 3 (00-232) [proposed]",	/* 04 0A */
+	"\004\013asymmetric access code 1 (00-232) [proposed]",	/* 04 0B */
+	"\004\014asymmetric access code 2 (00-232) [proposed]",	/* 04 0C */
+	"\004\020auxiliary memory code 2 (99-148) [proposed]",	/* 04 10 */
 	"\005\000logical unit does not respond to selection",	/* 05 00 */
 	"\006\000no reference position found",			/* 06 00 */
 	"\007\000multiple peripheral devices selected",		/* 07 00 */
@@ -120,6 +126,7 @@
 	"\010\001logical unit communication time-out",		/* 08 01 */
 	"\010\002logical unit communication parity error",	/* 08 02 */
 	"\010\003logical unit communication crc error (ultra-dma/32)",	/* 08 03 */
+	"\010\004unreachable copy target",			/* 08 04 */
 	"\011\000track following error",			/* 09 00 */
 	"\011\001tracking servo failure",			/* 09 01 */
 	"\011\002focus servo failure",				/* 09 02 */
@@ -140,6 +147,17 @@
 	"\014\010write error - recovery failed",		/* 0C 08 */
 	"\014\011write error - loss of streaming",		/* 0C 09 */
 	"\014\012write error - padding blocks added",		/* 0C 0A */
+	"\014\013auxiliary memory code 4 (99-148) [proposed]",	/* 0C 0B */
+	"\015\000error detected by third party temporary initiator",	/* 0D 00 */
+	"\015\001third party device failure",			/* 0D 01 */
+	"\015\002copy target device not reachable",		/* 0D 02 */
+	"\015\003incorrect copy target device type",		/* 0D 03 */
+	"\015\004copy target device data underrun",		/* 0D 04 */
+	"\015\005copy target device data overrun",		/* 0D 05 */
+#ifdef	__used__
+	"\016\000",						/* 0E 00 */
+	"\017\000",						/* 0F 00 */
+#endif
 	"\020\000id crc or ecc error",				/* 10 00 */
 	"\021\000unrecovered read error",			/* 11 00 */
 	"\021\001read retries exhausted",			/* 11 01 */
@@ -159,6 +177,7 @@
 	"\021\017error reading upc/ean number",			/* 11 0F */
 	"\021\020error reading isrc number",			/* 11 10 */
 	"\021\021read error - loss of streaming",		/* 11 11 */
+	"\021\022auxiliary memory code 3 (99-148) [proposed]",	/* 11 12 */
 	"\022\000address mark not found for id field",		/* 12 00 */
 	"\023\000address mark not found for data field",	/* 13 00 */
 	"\024\000recorded entity not found",			/* 14 00 */
@@ -194,6 +213,7 @@
 	"\030\005recovered data - recommend reassignment",	/* 18 05 */
 	"\030\006recovered data - recommend rewrite",		/* 18 06 */
 	"\030\007recovered data with ecc - data rewritten",	/* 18 07 */
+	"\030\010recovered data with linking",			/* 18 08 */
 	"\031\000defect list error",				/* 19 00 */
 	"\031\001defect list not available",			/* 19 01 */
 	"\031\002defect list error in primary list",		/* 19 02 */
@@ -207,22 +227,50 @@
 	"\036\000recovered id with ecc correction",		/* 1E 00 */
 	"\037\000partial defect list transfer",			/* 1F 00 */
 	"\040\000invalid command operation code",		/* 20 00 */
+	"\040\001access controls code 1 (99-314) [proposed]",	/* 20 01 */
+	"\040\002access controls code 2 (99-314) [proposed]",	/* 20 02 */
+	"\040\003access controls code 3 (99-314) [proposed]",	/* 20 03 */
+	"\040\004read type operation while in write capable state",	/* 20 04 */
+	"\040\005write type operation while in read capable state",	/* 20 05 */
+	"\040\006illegal command while in explicit address model",	/* 20 06 */
+	"\040\007illegal command while in implicit address model",	/* 20 07 */
+	"\040\010access controls code 5 (99-245) [proposed]",	/* 20 08 */
+	"\040\011access controls code 6 (99-245) [proposed]",	/* 20 09 */
+	"\040\012access controls code 7 (99-245) [proposed]",	/* 20 0A */
+	"\040\013access controls code 8 (99-245) [proposed]",	/* 20 0B */
 	"\041\000logical block address out of range",		/* 21 00 */
 	"\041\001invalid element address",			/* 21 01 */
+	"\041\002invalid address for write",			/* 21 02 */
 	"\042\000illegal function (use 20 00, 24 00, or 26 00)",/* 22 00 */
+#ifdef	__used__
+	"\043\000",						/* 23 00 */
+#endif
 	"\044\000invalid field in cdb",				/* 24 00 */
+	"\044\001cdb decryption error",				/* 24 01 */
+	"\044\002invalid cdb field while in explicit block address model",	/* 24 02 */
+	"\044\003invalid cdb field while in implicit block address model",	/* 24 03 */
 	"\045\000logical unit not supported",			/* 25 00 */
 	"\046\000invalid field in parameter list",		/* 26 00 */
 	"\046\001parameter not supported",			/* 26 01 */
 	"\046\002parameter value invalid",			/* 26 02 */
 	"\046\003threshold parameters not supported",		/* 26 03 */
-	"\046\004invalid release of active persistent reservation",	/* 26 04 */
+	"\046\004invalid release of persistent reservation",	/* 26 04 */
+	"\046\005data decryption error",			/* 26 05 */
+	"\046\006too many target descriptors",			/* 26 06 */
+	"\046\007unsupported target descriptor type code",	/* 26 07 */
+	"\046\010too many segment descriptors",			/* 26 08 */
+	"\046\011unsupported segment descriptor type code",	/* 26 09 */
+	"\046\012unexpected inexact segment",			/* 26 0A */
+	"\046\013inline data length exceeded",			/* 26 0B */
+	"\046\014invalid operation for copy source or destination",	/* 26 0C */
+	"\046\015copy segment granularity violation",		/* 26 0D */
 	"\047\000write protected",				/* 27 00 */
 	"\047\001hardware write protected",			/* 27 01 */
 	"\047\002logical unit software write protected",	/* 27 02 */
 	"\047\003associated write protect",			/* 27 03 */
 	"\047\004persistent write protect",			/* 27 04 */
 	"\047\005permanent write protect",			/* 27 05 */
+	"\047\006conditional write protect",			/* 27 06 */
 	"\050\000not ready to ready change, medium may have changed",	/* 28 00 */
 	"\050\001import or export element accessed",		/* 28 01 */
 	"\051\000power on, reset, or bus device reset occurred",/* 29 00 */
@@ -236,13 +284,20 @@
 	"\052\001mode parameters changed",			/* 2A 01 */
 	"\052\002log parameters changed",			/* 2A 02 */
 	"\052\003reservations preempted",			/* 2A 03 */
+	"\052\004reservations released",			/* 2A 04 */
+	"\052\005registrations preempted",			/* 2A 05 */
+	"\052\006asymmetric access code 6 (00-232) [proposed]",	/* 2A 06 */
+	"\052\007asymmetric access code 7 (00-232) [proposed]",	/* 2A 07 */
 	"\053\000copy cannot execute since host cannot disconnect",	/* 2B 00 */
 	"\054\000command sequence error",			/* 2C 00 */
 	"\054\001too many windows specified",			/* 2C 01 */
 	"\054\002invalid combination of windows specified",	/* 2C 02 */
 	"\054\003current program area is not empty",		/* 2C 03 */
 	"\054\004current program area is empty",		/* 2C 04 */
+	"\054\005illegal power condition request",		/* 2C 05 */
+	"\054\006persistent prevent conflict",			/* 2C 06 */
 	"\055\000overwrite error on update in place",		/* 2D 00 */
+	"\056\000insufficient time for operation",		/* 2E 00 */
 	"\057\000commands cleared by another initiator",	/* 2F 00 */
 	"\060\000incompatible medium installed",		/* 30 00 */
 	"\060\001cannot read medium - unknown format",		/* 30 01 */
@@ -254,8 +309,10 @@
 	"\060\007cleaning failure",				/* 30 07 */
 	"\060\010cannot write - application code mismatch",	/* 30 08 */
 	"\060\011current session not fixated for append",	/* 30 09 */
+	"\060\020medium not formatted",				/* 30 10 */
 	"\061\000medium format corrupted",			/* 31 00 */
 	"\061\001format command failed",			/* 31 01 */
+	"\061\002zoned formatting failed due to spare linking",	/* 31 02 */
 	"\062\000no defect spare location available",		/* 32 00 */
 	"\062\001defect list update failure",			/* 32 01 */
 	"\063\000tape length error",				/* 33 00 */
@@ -267,10 +324,16 @@
 	"\065\004enclosure services transfer refused",		/* 35 04 */
 	"\066\000ribbon, ink, or toner failure",		/* 36 00 */
 	"\067\000rounded parameter",				/* 37 00 */
+	"\070\000event status notification",			/* 38 00 */
+	"\070\002esn - power management class event",		/* 38 02 */
+	"\070\004esn - media class event",			/* 38 04 */
+	"\070\006esn - device busy class event",		/* 38 06 */
 	"\071\000saving parameters not supported",		/* 39 00 */
 	"\072\000medium not present",				/* 3A 00 */
 	"\072\001medium not present - tray closed",		/* 3A 01 */
 	"\072\002medium not present - tray open",		/* 3A 02 */
+	"\072\003medium not present - loadable",		/* 3A 03 */
+	"\072\004medium not present - medium auxiliary memory accessible",	/* 3A 04 */
 	"\073\000sequential positioning error",			/* 3B 00 */
 	"\073\001tape position error at beginning-of-medium",	/* 3B 01 */
 	"\073\002tape position error at end-of-medium",		/* 3B 02 */
@@ -292,18 +355,39 @@
 	"\073\023medium magazine inserted",			/* 3B 13 */
 	"\073\024medium magazine locked",			/* 3B 14 */
 	"\073\025medium magazine unlocked",			/* 3B 15 */
+	"\073\026mechanical positioning or changer error",	/* 3B 16 */
+#ifdef	__used__
+	"\074\000",						/* 3C 00 */
+#endif
 	"\075\000invalid bits in identify message",		/* 3D 00 */
 	"\076\000logical unit has not self-configured yet",	/* 3E 00 */
 	"\076\001logical unit failure",				/* 3E 01 */
 	"\076\002timeout on logical unit",			/* 3E 02 */
+	"\076\003logical unit failed self-test",		/* 3E 03 */
+	"\076\004logical unit unable to update self-test log",	/* 3E 04 */
 	"\077\000target operating conditions have changed",	/* 3F 00 */
 	"\077\001microcode has been changed",			/* 3F 01 */
 	"\077\002changed operating definition",			/* 3F 02 */
 	"\077\003inquiry data has changed",			/* 3F 03 */
+	"\077\004component device attached",			/* 3F 04 */
+	"\077\005device identifier changed",			/* 3F 05 */
+	"\077\006redundancy group created or modified",		/* 3F 06 */
+	"\077\007redundancy group deleted",			/* 3F 07 */
+	"\077\010spare created or modified",			/* 3F 08 */
+	"\077\011spare deleted",				/* 3F 09 */
+	"\077\012volume set created or modified",		/* 3F 0A */
+	"\077\013volume set deleted",				/* 3F 0B */
+	"\077\014volume set deassigned",			/* 3F 0C */
+	"\077\015volume set reassigned",			/* 3F 0D */
+	"\077\016reported luns data has changed",		/* 3F 0E */
+	"\077\017echo buffer overwritten",			/* 3F 0F */
+	"\077\020medium loadable",				/* 3F 10 */
+	"\077\021medium auxiliary memory accessible",		/* 3F 11 */
 	"\100\000ram failure (should use 40 nn)",		/* 40 00 */
 #ifdef	XXX
 	"\100\000nn diagnostic failure on component nn (80h-ffh)",	/* 40 00 */
 #endif
+	"\100\000diagnostic failure on component nn (80h-ffh)",	/* 40 00 */
 	"\101\000data path failure (should use 40 nn)",		/* 41 00 */
 	"\102\000power-on or self-test failure (should use 40 nn)",	/* 42 00 */
 	"\103\000message error",				/* 43 00 */
@@ -311,6 +395,10 @@
 	"\105\000select or reselect failure",			/* 45 00 */
 	"\106\000unsuccessful soft reset",			/* 46 00 */
 	"\107\000scsi parity error",				/* 47 00 */
+	"\107\001data phase crc error detected",		/* 47 01 */
+	"\107\002scsi parity error detected during st data phase",	/* 47 02 */
+	"\107\003information unit crc error detected",		/* 47 03 */
+	"\107\004asynchronous information protection error detected",	/* 47 04 */
 	"\110\000initiator detected error message received",	/* 48 00 */
 	"\111\000invalid message error",			/* 49 00 */
 	"\112\000command phase error",				/* 4A 00 */
@@ -319,11 +407,16 @@
 #ifdef	XXX
 	"\115\000nn tagged overlapped commands (nn = queue tag)",	/* 4D 00 */
 #endif
+	"\115\000tagged overlapped commands (nn = queue tag)",	/* 4D 00 */
 	"\116\000overlapped commands attempted",		/* 4E 00 */
+#ifdef	__used__
+	"\117\000",						/* 4F 00 */
+#endif
 	"\120\000write append error",				/* 50 00 */
 	"\120\001write append position error",			/* 50 01 */
 	"\120\002position error related to timing",		/* 50 02 */
 	"\121\000erase failure",				/* 51 00 */
+	"\121\001erase failure - incomplete erase operation detected",	/* 51 01 */
 	"\122\000cartridge fault",				/* 52 00 */
 	"\123\000media load or eject failed",			/* 53 00 */
 	"\123\001unload tape failure",				/* 53 01 */
@@ -331,6 +424,14 @@
 	"\124\000scsi to host system interface failure",	/* 54 00 */
 	"\125\000system resource failure",			/* 55 00 */
 	"\125\001system buffer full",				/* 55 01 */
+	"\125\002insufficient reservation resources",		/* 55 02 */
+	"\125\003insufficient resources",			/* 55 03 */
+	"\125\004insufficient registration resources",		/* 55 04 */
+	"\125\005access controls code 4 (99-314) [proposed]",	/* 55 05 */
+	"\125\006auxiliary memory code 1 (99-148) [proposed]",	/* 55 06 */
+#ifdef	__used__
+	"\126\000",						/* 56 00 */
+#endif
 	"\127\000unable to recover table-of-contents",		/* 57 00 */
 	"\130\000generation does not exist",			/* 58 00 */
 	"\131\000updated block read",				/* 59 00 */
@@ -346,12 +447,101 @@
 	"\134\001spindles synchronized",			/* 5C 01 */
 	"\134\002spindles not synchronized",			/* 5C 02 */
 	"\135\000failure prediction threshold exceeded",	/* 5D 00 */
+	"\135\001media failure prediction threshold exceeded",	/* 5D 01 */
+	"\135\002logical unit failure prediction threshold exceeded",	/* 5D 02 */
+	"\135\003spare area exhaustion prediction threshold exceeded",	/* 5D 03 */
+	"\135\020hardware impending failure general hard drive failure",/* 5D 10 */
+	"\135\021hardware impending failure drive error rate too high",	/* 5D 11 */
+	"\135\022hardware impending failure data error rate too high",	/* 5D 12 */
+	"\135\023hardware impending failure seek error rate too high",	/* 5D 13 */
+	"\135\024hardware impending failure too many block reassigns",	/* 5D 14 */
+	"\135\025hardware impending failure access times too high",	/* 5D 15 */
+	"\135\026hardware impending failure start unit times too high",	/* 5D 16 */
+	"\135\027hardware impending failure channel parametrics",/* 5D 17 */
+	"\135\030hardware impending failure controller detected",/* 5D 18 */
+	"\135\031hardware impending failure throughput performance",	/* 5D 19 */
+	"\135\032hardware impending failure seek time performance",	/* 5D 1A */
+	"\135\033hardware impending failure spin-up retry count",	/* 5D 1B */
+	"\135\034hardware impending failure drive calibration retry count",	/* 5D 1C */
+	"\135\040controller impending failure general hard drive failure",	/* 5D 20 */
+	"\135\041controller impending failure drive error rate too high",	/* 5D 21 */
+	"\135\042controller impending failure data error rate too high",/* 5D 22 */
+	"\135\043controller impending failure seek error rate too high",/* 5D 23 */
+	"\135\044controller impending failure too many block reassigns",/* 5D 24 */
+	"\135\045controller impending failure access times too high",	/* 5D 25 */
+	"\135\046controller impending failure start unit times too high",	/* 5D 26 */
+	"\135\047controller impending failure channel parametrics",	/* 5D 27 */
+	"\135\050controller impending failure controller detected",	/* 5D 28 */
+	"\135\051controller impending failure throughput performance",	/* 5D 29 */
+	"\135\052controller impending failure seek time performance",	/* 5D 2A */
+	"\135\053controller impending failure spin-up retry count",	/* 5D 2B */
+	"\135\054controller impending failure drive calibration retry count",	/* 5D 2C */
+	"\135\060data channel impending failure general hard drive failure",	/* 5D 30 */
+	"\135\061data channel impending failure drive error rate too high",	/* 5D 31 */
+	"\135\062data channel impending failure data error rate too high",	/* 5D 32 */
+	"\135\063data channel impending failure seek error rate too high",	/* 5D 33 */
+	"\135\064data channel impending failure too many block reassigns",	/* 5D 34 */
+	"\135\065data channel impending failure access times too high",	/* 5D 35 */
+	"\135\066data channel impending failure start unit times too high",	/* 5D 36 */
+	"\135\067data channel impending failure channel parametrics",	/* 5D 37 */
+	"\135\070data channel impending failure controller detected",	/* 5D 38 */
+	"\135\071data channel impending failure throughput performance",/* 5D 39 */
+	"\135\072data channel impending failure seek time performance",	/* 5D 3A */
+	"\135\073data channel impending failure spin-up retry count",	/* 5D 3B */
+	"\135\074data channel impending failure drive calibration retry count",	/* 5D 3C */
+	"\135\100servo impending failure general hard drive failure",	/* 5D 40 */
+	"\135\101servo impending failure drive error rate too high",	/* 5D 41 */
+	"\135\102servo impending failure data error rate too high",	/* 5D 42 */
+	"\135\103servo impending failure seek error rate too high",	/* 5D 43 */
+	"\135\104servo impending failure too many block reassigns",	/* 5D 44 */
+	"\135\105servo impending failure access times too high",/* 5D 45 */
+	"\135\106servo impending failure start unit times too high",	/* 5D 46 */
+	"\135\107servo impending failure channel parametrics",	/* 5D 47 */
+	"\135\110servo impending failure controller detected",	/* 5D 48 */
+	"\135\111servo impending failure throughput performance",	/* 5D 49 */
+	"\135\112servo impending failure seek time performance",/* 5D 4A */
+	"\135\113servo impending failure spin-up retry count",	/* 5D 4B */
+	"\135\114servo impending failure drive calibration retry count",/* 5D 4C */
+	"\135\120spindle impending failure general hard drive failure",	/* 5D 50 */
+	"\135\121spindle impending failure drive error rate too high",	/* 5D 51 */
+	"\135\122spindle impending failure data error rate too high",	/* 5D 52 */
+	"\135\123spindle impending failure seek error rate too high",	/* 5D 53 */
+	"\135\124spindle impending failure too many block reassigns",	/* 5D 54 */
+	"\135\125spindle impending failure access times too high",	/* 5D 55 */
+	"\135\126spindle impending failure start unit times too high",	/* 5D 56 */
+	"\135\127spindle impending failure channel parametrics",/* 5D 57 */
+	"\135\130spindle impending failure controller detected",/* 5D 58 */
+	"\135\131spindle impending failure throughput performance",	/* 5D 59 */
+	"\135\132spindle impending failure seek time performance",	/* 5D 5A */
+	"\135\133spindle impending failure spin-up retry count",/* 5D 5B */
+	"\135\134spindle impending failure drive calibration retry count",	/* 5D 5C */
+	"\135\140firmware impending failure general hard drive failure",/* 5D 60 */
+	"\135\141firmware impending failure drive error rate too high",	/* 5D 61 */
+	"\135\142firmware impending failure data error rate too high",	/* 5D 62 */
+	"\135\143firmware impending failure seek error rate too high",	/* 5D 63 */
+	"\135\144firmware impending failure too many block reassigns",	/* 5D 64 */
+	"\135\145firmware impending failure access times too high",	/* 5D 65 */
+	"\135\146firmware impending failure start unit times too high",	/* 5D 66 */
+	"\135\147firmware impending failure channel parametrics",	/* 5D 67 */
+	"\135\150firmware impending failure controller detected",	/* 5D 68 */
+	"\135\151firmware impending failure throughput performance",	/* 5D 69 */
+	"\135\152firmware impending failure seek time performance",	/* 5D 6A */
+	"\135\153firmware impending failure spin-up retry count",	/* 5D 6B */
+	"\135\154firmware impending failure drive calibration retry count",	/* 5D 6C */
 	"\135\377failure prediction threshold exceeded (false)",/* 5D FF */
 	"\136\000low power condition on",			/* 5E 00 */
 	"\136\001idle condition activated by timer",		/* 5E 01 */
 	"\136\002standby condition activated by timer",		/* 5E 02 */
 	"\136\003idle condition activated by command",		/* 5E 03 */
 	"\136\004standby condition activated by command",	/* 5E 04 */
+	"\136\101power state change to active",			/* 5E 41 */
+	"\136\102power state change to idle",			/* 5E 42 */
+	"\136\103power state change to standby",		/* 5E 43 */
+	"\136\105power state change to sleep",			/* 5E 45 */
+	"\136\107power state change to device control",		/* 5E 47 */
+#ifdef	__used__
+	"\137\000",						/* 5F 00 */
+#endif
 	"\140\000lamp failure",					/* 60 00 */
 	"\141\000video acquisition error",			/* 61 00 */
 	"\141\001unable to acquire video",			/* 61 01 */
@@ -374,6 +564,10 @@
 	"\147\005remove of logical unit failed",		/* 67 05 */
 	"\147\006attachment of logical unit failed",		/* 67 06 */
 	"\147\007creation of logical unit failed",		/* 67 07 */
+	"\147\010assign failure occurred",			/* 67 08 */
+	"\147\011multiply assigned logical unit",		/* 67 09 */
+	"\147\012asymmetric access code 4 (00-232) [proposed]",	/* 67 0A */
+	"\147\013asymmetric access code 5 (00-232) [proposed]",	/* 67 0B */
 	"\150\000logical unit not configured",			/* 68 00 */
 	"\151\000data loss on logical unit",			/* 69 00 */
 	"\151\001multiple logical unit failures",		/* 69 01 */
@@ -385,21 +579,44 @@
 	"\154\000rebuild failure occurred",			/* 6C 00 */
 	"\155\000recalculate failure occurred",			/* 6D 00 */
 	"\156\000command to logical unit failed",		/* 6E 00 */
+	"\157\000copy protection key exchange failure - authentication failure",/* 6F 00 */
+	"\157\001copy protection key exchange failure - key not present",	/* 6F 01 */
+	"\157\002copy protection key exchange failure - key not established",	/* 6F 02 */
+	"\157\003read of scrambled sector without authentication",	/* 6F 03 */
+	"\157\004media region code is mismatched to logical unit region",	/* 6F 04 */
+	"\157\005drive region must be permanent/region reset count error",	/* 6F 05 */
 #ifdef	XXX
 	"\160\000nn decompression exception short algorithm id of nn",	/* 70 00 */
 #endif
+	"\160\000decompression exception short algorithm id of nn",	/* 70 00 */
 	"\161\000decompression exception long algorithm id",	/* 71 00 */
 	"\162\000session fixation error",			/* 72 00 */
 	"\162\001session fixation error writing lead-in",	/* 72 01 */
 	"\162\002session fixation error writing lead-out",	/* 72 02 */
 	"\162\003session fixation error - incomplete track in session",	/* 72 03 */
 	"\162\004empty or partially written reserved track",	/* 72 04 */
+	"\162\005no more track reservations allowed",		/* 72 05 */
 	"\163\000cd control error",				/* 73 00 */
 	"\163\001power calibration area almost full",		/* 73 01 */
 	"\163\002power calibration area is full",		/* 73 02 */
 	"\163\003power calibration area error",			/* 73 03 */
 	"\163\004program memory area update failure",		/* 73 04 */
 	"\163\005program memory area is full",			/* 73 05 */
+	"\163\006rma/pma is almost full",			/* 73 06 */
+#ifdef	__used__
+	"\164\000",						/* 74 00 */
+	"\165\000",						/* 75 00 */
+	"\166\000",						/* 76 00 */
+	"\167\000",						/* 77 00 */
+	"\170\000",						/* 78 00 */
+	"\171\000",						/* 79 00 */
+	"\172\000",						/* 7A 00 */
+	"\173\000",						/* 7B 00 */
+	"\174\000",						/* 7C 00 */
+	"\175\000",						/* 7D 00 */
+	"\176\000",						/* 7E 00 */
+	"\177\000",						/* 7F 00 */
+#endif
 #ifdef	XXX
 	"\200\000start vendor unique",				/* 80 00 */
 #endif
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsihack.c cdrdao-1.1.5/scsilib/libscg/scsihack.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsihack.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scsihack.c	2001-11-27 14:25:40.000000000 -0500
@@ -1,7 +1,7 @@
-/* @(#)scsihack.c	1.37 01/02/15 Copyright 1997,2000 J. Schilling */
+/* @(#)scsihack.c	1.40 01/11/27 Copyright 1997,2000,2001 J. Schilling */
 #ifndef lint
 static	char _sccsid[] =
-	"@(#)scsihack.c	1.37 01/02/15 Copyright 1997,2000 J. Schilling";
+	"@(#)scsihack.c	1.40 01/11/27 Copyright 1997,2000,2001 J. Schilling";
 #endif
 /*
  *	Interface for other generic SCSI implementations.
@@ -24,7 +24,7 @@
  *	If your version has been integrated into the main steam release,
  *	the return value will be set to "schily".
  *
- *	Copyright (c) 1997 J. Schilling
+ *	Copyright (c) 1997,2000,2001 J. Schilling
  */
 /*
  * This program is free software; you can redistribute it and/or modify
@@ -167,9 +167,18 @@
 
 #if	defined(__NeXT__) || defined(IS_MACOS_X)
 #if	defined(HAVE_BSD_DEV_SCSIREG_H)
+/*
+ *	This is the
+ */
 #define	SCSI_IMPL		/* We found a SCSI implementation for NextStep and Mac OS X */
 
 #include "scsi-next.c"
+#else
+
+#define	SCSI_IMPL		/* We found a SCSI implementation for Mac OS X (Darwin-1.4) */
+
+#include "scsi-mac-iokit.c"
+
 #endif	/* HAVE_BSD_DEV_SCSIREG_H */
 
 #endif	/* NEXT / Mac OS X */
@@ -224,6 +233,11 @@
 #include "scsi-apollo.c"
 #endif
 
+#ifdef	AMIGA			/* We have a SCSI implementation for AmigaOS */
+#define	SCSI_IMPL
+#include "scsi-amigaos.c"
+#endif
+
 #ifdef	__NEW_ARCHITECTURE
 #define	SCSI_IMPL		/* We have a SCSI implementation for XXX */
 /*
@@ -304,7 +318,7 @@
  *	Choose your name instead of "schily" and make clear that the version
  *	string is related to a modified source.
  */
-LOCAL	char	_scg_trans_dversion[] = "scsihack.c-1.37";	/* The version for this transport*/
+LOCAL	char	_scg_trans_dversion[] = "scsihack.c-1.40";	/* The version for this transport*/
 
 /*
  * Return version information for the low level SCSI transport code.
diff -ruN cdrdao-1.1.5.orig/scsilib/libscg/scsitransp.c cdrdao-1.1.5/scsilib/libscg/scsitransp.c
--- cdrdao-1.1.5.orig/scsilib/libscg/scsitransp.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/libscg/scsitransp.c	2002-05-04 14:42:58.000000000 -0400
@@ -1,7 +1,7 @@
-/* @(#)scsitransp.c	1.81 01/04/20 Copyright 1988,1995,2000 J. Schilling */
+/* @(#)scsitransp.c	1.83 02/05/04 Copyright 1988,1995,2000 J. Schilling */
 /*#ifndef lint*/
 static	char sccsid[] =
-	"@(#)scsitransp.c	1.81 01/04/20 Copyright 1988,1995,2000 J. Schilling";
+	"@(#)scsitransp.c	1.83 02/05/04 Copyright 1988,1995,2000 J. Schilling";
 /*#endif*/
 /*
  *	SCSI user level command transport routines (generic part).
@@ -14,21 +14,7 @@
  *
  *	Copyright (c) 1988,1995,2000 J. Schilling
  */
-/*
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; see the file COPYING.  If not, write to
- * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
- */
+/*@@C@@*/
 
 #include <mconfig.h>
 #include <stdio.h>
@@ -52,7 +38,7 @@
  *	Choose your name instead of "schily" and make clear that the version
  *	string is related to a modified source.
  */
-LOCAL	char	_scg_version[]		= "0.5";	/* The global libscg version	*/
+LOCAL	char	_scg_version[]		= "0.6";	/* The global libscg version	*/
 LOCAL	char	_scg_auth_schily[]	= "schily";	/* The author for this module	*/
 
 #define	DEFTIMEOUT	20	/* Default timeout for SCSI command transport */
@@ -371,6 +357,7 @@
 		}
 		raisecond("SCSI ALREADY RUNNING !!", 0L);
 	}
+	scgp->cb_fun = NULL;
 	gettimeofday(scgp->cmdstart, (struct timezone *)0);
 	scgp->curcmdname = scgp->cmdname;
 	scgp->running = TRUE;
@@ -396,6 +383,8 @@
 
 	ret = scg_vtail(scgp);
 	scg_errflush(scgp);
+	if (scgp->cb_fun != NULL)
+		(*scgp->cb_fun)(scgp->cb_arg);
 	return (ret);
 }
 
diff -ruN cdrdao-1.1.5.orig/scsilib/rscsi/rscsi.c cdrdao-1.1.5/scsilib/rscsi/rscsi.c
--- cdrdao-1.1.5.orig/scsilib/rscsi/rscsi.c	2001-04-29 04:44:46.000000000 -0400
+++ cdrdao-1.1.5/scsilib/rscsi/rscsi.c	2002-04-20 15:40:18.000000000 -0400
@@ -1,12 +1,12 @@
-/* @(#)rscsi.c	1.12 01/04/21 Copyright 1994,2000 J. Schilling*/
+/* @(#)rscsi.c	1.20 02/04/20 Copyright 1994,2000-2002 J. Schilling*/
 #ifndef lint
 static	char sccsid[] =
-	"@(#)rscsi.c	1.12 01/04/21 Copyright 1994,2000 J. Schilling";
+	"@(#)rscsi.c	1.20 02/04/20 Copyright 1994,2000-2002 J. Schilling";
 #endif
 /*
  *	Remote SCSI server
  *
- *	Copyright (c) 1994,2000 J. Schilling
+ *	Copyright (c) 1994,2000-2002 J. Schilling
  */
 /*
  * This program is free software; you can redistribute it and/or modify
@@ -29,10 +29,10 @@
 #include <mconfig.h>
 #include <stdio.h>
 #include <stdxlib.h>
-#include <unixstd.h>
+#include <unixstd.h>	/* includes <sys/types.h> */
+#include <utypes.h>
 #include <fctldefs.h>
 #include <strdefs.h>
-#include <sys/types.h>
 #include <sys/socket.h>
 #ifdef	 HAVE_SYS_PARAM_H
 #include <sys/param.h>	/* BSD-4.2 & Linux need this for MAXHOSTNAMELEN */
@@ -40,7 +40,6 @@
 #include <errno.h>
 #include <pwd.h>
 
-#include <utypes.h>
 #include <standard.h>
 #include <deflts.h>
 #include <patmatch.h>
@@ -50,13 +49,11 @@
 #include <scg/scsitransp.h>
 
 #include <netinet/in.h>
-#include <arpa/inet.h>
+#ifdef	HAVE_ARPA_INET_H
+#include <arpa/inet.h>		/* BeOS does not have <arpa/inet.h> */
+#endif				/* but inet_ntaoa() is in <netdb.h> */
 #include <netdb.h>
 
-#ifndef	HAVE_ERRNO_DEF
-extern	int	errno;
-#endif
-
 EXPORT	int	main		__PR((int argc, char **argv));
 LOCAL	void	checkuser	__PR((void));
 LOCAL	char	*getpeer	__PR((void));
@@ -75,6 +72,10 @@
 LOCAL	void	isatapi		__PR((void));
 LOCAL	void	scsireset	__PR((void));
 LOCAL	void	sendcmd		__PR((void));
+
+LOCAL	int	fillrdbuf	__PR((void));
+LOCAL	int	readchar	__PR((char *cp));
+
 LOCAL	void	readbuf		__PR((char *buf, int n));
 LOCAL	void	voidarg		__PR((int n));
 LOCAL	void	readarg		__PR((char *buf, int n));
@@ -118,10 +119,22 @@
 		argc--, argv++;
 		argc--, argv++;
 	}
+	/*
+	 * WARNING you are only allowed to change the defaults configuration
+	 * filename if you also change the documentation and add a statement
+	 * that makes clear where the official location of the file is, why you
+	 * did choose a nonstandard location and that the nonstandard location
+	 * only refers to inofficial rmt versions.
+	 *
+	 * I was forced to add this because some people change cdrecord without
+	 * rational reason and then publish the result. As those people
+	 * don't contribute work and don't give support, they are causing extra
+	 * work for me and this way slow down the development.
+	 */
 	if (defltopen("/etc/default/rscsi") < 0) {
-		rscsierror(errno, errmsgstr(errno),
+		rscsierror(geterrno(), errmsgstr(geterrno()),
 			"Remote configuration error: Cannot open /etc/default/rscsi");
-/*		rscsirespond(-1, errno);*/
+/*		rscsirespond(-1, geterrno());*/
 		exit(EX_BAD);
 	}
 	debug_name=defltread("DEBUG=");
@@ -137,7 +150,7 @@
 		
 	if (argc > 0) {
 		if (debug_file == 0) {
-			rscsirespond(-1, errno);
+			rscsirespond(-1, geterrno());
 			exit(EX_BAD);
 		}
 		(void) setbuf(debug_file, (char *)0);
@@ -157,6 +170,7 @@
 
 	if (uid == 0) {
 		username = "root";
+		DEBUG("rscsid: user id 0, name root\n");
 		return;
 	}
 	pw = getpwuid(uid);
@@ -164,6 +178,7 @@
 		goto notfound;
 
 	username = pw->pw_name;
+	DEBUG2("rscsid: user id %ld, name %s\n", (long)uid, username);
 
 	defltfirst();
 	while ((uname = defltnext("USER=")) != NULL) {
@@ -187,14 +202,18 @@
 static	char		buffer[MAXHOSTNAMELEN];
 
 	if (getpeername(STDIN_FILENO, &sa, &sasize) < 0) {
-		DEBUG1("rscsid: peername %s\n", errmsgstr(errno));
+		DEBUG1("rscsid: peername %s\n", errmsgstr(geterrno()));
 		return ("ILLEGAL_SOCKET");
 	} else {
 		s = (struct sockaddr_in *)&sa;
 		if (s->sin_family != AF_INET)
 			return ("NOT_IP");
                
+#ifdef	HAVE_INET_NTOA
 		(void) js_snprintf(buffer, sizeof(buffer), "%s", inet_ntoa(s->sin_addr));
+#else
+		(void) js_snprintf(buffer, sizeof(buffer), "%x", s->sin_addr.s_addr);
+#endif
 		DEBUG1("rscsid: peername %s\n", buffer);
 		he = gethostbyaddr((char *)&s->sin_addr.s_addr, 4, AF_INET);
 		if (he != NULL)
@@ -310,8 +329,8 @@
 {
 	char	c;
 
-	while (read(STDIN_FILENO, &c, 1) == 1) {
-		errno = 0;
+	while (readchar(&c) == 1) {
+		seterrno(0);
 
 		switch (c) {
 
@@ -377,8 +396,8 @@
 	str = scg_version(scsi_ptr, atoi(what));
 	ret = strlen(str);
 	ret++;	/* Include null char */
-	rscsirespond(ret, errno);
-	write(STDOUT_FILENO, str, ret);
+	rscsirespond(ret, geterrno());
+	_nixwrite(STDOUT_FILENO, str, ret);
 }
 
 LOCAL void
@@ -398,10 +417,10 @@
 	DEBUG1("rscsid: O %s\n", device);
 	if (strncmp(device, "REMOTE", 6) == 0) {
 		scsi_ptr = NULL;
-		errno = EINVAL;
+		seterrno(EINVAL);
 	} else if (!checkscsi(device)) {
 		scsi_ptr = NULL;
-		errno = EACCES;
+		seterrno(EACCES);
 	} else {
 		scsi_ptr = scg_open(device, errstr, sizeof(errstr), debug, lverbose);
 		if (scsi_ptr == NULL) {
@@ -418,8 +437,8 @@
 		 * XXX This is currently the only place where we use the
 		 * XXX extended error string.
 		 */
-		rscsierror(errno, errmsgstr(errno), errstr);
-/*		rscsirespond(ret, errno);*/
+		rscsierror(geterrno(), errmsgstr(geterrno()), errstr);
+/*		rscsirespond(ret, geterrno());*/
 		return;
 	}
 	DEBUG4("rscsid:>A 0 %d.%d,%d,%d\n", 
@@ -433,7 +452,7 @@
 		0,
 		scg_target(scsi_ptr),
 		scg_lun(scsi_ptr));
-	(void) write(STDOUT_FILENO, rbuf, ret);
+	(void) _nixwrite(STDOUT_FILENO, rbuf, ret);
 }
 
 LOCAL void
@@ -445,7 +464,7 @@
 	readarg(device, sizeof(device));
 	DEBUG1("rscsid: C %s\n", device);
 	ret = scg_close(scsi_ptr);
-	rscsirespond(ret, errno);
+	rscsirespond(ret, geterrno());
 	scsi_ptr = NULL;
 }
 
@@ -462,7 +481,7 @@
 		return;
 	}
 	ret = scg_bufsize(scsi_ptr, atol(amt));
-	rscsirespond(ret, errno);
+	rscsirespond(ret, geterrno());
 }
 
 LOCAL void
@@ -480,7 +499,7 @@
 	ret = scg_bufsize(scsi_ptr, atol(amt));
 	if (preparebuffer(ret) == NULL)
 		ret = -1;
-	rscsirespond(ret, errno);
+	rscsirespond(ret, geterrno());
 }
 
 LOCAL void
@@ -497,7 +516,7 @@
 	}
 	scg_freebuf(scsi_ptr);
 	Sbuf = NULL;
-	rscsirespond(ret, errno);
+	rscsirespond(ret, geterrno());
 }
 
 LOCAL void
@@ -515,7 +534,7 @@
 		return;
 	}
 	ret = scg_havebus(scsi_ptr, atol(bus));
-	rscsirespond(ret, errno);
+	rscsirespond(ret, geterrno());
 }
 
 LOCAL void
@@ -536,14 +555,14 @@
 		rscsirespond(-1, EBADF);
 		return;
 	}
-	errno = 0;
+	seterrno(0);
 	ret = scg_settarget(scsi_ptr, atoi(bus), atoi(tgt), atoi(lun));
 	if (!checktarget()) {
 		scg_settarget(scsi_ptr, -1, -1, -1);
 		ret = -1;
 	}
-	if (errno != 0)
-		rscsirespond(ret, errno);
+	if (geterrno() != 0)
+		rscsirespond(ret, geterrno());
 	else
 		rscsireply(ret);
 }
@@ -560,10 +579,10 @@
 		rscsirespond(-1, EBADF);
 		return;
 	}
-	errno = 0;
+	seterrno(0);
 	ret = scg_initiator_id(scsi_ptr);
-	if (errno != 0)
-		rscsirespond(ret, errno);
+	if (geterrno() != 0)
+		rscsirespond(ret, geterrno());
 	else
 		rscsireply(ret);
 }
@@ -580,10 +599,10 @@
 		rscsirespond(-1, EBADF);
 		return;
 	}
-	errno = 0;
+	seterrno(0);
 	ret = scg_isatapi(scsi_ptr);
-	if (errno != 0)
-		rscsirespond(ret, errno);
+	if (geterrno() != 0)
+		rscsirespond(ret, geterrno());
 	else
 		rscsireply(ret);
 }
@@ -601,7 +620,7 @@
 		return;
 	}
 	ret = scg_reset(scsi_ptr, atoi(what));
-	rscsirespond(ret, errno);
+	rscsirespond(ret, geterrno());
 }
 
 LOCAL void
@@ -719,10 +738,36 @@
 		ret += n;
 		n = 0;
 	}
-	(void) write(STDOUT_FILENO, rbuf, ret);
+	(void) _nixwrite(STDOUT_FILENO, rbuf, ret);
 
 	if (n > 0)
-		(void) write(STDOUT_FILENO, Sbuf, n);
+		(void) _nixwrite(STDOUT_FILENO, Sbuf, n);
+}
+
+#define	READB_SIZE	128
+LOCAL	char		readb[READB_SIZE];
+LOCAL	char		*readbptr;
+LOCAL	int		readbcnt;
+
+LOCAL int
+fillrdbuf()
+{
+	readbptr = readb;
+
+	return (readbcnt = _niread(STDIN_FILENO, readb, READB_SIZE));
+}
+
+LOCAL int
+readchar(cp)
+	char	*cp;
+{
+	if (--readbcnt < 0) {
+		if (fillrdbuf() <= 0)
+			return (readbcnt);
+		--readbcnt;
+	}
+	*cp = *readbptr++;
+	return (1);
 }
 
 LOCAL void
@@ -730,11 +775,21 @@
 	register char	*buf;
 	register int	n;
 {
-	register int	i;
+	register int	i = 0;
 	register int	amt;
 
-	for (i = 0; i < n; i += amt) {
-		amt = read(STDIN_FILENO, &buf[i], n - i);
+	if (readbcnt > 0) {
+		amt = readbcnt;
+		if (amt > n)
+			amt = n;
+		movebytes(readbptr, buf, amt);
+		readbptr += amt;
+		readbcnt -= amt;
+		i += amt;
+	}
+
+	for (; i < n; i += amt) {
+		amt = _niread(STDIN_FILENO, &buf[i], n - i);
 		if (amt <= 0) {
 			DEBUG("rscsid: premature eof\n");
 			rscsierror(0, "Premature eof", NULL);
@@ -767,7 +822,7 @@
 	int	i;
 
 	for (i = 0; i < n; i++) {
-		if (read(STDIN_FILENO, &buf[i], 1) != 1)
+		if (readchar(&buf[i]) != 1)
 			exit(0);
 		if (buf[i] == '\n')
 			break;
@@ -837,7 +892,7 @@
 
 	DEBUG1("rscsid:>A %d\n", ret);
 	(void) js_snprintf(rbuf, sizeof(rbuf), "A%d\n", ret);
-	(void) write(STDOUT_FILENO, rbuf, strlen(rbuf));
+	(void) _nixwrite(STDOUT_FILENO, rbuf, strlen(rbuf));
 }
 
 LOCAL void
@@ -861,7 +916,7 @@
 		n += xlen;
 		xlen = 0;
 	}
-	(void) write(STDOUT_FILENO, rbuf, n);
+	(void) _nixwrite(STDOUT_FILENO, rbuf, n);
 	if (xlen > 0)
-		(void) write(STDOUT_FILENO, xstr, xlen);
+		(void) _nixwrite(STDOUT_FILENO, xstr, xlen);
 }
