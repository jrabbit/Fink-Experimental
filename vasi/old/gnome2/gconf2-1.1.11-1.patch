diff -Naur GConf-1.1.11/backends/Makefile.in GConf-new/backends/Makefile.in
--- GConf-1.1.11/backends/Makefile.in	Sun Jun  2 22:33:27 2002
+++ GConf-new/backends/Makefile.in	Mon Jun 10 20:24:58 2002
@@ -370,11 +370,11 @@
 markup-tree.lo markup-tree.o : markup-tree.c ../gconf/gconf-internals.h \
 	../config.h ../gconf/gconf-error.h ../gconf/gconf-value.h \
 	../gconf/gconf-engine.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h ../gconf/gconf-schema.h markup-tree.h
+	../gconf/GConfI.h ../gconf/gconf-schema.h markup-tree.h
 xml-backend.lo xml-backend.o : xml-backend.c ../gconf/gconf-backend.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-error.h \
 	../gconf/gconf-value.h ../gconf/gconf-engine.h \
-	../gconf/gconf-sources.h ../gconf/GConf.h ../gconf/gconf.h \
+	../gconf/gconf-sources.h ../gconf/GConfI.h ../gconf/gconf.h \
 	../gconf/gconf-schema.h ../gconf/gconf-enum-types.h xml-cache.h \
 	xml-dir.h
 xml-cache.lo xml-cache.o : xml-cache.c xml-cache.h ../gconf/gconf.h \
@@ -382,24 +382,24 @@
 	../gconf/gconf-error.h ../gconf/gconf-engine.h \
 	../gconf/gconf-enum-types.h xml-dir.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h
+	../gconf/GConfI.h
 xml-dir.lo xml-dir.o : xml-dir.c xml-dir.h ../gconf/gconf.h \
 	../gconf/gconf-schema.h ../gconf/gconf-value.h \
 	../gconf/gconf-error.h ../gconf/gconf-engine.h \
 	../gconf/gconf-enum-types.h xml-entry.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h
+	../gconf/GConfI.h
 xml-entry.lo xml-entry.o : xml-entry.c xml-entry.h ../gconf/gconf.h \
 	../gconf/gconf-schema.h ../gconf/gconf-value.h \
 	../gconf/gconf-error.h ../gconf/gconf-engine.h \
 	../gconf/gconf-enum-types.h ../gconf/gconf-internals.h \
-	../config.h ../gconf/gconf-sources.h ../gconf/GConf.h
+	../config.h ../gconf/gconf-sources.h ../gconf/GConfI.h
 xml-test.o: xml-test.c xml-entry.h ../gconf/gconf.h \
 	../gconf/gconf-schema.h ../gconf/gconf-value.h \
 	../gconf/gconf-error.h ../gconf/gconf-engine.h \
 	../gconf/gconf-enum-types.h xml-dir.h xml-cache.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h ../gconf/gconf-backend.h
+	../gconf/GConfI.h ../gconf/gconf-backend.h
 
 info-am:
 info: info-am
diff -Naur GConf-1.1.11/configure GConf-new/configure
--- GConf-1.1.11/configure	Sun Jun  2 22:29:23 2002
+++ GConf-new/configure	Mon Jun 10 20:27:01 2002
@@ -5566,7 +5566,7 @@
     # FIXME: Relying on posixy $() will cause problems for
     #        cross-compilation, but unfortunately the echo tests do not
     #        yet detect zsh echo's removal of \ escapes.
-    archive_cmds='$nonopt $(test "x$module" = xyes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib $libobjs $deplibs$linker_flags -install_name $rpath/$soname $verstring'
+    archive_cmds='$nonopt $(test x$module = xyes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib $libobjs $deplibs$linker_flags $(test x$module = xyes || echo -install_name $rpath/$soname $verstring)'
     # We need to add '_' to the symbols in $export_symbols first
     #archive_expsym_cmds="$archive_cmds"' && strip -s $export_symbols'
     hardcode_direct=yes
diff -Naur GConf-1.1.11/doc/gconf/Makefile.in GConf-new/doc/gconf/Makefile.in
--- GConf-1.1.11/doc/gconf/Makefile.in	Sun Jun  2 22:33:35 2002
+++ GConf-new/doc/gconf/Makefile.in	Mon Jun 10 20:28:00 2002
@@ -170,7 +170,7 @@
 
 # CFLAGS and LDFLAGS for compiling scan program. Only needed
 # if $(DOC_MODULE).types is non-empty.
-GTKDOC_CFLAGS = -I$(top_srcdir) $(CFLAGS) $(DEPENDENT_CFLAGS)
+GTKDOC_CFLAGS = -I$(top_srcdir) $(CFLAGS) $(DEPENDENT_CFLAGS) $(CPPFLAGS)
 
 GTKDOC_LIBS = $(LDFLAGS) $(DEPENDENT_LIBS) $(top_builddir)/gconf/libgconf-$(MAJOR_VERSION).la
 
diff -Naur GConf-1.1.11/gconf/Makefile.in GConf-new/gconf/Makefile.in
--- GConf-1.1.11/gconf/Makefile.in	Sun Jun  2 22:33:26 2002
+++ GConf-new/gconf/Makefile.in	Mon Jun 10 20:31:41 2002
@@ -160,7 +160,7 @@
 
 bin_PROGRAMS = gconfd-2 gconftool-2 $(SANITY_CHECK)
 
-CORBA_SOURCECODE = GConf-common.c GConf-skels.c GConf-stubs.c GConf.h
+CORBA_SOURCECODE = GConfI-common.c GConfI-skels.c GConfI-stubs.c GConfI.h
 
 built_sourcecode = \
 	$(CORBA_SOURCECODE)		\
@@ -243,7 +243,7 @@
 
 libgconf_2_la_LIBADD = $(INTLLIBS) $(DEPENDENT_LIBS)
 
-EXTRA_DIST = GConf.idl default.path.in gconfmarshal.list regenerate-enum-header.sh regenerate-enum-footer.sh
+EXTRA_DIST = GConfI.idl default.path.in gconfmarshal.list regenerate-enum-header.sh regenerate-enum-footer.sh
 mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
 CONFIG_HEADER = ../config.h
 CONFIG_CLEAN_FILES =  default.path
@@ -256,8 +256,8 @@
 libgconf_2_la_OBJECTS =  gconf-internals.lo gconf-backend.lo \
 gconf-changeset.lo gconf-error.lo gconf-listeners.lo gconf-locale.lo \
 gconf-schema.lo gconf-sources.lo gconf-value.lo gconf.lo \
-gconf-client.lo gconf-enum-types.lo GConf-common.lo GConf-skels.lo \
-GConf-stubs.lo
+gconf-client.lo gconf-enum-types.lo GConfI-common.lo GConfI-skels.lo \
+GConfI-stubs.lo
 @GTK_FALSE@bin_PROGRAMS =  gconfd-2$(EXEEXT) gconftool-2$(EXEEXT)
 @GTK_TRUE@bin_PROGRAMS =  gconfd-2$(EXEEXT) gconftool-2$(EXEEXT) \
 @GTK_TRUE@gconf-sanity-check-2$(EXEEXT)
@@ -472,20 +472,20 @@
 	$(MAKE) $(AM_MAKEFLAGS) top_distdir="$(top_distdir)" distdir="$(distdir)" dist-hook
 gconf-backend.lo gconf-backend.o : gconf-backend.c gconf-backend.h \
 	gconf-internals.h ../config.h gconf-error.h gconf-value.h \
-	gconf-engine.h gconf-sources.h GConf.h gconf-internals.h
+	gconf-engine.h gconf-sources.h GConfI.h gconf-internals.h
 gconf-changeset.lo gconf-changeset.o : gconf-changeset.c \
 	gconf-changeset.h gconf.h gconf-schema.h gconf-value.h \
 	gconf-error.h gconf-engine.h gconf-enum-types.h \
 	gconf-internals.h ../config.h gconf-error.h gconf-value.h \
-	gconf-engine.h gconf-sources.h GConf.h
+	gconf-engine.h gconf-sources.h GConfI.h
 gconf-client.lo gconf-client.o : gconf-client.c gconf-client.h gconf.h \
 	gconf-schema.h gconf-value.h gconf-error.h gconf-engine.h \
 	gconf-enum-types.h gconf-listeners.h gconf-changeset.h \
-	gconf-internals.h ../config.h gconf-sources.h GConf.h \
+	gconf-internals.h ../config.h gconf-sources.h GConfI.h \
 	gconfmarshal.h gconfmarshal.c
-GConf-common.lo GConf-common.o : GConf-common.c GConf.h
+GConfI-common.lo GConfI-common.o : GConfI-common.c GConfI.h
 gconf-database.o: gconf-database.c gconf-database.h gconf-error.h \
-	GConf.h gconf-listeners.h gconf-sources.h gconf-value.h \
+	GConfI.h gconf-listeners.h gconf-sources.h gconf-value.h \
 	gconf-internals.h ../config.h gconf-engine.h gconf-error.h \
 	gconf-locale.h gconfd.h
 gconf-enum-types.lo gconf-enum-types.o : gconf-enum-types.c \
@@ -494,10 +494,10 @@
 	gconf-listeners.h gconf-changeset.h
 gconf-error.lo gconf-error.o : gconf-error.c gconf-error.h \
 	gconf-internals.h ../config.h gconf-value.h gconf-engine.h \
-	gconf-error.h gconf-sources.h GConf.h
+	gconf-error.h gconf-sources.h GConfI.h
 gconf-internals.lo gconf-internals.o : gconf-internals.c ../config.h \
 	gconf-internals.h gconf-error.h gconf-value.h gconf-engine.h \
-	gconf-error.h gconf-sources.h GConf.h gconf-backend.h \
+	gconf-error.h gconf-sources.h GConfI.h gconf-backend.h \
 	gconf-internals.h gconf-sources.h gconf-schema.h gconf-value.h \
 	gconf.h gconf-schema.h gconf-engine.h gconf-enum-types.h
 gconf-listeners.lo gconf-listeners.o : gconf-listeners.c \
@@ -505,38 +505,38 @@
 	gconf-error.h gconf-engine.h gconf-enum-types.h
 gconf-locale.lo gconf-locale.o : gconf-locale.c gconf-locale.h \
 	gconf-internals.h ../config.h gconf-error.h gconf-value.h \
-	gconf-engine.h gconf-error.h gconf-sources.h GConf.h
+	gconf-engine.h gconf-error.h gconf-sources.h GConfI.h
 gconf-sanity-check.o: gconf-sanity-check.c gconf.h gconf-schema.h \
 	gconf-value.h gconf-error.h gconf-engine.h gconf-enum-types.h \
 	gconf-internals.h ../config.h gconf-error.h gconf-value.h \
-	gconf-engine.h gconf-sources.h GConf.h
+	gconf-engine.h gconf-sources.h GConfI.h
 gconf-schema.lo gconf-schema.o : gconf-schema.c gconf-schema.h \
 	gconf-value.h gconf-error.h gconf-internals.h ../config.h \
 	gconf-error.h gconf-value.h gconf-engine.h gconf-sources.h \
-	GConf.h
-GConf-skels.lo GConf-skels.o : GConf-skels.c GConf.h
+	GConfI.h
+GConfI-skels.lo GConfI-skels.o : GConfI-skels.c GConfI.h
 gconf-sources.lo gconf-sources.o : gconf-sources.c gconf-backend.h \
 	gconf-internals.h ../config.h gconf-error.h gconf-value.h \
-	gconf-engine.h gconf-sources.h GConf.h gconf-sources.h \
+	gconf-engine.h gconf-sources.h GConfI.h gconf-sources.h \
 	gconf-internals.h gconf-schema.h gconf.h gconf-schema.h \
 	gconf-enum-types.h
-GConf-stubs.lo GConf-stubs.o : GConf-stubs.c GConf.h
+GConfI-stubs.lo GConfI-stubs.o : GConfI-stubs.c GConfI.h
 gconf-value.lo gconf-value.o : gconf-value.c gconf-value.h gconf-error.h \
 	gconf-schema.h gconf-value.h gconf-internals.h ../config.h \
-	gconf-engine.h gconf-error.h gconf-sources.h GConf.h
-gconf.lo gconf.o : gconf.c GConf.h gconf.h gconf-schema.h gconf-value.h \
+	gconf-engine.h gconf-error.h gconf-sources.h GConfI.h
+gconf.lo gconf.o : gconf.c GConfI.h gconf.h gconf-schema.h gconf-value.h \
 	gconf-error.h gconf-engine.h gconf-enum-types.h \
 	gconf-internals.h ../config.h gconf-error.h gconf-value.h \
 	gconf-engine.h gconf-sources.h gconf-locale.h
 gconfd.o: gconfd.c ../config.h gconf-internals.h gconf-error.h \
 	gconf-value.h gconf-engine.h gconf-error.h gconf-sources.h \
-	GConf.h gconf-listeners.h gconf-locale.h gconf-schema.h \
+	GConfI.h gconf-listeners.h gconf-locale.h gconf-schema.h \
 	gconf-value.h gconf.h gconf-schema.h gconf-engine.h \
 	gconf-enum-types.h gconfd.h gconf-database.h
 gconftool.o: gconftool.c gconf.h gconf-schema.h gconf-value.h \
 	gconf-error.h gconf-engine.h gconf-enum-types.h \
 	gconf-internals.h ../config.h gconf-error.h gconf-value.h \
-	gconf-engine.h gconf-sources.h GConf.h
+	gconf-engine.h gconf-sources.h GConfI.h
 
 info-am:
 info: info-am
@@ -627,8 +627,8 @@
 dist-hook:
 	cd $(distdir) ; rm -f $(CLEANFILES)
 
-$(CORBA_SOURCECODE): $(srcdir)/GConf.idl $(ORBIT_IDL)
-	$(ORBIT_IDL) $(srcdir)/GConf.idl
+$(CORBA_SOURCECODE): $(srcdir)/GConfI.idl $(ORBIT_IDL)
+	$(ORBIT_IDL) $(srcdir)/GConfI.idl
 
 install-data-local:
 	-mkdir -p $(DESTDIR)$(sysconfdir)/gconf/$(MAJOR_VERSION)
diff -Naur GConf-1.1.11/gconf/gconf-internals.c GConf-new/gconf/gconf-internals.c
--- GConf-1.1.11/gconf/gconf-internals.c	Sun Jun  2 22:02:37 2002
+++ GConf-new/gconf/gconf-internals.c	Mon Jun 10 20:33:27 2002
@@ -2572,6 +2572,9 @@
         }
     }
 
+  /* needed on Darwin */
+  fsync (lock->lock_fd);
+
   return lock;
 }
 
diff -Naur GConf-1.1.11/gconf/gconf-internals.h GConf-new/gconf/gconf-internals.h
--- GConf-1.1.11/gconf/gconf-internals.h	Sun Jun  2 21:37:52 2002
+++ GConf-new/gconf/gconf-internals.h	Mon Jun 10 20:31:58 2002
@@ -37,7 +37,7 @@
 #include "gconf-value.h"
 #include "gconf-engine.h"
 #include "gconf-sources.h"
-#include "GConf.h"
+#include "GConfI.h"
 
 gchar*       gconf_key_directory  (const gchar* key);
 const gchar* gconf_key_key        (const gchar* key);
diff -Naur GConf-1.1.11/gconf/gconf.c GConf-new/gconf/gconf.c
--- GConf-1.1.11/gconf/gconf.c	Sun Jun  2 21:41:12 2002
+++ GConf-new/gconf/gconf.c	Mon Jun 10 20:32:15 2002
@@ -18,7 +18,7 @@
  */
 
 #include <popt.h>
-#include "GConf.h"
+#include "GConfI.h"
 #include "gconf.h"
 #include "gconf-internals.h"
 #include "gconf-sources.h"
diff -Naur GConf-1.1.11/gconf/gconfd.c GConf-new/gconf/gconfd.c
--- GConf-1.1.11/gconf/gconfd.c	Sun Jun  2 22:10:19 2002
+++ GConf-new/gconf/gconfd.c	Mon Jun 10 20:32:26 2002
@@ -37,7 +37,7 @@
 #include "gconf-database.h"
 #include <orbit/orbit.h>
 
-#include "GConf.h"
+#include "GConfI.h"
 
 #include <sys/types.h>
 #include <stdio.h>
diff -Naur GConf-1.1.11/gconf/gconfd.h GConf-new/gconf/gconfd.h
--- GConf-1.1.11/gconf/gconfd.h	Tue Mar  6 19:14:29 2001
+++ GConf-new/gconf/gconfd.h	Mon Jun 10 20:32:42 2002
@@ -27,7 +27,7 @@
 #endif /* __cplusplus */
 
 #include "gconf-error.h"
-#include "GConf.h"
+#include "GConfI.h"
 #include "gconf-database.h"
 
 PortableServer_POA gconf_get_poa ();
diff -Naur GConf-1.1.11/tests/Makefile.in GConf-new/tests/Makefile.in
--- GConf-1.1.11/tests/Makefile.in	Sun Jun  2 22:33:25 2002
+++ GConf-new/tests/Makefile.in	Mon Jun 10 20:34:02 2002
@@ -386,7 +386,7 @@
 	../gconf/gconf-value.h ../gconf/gconf-error.h \
 	../gconf/gconf-engine.h ../gconf/gconf-enum-types.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h ../gconf/gconf-backend.h
+	../gconf/GConfI.h ../gconf/gconf-backend.h
 testchangeset.o: testchangeset.c ../gconf/gconf.h \
 	../gconf/gconf-schema.h ../gconf/gconf-value.h \
 	../gconf/gconf-error.h ../gconf/gconf-engine.h \
@@ -395,28 +395,28 @@
 	../gconf/gconf-value.h ../gconf/gconf-error.h \
 	../gconf/gconf-engine.h ../gconf/gconf-enum-types.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h
+	../gconf/GConfI.h
 testencode.o: testencode.c ../gconf/gconf.h ../gconf/gconf-schema.h \
 	../gconf/gconf-value.h ../gconf/gconf-error.h \
 	../gconf/gconf-engine.h ../gconf/gconf-enum-types.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h
+	../gconf/GConfI.h
 testgconf.o: testgconf.c ../gconf/gconf.h ../gconf/gconf-schema.h \
 	../gconf/gconf-value.h ../gconf/gconf-error.h \
 	../gconf/gconf-engine.h ../gconf/gconf-enum-types.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h
+	../gconf/GConfI.h
 testlisteners.o: testlisteners.c ../gconf/gconf-listeners.h
 testpersistence.o: testpersistence.c ../gconf/gconf.h \
 	../gconf/gconf-schema.h ../gconf/gconf-value.h \
 	../gconf/gconf-error.h ../gconf/gconf-engine.h \
 	../gconf/gconf-enum-types.h ../gconf/gconf-internals.h \
-	../config.h ../gconf/gconf-sources.h ../gconf/GConf.h
+	../config.h ../gconf/gconf-sources.h ../gconf/GConfI.h
 testschemas.o: testschemas.c ../gconf/gconf.h ../gconf/gconf-schema.h \
 	../gconf/gconf-value.h ../gconf/gconf-error.h \
 	../gconf/gconf-engine.h ../gconf/gconf-enum-types.h \
 	../gconf/gconf-internals.h ../config.h ../gconf/gconf-sources.h \
-	../gconf/GConf.h
+	../gconf/GConfI.h
 testunique.o: testunique.c ../gconf/gconf.h ../gconf/gconf-schema.h \
 	../gconf/gconf-value.h ../gconf/gconf-error.h \
 	../gconf/gconf-engine.h ../gconf/gconf-enum-types.h
