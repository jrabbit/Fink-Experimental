Package: cyrus-imapd
Version: 2.1.12
Revision: 1
Maintainer: Matt Stephenson <cattrap@users.sourceforge.net>
Depends: cyrus-sasl2-shlibs, db3-shlibs, passwd (>= 20030202-2), daemonic
BuildDepends: openssl097-dev, db3, cyrus-sasl2-dev, dlcompat-dev
UpdatePOD: true
Source: mirror:custom:%N-%v.tar.gz
CustomMirror: <<
  nam-US: ftp://ftp.andrew.cmu.edu/pub/cyrus-mail/
  nam-US: ftp://ftp.andrew.cmu.edu/pub/cyrus-mail/OLD-VERSIONS/imap/
<<
Source-MD5: dc3355d0170509ccebd9788ed2daad39
PatchScript: sed 's|@prefix@|%p|g' <%a/%f.patch | patch -p1
UpdateConfigGuess: true
ConfigureParams: --with-bdb-incdir=%p/include/db3 --with-cyrus-prefix=%p --with-statedir=%p/var --with-auth=unix --with-pidfile=%p/var/run/cyrus-master.pid --with-cyrus-group=cyrus
InstallScript: <<
    mkdir -p %i/etc
    mkdir -p %i/share/doc/%N/man
    mkdir -p %i/share/%N/master/conf
    mkdir -p %i/var/imap/sieve
    mkdir -p %i/var/spool/imap
    make install DESTDIR=%d INSTALLPRIVLIB=%i/lib/perl5 INSTALLARCHLIB=%i/lib/perl5/darwin INSTALLSITELIB=%i/lib/perl5 INSTALLSITEARCH=%i/lib/perl5/darwin INSTALLMAN1DIR=%i/share/man/man1 INSTALLMAN3DIR=%i/share/man/man3
    cd tools; cp mkimap %i/bin
    cd master/conf; cp *.conf %i/share/%N/master/conf
    cd %i/share/%N/master/conf; cp normal.conf %i/etc/cyrus.conf
    mv %i/share/man/man8/master.8 %i/share/man/man8/master_imapd.8
    cp imapd.conf %i/etc
    chown cyrus %i/var/imap/sieve
    chgrp cyrus %i/var/imap/sieve
    chmod 0755 %i/var/imap/sieve
    chown cyrus %i/var/imap
    chgrp cyrus %i/var/imap
    chmod 750 %i/var/imap  
    chown cyrus %i/var/spool/imap
    chgrp cyrus %i/var/spool/imap
    chmod 750 %i/var/spool/imap  
    mkdir -p %i/var/run
    touch %i/var/run/cyrus-master.pid
    cd doc; cp *.html %i/share/doc/%N
    cd doc/man; cp *.html %i/share/doc/%N/man
<<
ConfFiles: <<
 %p/etc/cyrus.conf
 %p/etc/imapd.conf
<<
DocFiles: COPYRIGHT README
Splitoff: <<
 Package: %N-dev
 Files: include lib/*.a
 Description: Cyrus-imapd development headers and libraries
 DocFiles: COPYRIGHT README
 BuildDependsOnly: True
<<
DaemonicFile: <<
<service>
<description>Cyrus Mail Server</description>
<message>Starting Cyrus Mail Server</message>

<daemon name="master">
<executable background="yes">%p/bin/master</executable>
<configfile>%p/etc/imapd.conf</configfile>
<pidfile>%i/var/run/cyrus-master.pid</pidfile>
</daemon>

</service>
<<
PostInstScript: <<
echo "To finish setting up cyrus-imapd run 'sudo -u cyrus /sw/bin/mkimap'"
<<
PreRmScript: <<
if [ $1 != "upgrade" ]; then
  daemonic remove cyrus-imapd
fi
<<
Description: Cyrus mail server
DescDetail: <<
 The Cyrus IMAP server is a scaleable enterprise mail system designed for
use from small to large enterprise environments using standards-based
technologies.
<<
DescUsage: <<
 After installing and before running, to finish setting up the directories
for cyrus-imapd run the command 'sudo -u cyrus /sw/bin/mkimap'.
 To create a startup item that starts cyrus-imapd after reboot just run as
root 'daemonic enable cyrus-imapd'. To remove the cyrus-imapd startup item
just run as root 'daemonic remove cyrus-imapd'.
<<
License: Restrictive/Distributable
Homepage: http://asg.web.cmu.edu/cyrus/imapd