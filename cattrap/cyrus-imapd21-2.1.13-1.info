Package: cyrus-imapd21
Version: 2.1.13
Revision: 1
Maintainer: Matt Stephenson <cattrap@users.sourceforge.net>
Depends: cyrus-imapd21-pm560, passwd (>= 20030330-2), daemonic
BuildDepends: openssl097-dev, db41 | db41-ssl, cyrus-sasl2-dev, dlcompat-dev
Source: mirror:custom:cyrus-imapd-%v.tar.gz
CustomMirror: <<
  Primary: ftp://ftp.andrew.cmu.edu/pub/cyrus-mail/
  Secondary: ftp://ftp.andrew.cmu.edu/pub/cyrus-mail/OLD-VERSIONS/imap/
<<
Source-MD5: ac3a4773c2f0fb2d0f9c5ec8669b7e65
PatchScript: sed 's|@prefix@|%p|g' <%a/%f.patch | patch -p1
UpdateConfigGuess: true
ConfigureParams: --with-bdb-incdir=%p/include/db4 --with-cyrus-prefix=%p --with-statedir=%p/var --with-auth=unix --with-pidfile=%p/var/run/cyrus-master.pid --with-cyrus-group=cyrus
InstallScript: <<
    mkdir -p %i/etc
    mkdir -p %i/share/doc/%N/man
    mkdir -p %i/share/%N/master/conf
    mkdir -p %i/var/imap/sieve
    mkdir -p %i/var/spool/imap
    make install DESTDIR=%d
    cp -r tools %i/share/%N
    cd master/conf; cp *.conf %i/share/%N/master/conf
    cd %i/share/%N/master/conf; cp normal.conf %i/etc/cyrus.conf
    mv %i/share/man/man8/master.8 %i/share/man/man8/master_imapd.8
    mv %i/bin/master %i/bin/master_imapd
    cp cyrus-imapd %i/bin
    chmod 755 %i/bin/cyrus-imapd
    cp imapd.conf %i/etc
    chown cyrus %i/var/imap/sieve
    chgrp cyrus %i/var/imap/sieve
    chmod 0755 %i/var/imap/sieve
    chown cyrus %i/var/imap
    chgrp cyrus %i/var/imap
    chmod 750 %i/var/imap  
    chown cyrus %i/var/spool/imap
    chgrp cyrus %i/var/spool/imap
    chmod 750 %i/var/spool/imap  
    mkdir -p %i/var/run
    touch %i/var/run/cyrus-master.pid
    cd doc; cp *.html %i/share/doc/%N
    cd doc/man; cp *.html %i/share/doc/%N/man
<<
ConfFiles: <<
 %p/etc/cyrus.conf
 %p/etc/imapd.conf
<<
DocFiles: COPYRIGHT README
Splitoff: <<
 Package: %N-dev
 Files: include lib
 Description: Cyrus-imapd21 development headers and libraries
 DocFiles: COPYRIGHT README
 BuildDependsOnly: True
<<
Splitoff2: <<
 Package: %N-doc
 Files: share/doc/%N/*.html share/doc/%N/man share/man
 Description: Documentation for cyrus-imapd21
 DocFiles: COPYRIGHT README
<<
DaemonicName: cyrus-imapd
DaemonicFile: <<
<service>
<description>Cyrus Mail Server</description>
<message>Cyrus Mail Server</message>

<daemon name="master_imapd">
<executable background="yes">%p/bin/master_imapd</executable>
<configfile>%p/etc/imapd.conf</configfile>
<pidfile>%i/var/run/cyrus-master.pid</pidfile>
</daemon>

</service>
<<
PostInstScript: <<
 if [ -d "%p/var/imap/proc" ]; then
 echo ""
 echo "Installation Complete"
 echo ""
 else
   echo ""
   echo "Finishing Installation Setup"
   echo ""
   sudo -u cyrus %p/share/%N/tools/mkimap
 fi
<<
PreRmScript: <<
if [ $1 != "upgrade" ]; then
  daemonic remove cyrus-imapd
fi
<<
Description: Cyrus mail server
DescDetail: <<
 The Cyrus IMAP server is a scaleable enterprise mail system designed for
use from small to large enterprise environments using standards-based
technologies.
<<
DescUsage: <<
 To create a startup item that starts cyrus-imapd after reboot just run as
root 'daemonic enable cyrus-imapd'. To remove the cyrus-imapd startup item
just run as root 'daemonic remove cyrus-imapd'.
 To manually start/stop cyrus-imapd21, run 'sudo cyrus-imapd start' and
'sudo cyrus-imapd stop'.
<<
DescPackaging: <<
 To prevent conflict with postfix the 'master' executable and 'master.8'
man page were renamed to 'master_imapd' and 'master_imapd.8' respectively.
<<
License: Restrictive/Distributable
Homepage: http://asg.web.cmu.edu/cyrus/imapd