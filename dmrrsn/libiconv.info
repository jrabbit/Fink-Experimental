Package: libiconv
Version: 1.10
Revision: 1
#Source: mirror:sourceforge:fink/%n-%v.tar.gz
Source: mirror:gnu:libiconv/libiconv-%v.tar.gz
Source-MD5: 0d621d541e28ff053d8bbcf7215de3a4
Source2: mirror:gnu:gettext/gettext-0.14.5.tar.gz
#Source2: mirror:sourceforge:fink/gettext-0.14.5.tar.gz
Source2-MD5: e2f6581626a22a0de66dce1d81d00de3
PatchScript: <<
 cd %b/../gettext-0.14.5/build-aux; perl -pi -e 's/.*chmod.*777.*$//g' ltmain.sh
<<
Essential: yes
Depends: base-files
BuildDepends: fink (>= 0.13.0), fink-prebinding
Shlibs: <<
 %p/lib/libcharset.1.dylib 2.0.0 %n (>= 1.7-7)
 %p/lib/libiconv.2.dylib 6.0.0 %n (>= 1.10-1)
<<
DescPackaging: <<
 Shared libraries are in libiconv for backward compatibility, to avoid
 breaking dpkg during an update.

 In order to guarantee that the gettext header files are present when 
 libiconv is built, we now compile gettext during the building of this
 package.  (Previously, the complicated interaction between gettext and
 libiconv was handled during fink's bootstrap process, but not afterwards.)

 Previous versions by Christoph Pfisterer.
<<
NoSetLDFLAGS: true
NoSetCPPFLAGS: true
#SetLIBS: -L%p/lib
#ConfigureParams: --mandir=%p/share/man
CompileScript: <<
#! /bin/sh -ex
PATH=/bin:/sbin:/usr/bin:/usr/sbin
export PATH
cd %b/../gettext-0.14.5/gettext-runtime
EMACS=no CPPFLAGS="-I%b/../_inst/%p/include" LDFLAGS="-L%b/../_inst/%p/lib" ./configure --prefix=%p --infodir='${prefix}/share/info' --mandir='${prefix}/share/man' --with-included-gettext --disable-csharp --disable-rpath
make
find . -name "*.la" | xargs perl -pi.bak -e 's/relink_commands=.*/relink_commands=/g'
find . -name "*.la" | xargs perl -pi.bak -e 's/dependency_libs=.*/dependency_libs=/g'
find . -name "*.lai" | xargs perl -pi.bak -e 's/dependency_libs=.*/dependency_libs=/g'
rm -rf %b/../_inst
make install DESTDIR=%b/../_inst
cd %b/../libiconv-%v
CPPFLAGS="-I%b/../_inst/%p/include" LDFLAGS="-L%b/../_inst/%p/lib" ./configure --prefix=%p --mandir=%p/share/man
make
find . -name "*.la" | xargs perl -pi.bak -e 's/relink_commands=.*/relink_commands=/g'
find . -name "*.la" | xargs perl -pi.bak -e 's/dependency_libs=.*/dependency_libs=/g'
find . -name "*.lai" | xargs perl -pi.bak -e 's/dependency_libs=.*/dependency_libs=/g'
<<
InstallScript: <<
mkdir -p %i/share/man %i/share/doc/%n
make install prefix=%i mandir=%i/share/man docdir=%i/share/doc/%n
rm -rf %i/doc
rm -f %i/lib/charset.alias
<<
DocFiles: README* AUTHORS COPYING.LIB DESIGN NEWS NOTES THANKS
#
PostInstScript: <<
if [ -L %p/etc/alternatives/charset.alias ]; then
  update-alternatives --remove charset.alias %p/lib/charset.alias.libiconv
fi
<<
#
SplitOff: <<
 Package: libiconv-bin
 Essential: true
 Depends: libiconv (= %v-%r)
 Replaces: libiconv (<= 1.7-6)
 Files: bin share/doc/libiconv/*.html share/man
 Description: Executables for libiconv package
 DocFiles: README* AUTHORS COPYING.LIB DESIGN NEWS NOTES THANKS
<<
SplitOff2: <<
 Package: libiconv-dev
 Depends: libiconv (= %v-%r)
 Replaces: libiconv (<= 1.7-6)
 BuildDependsOnly: true
 Files: include lib/libcharset.dylib lib/libiconv.dylib lib/*.a lib/*.la
 Description: Developer files for libiconv package
 DocFiles: README* AUTHORS COPYING.LIB DESIGN NEWS NOTES THANKS
<<
Description: Character set conversion library
DescDetail: <<
GNU libiconv provides an iconv() implemententation for systems that lack
it, or whose implementation cannot convert from/to Unicode.
<<
DescPort: <<
charset.alias is deleted because it is empty on Darwin anyway and
causes unnecessary conflicts between packages.
<<
License: LGPL
Maintainer: Fink Core Group <fink-core@lists.sourceforge.net>
Homepage: http://www.gnu.org/software/libiconv/
