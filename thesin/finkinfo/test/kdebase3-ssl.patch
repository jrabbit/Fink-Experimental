--- kdebase-3.1.94/startkde	Sun Oct 26 05:45:35 2003
+++ kdebase-3.1.94-new/startkde	Thu Dec  4 10:47:46 2003
@@ -10,6 +10,8 @@
 # we have to unset this for Darwin since it will screw up KDE's dynamic-loading
 unset DYLD_FORCE_FLAT_NAMESPACE
 
+source "@PREFIX@/bin/init.sh"
+
 # Boot sequence:
 #
 # kdeinit is used to fork off processes which improves memory usage
@@ -50,6 +52,9 @@
 # Where X is the original font database that was set up before this script
 # runs.
 
+/usr/X11R6/bin/xmodmap -e "keycode 78 = Left"
+/usr/X11R6/bin/xmodmap -e "keycode 74 = Right"
+
 usr_odir=$HOME/.fonts/kde-override
 usr_fdir=$HOME/.fonts
 
@@ -177,7 +182,32 @@
 # We only check for 255 which means that the ksmserver process could not be 
 # started, any problems thereafter, e.g. ksmserver failing to initialize, 
 # will remain undetected.
-test -n "$KDEWM" && KDEWM="--windowmanager $KDEWM"
+
+USE_PROXY=0
+if test -n "$KDEWM"; then
+	if test -z `expr "$KDEWM" : '\(.*quartz-wm.*\)'`; then
+		USE_PROXY=1
+	fi
+	KDEWM="--windowmanager $KDEWM"
+else
+#	if test -x /usr/X11R6/bin/quartz-wm; then
+#		KDEWM="--windowmanager /usr/X11R6/bin/quartz-wm"
+#	else
+		USE_PROXY=1
+#	fi
+fi
+
+if test "$USE_PROXY" = "1"; then
+	if test -x /usr/X11R6/bin/quartz-wm; then
+		/usr/X11R6/bin/quartz-wm --only-proxy >/dev/null 2>&1 &
+	else
+		AUTOCUTSEL=`which autocutsel 2>/dev/null`
+		if test -n "$AUTOCUTSEL" && test -x "$AUTOCUTSEL"; then
+			$AUTOCUTSEL >/dev/null 2>&1 &
+		fi
+	fi
+fi
+
 kwrapper ksmserver $KDEWM 
 if test $? -eq 255; then
   # Startup error
