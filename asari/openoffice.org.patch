### Script to create language packs
--- /dev/null	Fri Feb 10 20:33:39 2006
+++ languagepack-splitoff	Fri Feb 10 20:32:14 2006
@@ -0,0 +1,42 @@
+#!/bin/bash
+
+set -e
+
+lang1=$1
+lang2=$2
+fink_p=$3
+fink_d=$4
+fink_i=$5
+fink_N=$6
+# Setting up environment
+case `uname -p` in
+  powerpc) . ./MacOSXPPCEnv.Set.sh;;
+  i386) . ./MacOSXIntelEnv.Set.sh;;
+  *) echo 'Unknown architecture'; exit 1;;
+esac
+
+# Variables needed to execute make_installer.pl
+export OUT="../$INPATH"
+export LOCAL_OUT="$OUT"
+export LOCAL_COMMON_OUT="$OUT"
+solarlibdir=$SOLARVER/$UPD/$INPATH/lib
+export PYTHONPATH=$SRC_ROOT/instsetoo_native/$INPATH/bin:$solarlibdir:$solarlibdir/python:$solarlibdir/python/lib-dynload
+build=`sed -n 's/^BUILD=\(.*\)$/\1/p' $SOLARENVINC/minor.mk`
+
+set -v
+
+# Install language pack
+pushd instsetoo_native/util
+/usr/bin/perl -w $SOLARENV/bin/make_installer.pl \
+  -f openoffice.lst -l $lang2 -p OpenOffice \
+  -packagelist ../inc_openoffice/unix/packagelist.txt \
+  -buildid $build -languagepack \
+  -destdir $fink_d \
+  -simple $fink_p/lib/$fink_N
+popd
+
+# Remove the list files
+/bin/rm -v $fink_d/gid_Module*
+
+/usr/bin/install -m 755 -d $fink_i/share/doc/$fink_N-$lang1
+/bin/ln -sf $fink_p/lib/$fink_N/licenses/LICENSE_$lang2 $fink_i/share/doc/$fink_N-$lang1/LICENSE
### Script to convert Mac OS X fonts to truetype fonts
--- /dev/null	Tue Feb  7 11:38:20 2006
+++ update-ooo-fonts.in	Tue Feb  7 11:37:47 2006
@@ -0,0 +1,52 @@
+#!/bin/sh
+set -e
+case $1 in
+    -h|-help|--help)
+    echo "Usage: `basename $0` [--clean]"
+    exit 0;;
+    ""|--clean) ;;
+    *)
+    echo "Usage: `basename $0` [--clean]"
+    exit 1;;
+esac
+
+/bin/mkdir -p "@PREFIX@/lib/@PKGNAME@/share/fonts/fondu"
+trap '/bin/rm -rf "@PREFIX@/lib/@PKGNAME@/share/fonts/fondu/"*.tmp' 0
+cd "@PREFIX@/lib/@PKGNAME@/share/fonts"
+
+# Remove old fonts and symlinks
+echo "Cleaning old Mac OS X fonts..."
+/bin/rm -f truetype/.fondudone
+/usr/bin/find -H truetype -type l > fondu/oldlinks.tmp
+while read link; do
+    to=`@PREFIX@/sbin/readlink "$link" || :`
+    case $to in
+        ../fondu/*) /bin/rm -f "$link"
+    esac
+done < fondu/oldlinks.tmp
+case $1 in
+    --clean)
+    /bin/rm -rf fondu
+    exit 0;;
+    *) /usr/bin/find -H fondu -type f -delete;;
+esac
+
+# Convert fonts
+echo "Converting Mac OS X fonts..."
+cd fondu
+/usr/bin/find -H /System/Library/Fonts /Library/Fonts -type f > sysfonts.tmp
+{
+    while read font; do
+        @PREFIX@/bin/fondu -force "$font" || :
+    done < sysfonts.tmp 3>&2 2>&1 1>&3 |
+      /usr/bin/grep -v "Can't find an appropriate resource fork" || :
+} 3>&2 2>&1 1>&3 3>&-
+/usr/bin/find -H . -name "*.bdf" -delete
+/usr/bin/find -H . -name "*.ttf" | /usr/bin/sed 's/.*\///' > fondu-ttf.tmp
+cd "@PREFIX@/lib/@PKGNAME@/share/fonts"
+
+# Create new symlinks
+while read font; do
+  /bin/ln -sf "../fondu/$font" "truetype/$font"
+done < fondu/fondu-ttf.tmp
+/usr/bin/touch truetype/.fondudone
### No-op if --with-system-python
--- python/makefile.mk	2005-12-29 01:57:47.000000000 +0900
+++ python/makefile.mk.fink	2006-01-15 20:59:52.000000000 +0900
@@ -105,7 +105,7 @@
 .ENDIF			# "$(SYSBASE)"!=""
 
 CONFIGURE_ACTION=./configure --prefix=$(MYCWD)/python-inst --enable-shared CFLAGS="$(python_CFLAGS)" LDFLAGS="$(python_LDFLAGS)"
-.IF "$(OS)$(CPU)" == "SOLARISI"
+.IF "$(OS)$(CPU)" == "SOLARISI" || "$(OS)$(BUILD_OS_MAJOR)$(BUILD_OS_MINOR)" == "MACOSX103"
 CONFIGURE_ACTION += --disable-ipv6
 .ENDIF
 .IF "$(COMNAME)"=="sunpro5"

### Avoid adding /sw/lib into DYLD_LIBRARY_PATH on checking libraries,
### which confises "libjpeg" and "libJPEG" etc.
--- solenv/bin/checkdll.sh.orig	2007-05-02 03:38:03.000000000 +0900
+++ solenv/bin/checkdll.sh	2007-05-02 12:14:15.000000000 +0900
@@ -45,15 +45,21 @@
 checkdll="$SOLARVERSION/$INPATH/bin$UPDMINOREXT/checkdll"
 
 if [ -x $checkdll ]; then
+    uname_s=`uname -s`
     while :
     do
 	case $1 in
 	    -L) shift; option=$1;;
 	    --) break;;
 	esac
-	case "${libpath+X}" in
-	    X) libpath=$libpath:$option;;
-	    *) libpath=$option;;
+	case $uname_s-$option in
+	    Darwin-${FINK_PREFIX-/sw}/lib) skip=true;;
+	    *) skip=false;;
+	esac
+	case "$skip-${libpath+X}" in
+	    true-*) ;;
+	    false-X) libpath=$libpath:$option;;
+	    false-*) libpath=$option;;
 	esac
 	shift
     done

### Force to link against /sw/lib/libpython.so
--- config_office/configure.in.orig	2007-01-19 21:55:19.000000000 +0900
+++ config_office/configure.in	2007-05-03 09:32:33.000000000 +0900
@@ -2937,11 +2937,7 @@
    python_version=`$PYTHON -c "import distutils.sysconfig; print distutils.sysconfig.get_config_var('VERSION');"`
    PYTHON_CFLAGS="-I$python_include"
 
-   if test "$_os" = "Darwin"; then
-      PYTHON_LIBS="-framework Python"
-   else
-      PYTHON_LIBS="-lpython$python_version"
-   fi
+   PYTHON_LIBS=`python2.5-config --ldflags`
    
    dnl check if the headers really work:
    save_CPPFLAGS="$CPPFLAGS"

--- config_office/configure.orig	2007-01-19 22:01:19.000000000 +0900
+++ config_office/configure	2007-05-03 09:31:06.000000000 +0900
@@ -11561,11 +11561,7 @@
    python_version=`$PYTHON -c "import distutils.sysconfig; print distutils.sysconfig.get_config_var('VERSION');"`
    PYTHON_CFLAGS="-I$python_include"
 
-   if test "$_os" = "Darwin"; then
-      PYTHON_LIBS="-framework Python"
-   else
-      PYTHON_LIBS="-lpython$python_version"
-   fi
+   PYTHON_LIBS=`python2.5-config --ldflags`
 
       save_CPPFLAGS="$CPPFLAGS"
    CPPFLAGS="$CPPFLAGS $PYTHON_CFLAGS"

### link mozilla bits to seamonkey; IZ 73440
--- config_office/configure.in.orig	2007-01-13 14:18:26.000000000 +0100
+++ config_office/configure.in	2007-01-13 14:20:11.000000000 +0100
@@ -58,6 +58,10 @@
 [  --with-firefox          Use Firefox instead of Mozilla Suite for building.
                           Only honoured with --with-system-mozilla
 ],,)
+AC_ARG_WITH(seamonkey,
+[  --with-seamonkey        Use Seamonkey instead of Mozilla Suite for building.
+                          Only honoured with --with-system-mozilla
+],,)
 AC_ARG_WITH(xulrunner,
 [  --with-xulrunner        Use XULRunner instead of Mozilla Suite for building.
                           Only honoured with --with-system-mozilla
@@ -3714,6 +3718,8 @@
     AC_MSG_CHECKING([which Mozilla flavour to use])
     if test -n "$with_firefox" && test "$with_firefox" != "no"; then
       MOZ_FLAVOUR=firefox
+    elif test -n "$with_seamonkey" && test "$with_seamonkey" != "no"; then
+      MOZ_FLAVOUR=seamonkey
     elif test -n "$with_xulrunner" && test "$with_xulrunner" != "no"; then
       MOZ_FLAVOUR=xulrunner
     else

--- config_office/configure.orig	2007-01-19 22:01:19.000000000 +0900
+++ config_office/configure	2007-05-03 11:33:06.000000000 +0900
@@ -1029,6 +1029,9 @@
   --with-firefox          Use Firefox instead of Mozilla Suite for building.
                           Only honoured with --with-system-mozilla
 
+  --with-seamonkey        Use Seamonkey instead of Mozilla Suite for building.
+                          Only honoured with --with-system-mozilla
+
   --with-xulrunner        Use XULRunner instead of Mozilla Suite for building.
                           Only honoured with --with-system-mozilla
 
@@ -1843,6 +1846,12 @@
 
 fi;
 
+# Check whether --with-seamonkey or --without-seamonkey was given.
+if test "${with_seamonkey+set}" = set; then
+  withval="$with_seamonkey"
+
+fi;
+
 # Check whether --with-xulrunner or --without-xulrunner was given.
 if test "${with_xulrunner+set}" = set; then
   withval="$with_xulrunner"
@@ -13577,6 +13586,8 @@
 echo $ECHO_N "checking which Mozilla flavour to use... $ECHO_C" >&6
     if test -n "$with_firefox" && test "$with_firefox" != "no"; then
       MOZ_FLAVOUR=firefox
+    elif test -n "$with_seamonkey" && test "$with_seamonkey" != "no"; then
+      MOZ_FLAVOUR=seamonkey
     elif test -n "$with_xulrunner" && test "$with_xulrunner" != "no"; then
       MOZ_FLAVOUR=xulrunner
     else

### Accept SeaMonkey!
--- libxmlsec/xmlsec1-1.2.6.patch.orig	2006-10-24 22:31:14.000000000 +0900
+++ libxmlsec/xmlsec1-1.2.6.patch	2007-05-03 12:47:42.000000000 +0900
@@ -236,7 +236,7 @@
       
   XMLSEC_NO_NSS="1"
   MOZILLA_MIN_VERSION="1.4"
-+ if test "z$MOZ_FLAVOUR" = "zfirefox" ; then
++ if test "z$MOZ_FLAVOUR" = "zfirefox" || test "z$MOZ_FLAVOUR" = "zseamonkey"; then
 +     MOZILLA_MIN_VERSION="1.0"
 + fi
   NSS_MIN_VERSION="3.2"

### Use LINKLIB rule instead of simple COPY for versioned libs; IZ 73052
diff -urN ooo_SRC680_m198_src.orig/icu/icu-3.6.patch ooo_SRC680_m198_src/icu/icu-3.6.patch
--- icu/icu-3.6.patch	2007-01-03 09:54:31.000000000 +0100
+++ icu/icu-3.6.patch	2007-01-03 09:55:04.000000000 +0100
@@ -1,5 +1,5 @@
 *** misc/icu/source/common/putil.c	Mon Jul 31 20:14:28 2006
---- misc/build/icu/source/common/putil.c	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/common/putil.c	Wed Jan  3 09:40:21 2007
 ***************
 *** 48,54 ****
   #endif
@@ -19,7 +19,7 @@
   #endif
   
 *** misc/icu/source/config/mh-darwin	Wed Feb  1 08:52:42 2006
---- misc/build/icu/source/config/mh-darwin	Fri Dec 15 10:50:25 2006
+--- misc/build/icu/source/config/mh-darwin	Wed Jan  3 09:41:43 2007
 ***************
 *** 25,31 ****
   SHLIB.cc=	$(CXX) -dynamiclib -dynamic $(CXXFLAGS) $(LDFLAGS)
@@ -33,12 +33,12 @@
   SHLIB.cc=	$(CXX) -dynamiclib -dynamic $(CXXFLAGS) $(LDFLAGS)
   
   ## Compiler switches to embed a library name and version information
-! LD_SONAME = -Wl,-compatibility_version -Wl,$(SO_TARGET_VERSION_MAJOR) -Wl,-current_version -Wl,$(SO_TARGET_VERSION) -install_name @executable_path/$(notdir $(MIDDLE_SO_TARGET))
+! LD_SONAME = -Wl,-compatibility_version -Wl,$(SO_TARGET_VERSION_MAJOR) -Wl,-current_version -Wl,$(SO_TARGET_VERSION) -install_name @executable_path/$(notdir $(FINAL_SO_TARGET))
   
   ## Compiler switch to embed a runtime search path
   LD_RPATH=
 *** misc/icu/source/config/mh-irix	Thu Mar 23 19:51:52 2006
---- misc/build/icu/source/config/mh-irix	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/config/mh-irix	Wed Jan  3 09:40:21 2007
 ***************
 *** 23,28 ****
 --- 23,31 ----
@@ -52,7 +52,7 @@
   THREADSCPPFLAGS = -D_REENTRANT -D_PTHREADS
   LIBCPPFLAGS =
 *** misc/icu/source/config/mh-linux	Thu Mar 23 19:51:52 2006
---- misc/build/icu/source/config/mh-linux	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/config/mh-linux	Wed Jan  3 09:40:21 2007
 ***************
 *** 20,25 ****
 --- 20,32 ----
@@ -70,7 +70,7 @@
   LDFLAGSICUDT=-nodefaultlibs -nostdlib
   
 *** misc/icu/source/config/mh-solaris	Fri Feb 24 20:31:14 2006
---- misc/build/icu/source/config/mh-solaris	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/config/mh-solaris	Wed Jan  3 09:40:21 2007
 ***************
 *** 18,34 ****
   
@@ -117,7 +117,7 @@
   
   ## Compiler switch to embed a library name
 *** misc/icu/source/data/Makefile.in	Sat Aug 12 00:22:24 2006
---- misc/build/icu/source/data/Makefile.in	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/data/Makefile.in	Wed Jan  3 09:40:21 2007
 ***************
 *** 344,350 ****
   ifneq ($(ICUDATA_SOURCE_IS_NATIVE_TARGET),YES)
@@ -136,7 +136,7 @@
   	@echo "$@" > $@
   endif
 *** misc/icu/source/layout/GXLayoutEngine.cpp	Fri Sep  2 20:22:10 2005
---- misc/build/icu/source/layout/GXLayoutEngine.cpp	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/layout/GXLayoutEngine.cpp	Wed Jan  3 09:40:21 2007
 ***************
 *** 39,45 ****
           return 0;
@@ -155,7 +155,7 @@
       if (LE_FAILURE(success)) {
           return 0;
 *** misc/icu/source/layout/LESwaps.h	Thu Jun 23 00:39:36 2005
---- misc/build/icu/source/layout/LESwaps.h	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/layout/LESwaps.h	Wed Jan  3 09:40:21 2007
 ***************
 *** 2,7 ****
 --- 2,8 ----
@@ -231,7 +231,7 @@
    * This class is used to access data which stored in big endian order
    * regardless of the conventions of the platform. It has been designed
 *** misc/icu/source/test/intltest/loctest.cpp	Thu Jul  6 03:50:04 2006
---- misc/build/icu/source/test/intltest/loctest.cpp	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/test/intltest/loctest.cpp	Wed Jan  3 09:40:21 2007
 ***************
 *** 4,9 ****
 --- 4,10 ----
@@ -243,7 +243,7 @@
   #include "unicode/decimfmt.h"
   #include "unicode/ucurr.h"
 *** misc/icu/source/test/intltest/tsputil.cpp	Wed Jul 19 00:18:10 2006
---- misc/build/icu/source/test/intltest/tsputil.cpp	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/test/intltest/tsputil.cpp	Wed Jan  3 09:40:21 2007
 ***************
 *** 4,9 ****
 --- 4,10 ----
@@ -255,7 +255,7 @@
   
   #include <float.h> // DBL_MAX, DBL_MIN
 *** misc/icu/source/test/intltest/uobjtest.cpp	Thu Mar 23 01:54:12 2006
---- misc/build/icu/source/test/intltest/uobjtest.cpp	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/test/intltest/uobjtest.cpp	Wed Jan  3 09:40:21 2007
 ***************
 *** 4,9 ****
 --- 4,10 ----
@@ -267,7 +267,7 @@
   #include "cmemory.h" // UAlignedMemory
   #include <string.h>
 *** misc/icu/source/test/intltest/ustrtest.cpp	Tue Dec 28 22:13:54 2004
---- misc/build/icu/source/test/intltest/ustrtest.cpp	Fri Dec 15 10:40:22 2006
+--- misc/build/icu/source/test/intltest/ustrtest.cpp	Wed Jan  3 09:40:21 2007
 ***************
 *** 4,9 ****
 --- 4,10 ----
diff -urN ooo_SRC680_m198_src.orig/icu/prj/d.lst ooo_SRC680_m198_src/icu/prj/d.lst
--- icu/prj/d.lst	2007-01-03 09:54:31.000000000 +0100
+++ icu/prj/d.lst	2007-01-03 09:55:56.000000000 +0100
@@ -6,8 +6,6 @@
 ..\%__SRC%\misc\build\icu\source\common\unicode\*.h %_DEST%\inc%_EXT%\external\unicode\*.h
 ..\%__SRC%\misc\build\icu\source\i18n\unicode\*.h %_DEST%\inc%_EXT%\external\unicode\*.h
 
-..\%__SRC%\lib\*.dylib %_DEST%\lib%_EXT%\*.dylib
-..\%__SRC%\lib\*.dylib.* %_DEST%\lib%_EXT%\*.dylib.*
 ..\%__SRC%\lib\*.a %_DEST%\lib%_EXT%\*.a
 ..\%__SRC%\lib\*.lib %_DEST%\lib%_EXT%\*.lib
 
@@ -24,15 +22,15 @@
 ..\%__SRC%\bin\gencmn       %_DEST%\bin%_EXT%\gencmn
 ..\%__SRC%\bin\gencmn.exe   %_DEST%\bin%_EXT%\gencmn.exe
 
-..\%__SRC%\lib\libicudata.so.*.*     %_DEST%\lib%_EXT%\
-..\%__SRC%\lib\libicui18n.so.*.*     %_DEST%\lib%_EXT%\
-..\%__SRC%\lib\libicule.so.*.*       %_DEST%\lib%_EXT%\
-..\%__SRC%\lib\libicuuc.so.*.*       %_DEST%\lib%_EXT%\
-..\%__SRC%\lib\libicutu.so.*.* %_DEST%\lib%_EXT%\
+..\%__SRC%\lib\libicudata.*.*.*     %_DEST%\lib%_EXT%\
+..\%__SRC%\lib\libicui18n.*.*.*     %_DEST%\lib%_EXT%\
+..\%__SRC%\lib\libicule.*.*.*       %_DEST%\lib%_EXT%\
+..\%__SRC%\lib\libicuuc.*.*.*       %_DEST%\lib%_EXT%\
+..\%__SRC%\lib\libicutu.*.*.*       %_DEST%\lib%_EXT%\
 ..\icuversion.mk %_DEST%\inc%_EXT%\icuversion.mk
 
-linklib: libicudata.so.*.*
-linklib: libicui18n.so.*.*
-linklib: libicule.so.*.*
-linklib: libicuuc.so.*.*
-linklib: libicutu.so.*.*
\ No newline at end of file
+linklib: libicudata.*.*.*
+linklib: libicui18n.*.*.*
+linklib: libicule.*.*.*
+linklib: libicuuc.*.*.*
+linklib: libicutu.*.*.*
