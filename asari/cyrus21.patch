diff -Naur cyrus-imapd-2.2.12/fink/cron.daily cyrus-imapd-2.2.12.fink/fink/cron.daily
--- cyrus-imapd-2.2.12/fink/cron.daily	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cron.daily	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,22 @@
+#!/bin/sh
+# Cyrus IMAPd daily maintenance script
+# Copyright (c) 2002 by Henrique M. Holschuh
+# Distributed under the terms of the GNU General Public License version 2
+#
+# This script:
+#   1. Backups the mailbox database to the portable text format,
+#      and compresses the result.  This backup can be used to restore
+#      the Cyrus mailbox database using ctl_mboxlist (after uncompressing
+#      the backup file).
+
+bak=@FINKPREFIX@/var/backups
+bakfile=${bak}/cyrus-mboxlist.txt.gz
+umask 022
+
+[ -x @FINKPREFIX@/sbin/ctl_mboxlist ] && {
+       [ -d $bak ] || ( mkdir -p $bak ; chmod 600 $bak )
+       [ -f $bakfile ] && mv ${bakfile} ${bakfile}.bak
+       su "--command=@FINKPREFIX@/sbin/ctl_mboxlist -d" - cyrus | gzip -9 >${bakfile}
+}
+
+exit 0
diff -Naur cyrus-imapd-2.2.12/fink/cyradm-16x16.xpm cyrus-imapd-2.2.12.fink/fink/cyradm-16x16.xpm
--- cyrus-imapd-2.2.12/fink/cyradm-16x16.xpm	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cyradm-16x16.xpm	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,45 @@
+/* XPM */
+static char *magick[] = {
+/* columns rows colors chars-per-pixel */
+"16 16 23 1",
+"  c Gray0",  
+". c #191919",
+"X c Gray20", 
+"o c #00007f",
+"O c #007f00",
+"+ c #007f7f",
+"@ c #7f0000",
+"# c #7f007f",
+"$ c #7f7f00",
+"% c #4c4c4c",
+"& c #666667",
+"* c Gray50",
+"= c Blue", 
+"- c Green",
+"; c Cyan",
+": c Red",
+"> c Magenta",
+", c Yellow",
+"< c Gray60", 
+"1 c #b2b2b2",
+"2 c Gray80",
+"3 c Gray90", 
+"4 c Gray100",
+/* pixels */
+"22111;1212211111",
+"211221213<121221",
+"2111212232<11122",
+"121121221<231<11",
+"2112232<34334112",
+"1112222243213212",
+";2221<11*&<<*<<1",
+"1221233323232231",
+"2233223333332&1<",
+"2213123333233*1*",
+"123312121222233*",
+"1233212<<213223<",
+"12331<1<<11<123*",
+"123333322222223*",
+"123223322222323*",
+"2<&%%%X%%%%X%%X%"
+};
diff -Naur cyrus-imapd-2.2.12/fink/cyradm-32x32.xpm cyrus-imapd-2.2.12.fink/fink/cyradm-32x32.xpm
--- cyrus-imapd-2.2.12/fink/cyradm-32x32.xpm	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cyradm-32x32.xpm	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,61 @@
+/* XPM */
+static char *magick[] = {
+/* columns rows colors chars-per-pixel */
+"32 32 23 1",
+"  c Gray0",  
+". c #191919",
+"X c Gray20", 
+"o c #00007f",
+"O c #007f00",
+"+ c #007f7f",
+"@ c #7f0000",
+"# c #7f007f",
+"$ c #7f7f00",
+"% c #4c4c4c",
+"& c #666667",
+"* c Gray50",
+"= c Blue", 
+"- c Green",
+"; c Cyan",
+": c Red",
+"> c Magenta",
+", c Yellow",
+"< c Gray60",
+"1 c #b2b2b2",
+"2 c Gray80",
+"3 c Gray90", 
+"4 c Gray100",
+/* pixels */
+"222111112;2112121222111112112121",
+"121112;2112211223+11212111121111",
+"221112222112111333+221121221112;",
+"2112111211222133333&12222;212222",
+"11111112212122333323$221+2121211",
+"212121112122333%3 332&41%1111121",
+";212112;22132233211%44443&112211",
+"2211222222233.3112344444442112;2",
+"11111211133321114444441444%22121",
+"1212222133311 444444*%4444%22212",
+"211112233111444444:4334%444%2111",
+";11222331 433223* 2332%322231112",
+"222213&&11&*&&%#%%# %&#%  #%&221",
+"12233343434444434444344444443311",
+"113&2&&&3333333333333332222333+2",
+"2133333333333333332333232X**23%o",
+"22344333333333232233222221#*24.%",
+"124#&34#&#333333333223323:.#24.%",
+"223333333333333333322332332224.%",
+"214333333323333323322222322224.X",
+"11333333 &23X&2&&3223223222234.X",
+"123334433333333333222232223234.%",
+"12333333&2X12X& &13X2322322134.%",
+"123333333233333332333222222224.X",
+"21333332&&&1&X2 3&&3X&&X222234.X",
+"213333333333323222222222222134.%",
+"123333333333332223322322222134.X",
+"113333233233232332232222322324.X",
+"223334434434444444434434444444.%",
+"12 .     .                    .X",
+"2112%%%%o%%X%%o%X%%%o%X%X%oXXo%%",
+"11121222122212122122122122222222"
+};
diff -Naur cyrus-imapd-2.2.12/fink/cyrdump.8 cyrus-imapd-2.2.12.fink/fink/cyrdump.8
--- cyrus-imapd-2.2.12/fink/cyrdump.8	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cyrdump.8	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,16 @@
+.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.24.
+.TH CYRDUMP "1" "Project Cyrus" "CMU"
+.SH NAME
+cyrdump \- dump mailboxes to stdout
+.SH SYNOPSIS
+.B 
+cyrdump [-C <configfile>] [-v] [mboxpattern ...]
+.SH DESCRIPTION
+.PP
+A tool for dumping IMAP mailboxes on a server.
+.TP
+\fB\-C <configfile>\fR
+Specify an alternate configuration file ( is used by default)
+.TP
+\fB\-v\fR
+Increase program verbosity.
diff -Naur cyrus-imapd-2.2.12/fink/cyrus-makedirs cyrus-imapd-2.2.12.fink/fink/cyrus-makedirs
--- cyrus-imapd-2.2.12/fink/cyrus-makedirs	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cyrus-makedirs	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,141 @@
+#!/bin/sh -e
+#
+#  cyrus-makedirs  -  Parses a Cyrus imap.d configuration file, and creates
+#                     the correct directory trees for all partitions
+#
+#  Copyright 2001,2002 by Henrique de Moraes Holschuh <hmh@debian.org.
+#  Released under the terms of the GNU General Public License (GPL) version 2
+#
+# $Id$
+
+# See lib/util.c, dir_hash_c for Cyrus' directory hashing
+# for the new hash style
+#HASHDIRS="A B C D E F G H I J K L M N O P Q R S T U V W"
+# for the old hash style
+HASHDIRS="a b c d e f g h i j k l m n o p q r s t u v w x y z"
+
+CYRUSOPTFILESYS=1
+[ -r @FINKPREFIX@/etc/default/cyrus21 ] && . @FINKPREFIX@/etc/default/cyrus21
+
+getconf () {
+       confvalue=`sed --silent -e "/^[[:blank:]]*$1:/ { \
+       s#^[[:blank:]]*$1:[[:blank:]]*## \
+       p
+       }" < "$CONF" | head -1`
+       result=${confvalue:-$2}
+}
+
+killsquat=0
+[ "$1" = "--cleansquat" ] && {
+       killsquat=1
+       shift
+}
+
+
+CONF="${1:-@FINKPREFIX@/etc/imapd.conf}"
+[ -r "$CONF" ] || {
+       echo $0: unable to read configuration file $CONF. Aborting...
+       exit 1
+}
+
+getconf configdirectory @FINKPREFIX@/var/lib/cyrus
+confdir="$result"
+[ -d "$confdir" ] || {
+       echo $0: $confdir is not an directory. Aborting...
+       exit 2
+}
+
+getconf sievedir @FINKPREFIX@/etc/sieve
+sievedir="$result"
+
+getconf sieveusehomedir 0
+case "$result" in
+       1|t|true|yes|on) nosievedir=1
+                       ;;
+       *)              nosievedir=0
+                       ;;
+esac
+
+getconf hashimapspool 0
+case "$result" in
+       1|t|true|yes|on) hashspool=1
+                       ;;
+       *)              hashspool=0
+                       ;;
+esac
+
+# Partitions list
+partitions=`sed --silent -e "/^[[:blank:]]*partition-[[:alnum:]]\+:/ { \
+            s#^[[:blank:]]*partition-[[:alnum:]]\+:[[:blank:]]*## \
+           p
+           } " < "$CONF" | sort | uniq | xargs`
+
+# First, fix up the entire confdir subtree
+echo "Creating cyrus control directories in ${confdir}..."
+[ -d "$confdir" ] || mkdir -p "$confdir"
+chmod 750 "$confdir"
+for i in db proc socket log msg user quota; do
+    [ -d "$confdir/$i" ] || mkdir -p "$confdir/$i"
+    chmod 700 "$confdir/$i"
+done
+chmod 750 $confdir/socket
+for i in user quota ; do
+    for j in $HASHDIRS ; do
+       [ -d "$confdir/$i/$j" ] || mkdir "$confdir/$i/$j"
+    done
+done
+chown -R cyrus:mail "$confdir"
+
+# Now, create the spool partitions
+for i in $partitions ; do
+       echo "Creating partition spool $i..."
+       [ -d "$i" ] || mkdir -p "$i"
+       chmod 750 "$i"
+       [ $hashspool -eq 1 ] && {
+          for j in $HASHDIRS ; do
+               [ -d "$i/$j" ] || mkdir "$i/$j"
+          done
+       }
+       [ -d "$i/stage." ] || mkdir "$i/stage."
+       chown -R cyrus:mail "$i"
+       # and kill any squatter indexes
+       [ $killsquat -ne 0 ] && find "$i" -name 'cyrus.squat' -type f -exec rm -f "{}" \;
+done
+
+# And the sieve directory structure
+[ $nosievedir -eq 0 ] && {
+       [ -d "$sievedir" ] || mkdir "$sievedir"
+       chmod 755 "$sievedir"
+       for j in $HASHDIRS ; do
+               [ -d "$sievedir/$j" ] || mkdir "$sievedir/$j"
+               chmod 755 "$sievedir/$j"
+       done
+       chown -R cyrus:mail "$sievedir"
+}
+
+[ "x${CYRUSOPTFILESYS}" != "x1" ] && exit 0
+#
+# Fix attributes for every partition
+#
+# ext2:  Don't use ext2 for Cyrus spools. But if you must, enable Sync writes
+# ext3:  Journal data too, since that improves access time a LOT
+#        (maybe in the future, there's a bug in 2.4.18 ext3 w/ +j)
+#
+echo "Trying to optimize Cyrus partitions, edit @FINKPREFIX@/etc/default/cyrus21 to disable..."
+partsys="${confdir} ${partitions}"
+filesys=`df -P -T ${partsys} | sed -e "1 d" -e "s/ \+/ /g" | cut -d " " -f 2 | xargs`
+for i in ${filesys} ; do
+       case ${i} in
+       ext2)
+               echo "Setting attributes to +S for  ${partsys%% *}..."
+               find "${partsys%% *}" -type d -exec chattr +S "{}" \;
+               ;;
+       ext3)
+               echo "Setting attributes to -S -j for  ${partsys%% *}..."
+               find "${partsys%% *}" -type d -exec chattr -S -j "{}" \;
+               ;;
+       esac
+       partsys="${partsys#* }"
+done
+
+exit 0
diff -Naur cyrus-imapd-2.2.12/fink/cyrus-makedirs.8 cyrus-imapd-2.2.12.fink/fink/cyrus-makedirs.8
--- cyrus-imapd-2.2.12/fink/cyrus-makedirs.8	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cyrus-makedirs.8	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,47 @@
+.\"                                      Hey, EMACS: -*- nroff -*-
+.\" First parameter, NAME, should be all caps
+.\" Second parameter, SECTION, should be 1-8, maybe w/ subsection
+.\" other parameters are allowed: see man(7), man(1)
+.TH CYRUS-MAKEDIRS 8 "2002-12-08"
+.\" Please adjust this date whenever revising the manpage.
+.\"
+.\" Some roff macros, for reference:
+.\" .nh        disable hyphenation
+.\" .hy        enable hyphenation
+.\" .ad l      left justify
+.\" .ad b      justify to both left and right margins
+.\" .nf        disable filling
+.\" .fi        enable filling
+.\" .br        insert line break
+.\" .sp <n>    insert n+1 empty lines
+.\" for manpage-specific macros, see man(7)
+.SH NAME
+cyrus-makedirs \- Sets up the Cyrus IMAPd system directories (spools)
+.SH SYNOPSIS
+.B cyrus-makedirs 
+.RI [ configfile ]
+.br
+.SH DESCRIPTION
+This manual page documents briefly the
+.B cyrus-makedirs
+command.
+Cyrus-makedirs is the Debian version of Cyrus upstream's mkimap program.
+.PP
+You
+.B should
+call @FINKPREFIX@/sbin/cyrus-makedirs when you change any imapd.conf(5) options
+that create or rename Cyrus mail spools/partitions.  It will be called
+automatically on package upgrades.
+.PP
+.\" TeX users may be more comfortable with the \fB<whatever>\fP and
+.\" \fI<whatever>\fP escape sequences to invode bold face and italics,
+.\" respectively.
+.SH OPTIONS
+You can optionally tell cyrus-makedirs the Cyrus imapd.conf config file
+to use.  @FINKPREFIX@/etc/imapd.conf is assumed, if no parameters are given.
+.SH SEE ALSO
+.BR imapd.conf(5),
+.BR @FINKPREFIX@/etc/default/cyrus21
+.SH AUTHOR
+This manual page was written by Henrique de Moraes Holschuh <hmh@debian.org>,
+for the Debian GNU/Linux system (but may be used by others).
diff -Naur cyrus-imapd-2.2.12/fink/cyrus.conf cyrus-imapd-2.2.12.fink/fink/cyrus.conf
--- cyrus-imapd-2.2.12/fink/cyrus.conf	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cyrus.conf	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,80 @@
+# Debian/Fink defaults for Cyrus IMAP server/cluster implementation
+# see cyrus.conf(5) for more information
+#
+# All the tcp services are tcpd-wrapped. see hosts_access(5)
+# $Id$
+
+START {
+       # do not delete this entry!
+       recover         cmd="@FINKPREFIX@/sbin/ctl_cyrusdb -r"
+  
+       # this is only necessary if using idled for IMAP IDLE
+       # this is NOT to be enabled right now in Debian/Fink builds
+       #idled          cmd="idled"
+
+       # this is useful on backend nodes of a Murder cluster
+       # it causes the backend to syncronize its mailbox list with
+       # the mupdate master upon startup
+       #mupdatepush   cmd="@FINKPREFIX@/sbin/ctl_mboxlist -m"
+
+       # this is recommended if using duplicate delivery suppression
+       delprune        cmd="@FINKPREFIX@/sbin/ctl_deliver -E 3"
+       # this is recommended if caching TLS sessions
+       tlsprune        cmd="@FINKPREFIX@/sbin/tls_prune"
+}
+
+# UNIX sockets start with a slash and are absolute paths
+# you can use a maxchild=# to limit the maximum number of forks of a service
+# you can use babysit=true and maxforkrate=# to keep tight tabs on the service
+# most services also accept -U (limit number of reuses) and -T (timeout)
+SERVICES {
+       # --- Normal cyrus spool, or Murder backends ---
+       # add or remove based on preferences
+       imap            cmd="imapd -U 30" listen="imap" prefork=0 maxchild=100
+       #imaps          cmd="imapd -s -U 30" listen="imaps" prefork=0 maxchild=100
+       pop3            cmd="pop3d -U 30" listen="pop3" prefork=0 maxchild=50
+       #pop3s          cmd="pop3d -s -U 30" listen="pop3s" prefork=0 maxchild=50
+
+       # At least one form of LMTP is required for delivery
+       # (you must keep the Unix socket name in sync with imap.conf)
+       #lmtp           cmd="lmtpd" listen="localhost:lmtp" prefork=0 maxchild=20
+       lmtpunix        cmd="lmtpd" listen="@FINKPREFIX@/var/run/cyrus/socket/lmtp" prefork=0 maxchild=20
+       # ----------------------------------------------
+
+       # useful if you need to give users remote access to sieve
+       # by default, we limit this to localhost in Debian/Fink
+       sieve           cmd="timsieved" listen="localhost:sieve" prefork=0 maxchild=100
+
+       # this one is needed for the notification services
+       notify          cmd="notifyd" listen="@FINKPREFIX@/var/run/cyrus/socket/notify" proto="udp" prefork=1
+
+       # --- Murder frontends -------------------------
+       # enable these and disable the matching services above,   
+       # except for sieve (which deals automatically with Murder)
+
+       # mupdate database service - must prefork at least 1
+       # (mupdate slaves)
+       #mupdate       cmd="mupdate" listen=2004 prefork=1
+       # (mupdate master, only one in the entire cluster)
+       #mupdate       cmd="mupdate -m" listen=2004 prefork=1
+
+       # proxies that will connect to the backends
+       #imap           cmd="proxyd" listen="imap" prefork=0 maxchild=100
+       #imaps          cmd="proxyd -s" listen="imaps" prefork=0 maxchild=100
+       #pop3           cmd="pop3proxyd" listen="pop3" prefork=0 maxchild=50
+       #pop3s          cmd="pop3proxyd -s" listen="pop3s" prefork=0 maxchild=50
+       #lmtp           cmd="lmtpproxyd" listen="lmtp" prefork=1 maxchild=20
+       # ----------------------------------------------
+}
+
+EVENTS {
+       # this is required
+       checkpoint      cmd="@FINKPREFIX@/sbin/ctl_cyrusdb -c" period=30
+
+       # this is only necessary if using duplicate delivery suppression
+       delprune        cmd="@FINKPREFIX@/sbin/ctl_deliver -E 3" at=0401
+
+       # this is only necessary if caching TLS sessions
+       tlsprune        cmd="@FINKPREFIX@/sbin/tls_prune" at=0401
+}
+
diff -Naur cyrus-imapd-2.2.12/fink/cyrus21.default cyrus-imapd-2.2.12.fink/fink/cyrus21.default
--- cyrus-imapd-2.2.12/fink/cyrus21.default	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cyrus21.default	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,21 @@
+# Defaults for Cyrus IMAPd 2.1 scripts
+# sourced by /etc/init.d/cyrus21, /usr/sbin/cyrus-makedirs
+# installed at /etc/default/cyrus21 by the maintainer scripts
+# $Id$
+ 
+#
+# This is a POSIX shell fragment
+#
+
+# Set this to 1 or higher to enable debugging on cyrmaster
+#CYRUS_VERBOSE=1
+
+# Socket listen queue backlog size
+# See listen(2). Default is 32, you may want to increase
+# this number if you have a very high connection rate
+#LISTENQUEUE=32
+
+# Wether cyrus-makedirs should optimize filesystems 
+# or not.  Switch it off if you are going to do your  
+# own optimizations.  Set to 1 to enable, 0 to disable
+#CYRUSOPTFILESYS=1
diff -Naur cyrus-imapd-2.2.12/fink/cyrus21.init cyrus-imapd-2.2.12.fink/fink/cyrus21.init
--- cyrus-imapd-2.2.12/fink/cyrus21.init	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/cyrus21.init	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,151 @@
+#! /bin/sh
+#
+# cyrus21      /etc/init.d/ script for cyrus2 IMAPd
+#              This file manages the Cyrus IMAPd master process.
+#
+#              Copr. 2001 by Henrique de Moraes Holschuh <hmh@debian.org>
+#              Distributed under the GPL version 2
+#
+# Version:     $Id$
+#
+
+# Overridable defaults
+unset CYRUS_VERBOSE
+unset LISTENQUEUE
+[ -r /etc/default/cyrus21 ] && . /etc/default/cyrus21
+
+[ "x${CYRUS_VERBOSE}" != "x" ] && export CYRUS_VERBOSE
+OPTIONS="-d"
+[ "x${LISTENQUEUE}" != "x" ] && OPTIONS="-l ${LISTENQUEUE} ${OPTIONS}"
+
+PATH=/sbin:/usr/sbin:/bin:/usr/bin
+DAEMON=/usr/sbin/cyrmaster
+NAME=cyrmaster
+DESC="Cyrus IMAPd"
+
+test -x ${DAEMON} || exit 0
+
+set -e
+
+START="--start --quiet --pidfile /var/run/${NAME}.pid --exec ${DAEMON} -- ${OPTIONS}"
+
+verifydb() {
+   while read -r DBKEY DBVALUE ; do
+       match=`gawk "/^${DBKEY}[[:blank:]]/ { print \\$2 }" < $1`
+       [ "x${match}" != "x${DBVALUE}" ] && return 0
+   done
+   return 1
+}
+
+createdir() {
+# $1 = user
+# $2 = group
+# $3 = permissions (octal)
+# $4 = path to directory
+       [ -d "$4" ] || mkdir -p "$4"
+       chown -c -h "$1:$2" "$4"
+       chmod -c "$3" "$4"
+}
+
+missingstatoverride () {
+       echo "$0: You are missing a dpkg-statoverride on $1.  Add it." >&2
+       exit 1
+}
+
+fixdirs () {
+       dir=`dpkg-statoverride --list /var/run/cyrus` \
+               || missingstatoverride /var/run/cyrus
+       [ -z "$dir" ] \
+               || createdir $dir
+       dir=`dpkg-statoverride --list /var/run/cyrus/socket` \
+               || missingstatoverride /var/run/cyrus/socket
+       [ -z "$dir" ] \
+               || createdir $dir
+}
+
+case "$1" in
+  start)
+       # Verify if there are old Cyrus 1.5 spools that were not upgraded
+       [ -f /var/lib/cyrus/mailboxes -a -d /var/lib/cyrus/deliverdb -a \
+         -d /var/spool/cyrus/mail/user -a ! -d /var/spool/cyrus/mail/stage. ] && {
+               echo "$0: It appears that you still have an version 1.5 spool" 1>&2
+               echo "$0: that needs to be upgraded. Please refer to the guide" 1>&2
+               echo "$0: at /usr/share/doc/cyrus21-common/UPGRADE.Debian" 1>&2
+               echo
+               echo "$0: Cyrmaster not started."
+               exit 2
+       }
+       # Verify consistency of database backends
+       [ -f /usr/lib/cyrus/cyrus-db-types.active ] && {
+               # is it safe to start cyrmaster? compare "key value" pairs
+               # from the (old) active database types file with the new one
+               verifydb /usr/lib/cyrus/cyrus-db-types.txt \
+                   < /usr/lib/cyrus/cyrus-db-types.active && {
+                   echo "$0: Database backends mismatch! You must manually" 1>&2
+                   echo "$0: verify and update the Cyrus databases to the" 1>&2
+                   echo "$0: new backends." 1>&2
+                   echo "$0: Please refer to /usr/share/doc/cyrus21-common/README.Debian" 1>&2
+                   echo "$0: for instructions." 1>&2
+                   echo
+                   echo "$0: Cyrmaster not started."
+                   exit 2
+               }
+       }
+       echo -n "Starting ${DESC}: "
+       fixdirs
+       if start-stop-daemon ${START} >/dev/null 2>&1 ; then
+               echo "$NAME."
+       else
+               if start-stop-daemon --test ${START} >/dev/null 2>&1; then
+                       echo "(failed)."
+                       exit 1
+               else
+                       echo "${DAEMON} already running."
+                       exit 0
+               fi
+       fi
+       ;;
+  stop)
+       echo -n "Stopping $DESC: "
+       if start-stop-daemon --stop --quiet --pidfile /var/run/$NAME.pid \
+                       --quiet --startas $DAEMON >/dev/null 2>&1 ; then
+               echo "$NAME."
+       else
+               echo "(failed)."
+       fi
+       ;;
+  reload|force-reload)
+       echo "Reloading $DESC configuration files."  
+       start-stop-daemon --stop --signal 1 --quiet \
+               --pidfile /var/run/$NAME.pid --exec $DAEMON >/dev/null 2>&1
+       ;; 
+  restart)
+       $0 stop && {
+         echo -n "Waiting for complete shutdown..."
+         i=5
+         while [ $i -gt 0 ] ; do
+               if start-stop-daemon --start --test \
+                  --pidfile /var/run/$NAME.pid \
+                  --exec $DAEMON >/dev/null 2>&1 ; then
+                       break
+               fi
+               sleep 2s
+               i=$(($i - 1))
+               echo -n "."
+         done
+         [ $i -eq 0 ] && {
+               echo
+               echo "fatal: incomplete shutdown detected, aborting."
+               exit 1
+         }   
+         echo
+       }
+       exec $0 start
+       ;;
+  *)
+       echo "Usage: $0 {start|stop|restart|reload|force-reload}" 1>&2
+       exit 1
+       ;;
+esac
+
+exit 0
diff -Naur cyrus-imapd-2.2.12/fink/get-backtrace.gdb cyrus-imapd-2.2.12.fink/fink/get-backtrace.gdb
--- cyrus-imapd-2.2.12/fink/get-backtrace.gdb	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/get-backtrace.gdb	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,4 @@
+c 
+bt  
+quit
+
diff -Naur cyrus-imapd-2.2.12/fink/imapd.conf cyrus-imapd-2.2.12.fink/fink/imapd.conf
--- cyrus-imapd-2.2.12/fink/imapd.conf	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/imapd.conf	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,279 @@
+# Debian/Fink Cyrus imapd.conf
+# See imapd.conf(5) for more information and more options
+
+# Configuration directory
+configdirectory: @FINKPREFIX@/var/lib/cyrus
+
+# Which partition to use for default mailboxes
+defaultpartition: default
+partition-default: @FINKPREFIX@/var/spool/cyrus/mail
+
+# News setup
+partition-news: @FINKPREFIX@/var/spool/cyrus/news
+newsspool: @FINKPREFIX@/var/spool/news
+
+# Alternate namespace
+# If enabled, activate the alternate namespace as documented in
+# @FINKPREFIX@/share/doc/cyrus2-common/html/altnamespace.html, where an user's
+# subfolders are in the same level as the INBOX
+altnamespace: no
+
+# UNIX Hierarchy Convention
+# Set to yes, and cyrus will accept dots in names, and use the forward
+# slash "/" to delimit levels of the hierarchy. This is done by converting
+# internally all dots to "^", and all "/" to dots. So the "rabbit.holes"
+# mailbox of user "helmer.fudd" is stored in "user.elmer^fud.rabbit^holes"
+#
+# WARNING: This option does NOT apply to admin tools such as cyradm 
+# (admins ONLY), reconstruct, quota, etc., NOR does it affect LMTP delivery
+# of messages directly to mailboxes via plus-addressing.
+# See also userprefix and sharedprefix on imapd.conf(5)
+unixhierarchysep: no
+
+# Munging illegal characters in headers
+# Headers of RFC2882 messages must not have characters with the 8th bit
+# set. However, too many badly-written MUAs generate this, including most
+# spamware.  Disable this if you want Cyrus to leave the crappage untouched
+# and you don't care that IMAP SEARCH won't work right anymore.
+#munge8bit: no
+
+# Forcing recipient user to lowercase
+# Cyrus 2.1 is case-sensitive.  If all your mail users are in lowercase, it is
+# probably a very good idea to set lmtp_downcase_rcpt to true.  The default is
+# to assume the user knows what he is doing, and not downcase anything.
+#lmtp_downcase_rcpt: yes
+
+# Uncomment the following and add the space-separated users who
+# have admin rights for all services.
+#admins: cyrus
+
+# Space-separated list of users that have lmtp "admin" status (i.e. that
+# can deliver email through TCP/IP lmtp) in addition to those in the
+# admins: entry above
+#lmtp_admins: postman
+  
+# Space-separated list of users that have mupdate "admin" status, in
+# addition to those in the admins: entry above. Note that mupdate slaves and
+# backends in a Murder cluster need to autenticate against the mupdate master
+# as admin users.
+#mupdate_admins: mupdateman
+
+# Space-separated list of users that have imapd "admin" status, in
+# addition to those in the admins: entry above
+#imap_admins: cyrus
+
+# Space-separated list of users that have sieve "admin" status, in
+# addition to those in the admins: entry above
+#sieve_admins: cyrus
+
+# List of users and groups that are allowed to proxy for other users,
+# seperated by spaces.  Any user listed in this will be allowed to login
+# for any other user.  Like "admins:" above, you can have imap_proxyservers
+# and sieve_proxyservers.
+#proxyservers: cyrus
+ 
+# No anonymous logins
+allowanonymouslogin: no
+
+# Minimum time between POP mail fetches in minutes
+popminpoll: 1
+ 
+# If nonzero, normal users may create their own IMAP accounts by creating
+# the mailbox INBOX.  The user's quota is set to the value if it is positive,
+# otherwise the user has unlimited quota.
+autocreatequota: 0
+
+# umask used by Cyrus programs
+umask: 077
+  
+# Sendmail binary location (used by sieve)
+sendmail: @FINKPREFIX@/sbin/sendmail
+  
+# If enabled, cyrdeliver will look for Sieve scripts in user's home
+# directories: ~user/.sieve.
+sieveusehomedir: false
+ 
+# If sieveusehomedir is false, this directory is searched for Sieve scripts.
+sievedir: @FINKPREFIX@/var/spool/sieve
+  
+# notifyd(8) method to use for "MAIL" notifications.  If not set, "MAIL"
+# notifications are disabled.  Valid methods are: null, log, zephyr
+#mailnotifier: zephyr
+  
+# notifyd(8) method to use for "SIEVE" notifications.  If not set, "SIEVE"
+# notifications are disabled.  This method is only used when no method is
+# specified in the script.  Valid methods are null, log, zephyr, mailto
+#sievenotifier: zephyr
+
+# DRAC (pop-before-smtp, imap-before-smtp) support
+# Set dracinterval to the time in minutes to call DRAC while a user is
+# connected to the imap/pop services. Set to 0 to disable DRAC (default)
+# Set drachost to the host where the rpc drac service is running
+#dracinterval: 0
+#drachost: localhost
+
+# If enabled, the partitions will also be hashed, in addition to the hashing
+# done on configuration directories. This is recommended if one partition has a
+# very bushy mailbox tree.
+hashimapspool: true
+  
+# Allow plaintext logins by default (SASL PLAIN)
+allowplaintext: yes
+
+# Force PLAIN/LOGIN authentication only
+# (you need to uncomment this if you are not using an auxprop-based SASL
+# mechanism.  saslauthd users, that means you!). And pay attention to
+# sasl_minimum_layer below, too.
+#sasl_mech_list: PLAIN
+  
+# The minimum SSF that the server will allow a client to negotiate. A
+# value of 1 requires integrity protection; any higher value requires some
+# amount of encryption.
+#sasl_minimum_layer: 0
+
+# The maximum SSF that the server will allow a client to negotiate. A
+# value of 1 requires integrity protection; any higher value requires some
+# amount of encryption.
+#sasl_maximum_layer: 256
+
+# List of remote realms whose users may log in using cross-realm
+# authentications.  Seperate each realm name by a space. A cross-realm
+# identity is considered any identity returned by SASL with an "@" in it.
+#loginrealms:
+
+# 
+# SASL library options (these are handled directly by the SASL libraries,
+# refer to SASL documentation for an up-to-date list of these)
+#
+ 
+# The mechanism(s) used by the server to verify plaintext passwords. Possible
+# values are "saslauthd", "auxprop", "pwcheck" and "alwaystrue".  They
+# are tried in order, you can specify more than one, separated by spaces.
+#
+# Do note that, since sasl will be run as user cyrus, you may have a lot of
+# trouble to set this up right.
+sasl_pwcheck_method: auxprop
+  
+# What auxpropd plugins to load, if using sasl_pwcheck_method: auxprop
+# by default, all plugins are tried (which is probably NOT what you want).
+#sasl_auxprop_plugin: sasldb
+  
+# If enabled, the SASL library will automatically create authentication secrets
+# when given a plaintext password. Refer to SASL documentation 
+sasl_auto_transition: no
+
+# 
+# SSL/TLS Options
+#
+ 
+# File containing the global certificate used for ALL services (imap, pop3,
+# lmtp, sieve)
+#tls_cert_file: @FINKPREFIX@/etc/ssl/certs/cyrus-global.pem
+  
+# File containing the private key belonging to the global server certificate.
+#tls_key_file: @FINKPREFIX@/etc/ssl/private/cyrus-global.key
+
+# File containing the certificate used for imap. If not specified, the global
+# certificate is used.  A value of "disabled" will disable SSL/TLS for imap.
+#tls_imap_cert_file: @FINKPREFIX@/etc/ssl/certs/cyrus-imap.pem
+
+# File containing the private key belonging to the imap-specific server
+# certificate.  If not specified, the global private key is used.  A value of
+# "disabled" will disable SSL/TLS for imap.
+#tls_imap_key_file: @FINKPREFIX@/etc/ssl/private/cyrus-imap.key
+
+# File containing the certificate used for pop3. If not specified, the global
+# certificate is used.  A value of "disabled" will disable SSL/TLS for pop3.
+#tls_pop3_cert_file: @FINKPREFIX@/etc/ssl/certs/cyrus-pop3.pem
+  
+# File containing the private key belonging to the pop3-specific server
+# certificate.  If not specified, the global private key is used.  A value of
+# "disabled" will disable SSL/TLS for pop3.
+#tls_pop3_key_file: @FINKPREFIX@/etc/ssl/private/cyrus-pop3.key
+  
+# File containing the certificate used for lmtp. If not specified, the global
+# certificate is used.  A value of "disabled" will disable SSL/TLS for lmtp.
+#tls_lmtp_cert_file: @FINKPREFIX@/etc/ssl/certs/cyrus-lmtp.pem
+  
+# File containing the private key belonging to the lmtp-specific server
+# certificate.  If not specified, the global private key is used.  A value of
+# "disabled" will disable SSL/TLS for lmtp.
+#tls_lmtp_key_file: @FINKPREFIX@/etc/ssl/private/cyrus-lmtp.key
+  
+# File containing the certificate used for sieve. If not specified, the global
+# certificate is used.  A value of "disabled" will disable SSL/TLS for sieve.
+#tls_sieve_cert_file: @FINKPREFIX@/etc/ssl/certs/cyrus-sieve.pem
+  
+# File containing the private key belonging to the sieve-specific server
+# certificate.  If not specified, the global private key is used.  A value of
+# "disabled" will disable SSL/TLS for sieve.
+#tls_sieve_key_file: @FINKPREFIX@/etc/ssl/private/cyrus-sieve.key
+
+# File containing one or more Certificate Authority (CA) certificates.
+#tls_ca_file: @FINKPREFIX@/etc/ssl/certs/cyrus-imapd-ca.pem
+
+# Path to directory with certificates of CAs.
+tls_ca_path: @FINKPREFIX@/etc/ssl/certs
+  
+# The length of time (in minutes) that a TLS session will be cached for later
+# reuse.  The maximum value is 1440 (24 hours), the default.  A value of 0 will
+# disable session caching.
+tls_session_timeout: 1440
+  
+# The list of SSL/TLS ciphers to allow.  The format of the string is described
+# in ciphers(1). THIS DISABLES THE WEAK 'FOR EXPORT' CRAP!
+tls_cipher_list: TLSv1:SSLv3:SSLv2:!NULL:!EXPORT:!DES:!LOW:@STRENGTH
+
+# Require a client certificate for ALL services (imap, pop3, lmtp, sieve).
+#tls_require_cert: false
+
+# Require a client certificate for imap ONLY.
+#tls_imap_require_cert: false
+
+# Require a client certificate for pop3 ONLY.
+#tls_pop3_require_cert: false
+
+# Require a client certificate for lmtp ONLY.
+#tls_lmtp_require_cert: false
+
+# Require a client certificate for sieve ONLY.
+#tls_sieve_require_cert: false
+ 
+#
+# Cyrus Murder cluster configuration
+#
+# Set the following options to the values needed for this server to
+# autenticate against the mupdate master server:
+# mupdate_server
+# mupdate_port
+# mupdate_username
+# mupdate_authname
+# mupdate_realm   
+# mupdate_password   
+# mupdate_retry_delay
+  
+##
+## KEEP THESE IN SYNC WITH cyrus.conf
+##
+# Unix domain socket that lmtpd listens on.
+lmtpsocket: @FINKPREFIX@/var/run/cyrus/socket/lmtp
+
+# Unix domain socket that idled listens on.
+idlesocket: @FINKPREFIX@/var/run/cyrus/socket/idle
+
+# Unix domain socket that the new mail notification daemon listens on.
+notifysocket: @FINKPREFIX@/var/run/cyrus/socket/notify
+
+##
+## DEBUGGING
+##
+# Keep the hook disabled when it is not in use
+#
+# gdb Back-traces
+#debug_command: /usr/bin/gdb -batch -cd=/tmp -x @FINKPREFIX@/lib/cyrus/get-backtrace.gdb @FINKPREFIX@/lib/cyrus/bin/%
+#
+# system-call traces NOT AVAIL ON OS X
+#debug_command: /usr/bin/strace -tt -o /tmp/strace.cyrus.%s.%d -p %2$d <&- 2>&1 &
+#
+# library traces NOT AVAIL ON OS X
+#debug_command: /usr/bin/ltrace -tt -n 2 -o /tmp/ltrace.cyrus.%s.%d -p %2$d <&- 2>&1 &
diff -Naur cyrus-imapd-2.2.12/fink/logcheck.ignore cyrus-imapd-2.2.12.fink/fink/logcheck.ignore
--- cyrus-imapd-2.2.12/fink/logcheck.ignore	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/logcheck.ignore	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,32 @@
+cyrus/ctl_cyrusdb\[[0-9]+\]: +(done +)?recovering cyrus databases
+cyrus/ctl_cyrusdb\[[0-9]+\]: +archiving
+cyrus/ctl_cyrusdb\[[0-9]+\]: +checkpointing
+cyrus/ctl_cyrusdb\[[0-9]+\]: +done checkpointing
+cyrus/ctl_deliver\[[0-9]+\]: +mydelete: committing txn
+cyrus/ctl_deliver\[[0-9]+\]: +mydelete: starting txn
+cyrus/ctl_deliver\[[0-9]+\]: +duplicate_prune: pruning back
+cyrus/ctl_deliver\[[0-9]+\]: +duplicate_prune: purged
+cyrus/tls_prune\[[0-9]+\]: +(tls_prune: )?purged
+cyrus/master\[[0-9]+\]: +ready for work
+cyrus/master\[[0-9]+\]: +about to exec
+cyrus/master\[[0-9]+\]: +process [0-9]+ exited, status 0
+cyrus/master\[[0-9]+\]: +service [a-zA-Z0-9]+ now has [0-9]+ workers
+cyrus/[a-zA-Z0-9]+\[[0-9]+\]: +executed
+cyrus/[a-zA-Z0-9]+\[[0-9]+\]: +accepted connection
+cyrus/[a-zA-Z0-9]+\[[0-9]+\]: +telling master
+cyrus/lmtpd\[[0-9]+\]: +lmtp connection preauth'd as postman
+cyrus/lmtpd\[[0-9]+\]: +dupelim: eliminated duplicate message to
+cyrus/lmtpd\[[0-9]+\]: +duplicate_check:
+cyrus/lmtpd\[[0-9]+\]: +duplicate_mark:
+cyrus/lmtpd\[[0-9]+\]: +mystore: committing txn
+cyrus/lmtpd\[[0-9]+\]: +mystore: starting txn
+cyrus/pop3d\[[0-9]+\]: +login:
+cyrus/imapd\[[0-9]+\]: +abort_txn: aborting txn
+cyrus/imapd\[[0-9]+\]: +delete: starting txn
+cyrus/imapd\[[0-9]+\]: +login:
+cyrus/imapd\[[0-9]+\]: +open: user .* opened
+cyrus/imapd\[[0-9]+\]: +mycommit: committing txn
+cyrus/imapd\[[0-9]+\]: +myfetch: reusing txn 
+cyrus/imapd\[[0-9]+\]: +myfetch: starting txn
+cyrus/imapd\[[0-9]+\]: +mystore: reusing txn
+cyrus/imapd\[[0-9]+\]: +seen_db: user .* opened
diff -Naur cyrus-imapd-2.2.12/fink/pam/imap cyrus-imapd-2.2.12.fink/fink/pam/imap
--- cyrus-imapd-2.2.12/fink/pam/imap	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/pam/imap	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,15 @@
+# PAM configuration file for Cyrus IMAP service
+# $Id$
+#
+# If you want to use Cyrus in a setup where users don't have
+# accounts on the local machine, you'll need to make sure
+# you use something like pam_permit for account checking.
+#
+# Also, take a look into libpam-ldap, libpam-mysql/libpam-pgsql
+# and libpam-pwdfile. They're likely to be helpful aid for creating
+# a closed-box email system.
+#
+
+auth   required        pam_unix.so nullok 
+account        required        pam_unix.so
+
diff -Naur cyrus-imapd-2.2.12/fink/pam/lmtp cyrus-imapd-2.2.12.fink/fink/pam/lmtp
--- cyrus-imapd-2.2.12/fink/pam/lmtp	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/pam/lmtp	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,15 @@
+# PAM configuration file for Cyrus LMTP service
+# $Id$
+#
+# If you want to use Cyrus in a setup where users don't have
+# accounts on the local machine, you'll need to make sure
+# you use something like pam_permit for account checking.
+#
+# Also, take a look into libpam-ldap, libpam-mysql/libpam-pgsql
+# and libpam-pwdfile. They're likely to be helpful aid for creating
+# a closed-box email system.
+#
+
+auth   required        pam_unix.so nullok 
+account        required        pam_unix.so
+
diff -Naur cyrus-imapd-2.2.12/fink/pam/mupdate cyrus-imapd-2.2.12.fink/fink/pam/mupdate
--- cyrus-imapd-2.2.12/fink/pam/mupdate	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/pam/mupdate	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,16 @@
+# PAM configuration file for Cyrus Murder mupdate service
+# $Id$
+# 
+# You'd better read the documentation damn well before you
+# start mupdate... this file is also likely wrong, please file
+# a bug against the cyrus21-murder package if you have better
+# ideas for the Debian/Fink default version of this file.
+# 
+# Also, take a look into libpam-ldap, libpam-mysql/libpam-pgsql
+# and libpam-pwdfile. They're likely to be helpful aid for creating
+# a closed-box email system.
+#
+
+auth   required        pam_unix.so nullok 
+account        required        pam_unix.so
+
diff -Naur cyrus-imapd-2.2.12/fink/pam/pop cyrus-imapd-2.2.12.fink/fink/pam/pop
--- cyrus-imapd-2.2.12/fink/pam/pop	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/pam/pop	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,15 @@
+# PAM configuration file for Cyrus POP3 service   
+# $Id$
+# 
+# If you want to use Cyrus in a setup where users don't have
+# accounts on the local machine, you'll need to make sure
+# you use something like pam_permit for account checking.
+# 
+# Also, take a look into libpam-ldap, libpam-mysql/libpam-pgsql
+# and libpam-pwdfile. They're likely to be helpful aid for creating
+# a closed-box email system.
+#
+
+auth   required        pam_unix.so nullok 
+account        required        pam_unix.so
+
diff -Naur cyrus-imapd-2.2.12/fink/pam/sieve cyrus-imapd-2.2.12.fink/fink/pam/sieve
--- cyrus-imapd-2.2.12/fink/pam/sieve	Thu Jan  1 09:00:00 1970
+++ cyrus-imapd-2.2.12.fink/fink/pam/sieve	Tue Mar 22 00:41:25 2005
@@ -0,0 +1,15 @@
+# PAM configuration file for Cyrus SIEVE timsieved service
+# $Id$
+#
+# If you want to use Cyrus in a setup where users don't have
+# accounts on the local machine, you'll need to make sure
+# you use something like pam_permit for account checking.
+#
+# Also, take a look into libpam-ldap, libpam-mysql/libpam-pgsql
+# and libpam-pwdfile. They're likely to be helpful aid for creating
+# a closed-box email system.
+#
+
+auth   required        pam_unix.so nullok
+account        required        pam_unix.so
+
diff -Naur cyrus-imapd-2.2.12/imap/cvt_cyrusdb.c cyrus-imapd-2.2.12.fink/imap/cvt_cyrusdb.c
--- cyrus-imapd-2.2.12/imap/cvt_cyrusdb.c	Sat May 22 12:45:48 2004
+++ cyrus-imapd-2.2.12.fink/imap/cvt_cyrusdb.c	Tue Mar 22 00:41:25 2005
@@ -60,7 +60,9 @@
 #include <syslog.h>
 
 #include <sys/ipc.h>
+#if !defined(__APPLE__)
 #include <sys/msg.h>
+#endif
 
 #include "acl.h"
 #include "assert.h"
diff -Naur cyrus-imapd-2.2.12/imap/mboxlist.c cyrus-imapd-2.2.12.fink/imap/mboxlist.c
--- cyrus-imapd-2.2.12/imap/mboxlist.c	Tue Jul 27 03:08:03 2004
+++ cyrus-imapd-2.2.12.fink/imap/mboxlist.c	Tue Mar 22 00:41:25 2005
@@ -60,7 +60,9 @@
 #include <syslog.h>
 
 #include <sys/ipc.h>
+#if !defined(__APPLE__)
 #include <sys/msg.h>
+#endif
 
 #include "acl.h"
 #include "annotate.h"
diff -Naur cyrus-imapd-2.2.12/imtest/imtest.c cyrus-imapd-2.2.12.fink/imtest/imtest.c
--- cyrus-imapd-2.2.12/imtest/imtest.c	Wed Dec  8 04:26:22 2004
+++ cyrus-imapd-2.2.12.fink/imtest/imtest.c	Tue Mar 22 00:41:25 2005
@@ -47,7 +47,9 @@
 #include <sys/time.h>
 #include <sys/types.h>
 #include <sys/ipc.h>
+#if !defined(__APPLE__)
 #include <sys/msg.h>
+#endif
 #include <sys/stat.h>
 #include <fcntl.h>
 
diff -Naur cyrus-imapd-2.2.12/installsieve/installscript.c cyrus-imapd-2.2.12.fink/installsieve/installscript.c
--- cyrus-imapd-2.2.12/installsieve/installscript.c	Fri Feb 14 05:15:37 2003
+++ cyrus-imapd-2.2.12.fink/installsieve/installscript.c	Tue Mar 22 00:41:25 2005
@@ -47,7 +47,9 @@
 #include <sys/stat.h>
 #include <sys/types.h>
 #include <sys/ipc.h>
+#if !defined(__APPLE__)
 #include <sys/msg.h>
+#endif
 
 #include <stdlib.h>
 #include <stdio.h>
diff -Naur cyrus-imapd-2.2.12/installsieve/request.c cyrus-imapd-2.2.12.fink/installsieve/request.c
--- cyrus-imapd-2.2.12/installsieve/request.c	Fri Feb 14 05:15:37 2003
+++ cyrus-imapd-2.2.12.fink/installsieve/request.c	Tue Mar 22 00:41:25 2005
@@ -47,8 +47,9 @@
 #include <sys/stat.h>
 #include <sys/types.h>
 #include <sys/ipc.h>
+#if !defined(__APPLE__)
 #include <sys/msg.h>
-
+#endif
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
diff -Naur cyrus-imapd-2.2.12/netnews/remotepurge.c cyrus-imapd-2.2.12.fink/netnews/remotepurge.c
--- cyrus-imapd-2.2.12/netnews/remotepurge.c	Fri Feb 14 05:15:47 2003
+++ cyrus-imapd-2.2.12.fink/netnews/remotepurge.c	Tue Mar 22 00:41:25 2005
@@ -48,7 +48,9 @@
 
 #include <sys/types.h>
 #include <sys/ipc.h>
+#if !defined(__APPLE__)
 #include <sys/msg.h>
+#endif
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <ctype.h>
diff -Naur cyrus-imapd-2.2.12/perl/Makefile.in cyrus-imapd-2.2.12.fink/perl/Makefile.in
--- cyrus-imapd-2.2.12/perl/Makefile.in	Thu Oct 23 03:50:17 2003
+++ cyrus-imapd-2.2.12.fink/perl/Makefile.in	Tue Mar 22 02:09:04 2005
@@ -82,7 +82,15 @@
 			   BDB_LIB="$(BDB_LIB)" BDB_INC="$(BDB_INC)" \
 			   OPENSSL_LIB="$(OPENSSL_LIB)" OPENSSL_INC="$(OPENSSL_INC)" \
 			   SASL_LIB="$(SASL_LIB)" SASL_INC="$(SASL_INC)" CC="$(CC)" \
-			     $(PERL) Makefile.PL PREFIX=$(prefix); \
+			   $(PERL) Makefile.PL PREFIX=$(prefix) \
+			   INSTALLSCRIPT=@FINKPREFIX@/bin \
+			   INSTALLBIN=@FINKPREFIX@/bin \
+			   INSTALLPRIVLIB=@FINKPREFIX@/lib/perl5/5.8.1 \
+			   INSTALLARCHLIB=@FINKPREFIX@/lib/perl5/5.8.1/darwin-thread-multi-2level \
+			   INSTALLSITELIB=@FINKPREFIX@/lib/perl5/5.8.1 \
+			   INSTALLSITEARCH=@FINKPREFIX@/lib/perl5/5.8.1/darwin-thread-multi-2level \
+			   INSTALLMAN1DIR=@FINKINSTALL@/share/man/man1 \
+			   INSTALLMAN3DIR=@FINKINSTALL@/share/man/man3; \
 			fi; \
 			$(MAKE) $(MFLAGS) DESTDIR=$(DESTDIR) all) || exit 1; \
 	done
@@ -91,7 +99,16 @@
 	@for d in  $(SUBDIRS); \
 	do \
 		(cd $$d; echo "### Making" install "in" `pwd`;	\
-			$(MAKE) $(MFLAGS) DESTDIR=$(DESTDIR) install) || exit 1; \
+			$(MAKE) $(MFLAGS) PREFIX=@FINKINSTALL@ \
+			INSTALLSCRIPT=@FINKPREFIX@/bin \
+			INSTALLBIN=@FINKPREFIX@/bin \
+			INSTALLPRIVLIB=@FINKPREFIX@/lib/perl5/5.8.1 \
+			INSTALLARCHLIB=@FINKPREFIX@/lib/perl5/5.8.1/darwin-thread-multi-2level \
+			INSTALLSITELIB=@FINKPREFIX@/lib/perl5/5.8.1 \
+			INSTALLSITEARCH=@FINKPREFIX@/lib/perl5/5.8.1/darwin-thread-multi-2level \
+			INSTALLMAN1DIR=@FINKINSTALL@/share/man/man1 \
+			INSTALLMAN3DIR=@FINKINSTALL@/share/man/man3; \
+			DESTDIR=$(DESTDIR) install) || exit 1; \
 	done
 
 clean::
diff -Naur cyrus-imapd-2.2.12/perl/sieve/Makefile.in cyrus-imapd-2.2.12.fink/perl/sieve/Makefile.in
--- cyrus-imapd-2.2.12/perl/sieve/Makefile.in	Thu Oct 23 03:50:24 2003
+++ cyrus-imapd-2.2.12.fink/perl/sieve/Makefile.in	Tue Mar 22 00:41:25 2005
@@ -84,7 +84,13 @@
 			   BDB_LIB="$(BDB_LIB)" BDB_INC="$(BDB_INC)" \
 			   OPENSSL_LIB="$(OPENSSL_LIB)" OPENSSL_INC="$(OPENSSL_INC)" \
 			   SASL_LIB="$(SASL_LIB)" SASL_INC="$(SASL_INC)" CC="$(CC)" \
-			     $(PERL) Makefile.PL PREFIX=$(prefix); \
+                            $(PERL) Makefile.PL PREFIX=$(prefix) \
+                               INSTALLPRIVLIB=@FINKPREFIX@/lib/perl5/5.8.1 \
+                               INSTALLARCHLIB=@FINKPREFIX@/lib/perl5/5.8.1/darwin-thread-multi-2level \
+                               INSTALLSITELIB=@FINKPREFIX@/lib/perl5/5.8.1 \
+                               INSTALLSITEARCH=@FINKPREFIX@/lib/perl5/5.8.1/darwin-thread-multi-2level \
+                               INSTALLMAN1DIR=@FINKINSTALL@/share/man/man1 \
+                               INSTALLMAN3DIR=@FINKINSTALL@/share/man/man3; \
 			fi; \
 			$(MAKE) $(MFLAGS) DESTDIR=$(DESTDIR) all) || exit 1; \
 	done
diff -Naur cyrus-imapd-2.2.12/perl/sieve/lib/request.c cyrus-imapd-2.2.12.fink/perl/sieve/lib/request.c
--- cyrus-imapd-2.2.12/perl/sieve/lib/request.c	Fri Feb 14 05:15:53 2003
+++ cyrus-imapd-2.2.12.fink/perl/sieve/lib/request.c	Tue Mar 22 00:41:25 2005
@@ -51,7 +51,9 @@
 #include <sys/stat.h>
 #include <sys/types.h>
 #include <sys/ipc.h>
+#if !defined(__APPLE__)
 #include <sys/msg.h>
+#endif
 
 #include <stdlib.h>
 #include <stdio.h>
diff -Naur cyrus-imapd-2.2.12/tools/dohash cyrus-imapd-2.2.12.fink/tools/dohash
--- cyrus-imapd-2.2.12/tools/dohash	Fri Feb 23 13:43:01 2001
+++ cyrus-imapd-2.2.12.fink/tools/dohash	Tue Mar 22 00:41:25 2005
@@ -112,7 +112,7 @@
 }
 close CONF;
 
-if (! $conf) { $conf = "/var/imap"; }
+if (! $conf) { $conf = "@FINKPREFIX@/var/imap"; }
 
 if ($interactive) {
     print "upgrade $conf? ";
diff -Naur cyrus-imapd-2.2.12/tools/mkimap cyrus-imapd-2.2.12.fink/tools/mkimap
--- cyrus-imapd-2.2.12/tools/mkimap	Wed Jun 30 03:16:54 2004
+++ cyrus-imapd-2.2.12.fink/tools/mkimap	Tue Mar 22 00:41:25 2005
@@ -59,7 +59,7 @@
 __END__
 require 5;
 
-$imapdconf = shift || "/etc/imapd.conf";
+$imapdconf = shift || "@FINKPREFIX@/etc/imapd.conf";
 
 open CONF, $imapdconf or die "can't open $imapdconf";
 print "reading configure file...\n";
diff -Naur cyrus-imapd-2.2.12/tools/rehash cyrus-imapd-2.2.12.fink/tools/rehash
--- cyrus-imapd-2.2.12/tools/rehash	Thu Oct 23 03:50:32 2003
+++ cyrus-imapd-2.2.12.fink/tools/rehash	Tue Mar 22 00:41:25 2005
@@ -140,7 +140,7 @@
     }
 }
 
-$imapdconf = shift || "/etc/imapd.conf";
+$imapdconf = shift || "@FINKPREFIX@/etc/imapd.conf";
 
 $yn = "y";
 $sievedir = "/usr/sieve";
@@ -178,7 +178,7 @@
 }
 close CONF;
 
-if (! $conf) { $conf = "/var/imap"; }
+if (! $conf) { $conf = "@FINKPREFIX@/var/imap"; }
 
 if ($interactive) {
     print "upgrade $conf? ";
diff -Naur cyrus-imapd-2.2.12/tools/undohash cyrus-imapd-2.2.12.fink/tools/undohash
--- cyrus-imapd-2.2.12/tools/undohash	Sun May 26 04:57:53 2002
+++ cyrus-imapd-2.2.12.fink/tools/undohash	Tue Mar 22 00:41:25 2005
@@ -45,7 +45,7 @@
 
 $| = 1;
 
-$imapdconf = shift || "/etc/imapd.conf";
+$imapdconf = shift || "@FINKPREFIX@/etc/imapd.conf";
 $hashispool = 0;
 
 open CONF, $imapdconf or die "can't open $imapdconf";
diff -Naur cyrus-imapd-2.2.12/tools/upgradesieve cyrus-imapd-2.2.12.fink/tools/upgradesieve
--- cyrus-imapd-2.2.12/tools/upgradesieve	Fri Feb 23 13:46:56 2001
+++ cyrus-imapd-2.2.12.fink/tools/upgradesieve	Tue Mar 22 00:41:25 2005
@@ -85,7 +85,7 @@
     }
 }
 
-$imapdconf = shift || "/etc/imapd.conf";
+$imapdconf = shift || "@FINKPREFIX@/etc/imapd.conf";
 
 $sievedir = "/usr/sieve";
 
