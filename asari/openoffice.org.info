Info2: <<
Package: openoffice.org
Description: Integrated office productivity suite
Version: 2.0.0
Revision: 14rc1
License: LGPL
Maintainer: Todai Fink Team <fink@sodan.ecc.u-tokyo.ac.jp>

BuildDepends: <<
  x11-dev, ant, bison, fileutils, system-java14-dev,
  archive-zip-pm586,
  libjpeg, expat, freetype219, libwpd-0.8-dev, libxml2,
  db42-ssl | db42,
  libsablot-dev, libsablot, unixodbc2 | unixodbc2-nox,
  sane-backends, libcurl3-ssl | libcurl3,
  libsndfile1-dev,
  portaudio (>= 0.18.1-2), neon24-ssl | neon24,
  mozilla-dev, libart2,
  atk1, audiofile, esound, gconf2-dev, libgettext3-dev, glib2-dev,
  gnome-keyring-dev (>= 0.4.3-1), gnome-vfs2-ssl-dev | gnome-vfs2-dev,
  gtk+2-dev, libbonobo2-dev, libbonoboui2-dev, libglade2,
  libgnome2-dev, libgnomecanvas2-dev, libgnomeprint2.2-dev,
  libgnomeprintui2.2-dev, libgnomeui2-dev, libiconv-dev, 
  orbit2-dev, pango1-xft2-dev, pcre, pkgconfig, popt, vte-dev, 
  python24, 
  boost1.32-py23 | boost1.32-py24,
  autoconf2.5, gcc3.3
<<

Depends: <<
  x11, system-java14, system-perl,
  libjpeg-shlibs, expat-shlibs, libwpd-0.8-shlibs, libxml2-shlibs,
  db42-ssl-shlibs | db42-shlibs, db42-ssl-java,
  libsablot-shlibs, unixodbc2-shlibs | unixodbc2-nox-shlibs,
  sane-backends-shlibs, libcurl3-ssl-shlibs | libcurl3-shlibs,
  libsndfile1-shlibs,
  portaudio-shlibs (>= 0.18.1-2), neon24-ssl-shlibs | neon24-shlibs,
  python24-shlibs, 
  boost1.32-py23-shlibs | boost1.32-py24-shlibs, 
  mozilla-shlibs, mozilla-mailnews, libart2-shlibs,
  fondu
<<

# FIXME -- workaround
Replaces: <<
  openoffice.org-af, openoffice.org-ar, openoffice.org-bg,
  openoffice.org-ca, openoffice.org-cs, openoffice.org-cy,
  openoffice.org-da, openoffice.org-de, openoffice.org-el,
  openoffice.org-en-gb, openoffice.org-eo, openoffice.org-es,
  openoffice.org-et, openoffice.org-eu, openoffice.org-fi,
  openoffice.org-fr, openoffice.org-gl, openoffice.org-he,
  openoffice.org-hi-in, openoffice.org-hu, openoffice.org-it,
  openoffice.org-ja, openoffice.org-km, openoffice.org-kn-in,
  openoffice.org-ko, openoffice.org-lt, openoffice.org-ms,
  openoffice.org-nb, openoffice.org-nl, openoffice.org-nn,
  openoffice.org-ns, openoffice.org-pl, openoffice.org-pt,
  openoffice.org-pt-br, openoffice.org-ru, openoffice.org-sk,
  openoffice.org-sl, openoffice.org-sv, openoffice.org-th,
  openoffice.org-tn, openoffice.org-tr, openoffice.org-xh,
  openoffice.org-zh-cn, openoffice.org-zh-tw, openoffice.org-zu,
  openoffice.org
<<

CustomMirror: <<
#aus-AU: http://openoffice.mirrors.ilisys.com.au/contrib/rc/2.0.0rc1/
aus-AU: ftp://mirror.pacific.net.au/OpenOffice/contrib/rc/2.0.0rc1/
aus-AU: http://mirror.pacific.net.au/openoffice/contrib/rc/2.0.0rc1/
aus-AU: ftp://ftp.planetmirror.com/pub/openoffice/contrib/rc/2.0.0rc1/
aus-AU: http://public.planetmirror.com/pub/openoffice/contrib/rc/2.0.0rc1/
eur-AT: http://gd.tuwien.ac.at/office/openoffice/contrib/rc/2.0.0rc1/
eur-AT: ftp://gd.tuwien.ac.at/office/openoffice/contrib/rc/2.0.0rc1/
eur-BE: http://ftp.belnet.be/pub/mirror/ftp.openoffice.org/contrib/rc/2.0.0rc1/
eur-BE: ftp://ftp.scarlet.be/pub/openoffice/contrib/rc/2.0.0rc1/
eur-BE: http://ftp.scarlet.be/pub/openoffice/contrib/rc/2.0.0rc1/
eur-BE: ftp://ftp.openoffice.skynet.be/pub/ftp.openoffice.org/contrib/rc/2.0.0rc1/
sam-BR: http://linorg.usp.br/OpenOffice.org/contrib/rc/2.0.0rc1/
sam-BR: ftp://ftp.pucpr.br/openoffice/contrib/rc/2.0.0rc1/
nam-CA: ftp://openoffice.mirror.cygnal.ca/openoffice/contrib/rc/2.0.0rc1/
nam-CA: http://openoffice.mirror.cygnal.ca/contrib/rc/2.0.0rc1/
nam-CA: http://gulus.USherbrooke.ca/pub/appl/openoffice/contrib/rc/2.0.0rc1/
eur-CZ: http://ftp.sh.cvut.cz/MIRRORS/OpenOffice/contrib/rc/2.0.0rc1/
eur-CZ: ftp://ftp.sh.cvut.cz/MIRRORS/OpenOffice/contrib/rc/2.0.0rc1/
eur-DK: http://mirrors.sunsite.dk/openoffice/contrib/rc/2.0.0rc1/
eur-DK: ftp://sunsite.dk/mirrors/openoffice/contrib/rc/2.0.0rc1/
eur-FR: ftp://openoffice.cict.fr/openoffice/contrib/rc/2.0.0rc1/
eur-FR: ftp://ftp.free.fr/mirrors/ftp.openoffice.org/contrib/rc/2.0.0rc1/
eur-DE: ftp://ftp.tu-chemnitz.de/pub/openoffice/contrib/rc/2.0.0rc1/
eur-DE: ftp://sunsite.informatik.rwth-aachen.de/pub/mirror/OpenOffice/contrib/rc/2.0.0rc1/
eur-DE: ftp://ftp.leo.org/pub/comp/general/office/openoffice/contrib/rc/2.0.0rc1/
eur-DE: http://ftp.leo.org/pub/comp/general/office/openoffice/contrib/rc/2.0.0rc1/
eur-DE: ftp://ftp.join.uni-muenster.de/pub/software/OpenOffice/contrib/rc/2.0.0rc1/
eur-DE: ftp://openoffice.tu-bs.de/OpenOffice.org/contrib/rc/2.0.0rc1/
eur-DE: http://ftp.stardiv.de/pub/OpenOffice.org/contrib/rc/2.0.0rc1/
eur-DE: ftp://ftp-stud.fht-esslingen.de/pub/Mirrors/ftp.openoffice.org/contrib/rc/2.0.0rc1/
eur-DE: http://mirror.xaranet.de/openoffice/contrib/rc/2.0.0rc1/
eur-GR: http://www.ellak.gr/pub/openoffice/contrib/rc/2.0.0rc1/
eur-GR: http://ftp.ntua.gr/pub/openoffice/contrib/rc/2.0.0rc1/
eur-GR: ftp://ftp.ntua.gr/pub/openoffice/contrib/rc/2.0.0rc1/
eur-HU: http://ftp.fsf.hu/OpenOffice.org/contrib/rc/2.0.0rc1/
#eur-HU: ftp://ftp.fsf.hu/OpenOffice.org/
eur-IE: ftp://ftp.heanet.ie/mirrors/openoffice.org/contrib/rc/2.0.0rc1/
eur-IE: http://ftp.heanet.ie/mirrors/openoffice.org/contrib/rc/2.0.0rc1/
asi-JP: ftp://ftp.kddlabs.co.jp/office/openoffice/contrib/rc/2.0.0rc1/
asi-JP: http://www.ring.gr.jp/archives/misc/openoffice/contrib/rc/2.0.0rc1/
asi-JP: ftp://ftp.ring.gr.jp/pub/misc/openoffice/contrib/rc/2.0.0rc1/
#eur-LT: http://files.akl.lt/OpenOffice.org/
#asi-MY: http://mymirror.asiaosc.org/openoffice/contrib/rc/2.0.0rc1/
eur-NL: http://ftp.nluug.nl/pub/office/openoffice/contrib/rc/2.0.0rc1/
eur-NL: ftp://ftp.snt.utwente.nl/pub/software/openoffice/contrib/rc/2.0.0rc1/
eur-NL: http://vlaai.snt.utwente.nl/pub/software/openoffice/contrib/rc/2.0.0rc1/
eur-PL: ftp://ftp.man.poznan.pl/pub/openoffice/contrib/rc/2.0.0rc1/
eur-PL: ftp://ftp.openoffice.pl/OpenOffice.ORG/contrib/rc/2.0.0rc1/
#eur-PT: http://ftpdem.ubi.pt/OpenOffice
eur-PT: http://mirrors.oninet.pt/openoffice/contrib/rc/2.0.0rc1/
#eur-PT: http://tux.cprm.net/pub/openoffice.org/
#eur-PT: ftp://tux.cprm.net/pub/openoffice.org/
eur-RO: ftp://ftp.iasi.roedu.net/pub/mirrors/openoffice.org/contrib/rc/2.0.0rc1/
eur-RO: http://ftp.iasi.roedu.net/mirrors/openoffice.org/contrib/rc/2.0.0rc1/
eur-YU: ftp://mirror.etf.bg.ac.yu/openoffice.org/contrib/rc/2.0.0rc1/
eur-YU: http://mirror.etf.bg.ac.yu/openoffice/contrib/rc/2.0.0rc1/
asi-SG: ftp://mirror.averse.net/pub/openoffice/contrib/rc/2.0.0rc1/
asi-SG: http://mirror.averse.net/openoffice/contrib/rc/2.0.0rc1/
eur-SI: ftp://ftp.bevc.net/mirrors/openoffice/contrib/rc/2.0.0rc1/
eur-SI: http://mirrors.bevc.net/openoffice/contrib/rc/2.0.0rc1/
eur-SI: http://www.wsection.com/openoffice/contrib/rc/2.0.0rc1/
asi-KR: ftp://ftp.kr.freebsd.org/pub/openoffice/contrib/rc/2.0.0rc1/
eur-ES: http://ftp.rediris.es/ftp/mirror/openoffice.org/contrib/rc/2.0.0rc1/
eur-ES: ftp://ftp.rediris.es/mirror/openoffice.org/contrib/rc/2.0.0rc1/
eur-SE: http://ftp.sunet.se/pub/Office/OpenOffice.org/contrib/rc/2.0.0rc1/
eur-CH: ftp://sunsite.cnlab-switch.ch/mirror/OpenOffice/contrib/rc/2.0.0rc1/
eur-CH: http://mirror.switch.ch/ftp/mirror/openoffice/contrib/rc/2.0.0rc1/
eur-CH: ftp://mirror.switch.ch/mirror/openoffice/contrib/rc/2.0.0rc1/
eur-UK: http://www.mirror.ac.uk/mirror/sunsite.dk/openoffice/contrib/rc/2.0.0rc1/
#eur-UK: ftp://mirrors.blueyonder.co.uk/sites/openoffice.org
#eur-UK: http://openoffice.blueyonder.co.uk
eur-UK: ftp://ftp.mirror.ac.uk/mirror/sunsite.dk/openoffice/contrib/rc/2.0.0rc1/
eur-UK: http://www.mirror.ac.uk/mirror/sunsite.dk/openoffice/contrib/rc/2.0.0rc1/
nam-US: http://www.binarycode.org/openoffice/contrib/rc/2.0.0rc1/
nam-US: http://mirrors.ibiblio.org/pub/mirrors/openoffice/contrib/rc/2.0.0rc1/
nam-US: ftp://ftp.ibiblio.org/pub/mirrors/openoffice/contrib/rc/2.0.0rc1/
nam-US: ftp://ftp.ussg.iu.edu/pub/openoffice/contrib/rc/2.0.0rc1/
nam-US: http://mirrors.isc.org/pub/openoffice/contrib/rc/2.0.0rc1/
nam-US: http://www.online-mirror.org/openoffice/contrib/rc/2.0.0rc1/
nam-US: ftp://openoffice.mirrors.pair.com/contrib/rc/2.0.0rc1/
nam-US: http://openoffice.mirrors.pair.com/contrib/rc/2.0.0rc1/
nam-US: ftp://openofficeorg.secsup.org/pub/software/openoffice/contrib/rc/2.0.0rc1/
nam-US: http://openofficeorg.secsup.org/contrib/rc/2.0.0rc1/
nam-US: http://openoffice.mirror.wrpn.net/contrib/rc/2.0.0rc1/
asi-TW: ftp://ftp.nctu.edu.tw/UNIX/OpenOffice/contrib/rc/2.0.0rc1/
<<
Source: mirror:custom:OOo_%vrc1_050928_src.tar.gz
SourceDirectory: OOo_%v_src
Source-MD5: 994f41c050885cef0521d2a75fd32477

PatchScript: <<
  /usr/bin/patch -p0 < %a/%n.patch
  /usr/bin/patch -f -p0 < %a/%n.macosx.patch || true
<<

SetCC: gcc-3.3
SetCXX: g++-3.3
SetCPPFLAGS: -I%p/include/db4 -I%p/include/boost
ConfigureParams: <<
  --with-gnu-cp=%p/bin/cp \
  --with-package-format=portable \
  --with-x --x-includes=/usr/X11R6/include --x-libraries=/usr/X11R6/lib \
  --with-jdk-home=/Library/Java/Home --with-ant-home=%p/lib/ant \
  --disable-crashdump \
  --with-build-version="%v-%r; Built with Fink <http://fink.sourceforge.net>" \
  --enable-libart \
  --enable-pasf \
  --with-system-db \
  --with-db-jar=%p/share/java/db42-ssl-java/db.jar \
  --with-system-libwpd \
  --with-system-sablot \
  --with-system-odbc-headers \
  --with-system-sane-header \
  --with-system-xrender-headers \
  --with-system-curl \
  --with-system-sndfile \
  --with-system-portaudio \
  --with-system-neon \
  --with-system-stdlibs \
  --with-system-zlib \
  --with-system-jpeg \
  --with-system-expat \
  --with-system-mozilla \
  --enable-gtk \
  --with-system-freetype \
  \
  --with-system-boost \
  --without-nas
<<
#  --with-system-python
#  --with-system-libxml \

GCC: 3.3
CompileScript: <<
  #!/bin/bash

  set -e

  echo "[ Message from OpenOffice.org package maintainer ] ================="
  echo
  echo "Welcome to OpenOffice.org build script!"
  echo
  echo "Notice for builders:"
  echo
  echo "1. This building process may take a couple of day or more,"
  echo "   and often fails with errors."
  echo "2. This building process may consume much of your disk space,"
  echo "   possibly up to 10GB."
  echo "3. This building process needs your own WindowServer process."
  echo "   i.e, it is not possible to build through simple SSH connection."
  echo "   This is because the building process uses /usr/bin/osacompile ."
  echo "   (This limitation would be removed in the future release.)"
  echo
  echo "If you faced a building problem, feel free to mail the maintainer,"
  echo "preferably with your environment (gcc-3.3's version, etc.) and"
  echo "the build log."
  echo "You can find the logs here:"
  echo "   %b/%n-%v-%r.buildlog"
  echo
  echo "The mail address is: Todai Fink Team <fink@sodan.ecc.u-tokyo.ac.jp>"
  echo
  echo "Please understand this Fink package is still unstable."
  echo
  echo "===================================================================="
  echo
  echo "If you are ready, press RETURN/ENTER to proceed..."

  read -t 60 || true

  echo

  # Record the time
  STARTTIME=`/bin/date +"%%F %%T %%Z(%%z)"`

  set -v

  # $X_LDFLAGS is needed to configure with X correctly.  
  export X_LDFLAGS=$LDFLAGS

  # $PKG_CONFIG_PATH is needed to configure with freetype219
  export PKG_CONFIG_PATH=%p/lib/freetype219/lib/pkgconfig

  /usr/bin/printf "[ Phase 1: Configure ]\n\n" >> %n-%v-%r.buildlog
  (cd config_office && autoconf && ./configure %c) 2>&1 |
    /usr/bin/tee -a %n-%v-%r.buildlog

  /usr/bin/printf "\n\n[ Phase 2: Bootstrap ]\n\n" >> %n-%v-%r.buildlog
  ./bootstrap 2>&1 |
    /usr/bin/tee -a %n-%v-%r.buildlog

  # Because we are using %p, $SOLARINC and $SOLARLIB need modified  
  # Include libdb_java-4.2.jnilib to DYLD_LIBRARY_PATH so that Java can find it
  /usr/bin/sed -i.bak \
    -e"/^SOLARLIB/s|-L/usr/lib|-L%p/lib/freetype219/lib -L%p/lib -L/usr/lib|" \
    -e"/^SOLARINC/s|-I/usr/X11R6/include -I/usr/X11R6/include/freetype2|-I%p/include/db4 -I%p/lib/freetype219/include/freetype2 -I%p/lib/freetype219/include -I%p/include -I/usr/X1186/include|" \
    -e"/^DYLD_LIBRARY_PATH/s|/lib|/lib:%b/FINKLIBS|" \
    MacosxEnv.Set.sh

  /bin/mkdir FINKLIBS
  /bin/ln -s %p/lib/libdb_java-4.2.jnilib FINKLIBS

  # Retry forever to build OOo until success!
  until [ -n "$succeeded" ]; do
    /usr/bin/printf "\n\n[ Phase 3: Make ]\n\n" >> %n-%v-%r.buildlog
    . MacosxEnv.Set.sh
    dmake 2>&1 | /usr/bin/tee -a %n-%v-%r.buildlog
    if [ ${PIPESTATUS[0]} == 0 ]; then
      succeeded=TRUE
      continue
    fi
    echo
    echo "[ Message from OpenOffice.org package maintainer ] ================="
    echo
    echo "Building OpenOffice.org faild with an error."
    echo "Now you can get rid of the cause by hand, or call for help."
    echo "The build directory is:"
    echo "  %b"
    echo "and the full log file is available here:"
    echo "  %b/%n-%v-%r.buildlog"
    echo
    echo "===================================================================="
    echo
    echo "Press RETURN/ENTER to exit or input any key to restart dmake..."
    read input
    [ -n "$input" ] || false
  done

  set +v

  echo
  echo "[ Message from OpenOffice.org package maintainer ] ================="
  echo
  echo "Congratulations!"
  echo "The building process of OpenOffice.org has completed!"
  echo "   Started:   $STARTTIME"

  ENDTIME=`/bin/date +"%%F %%T %%Z(%%z)"`

  echo "   Completed: $ENDTIME"

  DISKUSAGE=`/usr/bin/du -sh %b | /usr/bin/cut -f1`

  echo "   $DISKUSAGE is used for this building process (not including tarball)."
  echo
  echo "===================================================================="
  echo
<<

InstallScript: <<
  #!/bin/bash -ev
  for i in instsetoo_native/unxmacxp.pro/OpenOffice/install/en-US/darwin-*/*.sw; do
    /usr/bin/tar xf $i -C %i
  done
  /bin/mv %i/{Applications,lib}
  /bin/mv %i/lib/{openoffice.org*,%n}

  /bin/rm instsetoo_native/unxmacxp.pro/OpenOffice/install/en-US_temp/OpenOffice.org\ 2.0.app/Contents/openoffice.org
  /bin/ln -s %p/lib/%n instsetoo_native/unxmacxp.pro/OpenOffice/install/en-US_temp/OpenOffice.org\ 2.0.app/Contents/

  /usr/bin/install -m 755 -d %i/bin
  /bin/ln -s %p/lib/%n/program/{sbase,scalc,sdraw,simpress,smath,soffice,swriter} %i/bin

  /bin/ln -s %p/lib/libdb_java-4.2.jnilib %i/lib/%n/program

  /usr/bin/install -m 755 -d %i/share/doc/%n
  /bin/cp %i/lib/%n/LICENSE %i/share/doc/%n/LICENSE

  # Currently, Fink cannot handle "OpenOffice.org 2.0.app" (which contains space character) ?
  /usr/bin/install -d -m 755 %i/Applications
  /bin/cp -pR "instsetoo_native/unxmacxp.pro/OpenOffice/install/en-US_temp/OpenOffice.org 2.0.app" '%i/Applications/'
  /bin/chmod -R o-w '%i/Applications/'
  [ -x /Developer/Tools/SplitForks ] && /Developer/Tools/SplitForks '%i/Applications/'
<<
#AppBundles: instsetoo_native/unxmacxp.pro/OpenOffice/install/en-US_temp/OpenOffice.org*.app
PostInstScript: <<
  cd %p/lib/openoffice.org/share/fonts/truetype
  if [ -e .fondudone ]; then
    echo "Fonts seems to be already converted. skipping..."
  else
    echo "Converting Mac OS X fonts..."
    /usr/bin/touch .fondudone
    for font in /System/Library/Fonts/* /Library/Fonts/*; do
      %p/bin/fondu --force "$font" || true
    done
  fi    
  
  [ ! -e /Applications/Fink ] && /usr/bin/install -d -m 755 /Applications/Fink
  /bin/ln -s '%p/Applications/OpenOffice.org 2.0.app' /Applications/Fink/
<<
PostRmScript: /bin/rm -f '/Applications/Fink/OpenOffice.org 2.0.app'

Homepage: http://www.openoffice.org/

DescDetail: <<
OpenOffice.org is an Open Source, community-developed, multi-platform office
productivity suite. It includes the key desktop applications, such as a
word processor, spreadsheet, presentation manager, and drawing program,
with a user interface and feature set similar to other office suites.

Components include:
  * A universal word processing application for creating business
    letters, extensive text documents, professional layouts, and HTML
    documents.
  * A sophisticated application for performing advanced spreadsheet
    functions, such as analyzing figures, creating lists, and viewing data.
  * A tool for creating effective eye-catching presentations.
  * A vector-oriented draw module that enables the creation of 3D
    illustrations.
<<
DescPort: <<
This package is advised by NAKATA Maho <maho@FreeBSD.org>.
And furthermore, many many advice from ssa, _rene_, ericb2, and paveljanik
of #OpenOffice.org at irc.freenode.net. Thanks to all OOo persons!

You can join discussions on porting here:
http://porting.openoffice.org/servlets/SummarizeList?listName=dev

It is reported that:
  * Mac OS X SDK (which comes with Xcode) is needed.
  * Sometimes checking getaddrinfo() fails on configuring python (on Panther?).
  * %p/lib/openoffice.org/presets/config/standard.sog conflicts some of
    language packs.

Because DYLD_LIBRARY_PATH does not contain %p/lib by default,
Java cannot find %p/lib/libdb_java-4.2.jnilib at compile time and runtime.
This script tries to make a symlink of it in %p/lib/openoffice.org/programs.
<<
DescPackaging: <<
To Do 0: Enable system Python and libxml2
  ( --with-system-python and --with-system-libxml2 )
Fails on building instsetooo_native... 

To Do 1: Use Startup Notification
  ( --enable-libsn )
Available in Fink as "startup-notification-shlibs"

To Do 2: Report build failures on building nas (Network Audio System)
  ( --without-nas or --with-system-nas )
with internal nas, build fails on Panther. 
See: OpenOffice.org-2.0.0-1rc1.nazuna.0.buildlog

To Do 3: Font setting in PostInstScript
See: DescUsage

"boost" is required on compile time, but not needed on runtime.

These --with-system flags are not used because they are not in Fink:
   --with-system-mspack
   --with-system-myspell
   --with-system-mythes
   --with-system-altlinuxhyph
   --enable-evolution2

I have no idea about openldap. Maybe mozilla is enough?
   --enable-openldap

Some comments about configure logs:
# checking whether to enable fontconfig support... no
Using fontconfig is not supported on Mac OS X.

# checking whether to build Mozilla addressbook connectivity... no, not possible with system-mozilla
# checking whether to use Mozilla or Firefox... Mozilla
Shall I use Firefox instead of Mozilla?
<<
DescUsage: <<
To start OpenOffice.org, type "soffice" on your terminal,
or double-click "OpenOffice.org 2.0.app" icon located at /Applications/Fink .

To use GTK+ look and feel,
set SAL_USE_VCLPLUGIN environmental variable to "gtk".

To use system fonts which come with Mac OS X, execute these lines:
  cd %p/lib/openoffice.org/share/fonts/truetype
  for font in /Library/Fonts/*; do
    /sw/bin/fondu --force "$font"
  done
  for font in /System/Library/Fonts/*; do
    /sw/bin/fondu --force "$font"
  done
<<
<<
