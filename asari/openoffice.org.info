Info2: <<
Package: openoffice.org
Description: Integrated office productivity suite
Version: 1.9m131-2.0rc1
Revision: 3
License: LGPL
Maintainer: Todai Fink Team <fink@sodan.ecc.u-tokyo.ac.jp>

BuildDepends: <<
  x11-dev, ant, bison, fileutils, system-java14-dev,
  archive-zip-pm586,
  libjpeg, expat, freetype219, libwpd-0.8-dev, libxml2,
  db42-ssl | db42,
  libsablot-dev, libsablot, unixodbc2 | unixodbc2-nox,
  sane-backends, libcurl3-ssl | libcurl3,
  libsndfile1-dev,
  portaudio, neon24-ssl | neon24,
  mozilla-dev, libart2,
  atk1, audiofile, esound, gconf2-dev, libgettext3-dev, glib2-dev,
  gnome-keyring-dev (>= 0.4.3-1), gnome-vfs2-ssl-dev | gnome-vfs2-dev,
  gtk+2-dev, libbonobo2-dev, libbonoboui2-dev, libglade2,
  libgnome2-dev, libgnomecanvas2-dev, libgnomeprint2.2-dev,
  libgnomeprintui2.2-dev, libgnomeui2-dev, libiconv-dev, 
  orbit2-dev, pango1-xft2-dev, pcre, pkgconfig, popt, vte-dev, 
  python24, 
  boost1.32-py23 | boost1.32-py24,
  autoconf2.5
<<

Depends: <<
  x11, system-java14, system-perl,
  libjpeg-shlibs, expat-shlibs, libwpd-0.8-shlibs, libxml2-shlibs,
  db42-ssl-shlibs | db42-shlibs, db42-ssl-java,
  libsablot-shlibs, unixodbc2-shlibs | unixodbc2-nox-shlibs,
  sane-backends-shlibs, libcurl3-ssl-shlibs | libcurl3-shlibs,
  libsndfile1-shlibs,
  portaudio-shlibs, neon24-ssl-shlibs | neon24-shlibs,
  python24-shlibs, 
  boost1.32-py23-shlibs | boost1.32-py24-shlibs, 
  mozilla-shlibs, mozilla-mailnews, libart2-shlibs
<<
Source: ftp://ooopackages.good-day.net/pub/OpenOffice.org/sources/OOo_2.0RC1_source.tar.bz2
Source-MD5: 8ac07e6d1d11476144afc6542bb50191
NoSourceDirectory: true

PatchScript: <<
  /usr/bin/patch -p0 < %a/%n.patch
  /usr/bin/patch -p0 < %a/%n.experimental.patch || true
<<

SetCC: gcc-3.3
SetCXX: g++-3.3
SetCPPFLAGS: -I%p/include/db4 -I%p/include/boost
ConfigureParams: <<
  --with-gnu-cp=%p/bin/cp \
  --with-package-format=portable \
  --with-x --x-includes=/usr/X11R6/include --x-libraries=/usr/X11R6/lib \
  --with-jdk-home=/Library/Java/Home --with-ant-home=%p/lib/ant \
  --disable-crashdump \
  --with-build-version="%v-%r; Built with Fink <http://fink.sourceforge.net>" \
  --enable-libart \
  --with-system-db \
  --with-db-jar=%p/share/java/db42-ssl-java/db.jar \
  --with-system-libwpd \
  --with-system-sablot \
  --with-system-odbc-headers \
  --with-system-sane-header \
  --with-system-xrender-headers \
  --with-system-curl \
  --with-system-sndfile \
  --with-system-portaudio \
  --with-system-neon \
  --with-system-stdlibs \
  --with-system-zlib \
  --with-system-jpeg \
  --with-system-expat \
  --with-system-mozilla
<<
#  --with-system-boost \
#  --with-system-python
#  --enable-gtk \
#  --with-system-freetype \
#  --with-system-libxml \

GCC: 3.3
CompileScript: <<
  #!/bin/bash

  set -e

  echo "Welcome to OpenOffice.org build script!"
  echo ""
  echo "1. This building process may take a week or more,"
  echo "   and often fails with an error."
  echo "2. This building process may consume much of your disk space,"
  echo "   possibly up to 10GB."
  echo "3. This building process needs your own WindowServer process."
  echo "   i.e, it is not possible to build through simple SSH connection."
  echo "   This is because the building process uses /usr/bin/osacompile ."
  echo ""
  echo "If you faced a building problem, feel free to mail the maintainer,"
  echo "with your build log. You can obtain the log by executing this line:"
  echo "   /usr/bin/tail -1000 %b/%n-%v-%r.buildlog |"
  echo "      bzip2 > ~/Desktop/%n-%v-%r.buildlog.tail.bz2"
  echo "(Note: execute the command in one line.)"
  echo ""
  echo "The mail address is: Todai Fink Team <fink@sodan.ecc.u-tokyo.ac.jp>"
  echo ""
  echo "Please understand this Fink package is still experimental."
  echo ""
  echo "If you are ready, press RETURN/ENTER to proceed..."

  read -t 60 || true

  # Record the time
  STARTTIME=`/bin/date +"%%F %%T %%Z(%%z)"`

  set -v

  # $X_LDFLAGS is needed to configure X correctly.  
  export X_LDFLAGS=$LDFLAGS

  # $PKG_CONFIG_PATH is needed to configure freetype219; not working?
  export PKG_CONFIG_PATH=%p/lib/freetype219/lib/pkgconfig

  (cd config_office && autoconf && ./configure %c) 2>&1 | /usr/bin/tee -a %n-%v-%r.buildlog
  ./bootstrap                                      2>&1 | /usr/bin/tee -a %n-%v-%r.buildlog
  . MacosxEnv.Set.sh

  # Because we are using %p, $SOLARINC and $SOLARLIB need modified  
  export SOLARINC=`echo $SOLARINC | /usr/bin/sed -e"s|-I/usr/X11R6/include -I/usr/X11R6/include/freetype2|-I%p/include/db4 -I%p/lib/freetype219/include/freetype2 -I%p/lib/freetype219/include -I%p/include -I/usr/X1186/include|g"`
  export SOLARLIB=`echo $SOLARLIB | /usr/bin/sed -e"s|-L/usr/lib|-L%p/lib/freetype219/lib -L%p/lib -L/usr/lib|g"`

  # Include libdb_java-4.2.jnilib to DYLD_LIBRARY_PATH so that Java can find it
  /bin/mkdir FINKLIBS
  /bin/ln -s %p/lib/libdb_java-4.2.jnilib FINKLIBS
  export DYLD_LIBRARY_PATH="$DYLD_LIBRARY_PATH:%b/FINKLIBS"

  # Retry forever to build OOo until success!
  until [ -n "$succeeded" ]; do
    dmake 2>&1 | /usr/bin/tee -a %n-%v-%r.buildlog
    if [ ${PIPESTATUS[0]} == 0 ]; then
      succeeded=TRUE
      continue
    fi
    set > %n-%v-%r.env.sh
    echo "Build faild with an error."
    echo "Now you can get rid of the cause by hand, or call for help."
    echo "The build directory is:"
    echo "  %b"
    echo "Environmental variable is available here:"
    echo "  %b/%n-%v-%r.env.sh"
    echo "and the full log file is available here:"
    echo "  %b/%n-%v-%r.buildlog"
    echo ""
    echo "Press RETURN/ENTER to exit or input any key to restart dmake..."
    read input
    [ -n "$input" ] || false
  done

  set +v
  # Record the time and disk usage
  ENDTIME=`/bin/date +"%%F %%T %%Z(%%z)"`
  DISKUSAGE=`/usr/bin/du -sh %b | /usr/bin/cut -f1`

  echo "Congratulations! The building process of OpenOffice.org has completed!"
  echo "   Started: $STARTTIME, Completed: $ENDTIME"
  echo "   $DISKUSAGE is used for this building process (not including tarball)."
<<

InstallScript: <<
  #!/bin/bash -ev
  for i in instsetoo_native/unxmacxp.pro/OpenOffice/install/en-US/darwin-*/*.sw; do
    /usr/bin/tar xf $i -C %i
  done
  /bin/mv %i/{Applications,lib}
  /bin/mv %i/lib/{openoffice.org*,%n}

  /usr/bin/install -m 755 -d %i/bin
  /bin/ln -s %p/lib/%n/program/{sbase,scalc,sdraw,simpress,smath,soffice,swriter} %i/bin

  /bin/ln -s %p/lib/libdb_java-4.2.jnilib %i/lib/%n/program

  /usr/bin/install -m 755 -d %i/share/doc/%n
  /bin/cp %i/lib/%n/LICENSE %i/share/doc/%n/LICENSE
<<

Homepage: http://www.openoffice.org/

DescDetail: <<
OpenOffice.org is an Open Source, community-developed, multi-platform office
productivity suite. It includes the key desktop applications, such as a
word processor, spreadsheet, presentation manager, and drawing program,
with a user interface and feature set similar to other office suites.

Components include:
  * A universal word processing application for creating business
    letters, extensive text documents, professional layouts, and HTML
    documents.
  * A sophisticated application for performing advanced spreadsheet
    functions, such as analyzing figures, creating lists, and viewing data.
  * A tool for creating effective eye-catching presentations.
  * A vector-oriented draw module that enables the creation of 3D
    illustrations.
<<
DescPort: <<
This package is advised by NAKATA Maho <maho@FreeBSD.org>.
And furthermore, many many advice from ssa, _rene_, ericb2, and paveljanik
of #OpenOffice.org at irc.freenode.net. Thanks to all OOo persons!

You can join discussions on porting here:
http://porting.openoffice.org/servlets/SummarizeList?listName=dev

It is reported that:
  * Mac OS X SDK (which comes with Xcode) is needed.
  * Sometimes checking getaddrinfo() fails on configuring python (on Panther?).
  * %p/lib/openoffice.org/presets/config/standard.sog conflicts some of
    language packs.

Because DYLD_LIBRARY_PATH does not contain %p/lib by default,
Java cannot find %p/lib/libdb_java-4.2.jnilib at compile time and runtime.
This script tries to make a symlink of it in %p/lib/openoffice.org/programs.
<<
DescPackaging: <<
To Do & Memo:
# --with-system-mspack       # not in Fink
# --with-system-nas          # not in Fink
# --with-system-myspell      # not in Fink
# --with-system-mythes       # not in Fink
# --with-system-altlinuxhyph # not in Fink
# --with-system-python       # TO DO 3 : fails building instsetooo_native?
# actually link with system freetype    # TO DO 1

# --enable-openldap          # not needed?
# --enable-libsn             # libstartup-notification is not in Fink
# --enable-evolution2        # evolution2 not in Fink

# checking whether to enable fontconfig support... no
# checking whether to build Mozilla addressbook connectivity... no, not possible with system-mozilla
# checking whether to use Mozilla or Firefox... Mozilla
<<
DescUsage: <<
export SAL_USE_VCLPLUGIN="gtk" enables the use of GTK+ UI plugin?
<<
<<
