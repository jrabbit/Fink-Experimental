Package: fuse
Version: 0.1.0b006
Revision: 1
Source: http://dev.kublai.com/macfuse-%v.tar.gz
Source-MD5: 3e481d7f966c53508930cf8a7def9c17
Source2: mirror:sourceforge:%n/%n-2.6.1.tar.gz
Source2-MD5: 13e1873086a1d7a95f470bbc7428c528

Shlibs: <<
  %p/lib/libfuse.0.dylib 1.0.0 %n (>= 0.1.0b006-1)
  %p/lib/libulockmgr.1.dylib 2.0.0 %n (>= 0.1.0b006-1)
<<

PatchScript: <<
sed -i.bak -e 's,/System/Library/Extensions/,%p/lib/%n/,' fusefs/load/load_fusefs.c
sed -i.bak -e 's,/System/Library/Extensions/,%p/lib/%n/,' libfuse/fuse-2.6.1-macosx.patch
cd ../fuse-2.6.1 && patch -p1 < ../macfuse-%v/libfuse/fuse-2.6.1-macosx.patch
<<
CompileScript: <<
#!/bin/sh -ev
cd fusefs
xcodebuild -target fusefs -configuration Release
xcodebuild -target load_fusefs -configuration Release
xcodebuild -target mount_fusefs -configuration Release
cd ../../fuse-2.6.1
CFLAGS="-D__FreeBSD__=10 -O -g" ./configure --prefix=%p --disable-dependency-tracking
make
<<
InstallScript: <<
mkdir -p %i/lib/%n
cp -R fusefs/build/Release/fusefs.kext %i/lib/%n
cp fusefs/build/Release/load_fusefs %i/lib/%n/fusefs.kext/Contents/Resources/
# TODO: figure out where else we can put this
mkdir -p %i/sbin
cp fusefs/build/Release/mount_fusefs %i/sbin
#cp fusefs/build/Release/mount_fusefs fusefs/fusefs.fs/
#ln -s /System/Library/Filesystems/fusefs.fs/mount_fusefs %i/sbin
#mkdir -p %d/System/Library/Filesystems
#cp -R fusefs/fusefs.fs %d/System/Library/Filesystems/
cd ../fuse-2.6.1 && make install DESTDIR=%d
<<
PostInstScript: <<
chown -R root:wheel %p/lib/%n/fusefs.kext
#chown -R root:wheel /System/Library/Filesystems/fusefs.fs
chmod u+s %p/lib/%n/fusefs.kext/Contents/Resources/load_fusefs
<<
DocFiles: COPYING HOWTO

SplitOff: <<
  Package: fuse-dev
  Depends: fuse (= %v-%r), pkgconfig
  BuildDependsOnly: True
  DocFiles: COPYING
  Files: <<
    include 
    lib/libfuse.dylib lib/libfuse.a
    lib/libulockmgr.dylib lib/libulockmgr.a
    lib/pkgconfig
  <<
<<

Description: File systems in userspace
DescDetail: <<
This is MacFUSE, a port of FUSE (file systems in user space) for OS X.
<<
DescPort: <<
Use "sude daemonic enable fuse" to load the FUSE kernel module automatically.
<<
License: BSD
Maintainer: Brendan Cully <bcully@users.sourceforge.net>
