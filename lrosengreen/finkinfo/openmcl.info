Package: openmcl
Version: 0.14.2.040914
Revision: 10
Description: ANSI Common Lisp implementation
License: LGPL
Maintainer: Lars Rosengreen <lars@margay.org>

Source: http://www.margay.org/fink/%n-cvs-%v.tar.bz2
Source2: ftp://clozure.com/pub/%n-darwinppc-bin-0.14.2-p1.tar.gz
Source3: ftp://clozure.com/pub/%n-darwin-interfaces-040505.tar.gz

Source-MD5:  192b405923015aed8a73be24a4ff321b
Source2-MD5: a984baf2c55293baac14314d61c203b0
Source3-MD5: b66cda4edbf5e18baa54dae060e30f37

SourceDirectory: ccl

PatchScript: sed -e 's|@PREFIX@|%p|g' -e 's|@DATE@|'`echo %v | awk -F'[^0-9]+' '{ print $NF }'`'|g' <%a/%n.patch | patch -p1

CompileScript: <<
  cd lisp-kernel/darwin ; make
  echo '(ccl::xload-level-0 :force)' | ./dppccl --batch
  echo '(ccl::compile-ccl)' | ./dppccl --batch
  echo '(ccl::save-application "dppccl.image")' | ./dppccl --batch --image-name ppc-boot.image
<<

InstallScript: <<
  find %b -type d -name CVS -depth -exec rm -rf {} \;
  find %b -type f -name .cvsignore -exec rm -f {} \;
  install -m 755 -d %i/bin
  echo '#! /bin/sh' >> %i/bin/%n
  echo 'CCL_DEFAULT_DIRECTORY=%p/lib/%n/ccl exec %p/lib/%n/ccl/dppccl $@' >> %i/bin/%n
  chmod +x %i/bin/%n
  install -m 755 -d %i/lib/%n/ccl

  install -m 755 dppccl %i/lib/%n/ccl
  install -m 644 dppccl.image %i/lib/%n/ccl
  
  install -m 755 -d %i/lib/%n/ccl/tools
  install -m 644 tools/*.dfsl %i/lib/%n/ccl/tools
  
  cp -Rp darwin-headers %i/lib/%n/ccl
  cp -Rp examples %i/lib/%n/ccl
  cp -Rp OpenMCL.app %i/lib/%n/ccl
  cp -Rp library %i/lib/%n/ccl
<<

DocFiles: LGPL LICENSE ChangeLog

Homepage: http://openmcl.clozure.com/

DescDetail: <<
  A free ANSI Common Lisp implementation for the Macintosh with
  several advanced features including native (POSIX) threading,
  support for most of AMOP, and an elegant interface to
  Objective-C/Cocoa.

  The Fink package incorporates recent bug fixes committed to
  OpenMCL's upstream stable CVS tree and has support for using REQUIRE
  with ASDF systems.
<< 

DescPackaging: << 
  * Derived from the DarwinPorts package for OpenMCL originally
    created by Gregory Wright

  * This package roughly tracks the ccl-14 stable CVS tree at
    :pserver:cvs@clozure.com:/usr/local/tmpcvs/ccl-0.14

  * OpenMCL.app is not a normal application.  It is part of OpenMCL's
    support for Cocoa, and needs to go in %p/lib/%n/ccl.

  * The sed/awk stuff in PatchScript is kind of yucky -- its there to
    get the date of the CVS snapshot into ccl:*openmcl-version*

  * Does not install asdf-install -- users who want this feature
    should install cl-asdf-openmcl instead.

  * tools/asdf.lisp has been patched to provide an SBCL style REQUIRE
    mechanism for ASDF systems, and to add
    #P"%p/lib/common-lisp/openmcl/systems/" to asdf:*central-registry*
<<
