diff -uNr openldap-2.2.26/build/ltmain.sh openldap-2.2.26-new/build/ltmain.sh
--- openldap-2.2.26/build/ltmain.sh	2005-01-20 12:00:55.000000000 -0500
+++ openldap-2.2.26-new/build/ltmain.sh	2005-08-29 14:13:15.000000000 -0400
@@ -1773,7 +1773,7 @@
 
 	  if test "$installed" = no; then
 	    notinst_deplibs="$notinst_deplibs $lib"
-	    need_relink=yes
+	    need_relink=no
 	  fi
 
 	  if test -n "$old_archive_from_expsyms_cmds"; then
diff -uNr openldap-2.2.26/build/top.mk openldap-2.2.26-new/build/top.mk
--- openldap-2.2.26/build/top.mk	2005-01-20 12:00:55.000000000 -0500
+++ openldap-2.2.26-new/build/top.mk	2005-08-29 14:19:43.000000000 -0400
@@ -69,7 +69,7 @@
 LIBTOOL = @LIBTOOL@
 LIBRELEASE = @OPENLDAP_LIBRELEASE@
 LIBVERSION = @OPENLDAP_LIBVERSION@
-LTVERSION = -release $(LIBRELEASE) -version-info $(LIBVERSION)
+LTVERSION = -version-info $(LIBVERSION)
 
 # libtool --only flag for libraries: platform specific
 NT_LTONLY_LIB = # --only-$(BUILD_LIBS_DYNAMIC)
@@ -199,7 +199,7 @@
 DEFS = $(LDAP_INCPATH) $(XINCPATH) $(XDEFS) $(AC_DEFS) $(DEFINES)
 CFLAGS = $(AC_CFLAGS) $(DEFS)
 LDFLAGS = $(LDAP_LIBPATH) $(AC_LDFLAGS) $(XLDFLAGS)
-LIBS = $(XLIBS) $(XXLIBS) $(AC_LIBS) $(XXXLIBS)
+LIBS = $(XLIBS) $(XXLIBS) $(XXXLIBS) $(AC_LIBS)
 
 LT_CFLAGS = $(AC_CFLAGS)
 LT_CPPFLAGS = $(DEFS)
diff -uNr openldap-2.2.26/build/version.sh openldap-2.2.26-new/build/version.sh
--- openldap-2.2.26/build/version.sh	2005-01-20 12:00:55.000000000 -0500
+++ openldap-2.2.26-new/build/version.sh	2005-08-29 15:07:44.000000000 -0400
@@ -1,45 +1,32 @@
 #! /bin/sh
-# $OpenLDAP: pkg/ldap/build/version.sh,v 1.8.2.6 2005/01/20 17:00:55 kurt Exp $
-## This work is part of OpenLDAP Software <http://www.openldap.org/>.
-##
-## Copyright 1998-2005 The OpenLDAP Foundation.
-## All rights reserved.
-##
-## Redistribution and use in source and binary forms, with or without
-## modification, are permitted only as authorized by the OpenLDAP
-## Public License.
-##
-## A copy of this license is available in the file LICENSE in the
-## top-level directory of the distribution or, alternatively, at
-## <http://www.OpenLDAP.org/license.html>.
-
+# $OpenLDAP: pkg/ldap/build/version.sh,v 1.5.2.39 2003/03/29 15:45:42 kurt Exp $
+## Copyright 2000-2003 The OpenLDAP Foundation
+## COPYING RESTRICTIONS APPLY.  See COPYRIGHT File in top level directory
+## of this package for details.
+#
 DIR=`dirname $0`
 . $DIR/version.var
 
 if test $ol_patch != X ; then
 	ol_version=${ol_major}.${ol_minor}.${ol_patch}
-	ol_api_lib_release=${ol_major}.${ol_minor}
 	ol_type=Release
 elif test $ol_minor != X ; then
 	ol_version=${ol_major}.${ol_minor}.${ol_patch}
-	ol_api_lib_release=${ol_major}.${ol_minor}-releng
 	ol_type=Engineering
 else
 	ol_version=${ol_major}.${ol_minor}
-	ol_api_lib_release=${ol_major}-devel
 	ol_type=Devel
+	ol_api_lib=0:0:0
 fi
 
 ol_string="${ol_package} ${ol_version}-${ol_type}"
-ol_api_lib_version="${ol_api_current}:${ol_api_revision}:${ol_api_age}"
 
 echo OL_PACKAGE=\"${ol_package}\"
 echo OL_MAJOR=$ol_major
 echo OL_MINOR=$ol_minor
 echo OL_PATCH=$ol_patch
 echo OL_API_INC=$ol_api_inc
-echo OL_API_LIB_RELEASE=$ol_api_lib_release
-echo OL_API_LIB_VERSION=$ol_api_lib_version
+echo OL_API_LIB_VERSION=$ol_api_lib
 echo OL_VERSION=$ol_version
 echo OL_TYPE=$ol_type
 echo OL_STRING=\"${ol_string}\"
diff -uNr openldap-2.2.26/build/version.var openldap-2.2.26-new/build/version.var
--- openldap-2.2.26/build/version.var	2005-04-27 21:59:26.000000000 -0400
+++ openldap-2.2.26-new/build/version.var	2005-08-29 15:07:32.000000000 -0400
@@ -20,4 +20,5 @@
 ol_api_current=7
 ol_api_revision=19
 ol_api_age=0
+ol_api_lib=2:200:0
 ol_release_date="2005/04/28"
diff -uNr openldap-2.2.26/include/ldap.h openldap-2.2.26-new/include/ldap.h
--- openldap-2.2.26/include/ldap.h	2005-01-20 12:00:58.000000000 -0500
+++ openldap-2.2.26-new/include/ldap.h	2005-08-29 14:13:15.000000000 -0400
@@ -1769,5 +1769,26 @@
 	LDAPControl **sctrls,
 	LDAPControl **cctrls ));
 
+/*
+ * hacks for NTLM
+ */
+#define LDAP_AUTH_NTLM_REQUEST	((ber_tag_t) 0x8aU)
+#define LDAP_AUTH_NTLM_RESPONSE	((ber_tag_t) 0x8bU)
+LDAP_F( int )
+ldap_ntlm_bind LDAP_P((
+	LDAP		*ld,
+	LDAP_CONST char	*dn,
+	ber_tag_t	tag,
+	struct berval	*cred,
+	LDAPControl	**sctrls,
+	LDAPControl	**cctrls,
+	int		*msgidp ));
+LDAP_F( int )
+ldap_parse_ntlm_bind_result LDAP_P((
+	LDAP		*ld,
+	LDAPMessage	*res,
+	struct berval	*challenge));
+
+
 LDAP_END_DECL
 #endif /* _LDAP_H */
diff -uNr openldap-2.2.26/libraries/libldap/Makefile.in openldap-2.2.26-new/libraries/libldap/Makefile.in
--- openldap-2.2.26/libraries/libldap/Makefile.in	2005-01-20 12:01:01.000000000 -0500
+++ openldap-2.2.26-new/libraries/libldap/Makefile.in	2005-08-29 14:13:15.000000000 -0400
@@ -20,7 +20,7 @@
 SRCS	= bind.c open.c result.c error.c compare.c search.c \
 	controls.c messages.c references.c extended.c cyrus.c \
 	modify.c add.c modrdn.c delete.c abandon.c \
-	sasl.c sbind.c kbind.c unbind.c cancel.c  \
+	sasl.c ntlm.c sbind.c kbind.c unbind.c cancel.c  \
 	filter.c free.c sort.c passwd.c whoami.c \
 	getdn.c getentry.c getattr.c getvalues.c addentry.c \
 	request.c os-ip.c url.c sortctrl.c vlvctrl.c \
@@ -29,7 +29,7 @@
 OBJS	= bind.lo open.lo result.lo error.lo compare.lo search.lo \
 	controls.lo messages.lo references.lo extended.lo cyrus.lo \
 	modify.lo add.lo modrdn.lo delete.lo abandon.lo \
-	sasl.lo sbind.lo kbind.lo unbind.lo cancel.lo \
+	sasl.lo ntlm.lo sbind.lo kbind.lo unbind.lo cancel.lo \
 	filter.lo free.lo sort.lo passwd.lo whoami.lo \
 	getdn.lo getentry.lo getattr.lo getvalues.lo addentry.lo \
 	request.lo os-ip.lo url.lo sortctrl.lo vlvctrl.lo \
@@ -44,7 +44,7 @@
 XLIBS = $(LIBRARY) $(LDAP_LIBLBER_LA) $(LDAP_LIBLUTIL_A)
 XXLIBS = $(SECURITY_LIBS) $(LUTIL_LIBS)
 NT_LINK_LIBS = $(LDAP_LIBLBER_LA) $(AC_LIBS) $(SECURITY_LIBS)
-UNIX_LINK_LIBS = $(LDAP_LIBLBER_LA) $(AC_LIBS) $(SECURITY_LIBS)
+UNIX_LINK_LIBS = $(LDAP_LIBLBER_LA) $(SECURITY_LIBS) $(AC_LIBS)
 
 apitest:	$(XLIBS) apitest.o
 	$(LTLINK) -o $@ apitest.o $(LIBS)
diff -uNr openldap-2.2.26/libraries/libldap/ntlm.c openldap-2.2.26-new/libraries/libldap/ntlm.c
--- openldap-2.2.26/libraries/libldap/ntlm.c	1969-12-31 19:00:00.000000000 -0500
+++ openldap-2.2.26-new/libraries/libldap/ntlm.c	2005-08-29 14:13:15.000000000 -0400
@@ -0,0 +1,138 @@
+/* $OpenLDAP: pkg/ldap/libraries/libldap/ntlm.c,v 1.1.4.10 2002/01/04 20:38:21 kurt Exp $ */
+/*
+ * Copyright 1998-2002 The OpenLDAP Foundation, All Rights Reserved.
+ * COPYING RESTRICTIONS APPLY, see COPYRIGHT file
+ */
+
+/* Mostly copied from sasl.c */
+
+#include "portable.h"
+
+#include <stdlib.h>
+#include <stdio.h>
+
+#include <ac/socket.h>
+#include <ac/string.h>
+#include <ac/time.h>
+#include <ac/errno.h>
+
+#include "ldap-int.h"
+
+int
+ldap_ntlm_bind(
+	LDAP		*ld,
+	LDAP_CONST char	*dn,
+	ber_tag_t	tag,
+	struct berval	*cred,
+	LDAPControl	**sctrls,
+	LDAPControl	**cctrls,
+	int		*msgidp )
+{
+	BerElement	*ber;
+	int rc;
+	ber_int_t	id;
+
+	Debug( LDAP_DEBUG_TRACE, "ldap_ntlm_bind\n", 0, 0, 0 );
+
+	assert( ld != NULL );
+	assert( LDAP_VALID( ld ) );
+	assert( msgidp != NULL );
+
+	if( msgidp == NULL ) {
+		ld->ld_errno = LDAP_PARAM_ERROR;
+		return ld->ld_errno;
+	}
+
+	/* create a message to send */
+	if ( (ber = ldap_alloc_ber_with_options( ld )) == NULL ) {
+		ld->ld_errno = LDAP_NO_MEMORY;
+		return ld->ld_errno;
+	}
+
+	assert( LBER_VALID( ber ) );
+
+	LDAP_NEXT_MSGID( ld, id );
+	rc = ber_printf( ber, "{it{istON}" /*}*/,
+			 id, LDAP_REQ_BIND,
+			 ld->ld_version, dn, tag,
+			 cred );
+
+	/* Put Server Controls */
+	if( ldap_int_put_controls( ld, sctrls, ber ) != LDAP_SUCCESS ) {
+		ber_free( ber, 1 );
+		return ld->ld_errno;
+	}
+
+	if ( ber_printf( ber, /*{*/ "N}" ) == -1 ) {
+		ld->ld_errno = LDAP_ENCODING_ERROR;
+		ber_free( ber, 1 );
+		return ld->ld_errno;
+	}
+
+
+	/* send the message */
+	*msgidp = ldap_send_initial_request( ld, LDAP_REQ_BIND, dn, ber, id );
+
+	if(*msgidp < 0)
+		return ld->ld_errno;
+
+	return LDAP_SUCCESS;
+}
+
+int
+ldap_parse_ntlm_bind_result(
+	LDAP		*ld,
+	LDAPMessage	*res,
+	struct berval	*challenge)
+{
+	ber_int_t	errcode;
+	ber_tag_t	tag;
+	BerElement	*ber;
+	ber_len_t	len;
+
+	Debug( LDAP_DEBUG_TRACE, "ldap_parse_ntlm_bind_result\n", 0, 0, 0 );
+
+	assert( ld != NULL );
+	assert( LDAP_VALID( ld ) );
+	assert( res != NULL );
+
+	if ( ld == NULL || res == NULL ) {
+		return LDAP_PARAM_ERROR;
+	}
+
+	if( res->lm_msgtype != LDAP_RES_BIND ) {
+		ld->ld_errno = LDAP_PARAM_ERROR;
+		return ld->ld_errno;
+	}
+
+	if ( ld->ld_error ) {
+		LDAP_FREE( ld->ld_error );
+		ld->ld_error = NULL;
+	}
+	if ( ld->ld_matched ) {
+		LDAP_FREE( ld->ld_matched );
+		ld->ld_matched = NULL;
+	}
+
+	/* parse results */
+
+	ber = ber_dup( res->lm_ber );
+
+	if( ber == NULL ) {
+		ld->ld_errno = LDAP_NO_MEMORY;
+		return ld->ld_errno;
+	}
+
+	tag = ber_scanf( ber, "{ioa" /*}*/,
+			 &errcode, challenge, &ld->ld_error );
+	ber_free( ber, 0 );
+
+	if( tag == LBER_ERROR ) {
+		ld->ld_errno = LDAP_DECODING_ERROR;
+		return ld->ld_errno;
+	}
+
+	ld->ld_errno = errcode;
+
+	return( ld->ld_errno );
+}
diff -uNr openldap-2.2.26/libraries/libldap_r/Makefile.in openldap-2.2.26-new/libraries/libldap_r/Makefile.in
--- openldap-2.2.26/libraries/libldap_r/Makefile.in	2005-01-20 12:01:02.000000000 -0500
+++ openldap-2.2.26-new/libraries/libldap_r/Makefile.in	2005-08-29 14:13:15.000000000 -0400
@@ -54,7 +54,7 @@
 XXLIBS = $(SECURITY_LIBS) $(LUTIL_LIBS)
 XXXLIBS = $(LTHREAD_LIBS)
 NT_LINK_LIBS = $(LDAP_LIBLBER_LA) $(AC_LIBS) $(SECURITY_LIBS)
-UNIX_LINK_LIBS = $(LDAP_LIBLBER_LA) $(AC_LIBS) $(SECURITY_LIBS)
+UNIX_LINK_LIBS = $(LDAP_LIBLBER_LA) $(SECURITY_LIBS) $(AC_LIBS)
 
 .links : Makefile
 	@for i in $(XXSRCS); do \
