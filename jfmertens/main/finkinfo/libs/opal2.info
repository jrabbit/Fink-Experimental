Package: opal2
Version: 2.2.2
Revision: 1
Maintainer: None <fink-devel@users.sourceforge.net>
BuildDepends: cyrus-sasl2-dev, expat1, openldap23-dev, openssl097-dev, pwlib1, doxygen, sdl, sed
# sed : because I don't know how to write the patchscript in perl...
Depends: %N-shlibs (= %v-%r)
Source: http://www.ekiga.org/admin/downloads/latest/sources/sources/opal-%v.tar.gz
Source-MD5: 899e38f5586e3b03d07cc1c55680a56f
PatchScript: <<
 sed -ri -e '/MACOSX/i #include <ptbuildopts.h>' src/codec/speex/libspeex/kiss_fft.h
<<
NoSetLDFLAGS: true
SetLIBRARY_PATH: %p/lib
NoSetCPPFLAGS: true
CompileScript: <<
#!/bin/sh -ev
  export CPATH=%p/include; export PWLIBDIR=%p/lib/pwlib1
  if [ %m = i386 ] ; then abbr=x86 ; else abbr=ppc ; fi
  ./configure --prefix=%p/lib/%n
#  --enable-h263avcodec=%p/include/ffmpeg doens't work
  make LDFLAGS="-L%p/lib -lresolv -L../../lib" opt optnoshared \
        LDSOOPTS="-dynamiclib -compatibility_version 2.2 -current_version %v -install_name %p/lib/%n/lib/libopal_Darwin_${abbr}_r.2.dylib" \
        libso_target="lib/libopal_Darwin_${abbr}_r.%v.dylib"
  make docs
  make test
<<
InstallScript: <<
#!/bin/sh -ev
  make install DESTDIR=%d
  rm -f %i/lib/%n/lib/*.dylib.*
  if [ %m = i386 ] ; then abbr=x86 ; else abbr=ppc ; fi
  cd %i/lib/%n/lib
  ln -fs libopal_Darwin_${abbr}_r.%v.dylib libopal_Darwin_${abbr}_r.2.2.dylib
  ln -fs libopal_Darwin_${abbr}_r.2.2.dylib libopal_Darwin_${abbr}_r.2.dylib
  ln -fs libopal_Darwin_${abbr}_r.2.dylib libopal_Darwin_${abbr}_r.dylib
  ln -fs libopal_Darwin_${abbr}_r.dylib libopal.dylib
  rm *.so
  cd -
  cp -pP version.h %i/lib/%n
#  ranlib %i/lib/%n/lib/libopal_Darwin_*.a
  mkdir -p %i/share/doc/%n
  mv html %i/share/doc/%n
<<
SplitOff: <<
  Package: %N-shlibs
  Depends: cyrus-sasl2-shlibs, expat1-shlibs, openldap23-shlibs, openssl097-shlibs, pwlib1-shlibs, sdl-shlibs
  Description: Shared libraries for %N
  Files: lib/%N/lib/libopal_Darwin_*.2.*.dylib
##  Shlibs: <<
##    ( %m = powerpc ) %p/lib/%N/lib/libopal_Darwin_ppc_r.2.dylib 2.2 %n (>= 2.2.2-1)
##    ( %m = i386    ) %p/lib/%N/lib/libopal_Darwin_x86_r.2.dylib 2.2 %n (>= 2.2.2-1)
##  <<
  DocFiles: mpl-1.0.htm
<<
DocFiles: mpl-1.0.htm
Description: Successor (?) of OpenH323
License: OSI-Approved
Homepage: http://www.openh323.org/
