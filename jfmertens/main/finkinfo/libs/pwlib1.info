Package: pwlib1
Version: 1.10.1
Revision: 1
Maintainer: Shawn Hsiao <shawn@users.sourceforge.net>
BuildDepends: audiofile, esound, cyrus-sasl2-dev, expat1, openldap23-dev, openssl097-dev, sdl, doxygen, sed, libdv4
# libdv4 for 1 configure test..
# none of the plugins seem to get built yet
# sed : because I don't know how to write the patchscript in perl...
Depends: %N-shlibs (= %v-%r)
# Depends: just in order not to have to duplicate the docfiles...
Conflicts: pwlib
Replaces: pwlib
Provides: pwlib
Source: http://www.ekiga.org/admin/downloads/latest/sources/sources/pwlib-%v.tar.gz
Source-MD5: 51414920d7b21125df2bf6870c0fc2e4
PatchScript: <<
#!/bin/sh -ev
  find . \( -name CVS -o -name '.cvsignore' -o -name '*.bak' \) -exec rm -fR \{\} \+ || true
  sed -ri.bak -e '/P_MACOSX/,+40{/socklen_t/d}' include/ptlib/unix/ptlib/pmachdep.h
#  perl -pi.bak -e 's,^LDAP_SOURCE,CFLAGS += -DLDAP_DEPRECATED\n$&,' src/ptlib/unix/Makefile
  perl -pi.bak -e 's,sys/soundcard\.h,liboss/soundcard.h,' {,plugins/}configure*
  sed -ri.bak -e '/NETBSD/,+5{ /#endif/a\
\
#ifdef P_MACOSX\
#include <liboss/soundcard.h>\
#endif
}' plugins/sound_{esd,oss}/sound_*.h src/ptlib/unix/ossaix.cxx
  sed -ri -e 's,^\#include <sys/socket\.h>,#include <stddef.h>,' configure
  sed -ri.bak -e 's,libesd.a,libesd.dylib,' make/unix.mak
  sed -ri.bak -e 's,-shared,-bundle,' make/plugins.mak
  sed -ri.bak -e 's,/share/pwlib,,' make/ptlib-config.in
<<
NoSetLDFLAGS: true
SetLIBRARY_PATH: %p/lib
NoSetCPPFLAGS: true
# liboss1 is broken, hence in the meantime --disable-oss; also trouble with --enable-shm-video :
ConfigureParams: --prefix=%p/lib/%n --exec-prefix=%p/lib/%n --enable-plugins --enable-v4l2 --enable-v4l --enable-bsdvideo --enable-avc --enable-dc --enable-alsa --disable-oss --enable-remconn
CompileScript: <<
#!/bin/sh -ev
  export CPATH=%p/include; export ESDDIR=%p
  if [ %m = i386 ] ; then abbr=x86 ; else abbr=ppc ; fi
  ./configure %c
  make LDFLAGS="-L%p/lib -lresolv -L../../lib" PWLIBDIR=%b \
	LDSOOPTS="-dynamiclib -compatibility_version 1.10 -current_version %v -install_name %p/lib/%n/lib/libpt_Darwin_${abbr}_r.1.dylib" \
	libso_target="lib/libpt_Darwin_${abbr}_r.%v.dylib"
  make docs
<<
InstallScript: <<
#  make install DESTDIR=%d # is broken..
  mkdir -p %i/lib/%n/src
  mkdir -p %i/lib/%n/make
  mkdir -p %i/lib/%n/lib
  mkdir -p %i/lib/%n/bin
  cp -pPR version.h include plugins %i/lib/%n
  find %i/lib/%n \( -name '*.h.*' -o -name '*.bak' \) -exec rm \{\} \+ || true
  cp -pPR make/{*.mak,ptlib-config} %i/lib/%n/make
  ln -s ../make/ptlib-config  %i/lib/%n/bin
  chmod a-x %i/lib/%n/include/ptclib/*
  cp -pPR lib/lib* %i/lib/%n/lib
  cd %i/lib/%n/lib; ln -s libpt_Darwin_*_r.dylib libpt.dylib; ranlib libpt_Darwin_*.a; cd -
  mkdir -p %i/share/doc/%n
  cp -pPR samples html %i/share/doc/%n
<<
SplitOff: <<
  Package: %N-shlibs
  Depends: cyrus-sasl2-shlibs, esound-shlibs, expat1-shlibs, openldap23-shlibs, openssl097-shlibs, sdl-shlibs
  Conflicts: pwlib-shlibs
  Replaces: pwlib-shlibs
  Provides: pwlib-shlibs
  Description: Shared libraries for pwlib
  Files: lib/%N/lib/libpt_Darwin_*.1.10*.dylib
#  Shlibs: <<
#    ( %m = powerpc ) %p/lib/%N/lib/libpt_Darwin_ppc_r.1.dylib 1.10 %n (>= 1.10.1-1)
#    ( %m = i386    ) %p/lib/%N/lib/libpt_Darwin_x86_r.1.dylib 1.10 %n (>= 1.10.1-1)
#  <<
  DocFiles: mpl-1.0.htm ReadMe.txt History.txt
<<
DocFiles: mpl-1.0.htm ReadMe.txt History.txt
Description: Portable Windows library for OpenH323
DescPort: <<
It is a different compile method, so i've decided to copy the dir
of the compiled into %p/lib/pwlib/. To compile a file that requires
them add to make 'PWLIBDIR=%p/lib/pwlib/'. Builds with %i/lib/%n/src, 
whose presence is necessary to build openh323.
(Jfm:) The original install target, as well as ptlib-config, expect the "make"
subdirectory to lie in PWLIBDIR/share/pwlib _ but this doesn't seem compatible
with the use of PWLIBDIR when building dependent pkgs (openh323 _ aka opal).
Even the empty dir PWLIBDIR/src is needed by common.mak _ to avoid the assignment
"TARGET_LIBS     = $(SYSLIBDIR)/$(PTLIB_FILE)" _ (eg, build of simph in openh323
would fail w/o it).
<<
DescPackaging: Version 1.5.2-10 by James Gibbs <jimgibbs@mac.com>
License: OSI-Approved
Homepage: http://www.openh323.org/
