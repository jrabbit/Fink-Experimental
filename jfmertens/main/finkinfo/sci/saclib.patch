################################################
# mksysdep.pl V 0.0
# Created by Chris Brown, 20 May, 208
################################################

if (! $ENV{'saclib'})
{
    print "SACLIB Error: The saclib environment variable must be set!\n";
    exit(1);
}

### Get architecture type
$ptype = "unknown";
$uname = `uname -mpi`;
if ($uname =~ /i\S*86/)
{
    $ptype = "x86";
}
elsif ($uname =~ /Sun|sun|SUN|Sparc|sparc|SPARC/)
{
    $ptype = "sparc";
}
else
{
    print "SACLIB Warning: Could not determine processor type!\n";
}

### Get OS type
$ostype = "unknown";
$uname = `uname -s`;
if ($uname =~ /linux|Linux|LINUX/)
{
    $ostype = "linux";
}
elsif ($uname =~ /Sun|sun|SUN|solaris|Solaris/)
{
    $ostype = "solaris";
}
else
{
    print "SACLIB Warning: Could not determine OS type!\n";
}


### Copy system dependent files
### Create sysdep.h
    $littleEndian = "/* Created by $saclib/bin/mksysdep.pl */
#ifndef LITTLE_ENDIAN
#define LITTLE_ENDIAN
#endif
#undef BIG_ENDIAN
";
    $bigEndian = "/* Created by $saclib/bin/mksysdep.pl */
#ifndef BIG_ENDIAN
#define BIG_ENDIAN
#endif
#undef LITTLE_ENDIAN
";
open(SYSDEP,"> $ENV{'saclib'}/include/sysdep.h");
if ($ptype eq "x86" && $ostype eq "linux")
{
    print SYSDEP $littleEndian;
    print SYSDEP "#define _X86_LINUX_\n";
    system("bash -c \"pushd $ENV{'saclib'}/sysdep/linuxX86 ; ./install ; popd\"");
    
}
elsif ($ptype eq "sparc" && $ostype eq "solaris")
{
    print SYSDEP $bigEndian;
    print SYSDEP "#define _SPARC_SOLARIS_\n";
    system("bash -c \"pushd $ENV{'saclib'}/sysdep/solarisSparc ; ./install ; popd\"");
}

