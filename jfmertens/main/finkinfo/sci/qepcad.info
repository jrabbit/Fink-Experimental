Info2: <<
Package: qepcad%type_pkg[-gcc4.3]
Version: 1.50
Revision: 2
#Source: http://www.cs.usna.edu/~qepcad/INSTALL/%{Ni}-B.%v.tar.gz
Source: http://www.cs.usna.edu/~wcbrown/qesource.tar.gz
Source-MD5: 517f5a8c49a8a89ecbae37897288f522
SourceDirectory: qesource
Type: -gcc4.3 (boolean)
BuildDepends: freeglut, readline5, saclib%type_pkg[-gcc4.3], sed
Depends: freeglut-shlibs, readline5-shlibs, singular
Conflicts: %{Ni}, %{Ni}-gcc43
Replaces: %{Ni}, %{Ni}-gcc43

PatchScript: <<
#!/bin/sh -ev
find . -name '*.o' -exec rm -f \{\} \;
if [ "%type_raw[-gcc4.3]" == "-gcc4.3" ] ; then nopic=''; else nopic="-mdynamic-no-pic"; fi
# to strip binaries ( using "-s" would lead at launch to dyld error "lazy pointer not found" ):
echo '__mh_execute_header' > symlst
sed -i'' -e 's;(EXE)\|(LIBS);& -Wl,-x -exported_symbols_list %b/symlst -dead_strip;' \
	 -e "s,O4,O3 -fstrict-aliasing $nopic -Wall," \
	 -e "s,= *-g,& $nopic -Wall -DNO_SACLIB_MACROS ," \
	{.,cad2d,plot2d,source}/Makefile extensions/adj2d/new_make
sed -i'' -e 's,gmake,make,' Makefile
sed -i'' -e 's,-lreadline,-L%p/lib &,' {cad2d,source}/Makefile
sed -i'' -e '/^GLBASE/s,/usr,&/X11R6,' -e '/^GLUTBASE/s,/usr,%p,' plot2d/Makefile
sed -i'' -e 's,/bin/ADJ2D_plot,%p&,' extensions/rend/PLOT_2D_CAD.cc
sed -i'' -e 's,qepath [+],string("%p/etc") +,' -e 's,default.qepcadrc,qepcadrc,' {cad2d/src,source/main}/MAIN.c
sed -i'' -e 's,qepcad.help,%p/share/%{Ni}/&,' -e 's,/bin/%p,,' source/userint/HELPFRD.c
sed -i'' -e 's,getenv("qe"),"%p",' {cad2d/src,source/main}/MAIN.c extensions/rend/PLOT_2D_CAD.cc source/userint/HELPFRD.c
sed      -e 's,^#S,S,' -e 's,/usr,%p,' < default.qepcadrc > qepcadrc
  ## gcc43 requires the following (first for srtcpy, second and third for memmove):
  sed -i'' -e 's,#include <string>,#include <cstring>\n&,' extensions/rend/PLOT_2D_CAD.cc source/db/convenientstreams.h
  sed -i'' -e 's,#include <cstdlib>,#include <cstring>\n&,' source/db/unnamedpipe.h
<<
CompileScript: <<
#!/bin/sh -ev
if [ "%type_raw[-gcc4.3]" == "-gcc4.3" ] ; then export PATH=%p/lib/gcc4.3/bin:$PATH CC=gcc; fi
export saclib=%p
export qe=`pwd`
make both
cd cad2d; make both; cd -
cd plot2d; make; cd -
<<
InstallScript: <<
mkdir -p %i/include/%{Ni} %i/lib/%{Ni} %i/bin %i/share/%{Ni} %i/etc
cp -p --parents `find . -name '*.h'` %i/include/%{Ni}
cp -p `find . -name '*.a'` %i/lib/%{Ni}
ranlib %i/lib/%{Ni}/*.a
cp -p source/%{Ni}{,d} cad2d/cad2d{,d} plot2d/ADJ2D_plot %i/bin
cp -p source/qepcad.help %i/share/%{Ni}
cp -p qepcadrc %i/etc
chmod -R a+rX %i
<<
ConfFiles: %p/etc/qepcadrc
DocFiles: LICENSE LOG README TODO
Description: Tarski's Quantifier Elimination
License: OSI-Approved
Homepage: http://www.cs.usna.edu/~qepcad/B/QEPCAD.html
Maintainer: JF Mertens <jfmertens@users.sourceforge.net>
<<
