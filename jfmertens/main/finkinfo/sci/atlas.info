Package: atlas
Version: 3.7.37
Revision: 1
Description: Portably optimal linear algebra software
DescDetail: <<
The current version provides a complete BLAS and LAPACK API.
For many operations, ATLAS achieves performance on par
with machine-specific tuned libraries.
Installs also LAPACK's docs and manpages.
Headers: cblas.h clapack.h, plus the atlas headers
Libraries installed:
liblapack.a	: The LAPACK routines provided by ATLAS, plus the rest of LAPACK from netlib.org.
libcblas.a	: The ANSI C interface to the BLAS.
libf77blas.a	: The Fortran77 interface to the BLAS.
libatlas.a	: The main ATLAS library, providing low-level routines for all interface libs.
Plus the threaded variants libptcblas.a and libptf77blas.a, and an all-encompassing libatlas.dylib
<<
DescPort: <<
The optimized subset of LAPACK provided by ATLAS is merged
with the full LAPACK from http://www.netlib.org/lapack.
<<
DescUsage: <<
Order is important when linking! Use:
-L%p/lib -llapack -lcblas -lf77blas -latlas
<<
Source: mirror:sourceforge:math-atlas/%n%v.tar.bz2
Source-MD5: 5c3fb9a4c74e8426105558a23b2215ff
Source2: http://www.netlib.org/lapack/lapack-3.1.1.tgz
Source2-MD5: 00b21551a899bcfbaa7b8443e1faeef9
License: BSD
# since we're experimenting with building a dylib :
BuildDependsOnly: true
PatchScript: <<
#!/bin/sh -ev
cd ..; ln -s lapack-3.1.1 LAPACK; cd -
perl -pi -e 's|g77|gfortran|g' ../LAPACK/INSTALL/make.inc.LINUX
perl -pi -e 's,\.\./\.\./blas\$\(PLAT\)\.a,%b/../bld/lib/libptf77blas.a %b/../bld/lib/libptcblas.a %b/../bld/lib/libatlas.a,' \
	../LAPACK/INSTALL/make.inc.LINUX
<<
BuildDepends: gcc42
SourceDirectory: ATLAS
CompileScript: <<
#!/bin/sh -ev
 if [ %m = 'powerpc' ]; then n=`machine|sed -e 's,^ppc,,'`; mflags="-mcpu=$n -mtune=$n -faltivec -m32"
	elif [ %m = 'i386' ]; then mflags="-march=nocona -mfpmath=sse,387 -msse -msse2 -msse3 -mmmx -m32"
	else mflags=''
 fi
 flags="-O3 -fomit-frame-pointer -fstrict-aliasing -freorder-blocks -fsched-interblock -fgcse-sm -fgcse-las -fgcse-after-reload $mflags"
 cd ../LAPACK
 sed -e "s;\(-funroll-all-loops\) -O3;\1 $flags;" -e 's,^TIMER,\#TIMER,' -e '/INT_ETIME/s,^\# *,,' \
	< INSTALL/make.inc.LINUX > make.inc
 make lapacklib
 mkdir -p ../bld
 cd ../bld
 ../ATLAS/configure --prefix=%p --with-netlib-lapack=%b/../LAPACK/lapack_LINUX.a --cflags="$flags"
 make
<<
InfoTest: <<
TestScript: <<
#!/bin/sh -ev
 cd ../LAPACK
 mv lapack_LINUX.a lapack_LINUX.a~; ln -s ../bld/lib/liblapack.a lapack_LINUX.a
 make lapack_testing blas_testing
 # to get timing uncluttered by compilation times, we'll repeat the tests at the end of the log:
 rm {BLAS,TESTING}/*.out
 cd ../bld
 make test pttest time
 cd ../LAPACK
 time { make blas_testing; cd TESTING; make ; }
<<
<<
InstallScript: <<
#!/bin/sh -ev
 mkdir -p %i/share/doc/%n/LAPACK
 cp doc/* README %i/share/doc/%n
 head -n29 bin/atlas_tee.c > %i/share/doc/%n/LICENSE
 cp -pPR ../LAPACK/manpages/{blas/,}man %i/share
 cp -pPR ../LAPACK/{html,COPYING,README} %i/share/doc/%n/LAPACK
 ln -s html/index.html %i/share/doc/%n/LAPACK
 cd ../bld
 # we first make a shared lib; easier to just write the command here than to fix lib/Makefile ...
 # put this here to make sure it is after the testscript, else dylib might affect timings.
 # dylib just made to experiment; not sure this should stay.
 # The '-m' flag at the end is dirty trick to get around an "undefined symbol" for _MAIN__, from -lgfortranbegin;
 # _ it swallows the immediately following -lgfortranbegin in the command transmitted to /usr/bin/libtool ...
 # There are no undefined symbols w/o "from ..." in the resulting dylib.
 # Is it the -all_load flag that causes the symbol "_main" from libgfortranbegin.a to be loaded ?
 cd lib
 gfortran -dynamiclib -single_module -all_load -install_name %p/lib/libatlas.dylib -o libatlas.dylib \
	liblapack.a libptf77blas.a libptcblas.a libatlas.a -Wl,-x -dead_strip -m
 # now try to make an exported symbols list, then re-link and strip (makes only a 5% gain in size ..)
 # not completely sure the symbols '^_[cf]atlas_' are not meant to be exported .. To be checked
 nm -m libatlas.dylib|egrep -v 'undefined.*\(from'|cut -f4 -d' '|egrep -v '^_(ATL|atl|[cf]atlas)_' > lst
 gfortran -dynamiclib -single_module -all_load -install_name %p/lib/libatlas.dylib -o libatlas.dylib \
	liblapack.a libptf77blas.a libptcblas.a libatlas.a -Wl,-x -dead_strip -exported_symbols_list lst -m
 # lib still has %p/lib/gcc4.2/lib/libgcc_s.1.dylib unnecessarily among its load commands _
 # don't know how to remove that (except by issuing the ld command myself ..)
 cd -
 make install DESTDIR=%i
 ranlib %i/lib/*.a
 cp -p lib/*.dylib %i/lib
 chmod -R a+rX %i/share
<<
Homepage: http://math-atlas.sourceforge.net
Maintainer: Jeffrey Whitaker <jswhit@fastmail.fm>
