Info2: <<
Package: saclib%type_pkg[-gcc4.3]
Version: 2.2.0
Revision: 2
#Source: http://www.cs.usna.edu/~qepcad/INSTALL/%{Ni}%v.tar.gz
Source: http://www.cs.usna.edu/~wcbrown/%{Ni}%v.tar.gz
Source-MD5: 6fd2489018a0d163338a9dcd42f72e48
Type: -gcc4.3 (boolean)
Conflicts: %{Ni}, %{Ni}-gcc43
Replaces: %{Ni}, %{Ni}-gcc43

PatchScript: <<
#!/bin/sh -ev
rm -fR RCS
echo "#ifdef __LITTLE_ENDIAN__
#ifndef _LITTLE_ENDIAN_
#define _LITTLE_ENDIAN_
#endif
#undef _BIG_ENDIAN_
#endif
#ifdef __BIG_ENDIAN__
#ifndef _BIG_ENDIAN_
#define _BIG_ENDIAN_
#endif
#undef _LITTLE_ENDIAN_
#endif" > sysdep/linuxX86/sysdep.h
sed -i'' -e '/Get architecture type/,/else/s,else,elsif ($uname =~ /Power|powerpc/)\n{\n\t$ptype = "ppc";\n}\n&,' \
	-e '/Get OS type/,/else/s,else,elsif ($uname =~ /Darwin/)\n{\n\t$ostype = "darwin";\n}\n&,' \
	-e '/^ *elsif .*x86.*linux/{
		s,[(],((,
		s,[)]$,) || $ostype eq "darwin"),
		}' bin/mksysdep.pl 
  sed -i'' -e '/<malloc\.h>/c\
#ifndef __APPLE__\
#include <malloc.h>\
#endif' src/IQR.c
  if [ "%type_raw[-gcc4.3]" == "-gcc4.3" ] ; then nopic=''; else nopic="-mdynamic-no-pic"; fi
  ## first line next is to avoid "...will break strict-aliasing rules" warnings:
  sed -i'' \
	-e "/Compiling/,\$s,%{Ni}/lib/objo$,&\n  make  CC=\$CC \"SACFLAG=-O3\" EXTENSION=o MMAPFS.o MMPDDF.o MMPFBL.o," \
	-e 's,\(SACFLAG=\)",\1-O3 -fstrict-aliasing",' \
	-e "s,SACFLAG=,&$nopic -Wall ," bin/mklib
  sed -i'' -e '/_X86_LINUX_/c\
#if defined (_X86_LINUX_) || defined (__APPLE__)' \
	-e '/ieee754\.h/c\
#ifdef _X86_LINUX_\
#include <ieee754.h>\
#endif' include/hfloats.h

## Some "implicit declaration of function 'GCASET'" warnings (GCASET is also an apparenly equivalent  macro in sacmacros.h ...)
# Could be cured by removing the strange "#ifdef NO_SACLIB_MACROS" under "Macros that are always defined"  in sacmacros.h...
# or at least moving CGASET out of that list
## Remain a couple of implicit declaration warnings for FPCATCH, NORMFCT and NORMLHS _ no .h file has such declarations..; too bad !
<<
CompileScript: <<
  #!/bin/sh -ev
  if [ "%type_raw[-gcc4.3]" == "-gcc4.3" ]; then export PATH=%p/lib/gcc4.3/bin:$PATH CC=gcc; fi
  export %{Ni}=%b
  bin/sconf; bin/mkproto; bin/mkmake; bin/mklib all
<<
InstallScript: <<
  #!/bin/sh -ev
  mkdir -p %i/bin %i/lib %i/include %i/share/doc/%{Ni} %i/share/%{Ni}
  cp -p lib/*.a %i/lib
  ln -s %{Ni}o.a %i/lib/%{Ni}.a
  cp -p include/*.h %i/include
  cp -p doc/{,maint_guide/}*.dvi %i/share/doc/%{Ni}
  cp -p bin/sdesc %i/bin
  cp -p bin/{b2l,l2b}.awk doc/*.doc %i/share/%{Ni}
  sed -i'' -e 's,[$]%{Ni}/[bindoc]\{3\},%p/share/%{Ni},' %i/bin/sdesc
  chmod -R a+rX %i
  sed -e '/INSTALLATION/,/done\.$/d' -e 's,COPYRIGHT ,LICENSE ,' < README | uniq > HELP
<<
DocFiles: HELP LICENSE
Description: Computer algebra, specially on ordered fields
License: OSI-Approved
Homepage: http://www.cs.usna.edu/~qepcad/B/QEPCAD.html
Maintainer: JF Mertens <jfmertens@users.sourceforge.net>
<<
