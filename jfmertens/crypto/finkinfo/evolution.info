Package: evolution
Version: 2.6.1
Revision: 1
Source-MD5: 6ca70a86e6d8e8b3824e58f28a362065
Source: mirror:gnome:sources/%n/2.6/%n-%v.tar.bz2
BuildDepends: atk1, audiofile, cyrus-sasl2-dev, db43-ssl, dbus-dev, esound, evolution-data-server-dev (>= 1.6.1-1), gail17-dev, gconf2-dev, glib2-dev, gnome-keyring-dev, gnome-vfs2-ssl-dev, gnutls12, gstreamer-dev, gtk+2-dev, gtkhtml3.8.15-dev, libart2, libbonobo2-dev, libbonoboui2-dev, libgcrypt, libgettext3-dev, libglade2, libgnome2-dev, libgnomecanvas2-dev, libgnomeprint2.2-dev, libgnomeprintui2.2-dev, libgnomeui2-dev, libgpg-error, libhowl-dev, libiconv-dev, libjpeg, libsoup2.2.8-ssl, libtasn1, libxml2, seamonkey-dev, openldap23-dev, openssl097-dev, orbit2-dev, pango1-xft2-dev, popt, pth2-dev, x11-dev, gettext-tools, scrollkeeper, pkgconfig, intltool, gtk-doc, orbit2
Depends: %N-shlibs (>= %v-%r), dbus-shlibs, evolution-data-server (>= 1.6.1-1), gstreamer-shlibs, openssl097-shlibs, gconf2, scrollkeeper
NoSetLDFLAGS: true
SetLIBRARY_PATH: %p/lib
NoSetCPPFLAGS: true
SetCPPFLAGS: -no-cpp-precomp
SetCFLAGS: -O3 -funroll-loops -fstrict-aliasing -DLDAP_DEPRECATED=1
NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1
PatchScript: <<
  perl -pi.bak -e 's/hardcode_direct=yes/hardcode_direct=no/g' configure && perl -pi.bak -e "s/-scrollkeeper-update/#-scrollkeeper-update/g" help/C/Makefile.in
  perl -pi.bak -e 's,libdir\)/locale,datadir)/locale,' po/Makefile.in.in
## The following are 'for safety' : to avoid "implicit declararation" warnings (still check the ngettext thing in filter-datespec.c.)
  perl -pi.bak -e 's|G_END|GtkWidget * alarm_list_dialog_peek (ECal *ecal, EAlarmList *list_store);\n$&|' calendar/gui/dialogs/alarm-list-dialog.h
  perl -pi.bak -e 's|G_END|void memo_page_set_classification (MemoPage *page, ECalComponentClassification class);\nvoid memo_page_set_show_categories (MemoPage *page, gboolean state);\n$&|' calendar/gui/dialogs/memo-page.h
  perl -pi.bak -e 's,\#include <libecal,#include <libedataserver/e-data-server-util.h>\n$&,' a11y/calendar/ea-gnome-calendar.c
  perl -pi.bak -e 's,i18n\.h>$,$&\n#include <libgnomeui/gnome-file-entry.h>,' calendar/gui/dialogs/alarm-dialog.c
#  perl -pi.bak -e 's,\#define DAY_INDEX 3,\#include <libintl.h>\n$&,' filter/filter-datespec.c
## a quick fix for a bad linking _ just to see what comes next
  perl -pi.bak -e 's;\$\(LINK\);$& -Wl,-m;' plugins/groupwise-features/Makefile.in
<<
ConfigureParams: --enable-static=yes --enable-ipv6=yes --enable-nntp=yes --enable-exchange=yes --enable-file-chooser --enable-plugins=all --with-openldap=yes --with-krb4=/usr --with-krb5=/usr --enable-gtk-doc --mandir=%p/share/man --enable-nss --with-nspr-includes=%p/include/seamonkey/nspr --with-nss-includes=%p/include/seamonkey/nss --with-nspr-libs=%p/lib/seamonkey --with-nss-libs=%p/lib/seamonkey --enable-maintainer-mode
CompileScript: <<
#!/bin/sh -ev
  export CPATH=%p/include
  ./configure %c
#  perl -pi -e 's,\-L(/usr|%p)/lib([^/]),\2,g; s,\-I(/usr|%p)/include([^/]),\2,g' config.status
  perl -pi -e 's,\-L/usr/lib([^/]),\2,g; s,\-I(/usr|%p)/include([^/]),\2,g' config.status
  make
<<
InstallScript: <<
  make install prefix=%i
  mkdir -p %i/share/doc; ln -s %N-shlibs %i/share/doc/%n
  find %i/lib -name '*\.la'|xargs perl -pi -e 's, \-[LR]%p/lib([^/]),\1,g'
<<
PreInstScript: <<
  if [ upgrade = "$1" ]; then
    rm -fR %p/share/doc/%n
  fi
<<
PostInstScript: <<
 if [ configure = "$1" ]; then
  export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`
  gconftool-2 --makefile-install-rule %p/etc/gconf/schemas/apps-evolution-mail-prompts-checkdefault-2.6.schemas
  gconftool-2 --makefile-install-rule %p/etc/gconf/schemas/apps_evolution_addressbook-2.6.schemas
  gconftool-2 --makefile-install-rule %p/etc/gconf/schemas/apps_evolution_calendar-2.6.schemas
  gconftool-2 --makefile-install-rule %p/etc/gconf/schemas/apps_evolution_shell-2.6.schemas
  gconftool-2 --makefile-install-rule %p/etc/gconf/schemas/evolution-mail-2.6.schemas
  scrollkeeper-update
 fi
<<
PostRmScript: <<  
 if [ remove != "$1" ]; then
  scrollkeeper-update
 fi
<<
SplitOff: <<
  Package: %N-shlibs
  Depends: evolution-data-server-shlibs (>= 1.6.1-1), gtkhtml3.8.15-shlibs
  Files: lib/%N/2.6/*.0.dylib
  DocFiles: AUTHORS COPYING COPYING-DOCS HACKING MAINTAINERS NEWS README
  Shlibs: <<
    %p/lib/evolution/2.6/libeabutil.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libeconduit.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libecontacteditor.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libecontactlisteditor.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libefilterbar.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libemiscwidgets.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libeshell.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libessmime.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libetable.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libetext.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libetimezonedialog.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libeutil.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libevolution-a11y.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libevolution-addressbook-a11y.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libevolution-addressbook-importers.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libevolution-calendar-a11y.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libevolution-calendar-importers.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libevolution-mail-importers.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libevolution-smime.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libevolution-widgets-a11y.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libfilter.0.dylib 1.0.0 %n (>= 2.6.0-1)
    %p/lib/evolution/2.6/libmenus.0.dylib 1.0.0 %n (>= 2.6.0-1)
  <<
<<
SplitOff2: <<
  Package: %N-dev
  Depends: %N-shlibs (>= %v-%r), pkgconfig
  Files: lib/%N/2.6/*.{{,l}a,dylib} lib/%N/2.6/plugins/*.{,l}a lib/%N/2.6/components/*.{,l}a lib/pkgconfig include/%N-2.6 share/idl/%N-2.6
  InstallScript: mkdir -p %i/share/doc; ln -s %N-shlibs %i/share/doc/%n
<<
Description: Advanced email client
DescPort: <<
 Original package and port for evolution < 1.4 by Max Horn
<<
DescPackaging: <<
 The --enable-maintainer-mode is for the config.status thing in the compilescript (to avoid BuildConflict with gtkhtml-dev).
 TODO: --enable-pilot-conduits=yes (needs a "gnome-pilot" pkg).
# Also _ cf end of configure ouput _ a pkg "dbus-glib-1" would be needed for a full build.
<<
Homepage: http://gnome.org/projects/evolution/
License: GPL
Maintainer: The Gnome Core Team <fink-gnome-core@lists.sourceforge.net>

