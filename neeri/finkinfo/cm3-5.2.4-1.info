Package: cm3
Version: 5.2.4
Revision: 1
Maintainer: Matthias Neeracher <neeracher@mac.com>
Depends: 
Source: http://www.elegosoft.com/cm3/cm3-src-all-5.2.4.tgz
Source-MD5: d7ce529bc6bffc87ade367c7c0d79256
Source2: http://www.elegosoft.com/cm3/cm3-min-POSIX-PPC_DARWIN-5.2.4.tgz
Source2-MD5: b12f68341a97f2af1eac0c77929af77a
NoSourceDirectory: true
PatchScript: <<
patch -p1 <%a/%f.patch
mkdir bootstrap
tar -C bootstrap -zxvf system.tgz
cp bootstrap.cm3.cfg bootstrap/bin/cm3.cfg
perl -i -pe 's|\@USE_ROOT\@|%b/bootstrap/|; s|\@INSTALL_ROOT\@|%i/cm3/|' bootstrap/bin/cm3.cfg
<<
CompileScript: <<
echo "We build and install at once, so all the work is in InstallScript"
<<
InstallScript: <<
cd scripts; PATH=%b/bootstrap/bin:$PATH M3GC_SIMPLE=yes ./do-cm3-core.sh buildship
cd scripts; PATH=%b/bootstrap/bin:$PATH M3GC_SIMPLE=yes ./do-pkg.sh buildship tcp

ln -s %p/cm3/pkg/cm3/PPC_DARWIN/cm3 %i/cm3/bin/cm3
cp bootstrap.cm3.cfg %i/cm3/bin/cm3.cfg
perl -i -pe 's|\@USE_ROOT\@|%p/cm3/|; s|\@INSTALL_ROOT\@|%p/cm3/|' %i/cm3/bin/cm3.cfg

echo Fixing .M3EXPORT files...
find %i -name .M3EXPORTS -print -exec perl -i -pe 's|%d||' '{}' ';'
echo Fixing dynamic libraries...
find %i -name '*.[0-9].[0-9].dylib'|perl -pe '($i=$_)=~s|%d||;chomp($i);`install_name_tool -id $i $_`'

<<
DocFiles: COPYRIGHT-CMASS COPYRIGHT-DEC
Description: Critical Mass Modula-3 Compiler
DescDetail: <<
<<
DescPort: <<
This port was mainly accomplished by reverse engineering the darwinports
version by Landon Fuller. 

The port now seems to actually work, but the file organization is
distincly non-fink. This will be fixed RSN.
<< 
License: Restrictive Homepage:
http://www.m3.org

