Package: memcached
Version: 1.1.12
Revision: 1
Description: high-performance cache system
License: BSD
Maintainer: Benjamin Reed <memcached@fink.racoonfink.com>
BuildDepends: libevent (>= 1.1-1)
Depends: daemonic

Source: http://www.danga.com/%n/dist/%n-%v.tar.gz
Source-MD5: a1236dad33e9ac6c36d53faa8da61780

ConfigureParams: --mandir=%p/share/man

InstallScript: <<
#!/bin/sh -ev
	make install DESTDIR="%d"

	install -d -m 755 %i/sbin
	cat <<END >%i/sbin/start-memcached.sh
#!/bin/sh -e

source %p/etc/memcached.conf

[ -n "\$PORT"  ] && MEMCACHED_OPTIONS="\$MEMCACHED_OPTIONS -p \$PORT"
[ -n "\$RUNAS" ] && MEMCACHED_OPTIONS="\$MEMCACHED_OPTIONS -u \$RUNAS"
[ -n "\$MEM"   ] && MEMCACHED_OPTIONS="\$MEMCACHED_OPTIONS -m \$MEM"

memcached \$MEMCACHED_OPTIONS
END
	chmod 755 %I/sbin/start-memcached.sh

	install -d -m 755 %i/etc
	cat <<END >%i/etc/memcached.conf
# the port to listen on
PORT=11211

# the user to run as
RUNAS=nobody

# the amount of memory (in MB) to use
MEM=64

# any other options you want to set
# (-d means "daemon mode")
MEMCACHED_OPTIONS="-d"
END

	chmod 644 %i/etc/memcached.conf
<<
ConfFiles: %p/etc/memcached.conf
DaemonicFile: <<
<service>
 <description>Memory Cache</description>
 <message>Memory Cache</message>
 <daemon name="memcached">
  <executable background="yes">%p/sbin/start-memcached.sh</executable>
 </daemon>
</service>
<<
PostInstScript: <<
daemonic install memcached
<<
PreRmScript: <<
# clean up
if [ $1 != "upgrade" ]; then
  daemonic remove memcached
fi
<<

Homepage: http://www.danga.com/memcached/
DescDetail: <<
memcached is a high-performance, distributed memory object caching
system, generic in nature, but intended for use in speeding up
dynamic web applications by alleviating database load.
<<
