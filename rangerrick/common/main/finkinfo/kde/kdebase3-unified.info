Package: kdebase3-unified
Version: 3.5.2
Revision: 3
Description: KDE - base system
License: GPL/LGPL
Maintainer: Benjamin Reed <kdebase3@fink.racoonfink.com>

Depends: %N-shlibs (>= %v-%r), kdelibs3-unified (>= %v-1), lesstif-shlibs, libart2-shlibs, libjpeg-shlibs, libpng3-shlibs (>= 1.2.5-4), pcre-shlibs, qt3-shlibs (>= 3.3.5-3), remap-bad-apple-keys, x11, xfontpath
BuildDepends: <<
	arts-dev (>= 1.5.2-1),
	audiofile,
	autoconf2.5,
	cctools-single-module,
	cups-dev,
	cyrus-sasl2-dev,
	dbus-dev,
	dbus-qt3-dev,
	esound,
	fink (>= 0.20.2.1-1),
	fontconfig2-dev,
	freetype219,
	libgettext3-dev,
	gettext-tools,
	glib2 (>= 2.2.1-4),
	glib2-dev (>= 2.2.1-4),
	kdelibs3-unified-dev (>= %v-1),
	lesstif (>= 0.93.18-6),
	libart2,
	libjpeg,
	libiconv-dev,
	libidn,
	libogg,
	libpng3 (>= 1.2.5-4),
	libusb,
	libvorbis0,
	libmad,
	pcre,
	qt3 (>= 3.3.5-3),
	qt3-doc,
	system-openssl-dev,
	x11-dev,
	xfontpath,
	unsermake (>= 0.4-0.20060316.1)
<<
Conflicts: kio-fish
Replaces: kdebase3, kdebase3-ssl, kdebase3-dev, kdebase3-ssl-dev, kdebase3-shlibs, kdebase3-ssl-shlibs, kio-fish, lisa, kdenetwork3 (<< 3.2.0-1), kdepasswd (<< 3.3.1-1), kde-extra-themes (<< 3.4.0-1), kdeedu3 (<< 3.4.0-1)
Provides: kate, kdm, konqueror, konsole, kwrite
GCC: 3.3

CustomMirror: <<
	nam-US: http://ranger.befunk.com/fink
	nam-US: http://astrange.ithinksw.net/~astrange/ranger-fink
	nam-CA: http://www.southofheaven.net/befunk
<<
Source: mirror:kde:stable/%v/src/kdebase-%v.tar.bz2
Source-MD5: c5685e1be34e033286aa1f37002a0552
SourceDirectory: kdebase-%v
Source2: mirror:custom:kde-admindir-3.5.2-2.tar.bz2
Source2-MD5: 68eb58373b097c997bff91c1e4d48171
Source2ExtractDir: kdebase-%v

PatchScript: <<
	sed -e 's,@FINKPREFIX@,%p,g' %a/%n.patch | patch -p1 
	perl -pi -e 's,-O2,-Os,g; s,doc/HTML,doc/kde,g; s,/usr/share/doc/packages/qt3/html,%p/share/doc/qt3/html,g;' admin/*
	perl -pi -e 's/-Xlinker -framework -Xlinker (\S*)/-Wl,-framework,$1/g; s/-framework (\S*)/-Wl,-framework,$1/g;' configure
<<

NoSetLDFLAGS: true
NoSetCPPFLAGS: true

ConfigureParams: --without-nfs --with-ldap=framework --with-distribution='Fink/Mac OS X'

CompileScript: <<
#!/bin/sh -e

	export HOME=/tmp PREFIX="%p" QTDOCDIR="%p/share/doc/qt3/html" UNSERMAKE=1
	. ./environment-helper.sh
	export lt_cv_sys_max_cmd_len=65536

	export CC=gcc-3.3 CXX=g++-3.3

	export PKG_CONFIG_PATH="%p/lib/fontconfig2/lib/pkgconfig:%p/lib/freetype219/lib/pkgconfig:$PKG_CONFIG_PATH"

	case $SW_VERSION in
		10.[0123])
			perl -pi -e 's,FONTINST_SUBDIR="kfontinst",FONTINST_SUBDIR="",' kcontrol/kfontinst/configure.in.in
			;;
	esac

	./build-helper.sh cvs       %N %v %r make -f admin/Makefile.common cvs
	./build-helper.sh configure %N %v %r ./configure %c $CONFIGURE_PARAMS
	./build-helper.sh make      %N %v %r unsermake -p KDM_FLAGS="-UHAVE_UTMPX -DBSD_UTMP=1"
<<

InstallScript: <<
#!/bin/sh -e

	export HOME=/tmp PREFIX="%p" QTDOCDIR="%p/share/doc/qt3/html" UNSERMAKE=1
	. ./environment-helper.sh

	./build-helper.sh install        %N %v %r unsermake -p -j1 install DESTDIR=%d

	mkdir -p %i/share/doc/installed-packages
	touch %i/share/doc/installed-packages/%N

	touch %i/share/doc/installed-packages/kdebase3
	touch %i/share/doc/installed-packages/kdebase3-shlibs
	touch %i/share/doc/installed-packages/kdebase3-dev
	touch %i/share/doc/installed-packages/kdebase3-ssl
	touch %i/share/doc/installed-packages/kdebase3-ssl-shlibs
	touch %i/share/doc/installed-packages/kdebase3-ssl-dev

	install -d -m 755 %i/etc/pam.d
	install -c -m 444 /etc/pam.d/login %i/etc/pam.d/kde
	install -c -m 444 /etc/pam.d/login %i/etc/pam.d/kdm
	install -c -m 444 /etc/pam.d/login %i/etc/pam.d/kcheckpass
	install -c -m 444 /etc/pam.d/login %i/etc/pam.d/kscreensaver
	rm -rf %i/share/icons/crystalsvg/scalable/apps/artsbuilder.*

	mv "%i/apps/share/konsole/fonts" "%d`%p/bin/xfontpath basedir`/konsole"
<<

PostInstScript: <<
	update-alternatives --install /etc/pam.d/kde          pam.d-kde          %p/etc/pam.d/kde          50
	update-alternatives --install /etc/pam.d/kdm          pam.d-kdm          %p/etc/pam.d/kdm          50
	update-alternatives --install /etc/pam.d/kcheckpass   pam.d-kcheckpass   %p/etc/pam.d/kcheckpass   50
	update-alternatives --install /etc/pam.d/kscreensaver pam.d-kscreensaver %p/etc/pam.d/kscreensaver 50
	if test -x "%p/bin/xfontpath"; then
		"%p/bin/xfontpath" --silent install konsole
	fi
<<
PreRmScript: <<
	update-alternatives --remove pam.d-kde          %p/etc/pam.d/kde
	update-alternatives --remove pam.d-kdm          %p/etc/pam.d/kdm
	update-alternatives --remove pam.d-kcheckpass   %p/etc/pam.d/kcheckpass
	update-alternatives --remove pam.d-kscreensaver %p/etc/pam.d/kscreensaver
	if test -x "%p/bin/xfontpath"; then
		"%p/bin/xfontpath" --silent remove konsole
	fi
<<
DocFiles: AUTHORS COPYING INSTALL README README.pam
SplitOff: <<
	Package: %N-dev
	Description: KDE - base development headers and libraries
	Depends: %N (>= %v-%r), %N-shlibs (>= %v-%r)
	Replaces: kdebase3, kdebase3-ssl, kdebase3-dev, kdebase3-ssl-dev, %N (<< %v-%r), %N-dev (<< %v-1), kde-extra-themes
	BuildDependsOnly: true
	Files: <<
		include
		lib/*.la
		lib/libkasbar.dylib
		lib/libkateinterfaces.dylib
		lib/libkateutils.dylib
		lib/libkdecorations.dylib
		lib/libkfontinst.dylib
		lib/libkhotkeys_shared.dylib
		lib/libkickermain.dylib
		lib/libkonq.dylib
		lib/libkonqsidebarplugin.dylib
		lib/libksgrd.dylib
		lib/libksplashthemes.dylib
		lib/libtaskbar.dylib
		lib/libtaskmanager.dylib
	<<
<<
SplitOff2: <<
	Package: %N-shlibs
	Description: KDE - base shared libraries
	Depends: cyrus-sasl2-shlibs, kdelibs3-unified-shlibs (>= %v-1), libusb-shlibs
	Replaces: kdebase3, kdebase3-ssl, kdebase3-dev, kdebase3-ssl-dev, kdebase3-shlibs, kdebase3-ssl-shlibs, kde-extra-themes
	Recommends: %N (>= %v-%r)
	Files: <<
		lib/kde3/*_panelextension*.so
		lib/kde3/*_panelapplet*.so
		lib/kde3/*thumbnail*.so
		lib/kde3/*proxy*.so
		lib/kde3/kcm_*.so
		lib/kde3/kded_*.so
		lib/kde3/kfile_*.so
		lib/kde3/kgreet*.so
		lib/kde3/kickermenu_*.so
		lib/kde3/kio_*.so
		lib/kde3/konq_*.so
		lib/kde3/konqsidebar_*.so
		lib/kde3/ksplash*.so
		lib/kde3/kstyle*.so
		lib/kde3/kwebdesktop.so
		lib/kde3/kwin3_*.so
		lib/kde3/kwin_*.so
		lib/kde3/kxkb*.so
		lib/kde3/lib*part.so
		lib/kde3/lib*filter.so
		lib/kde3/libkhtmlkttsdplugin.so
		lib/kde3/libnsplugin.so
		lib/libkasbar.*.dylib
		lib/libkateinterfaces.*.dylib
		lib/libkateutils.*.dylib
		lib/libkdecorations.*.dylib
		lib/libkfontinst.*.dylib
		lib/libkhotkeys_shared.*.dylib
		lib/libkickermain.*.dylib
		lib/libkonq.*.dylib
		lib/libkonqsidebarplugin.*.dylib
		lib/libksgrd.*.dylib
		lib/libksplashthemes.*.dylib
		lib/libtaskbar.*.dylib
		lib/libtaskmanager.*.dylib
	<<
	Shlibs: <<
		%p/lib/libkasbar.1.dylib 2.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libkateinterfaces.0.dylib 1.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libkateutils.0.dylib 1.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libkdecorations.1.dylib 2.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libkfontinst.0.dylib 1.0.0 %N-shlibs (>= 3.5.0-1)
		%p/lib/libkhotkeys_shared.1.dylib 2.0.0 %N-shlibs (>= 3.5.0-1)
		%p/lib/libkickermain.1.dylib 2.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libkonq.4.dylib 7.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libkonqsidebarplugin.1.dylib 4.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libksgrd.1.dylib 4.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libksplashthemes.0.dylib 1.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libtaskbar.1.dylib 4.0.0 %N-shlibs (>= 3.4.0-1)
		%p/lib/libtaskmanager.1.dylib 2.0.0 %N-shlibs (>= 3.4.0-1)
	<<
<<
SplitOff3: <<
	Package: kdebase3
	Depends: %N (= %v-%r)
	Files: share/doc/installed-packages/%n
<<
SplitOff4: <<
	Package: kdebase3-dev
	Depends: %N-dev (= %v-%r)
	Files: share/doc/installed-packages/%n
<<
SplitOff5: <<
	Package: kdebase3-shlibs
	Depends: %N-shlibs (= %v-%r)
	Files: share/doc/installed-packages/%n
<<
SplitOff6: <<
	Package: kdebase3-ssl
	Depends: %N (= %v-%r)
	Files: share/doc/installed-packages/%n
<<
SplitOff7: <<
	Package: kdebase3-ssl-dev
	Depends: %N-dev (= %v-%r)
	Files: share/doc/installed-packages/%n
<<
SplitOff8: <<
	Package: kdebase3-ssl-shlibs
	Depends: %N-shlibs (= %v-%r)
	Files: share/doc/installed-packages/%n
<<
DescDetail: <<
Core applications for the K Desktop Environment.
<<
