diff -uNr kdelibs-3.4.0/dnssd/configure.in.in kdelibs-3.4.0-new/dnssd/configure.in.in
--- kdelibs-3.4.0/dnssd/configure.in.in	Thu Feb  3 18:33:05 2005
+++ kdelibs-3.4.0-new/dnssd/configure.in.in	Sat Feb 26 15:05:17 2005
@@ -16,7 +16,11 @@
 			TXTRecordDeallocate( (TXTRecordRef*) 0);
 		],[
 			AC_DEFINE(HAVE_DNSSD,1,[Define if dns-sd is available])
-                        LIB_DNSSD="-ldns_sd"
+			if [ `uname -s` = 'Darwin' ]; then
+				LIB_DNSSD="-framework System"
+			else
+                        	LIB_DNSSD="-ldns_sd"
+			fi
 			AC_MSG_RESULT(yes)
 		],[
 			AC_MSG_RESULT(no)
diff -uNr kdelibs-3.4.0/kdecore/Makefile.am kdelibs-3.4.0-new/kdecore/Makefile.am
--- kdelibs-3.4.0/kdecore/Makefile.am	Thu Feb  3 18:33:07 2005
+++ kdelibs-3.4.0-new/kdecore/Makefile.am	Sat Feb 26 15:05:17 2005
@@ -24,7 +24,7 @@
 
 if include_SVGICONS
 SVGICONS=svgicons
-SVGICON_LIB=svgicons/libkdesvgicons.la
+SVGICON_LIB=svgicons/libkdesvgicons.la $(LIBZ)
 endif
 
 SUBDIRS = malloc network $(SVGICONS) . kconfig_compiler tests
diff -uNr kdelibs-3.4.0/kdecore/kglobalsettings.cpp kdelibs-3.4.0-new/kdecore/kglobalsettings.cpp
--- kdelibs-3.4.0/kdecore/kglobalsettings.cpp	Wed Feb 23 06:56:40 2005
+++ kdelibs-3.4.0-new/kdecore/kglobalsettings.cpp	Sat Feb 26 15:05:17 2005
@@ -490,7 +490,7 @@
       s_desktopPath->append('/');
 
     // Trash Path - TODO remove in KDE4 (kio_trash can't use it for interoperability reasons)
-    *s_trashPath = *s_desktopPath + i18n("Trash") + "/";
+    *s_trashPath = *s_desktopPath + "." + i18n("Trash") + "/";
     *s_trashPath = g.readPathEntry( "Trash" , *s_trashPath);
     *s_trashPath = QDir::cleanDirPath( *s_trashPath );
     if ( !s_trashPath->endsWith("/") )
diff -uNr kdelibs-3.4.0/kdecore/ksocks.cpp kdelibs-3.4.0-new/kdecore/ksocks.cpp
--- kdelibs-3.4.0/kdecore/ksocks.cpp	Tue May 11 04:31:44 2004
+++ kdelibs-3.4.0-new/kdecore/ksocks.cpp	Sat Feb 26 15:05:17 2005
@@ -475,7 +475,7 @@
                                                    ksocklen_t addrlen) {
    if (_useSocks && F_connect)
       return (*F_connect)(sockfd, serv_addr, addrlen);
-   else return ::connect(sockfd, (sockaddr*) serv_addr, (socklen_t)addrlen);
+   else return ::connect(sockfd, (sockaddr*) serv_addr, (ksocklen_t)addrlen);
 }
 
 
@@ -498,7 +498,7 @@
    if (_useSocks && F_recvfrom) {
       return (*F_recvfrom)(s, buf, len, flags, from, fromlen);
    } else {
-      socklen_t casted_len = (socklen_t) *fromlen;
+      kde_socklen_t casted_len = (kde_socklen_t) *fromlen;
       int rc = ::recvfrom(s, (char*) buf, len, flags, from, &casted_len);
       *fromlen = casted_len;
       return rc;
@@ -510,7 +510,7 @@
                              const sockaddr *to, ksocklen_t tolen) {
    if (_useSocks && F_sendto)
       return (*F_sendto)(s, msg, len, flags, to, tolen);
-   else return ::sendto(s, (char*) msg, len, flags, to, (socklen_t)tolen);
+   else return ::sendto(s, (char*) msg, len, flags, to, (ksocklen_t)tolen);
 }
 
 
@@ -532,7 +532,7 @@
    if (_useSocks && F_getsockname) {
       return (*F_getsockname)(s, name, namelen);
    } else {
-     socklen_t casted_len = *namelen;
+     kde_socklen_t casted_len = *namelen;
      int rc = ::getsockname(s, name, &casted_len);
      *namelen = casted_len;
      return rc;
@@ -544,7 +544,7 @@
    if (_useSocks && F_getpeername) {
       return (*F_getpeername)(s, name, namelen);
    } else {
-      socklen_t casted_len = *namelen;
+      kde_socklen_t casted_len = *namelen;
       int rc = ::getpeername(s, name, &casted_len);
       *namelen = casted_len;
       return rc;
@@ -556,7 +556,7 @@
    if (_useSocks && F_accept) {
      return (*F_accept)(s, addr, addrlen);
    } else {
-      socklen_t casted_len = *addrlen;
+      kde_socklen_t casted_len = *addrlen;
       int rc = ::accept(s, addr, &casted_len);
       *addrlen = casted_len;
       return rc;
@@ -582,13 +582,13 @@
 int KSocks::bind (int sockfd, const sockaddr *my_addr, ksocklen_t addrlen) {
    if (_useSocks && F_bind)
       return (*F_bind)(sockfd, my_addr, addrlen);
-   else return ::bind(sockfd, my_addr, (socklen_t)addrlen);
+   else return ::bind(sockfd, my_addr, (ksocklen_t)addrlen);
 }
 
 int KSocks::bind (int sockfd, sockaddr *my_addr, ksocklen_t addrlen) {
    if (_useSocks && F_bind)
       return (*F_bind)(sockfd, my_addr, addrlen);
-   else return ::bind(sockfd, my_addr, (socklen_t)addrlen);
+   else return ::bind(sockfd, my_addr, (ksocklen_t)addrlen);
 }
 
 
diff -uNr kdelibs-3.4.0/kdecore/kstandarddirs.cpp kdelibs-3.4.0-new/kdecore/kstandarddirs.cpp
--- kdelibs-3.4.0/kdecore/kstandarddirs.cpp	Thu Feb  3 18:33:08 2005
+++ kdelibs-3.4.0-new/kdecore/kstandarddirs.cpp	Sat Feb 26 15:05:17 2005
@@ -1020,7 +1020,7 @@
     if (!strcmp(type, "data"))
 	return "share/apps/";
     if (!strcmp(type, "html"))
-	return "share/doc/HTML/";
+	return "share/doc/kde/";
     if (!strcmp(type, "icon"))
 	return "share/icons/";
     if (!strcmp(type, "config"))
diff -uNr kdelibs-3.4.0/kdecore/network/kresolvermanager.cpp kdelibs-3.4.0-new/kdecore/network/kresolvermanager.cpp
--- kdelibs-3.4.0/kdecore/network/kresolvermanager.cpp	Wed Feb 23 06:56:45 2005
+++ kdelibs-3.4.0-new/kdecore/network/kresolvermanager.cpp	Sat Feb 26 15:05:17 2005
@@ -31,6 +31,7 @@
 
 #ifdef HAVE_RES_INIT
 # include <sys/stat.h>
+# include <nameser.h>
 # include <resolv.h>
 # include <time.h>
 #endif
diff -uNr kdelibs-3.4.0/kdecore/network/ksocketdevice.cpp kdelibs-3.4.0-new/kdecore/network/ksocketdevice.cpp
--- kdelibs-3.4.0/kdecore/network/ksocketdevice.cpp	Thu Feb  3 18:33:08 2005
+++ kdelibs-3.4.0-new/kdecore/network/ksocketdevice.cpp	Sat Feb 26 15:05:17 2005
@@ -311,7 +311,7 @@
     }
 
   struct sockaddr sa;
-  socklen_t len = sizeof(sa);
+  kde_socklen_t len = sizeof(sa);
   int newfd = kde_accept(m_sockfd, &sa, &len);
   if (newfd == -1)
     {
@@ -385,7 +385,7 @@
 
 static int do_read_common(int sockfd, char *data, Q_ULONG maxlen, KSocketAddress* from, ssize_t &retval, bool peek = false)
 {
-  socklen_t len;
+  kde_socklen_t len;
   if (from)
     {
       from->setLength(len = 128); // arbitrary length
@@ -527,7 +527,7 @@
   if (m_sockfd == -1)
     return KSocketAddress();	// not open, empty value
 
-  socklen_t len;
+  kde_socklen_t len;
   KSocketAddress localAddress;
   localAddress.setLength(len = 32);	// arbitrary value
   if (kde_getsockname(m_sockfd, localAddress.address(), &len) == -1)
@@ -556,7 +556,7 @@
   if (m_sockfd == -1)
     return KSocketAddress();	// not open, empty value
 
-  socklen_t len;
+  kde_socklen_t len;
   KSocketAddress peerAddress;
   peerAddress.setLength(len = 32);	// arbitrary value
   if (kde_getpeername(m_sockfd, peerAddress.address(), &len) == -1)
diff -uNr kdelibs-3.4.0/kdecore/network/syssocket.h kdelibs-3.4.0-new/kdecore/network/syssocket.h
--- kdelibs-3.4.0/kdecore/network/syssocket.h	Wed Feb 23 06:56:45 2005
+++ kdelibs-3.4.0-new/kdecore/network/syssocket.h	Sat Feb 26 15:06:18 2005
@@ -53,7 +53,7 @@
   }
 
   // bind
-  inline int kde_bind(int fd, const struct sockaddr* sa, socklen_t len)
+  inline int kde_bind(int fd, const struct sockaddr* sa, kde_socklen_t len)
   {
     return ::bind(fd, sa, len);
   }
@@ -65,25 +65,25 @@
   }
 
   // connect
-  inline int kde_connect(int fd, const struct sockaddr* sa, socklen_t len)
+  inline int kde_connect(int fd, const struct sockaddr* sa, kde_socklen_t len)
   {
     return ::connect(fd, (struct sockaddr*)sa, len);
   }
 
   // accept
-  inline int kde_accept(int fd, struct sockaddr* sa, socklen_t* len)
+  inline int kde_accept(int fd, struct sockaddr* sa, kde_socklen_t* len)
   {
     return ::accept(fd, sa, len);
   }
 
   // getpeername
-  inline int kde_getpeername(int fd, struct sockaddr* sa, socklen_t* len)
+  inline int kde_getpeername(int fd, struct sockaddr* sa, kde_socklen_t* len)
   {
     return ::getpeername(fd, sa, len);
   }
 
   // getsockname
-  inline int kde_getsockname(int fd, struct sockaddr* sa, socklen_t* len)
+  inline int kde_getsockname(int fd, struct sockaddr* sa, kde_socklen_t* len)
   {
     return ::getsockname(fd, sa, len);
   }
diff -uNr kdelibs-3.4.0/kdeprint/configure.in.in kdelibs-3.4.0-new/kdeprint/configure.in.in
--- kdelibs-3.4.0/kdeprint/configure.in.in	Sat Mar 13 08:13:23 2004
+++ kdelibs-3.4.0-new/kdeprint/configure.in.in	Sat Feb 26 15:05:17 2005
@@ -80,7 +80,7 @@
 
       dnl check if CUPS is at least 1.1.20
       ac_have_new_cups="no"
-      AC_CHECK_CUPS_VERSION(1.0120)
+      AC_CHECK_CUPS_VERSION(1.0121)
       if test "$ac_have_new_cups" = "yes"; then
  	AC_DEFINE(HAVE_CUPS_NO_PWD_CACHE, 1, CUPS doesn't have password caching)
       fi
diff -uNr kdelibs-3.4.0/kdesu/su.cpp kdelibs-3.4.0-new/kdesu/su.cpp
--- kdelibs-3.4.0/kdesu/su.cpp	Tue Apr 13 09:33:21 2004
+++ kdelibs-3.4.0-new/kdesu/su.cpp	Sat Feb 26 15:05:17 2005
@@ -74,13 +74,14 @@
 	setTerminal(true);
 
     QCStringList args;
+    args += "-c";
+    args += "staff";
     if ((m_Scheduler != SchedNormal) || (m_Priority > 50))
 	args += "root";
     else
 	args += m_User;
     args += "-c";
     args += QCString(__KDE_BINDIR) + "/kdesu_stub";
-    args += "-";
 
     QCString command = __PATH_SU;
     if (::access(__PATH_SU, X_OK) != 0)
diff -uNr kdelibs-3.4.0/kdeui/Makefile.am kdelibs-3.4.0-new/kdeui/Makefile.am
--- kdelibs-3.4.0/kdeui/Makefile.am	Wed Feb 23 06:56:49 2005
+++ kdelibs-3.4.0-new/kdeui/Makefile.am	Sat Feb 26 15:05:17 2005
@@ -27,10 +27,10 @@
 AM_LDFLAGS = $(LDFLAGS_AS_NEEDED) $(LDFLAGS_NEW_DTAGS)
 
 lib_LTLIBRARIES = libkdeui.la libkspell.la
-libkdeui_la_LDFLAGS = $(KDE_MT_LDFLAGS) -no-undefined -version-info 6:0:2
+libkdeui_la_LDFLAGS = $(KDE_MT_LDFLAGS) $(all_libraries) -no-undefined -version-info 6:0:2
 libkdeui_la_LIBADD = ../kdecore/libkdecore.la
 
-libkspell_la_LDFLAGS = $(KDE_MT_LDFLAGS) -version-info 6:0:2 -no-undefined
+libkspell_la_LDFLAGS = $(KDE_MT_LDFLAGS) $(all_libraries) -version-info 6:0:2 -no-undefined
 libkspell_la_LIBADD = libkdeui.la
 libkspell_la_SOURCES = dummy.cpp
 
diff -uNr kdelibs-3.4.0/kimgio/Makefile.am kdelibs-3.4.0-new/kimgio/Makefile.am
--- kdelibs-3.4.0/kimgio/Makefile.am	Mon Jan  3 09:53:24 2005
+++ kdelibs-3.4.0-new/kimgio/Makefile.am	Sat Feb 26 15:05:17 2005
@@ -21,7 +21,7 @@
              kimg_pcx.la kimg_tga.la kimg_rgb.la kimg_xcf.la kimg_dds.la $(KIMGIO_EXR_MODULES) \
 			 kimg_psd.la
 
-KIMGIO_PLUGIN = -avoid-version -export-symbols-regex 'kimgio_.*_(read|write)'
+KIMGIO_PLUGIN = -avoid-version
 
 kimg_tiff_la_SOURCES = tiffr.cpp
 kimg_tiff_la_LDFLAGS = -module $(KIMGIO_PLUGIN) -no-undefined $(all_libraries)
diff -uNr kdelibs-3.4.0/kinit/Makefile.am kdelibs-3.4.0-new/kinit/Makefile.am
--- kdelibs-3.4.0/kinit/Makefile.am	Thu Feb  3 18:33:17 2005
+++ kdelibs-3.4.0-new/kinit/Makefile.am	Sat Feb 26 15:05:17 2005
@@ -15,7 +15,7 @@
 #    the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
 #    Boston, MA 02111-1307, USA.
 
-INCLUDES = -I$(srcdir)/../libltdl/ $(all_includes) $(KDEINIT_XFT_INCLUDES)
+INCLUDES = -I$(srcdir)/../libltdl/ $(KDEINIT_XFT_INCLUDES) $(all_includes)
 
 SUBDIRS = . tests
 
diff -uNr kdelibs-3.4.0/kinit/setproctitle.cpp kdelibs-3.4.0-new/kinit/setproctitle.cpp
--- kdelibs-3.4.0/kinit/setproctitle.cpp	Fri Nov 12 19:01:44 2004
+++ kdelibs-3.4.0-new/kinit/setproctitle.cpp	Sat Feb 26 15:05:17 2005
@@ -76,7 +76,9 @@
 # endif
 # if SPT_TYPE == SPT_PSSTRINGS
 #  include <machine/vmparam.h>
-#  include <sys/exec.h>
+#  ifdef HAVE_SYS_EXEC_H
+#    include <sys/exec.h>
+#  endif
 #  ifndef PS_STRINGS	/* hmmmm....  apparently not available after all */
 #   undef SPT_TYPE
 #   define SPT_TYPE	SPT_REUSEARGV
diff -uNr kdelibs-3.4.0/kio/kssl/kopenssl.cc kdelibs-3.4.0-new/kio/kssl/kopenssl.cc
--- kdelibs-3.4.0/kio/kssl/kopenssl.cc	Tue May 11 04:31:45 2004
+++ kdelibs-3.4.0-new/kio/kssl/kopenssl.cc	Sat Feb 26 15:05:17 2005
@@ -322,6 +322,7 @@
              #elif defined(_AIX)
              << "libcrypto.a(libcrypto.so.0)"
 	     #elif defined(__APPLE__)
+	     << "libcrypto.0.9.7.dylib"
 	     << "libcrypto.dylib"
 	     << "libcrypto.0.9.dylib"
 	     #else
diff -uNr kdelibs-3.4.0/kio/misc/kpac/Makefile.am kdelibs-3.4.0-new/kio/misc/kpac/Makefile.am
--- kdelibs-3.4.0/kio/misc/kpac/Makefile.am	Thu Dec 25 10:52:00 2003
+++ kdelibs-3.4.0-new/kio/misc/kpac/Makefile.am	Sat Feb 26 15:05:17 2005
@@ -10,7 +10,7 @@
 kded_proxyscout_la_SOURCES = proxyscout.skel proxyscout.cpp script.cpp \
                              downloader.cpp discovery.cpp
 kded_proxyscout_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_proxyscout_la_LIBADD = $(LIB_KIO) $(top_builddir)/kjs/libkjs.la
+kded_proxyscout_la_LIBADD = $(LIB_KIO) $(top_builddir)/kjs/libkjs.la $(LIBRESOLV)
 
 kpac_dhcp_helper_SOURCES = kpac_dhcp_helper.c
 kpac_dhcp_helper_LDADD = $(LIBSOCKET)
diff -uNr kdelibs-3.4.0/kioslave/http/configure.in.in kdelibs-3.4.0-new/kioslave/http/configure.in.in
--- kdelibs-3.4.0/kioslave/http/configure.in.in	Thu Nov  4 16:05:13 2004
+++ kdelibs-3.4.0-new/kioslave/http/configure.in.in	Sat Feb 26 15:05:17 2005
@@ -69,7 +69,7 @@
 case "$with_gssapi" in
 no) AC_MSG_RESULT(no) ;;
 framework)
-  GSSAPI_LIBS="-Xlinker -framework -Xlinker GSSAPI"
+  GSSAPI_LIBS="-Xlinker -framework -Xlinker Kerberos"
   AC_DEFINE_UNQUOTED(HAVE_LIBGSSAPI, 1, [Define if you have GSSAPI libraries])
   GSSAPI_SUBDIR="gssapi"
   AC_MSG_RESULT(Apple framework)
