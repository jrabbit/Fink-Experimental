Package: icecream
Version: 0.6
Revision: 11
Depends: kdelibs3-ssl-shlibs | kdelibs3-shlibs, libgnugetopt-shlibs
Suggests: ccache
BuildDepends: kdelibs3-ssl-dev | kdelibs3-dev, libgnugetopt
Maintainer: Benjamin Reed <icecream@fink.racoonfink.com>
Source: ftp://ftp.suse.com/pub/projects/%n/%n-%v-20040829.tar.bz2
Source-MD5: 969bb373964f31a26198a00b57c54d5a
SourceDirectory: %N
Patch: %n.patch
NoSetCPPFLAGS: true
SetCPPFLAGS: -no-cpp-precomp -I./src -I./lzo -I%p/include -I%p/include/gnugetopt
SetLIBS: -L%p/lib -lgnugetopt
ConfigureParams:  --mandir=%p/share/man --infodir=%p/share/info --with-qt-dir=%p --with-qt-includes=%p/include/qt
CompileScript: <<
#!/bin/sh -ex
  unset DISTCC_HOSTS
  unset CCACHE_PREFIX
  ./configure %c
  make
<<
InstallScript: <<
#!/bin/sh -ex

  make install DESTDIR="%d"
  mv %i/bin/scheduler %i/bin/icescheduler
  rm -rf %i/bin/c++
  rm -rf %i/bin/cc
  rm -rf %i/bin/g++
  rm -rf %i/bin/gcc

  install -d -m 755 %i/etc
  cat <<END > %i/etc/icecream.conf
# Enable building with multiple concurrent make
# sessions by default -- this can cause problems
# with building some packages.  If you have issues
# building a package, comment this back out and
# try again.
#MAKEFLAGS=-j4
END

  install -d -m 755 %i/etc/profile.d
  cat <<END > %i/etc/profile.d/icecream.sh
#### DO NOT EDIT BELOW HERE ####
grep -q -E '^ *MAKEFLAGS' %p/etc/icecream.conf       && export MAKEFLAGS=\`grep MAKEFLAGS %p/etc/icecream.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
END
  cat <<END > %i/etc/profile.d/icecream.csh
#### DO NOT EDIT BELOW HERE ####
grep -q -E '^ *MAKEFLAGS' %p/etc/icecream.conf       && setenv MAKEFLAGS \`grep MAKEFLAGS %p/etc/icecream.conf | grep -v '^ *#' | tr -d \'\" | cut -d= -f2\`
END

 chmod 755 %i/etc/profile.d/*
<<
SplitOff: <<
  Package: %N-default
  Depends: %N (>= %v-%r), ccache (>= 2.2), ccache-default (>= 2.2)
  Description: Enable icecream+ccache by default
  RuntimeVars: <<
    CCACHE_PREFIX: icecc
  <<
<<
ConfFiles: %p/etc/icecream.conf
DocFiles: README TODO
Description: Centralized distributed compilation tool
DescDetail: <<
Icecream is created by SUSE and is based on ideas and code by distcc.
Like distcc it takes compile jobs from your (KDE) build and distributes
it to remote machines allowing a parallel build on several machines
you've got.  But unlike distcc Icecream uses a central server that
schedules the compile jobs to the fastest free server and is as this
dynamic.  This advantage pays off mostly for shared computers, if
you're the only user on x machines, you have full control over them
anyway.
<<
Homepage: http://wiki.kde.org/tiki-index.php?page=icecream
License: GPL
