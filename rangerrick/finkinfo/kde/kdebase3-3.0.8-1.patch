Index: admin/Makefile.common
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/Makefile.common,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
Index: admin/acinclude.m4.in
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/acinclude.m4.in,v
retrieving revision 1.1.1.4
retrieving revision 1.15
diff -u -u -r1.1.1.4 -r1.15
--- admin/acinclude.m4.in	1 Oct 2002 01:44:25 -0000	1.1.1.4
+++ admin/acinclude.m4.in	1 Oct 2002 01:46:54 -0000	1.15
@@ -699,13 +699,10 @@
      AC_CHECK_LIB(ipc, shmat, X_EXTRA_LIBS="$X_EXTRA_LIBS -lipc"))
    
    # darwin needs this to initialize the environment
-   AC_CHECK_HEADERS(crt_externs.h)
+   AC_CHECK_HEADERS([crt_externs.h sys/types.h])
    AC_CHECK_FUNC(_NSGetEnviron, [AC_DEFINE(HAVE_NSGETENVIRON, 1, [Define if your system needs _NSGetEnviron to set up the environment])])
  
-   # more headers that need to be explicitly included on darwin
-   AC_CHECK_HEADERS(sys/types.h stdint.h)
-
-   # darwin requires a poll emulation library
+   # darwin requires a poll.h emulation library
    AC_CHECK_LIB(poll, poll, LIB_POLL="-lpoll")
 
    # CoreAudio framework
@@ -714,6 +711,12 @@
      FRAMEWORK_COREAUDIO="-framework CoreAudio"
    ])
 
+   # CoreServices framework
+   AC_CHECK_HEADER(CoreServices/CoreServices.h, [
+     AC_DEFINE(HAVE_CORESERVICES, 1, [Define if you have the CoreServices API])
+     FRAMEWORK_CORESERVICES="-framework CoreServices"
+   ])
+
    # Solaris 2.6 and others need -lresolv for res_init
    AC_CHECK_FUNCS(res_init, , [
      kde_libs_safe="$LIBS"
@@ -736,6 +739,8 @@
    AC_SUBST(FRAMEWORK_COREAUDIO)
    LIBSOCKET="$X_EXTRA_LIBS"
    AC_SUBST(LIBSOCKET)
+   AC_SUBST(FRAMEWORK_COREAUDIO)
+   AC_SUBST(LIB_POLL)
    AC_SUBST(LIBRESOLV)
    AC_SUBST(X_EXTRA_LIBS)
    AC_CHECK_LIB(ucb, killpg, [LIBUCB="-lucb"]) dnl for Solaris2.4
@@ -905,7 +910,7 @@
 kde_ldflags_safe="$LDFLAGS"
 kde_libs_safe="$LIBS"
 
-LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS"
+LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS"
 LIBS="-lXext -lX11 $LIBSOCKET"
 
 AC_TRY_LINK([
@@ -947,9 +952,9 @@
 kde_save_LDFLAGS="$LDFLAGS"
 kde_save_CFLAGS="$CFLAGS"
 kde_save_LIBS="$LIBS"
-LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS"
+LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS"
 CFLAGS="$CFLAGS -I$x_includes"
-LIBS="-lXinerama -lXext"
+LIBS="-lXinerama -lXext -lX11"
 
 if test "x$no_xinerama" = "xno"; then
 
@@ -1846,15 +1851,29 @@
    AC_REQUIRE([K_PATH_X])
 
 if test $kde_qtver = 3; then
+   AC_SUBST(LIB_ARTSKDE, "-lartskde")
+   AC_SUBST(LIB_DCOP, "-lDCOP")
+   AC_SUBST(LIB_KAB, "-lkab")
+   AC_SUBST(LIB_KABC, "-lkabc")
    AC_SUBST(LIB_KDECORE, "-lkdecore")
+   AC_SUBST(LIB_KDED, "@PREFIX@/lib/kded.la")
+   AC_SUBST(LIB_KDEFX, "-lkdefx")
+   AC_SUBST(LIB_KDEPRINT, "-lkdeprint")
+   AC_SUBST(LIB_KDESASL, "-lkdesasl")
+   AC_SUBST(LIB_KDESU, "-lkdesu")
    AC_SUBST(LIB_KDEUI, "-lkdeui")
-   AC_SUBST(LIB_KIO, "-lkio")
-   AC_SUBST(LIB_SMB, "-lsmb")
-   AC_SUBST(LIB_KAB, "-lkab")
    AC_SUBST(LIB_KHTML, "-lkhtml")
-   AC_SUBST(LIB_KSPELL, "-lkspell")
+   AC_SUBST(LIB_KIO, "-lkio")
    AC_SUBST(LIB_KPARTS, "-lkparts")
-   AC_SUBST(LIB_KDEPRINT, "-lkdeprint")
+   AC_SUBST(LIB_KJAVA, "-lkjava")
+   AC_SUBST(LIB_KJS, "-lkjs")
+   AC_SUBST(LIB_KMID, "-lkmid")
+   AC_SUBST(LIB_KSCRIPT, "-lkscript")
+   AC_SUBST(LIB_KSPELL, "-lkspell")
+   AC_SUBST(LIB_KTEXTEDITOR, "-lktexteditor")
+   AC_SUBST(LIB_SHELLSCRIPT, "-lshellscript")
+   AC_SUBST(LIB_SMB, "-lsmb")
+   AC_SUBST(LIB_VCARD, "-lvcard")
 # these are for backward compatibility
    AC_SUBST(LIB_KSYCOCA, "-lkio")
    AC_SUBST(LIB_KFILE, "-lkio")
@@ -2544,10 +2563,10 @@
       if test $kde_use_debug_code = "full"; then
         CFLAGS="-g3 $CFLAGS"
       else
-        CFLAGS="-g -O2 $CFLAGS"
+        CFLAGS="-g -O $CFLAGS"
       fi
     else
-      CFLAGS="-O2 $CFLAGS"
+      CFLAGS="-Os -Ddlsym=dlsym_auto_underscore -frename-registers -mmultiple -mcpu=750 -mtune=750 $CFLAGS"
     fi
   fi
 
@@ -2577,7 +2596,7 @@
         if test "$kde_use_debug_code" = "full"; then
           CXXFLAGS="-g3 $CXXFLAGS"
         else
-          CXXFLAGS="-g -O2 $CXXFLAGS"
+          CXXFLAGS="-g -O $CXXFLAGS"
         fi
       fi
       KDE_CHECK_COMPILER_FLAG(fno-builtin,[CXXFLAGS="-fno-builtin $CXXFLAGS"])
@@ -2589,7 +2608,7 @@
       if test "$CXX" = "KCC"; then
         CXXFLAGS="+K3 $CXXFLAGS"
       else
-        CXXFLAGS="-O2 $CXXFLAGS"
+        CXXFLAGS="-Os -Ddlsym=dlsym_auto_underscore -frename-registers -mmultiple -mcpu=750 -mtune=750 $CXXFLAGS"
       fi  
     fi
   fi
@@ -3058,9 +3077,9 @@
     ac_save_ldflags="$LDFLAGS"
     ac_save_cflags="$CFLAGS"
     if test "x$kde_use_qt_emb" != "xyes"; then
-      LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm -lX11 -lXext $LIBZ $LIBSOCKET"
+      LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm -lX11 -lXext $LIBZ $LIBSOCKET"
     else
-      LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm $LIBZ $LIBSOCKET"
+      LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm $LIBZ $LIBSOCKET"
     fi
     CFLAGS="$CFLAGS $X_INCLUDES $USER_INCLUDES"
     test -n "$XPM_INCLUDE" && CFLAGS="-I$XPM_INCLUDE $CFLAGS"
@@ -4555,6 +4574,7 @@
       KDE_JAVA_PREFIX(/usr/lib/IBMJava2*)
       KDE_JAVA_PREFIX(/usr/lib/IBMJava*)
       KDE_JAVA_PREFIX(/opt/java*)
+      KDE_JAVA_PREFIX(/Library/Java/Home)
     
       kde_cv_path="NONE"
       kde_save_IFS=$IFS
@@ -4606,10 +4626,20 @@
 dnl At this point kde_java_bindir and kde_java_includedir are either set or "no"
 if test "x$kde_java_bindir" != "xno"; then
 
+  case $host_os in
+    darwin*)
+      dnl Look for libjvm.dylib
+      kde_java_libjvmdir=`find $kde_java_bindir/.. -name libjvm.dylib | sed 's,libjvm.dylib,,'|head -n 1`
+      kd_java_libhpidir=''
+      dnl Darwin doesn't have libhpi
+      ;;
+    *)
   dnl Look for libjvm.so
   kde_java_libjvmdir=`find $kde_java_bindir/.. -name libjvm.so | sed 's,libjvm.so,,'|head -n 1`
   dnl Look for libhpi.so and avoid green threads
-  kde_java_libhpidir=`find $kde_java_bindir/.. -name libhpi.so | grep -v green | sed 's,libhpi.so,,' | head -n 1`
+  kde_java_libhpidir=`find $kde_java_bindir/.. -name libhpi.so | grep -v green | sed 's,libhpi.so,,' | tail -n 1`
+      ;;
+  esac
 
   dnl Now check everything's fine under there
   dnl the include dir is our flag for having the JDK
@@ -4638,17 +4668,29 @@
     JAVAC=
     jni_includes=
   fi
-
+  case $host_os in
+    darwin*)
+      if test ! -r "$kde_java_libjvmdir/libjvm.dylib"; then
+        AC_MSG_ERROR([libjvm.dylib not found under $kde_java_libjvmdir. Use --without-java.])
+      fi
+      dnl Darwin doesn't have libhpi, but it's not fatal
+      LIB_JVM="-framework JavaVM"
+      LIB_HPI=""
+      ;;
+    *)
   if test ! -r "$kde_java_libjvmdir/libjvm.so"; then
      AC_MSG_ERROR([libjvm.so not found under $kde_java_libjvmdir. Use --without-java.])
   fi 
+      LIB_JVM="-L$kde_java_libjvmdir -ljvm"
+      if test ! -r "$kde_java_libhpidir/libhpi.so"; then
+        AC_MSG_ERROR([libhpi.so not found under $kde_java_libhpidir. Use --without-java.])
+      fi
+      LIB_HPI="-L$kde_java_libhpidir -lhpi"
+      ;;
+  esac
 
   if test ! -x "$kde_java_bindir/java"; then
       AC_MSG_ERROR([java not found under $kde_java_bindir. javac was found though! Use --with-java or --without-java.])
-  fi
-
-  if test ! -r "$kde_java_libhpidir/libhpi.so"; then
-    AC_MSG_ERROR([libhpi.so not found under $kde_java_libhpidir. Use --without-java.])
   fi
 
   if test -n "$jni_includes"; then
Index: admin/detect-autoconf.sh
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/detect-autoconf.sh,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- admin/detect-autoconf.sh	10 Jul 2002 02:47:38 -0000	1.1.1.1
+++ admin/detect-autoconf.sh	15 Jul 2002 22:55:00 -0000	1.2
@@ -42,12 +42,12 @@
 checkAutomakeAclocal ()
 {
   if test -z "$UNSERMAKE"; then
-    if test -x "`$WHICH automake-1.5`" ; then
-      AUTOMAKE="`$WHICH automake-1.5`"
-      ACLOCAL="`$WHICH aclocal-1.5`"
-    elif test -x "`$WHICH automake-1.6`" ; then
+    if test -x "`$WHICH automake-1.6`" ; then
       AUTOMAKE="`$WHICH automake-1.6`"
       ACLOCAL="`$WHICH aclocal-1.6`"
+    elif test -x "`$WHICH automake-1.5`" ; then
+      AUTOMAKE="`$WHICH automake-1.5`"
+      ACLOCAL="`$WHICH aclocal-1.5`"
     fi
   else
      AUTOMAKE="$UNSERMAKE"
Index: admin/libtool.m4.in
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/libtool.m4.in,v
retrieving revision 1.1.1.3
retrieving revision 1.7
diff -u -u -r1.1.1.3 -r1.7
--- admin/libtool.m4.in	14 Aug 2002 13:18:45 -0000	1.1.1.3
+++ admin/libtool.m4.in	16 Sep 2002 14:31:34 -0000	1.7
@@ -609,6 +609,12 @@
     lt_cv_sys_max_cmd_len=-1;
     ;;
 
+  darwin*)
+    # this should be enough... the length test freaks out some versions
+    # of OSX's `expr`
+    lt_cv_sys_max_cmd_len=16384;
+    ;;
+
   *)
     # If test is not a shell built-in, we'll probably end up computing a
     # maximum length that is only half of the actual maximum length, but
@@ -1132,7 +1138,7 @@
 darwin* | rhapsody*)
   dynamic_linker="$host_os dyld"
   version_type=darwin
-  need_lib_prefix=no
+  need_lib_prefix=yes
   need_version=no
   # FIXME: Relying on posixy $() will cause problems for
   #        cross-compilation, but unfortunately the echo tests do not
@@ -1901,16 +1907,7 @@
   ;;
 
 darwin* | rhapsody*)
-  lt_cv_deplibs_check_method='file_magic Mach-O dynamically linked shared library'
-  lt_cv_file_magic_cmd='/usr/bin/file -L'
-  case "$host_os" in
-  rhapsody* | darwin1.[[012]])
-    lt_cv_file_magic_test_file=`/System/Library/Frameworks/System.framework/System`
-    ;;
-  *) # Darwin 1.3 on
-    lt_cv_file_magic_test_file='/usr/lib/libSystem.dylib'
-    ;;
-  esac
+  lt_cv_deplibs_check_method='pass_all'
   ;;
 
 freebsd*)
@@ -2560,6 +2557,11 @@
 	;;
     esac
     ;;
+  darwin*)
+    shared_flag='-dynamiclib'
+    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs && $CC -dynamiclib -install_name $rpath/$soname $predep_objects ${lib}-master.o $deplibs $postdep_objects $compiler_flags -o $lib'
+    output_verbose_link_cmd='$CC -dynamiclib $CFLAGS -v conftest.$objext 2>&1 | egrep "\-L"'
+    ;;
   dgux*)
     case $cc_basename in
       ec++)
@@ -4750,7 +4752,9 @@
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
 	;;
       *) # Darwin 1.3 on
-	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+	#_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+        # testing with twolevel namespaces
+	_LT_AC_TAGVAR(allow_undefined_flag, $1)=unsupported
 	;;
       esac
 
@@ -4758,7 +4762,7 @@
       #        cross-compilation, but unfortunately the echo tests do not
       #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
       #	       `"' quotes if we put them in here... so don't!
-      _LT_AC_TAGVAR(archive_cmds, $1)='$CC $(test .$module = .yes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib $libobjs $deplibs$linker_flags -install_name $rpath/$soname $verstring'
+      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs && $CC $(test .$module = .yes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $linker_flags $(test x$module != xyes && echo -install_name $rpath/$soname $verstring)'
       # We need to add '_' to the symbols in $export_symbols first
       #_LT_AC_TAGVAR(archive_expsym_cmds, $1)="$_LT_AC_TAGVAR(archive_cmds, $1)"' && strip -s $export_symbols'
       _LT_AC_TAGVAR(hardcode_direct, $1)=yes
Index: admin/ltconfig
===================================================================
RCS file: admin/ltconfig
diff -N admin/ltconfig
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ admin/ltconfig	25 Jun 2002 03:34:27 -0000	1.1.1.1
@@ -0,0 +1,4 @@
+#! /bin/sh
+# Written by <matz@kde.org> and placed into the public domain ;-)
+echo "This file shouldn't be called.  It exists solely for the purpose"
+echo "to make automake 1.4 cope with newer libtools."
Index: admin/ltmain.sh
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/ltmain.sh,v
retrieving revision 1.1.1.2
retrieving revision 1.4
diff -u -u -r1.1.1.2 -r1.4
--- admin/ltmain.sh	10 Jul 2002 02:47:39 -0000	1.1.1.2
+++ admin/ltmain.sh	13 Jul 2002 04:33:25 -0000	1.4
@@ -3321,7 +3321,23 @@
 	if test -n "$export_symbols" && test -n "$archive_expsym_cmds"; then
 	  eval cmds=\"$archive_expsym_cmds\"
 	else
+          if test "x$verstring" = "x0.0"; then
+                tmp_verstring=
+          else
+                tmp_verstring="$verstring"
+          fi
+ 	  save_deplibs="$deplibs"
+ 	  for conv in $convenience; do
+            tmp_deplibs=
+            for test_deplib in $deplibs; do
+              if test "$test_deplib" != "$conv"; then
+                tmp_deplibs="$tmp_deplibs $test_deplib"
+              fi
+            done
+            deplibs="$tmp_deplibs"
+ 	  done
 	  eval cmds=\"$archive_cmds\"
+ 	  deplibs="$save_deplibs"
 	fi
 
 	if len=`expr "X$cmds" : ".*"` &&
@@ -3419,7 +3435,12 @@
 	  if test -n "$export_symbols" && test -n "$archive_expsym_cmds"; then
 	    eval cmds=\"$archive_expsym_cmds\"
 	  else
-	    eval cmds=\"$archive_cmds\"
+            save_deplibs="$deplibs"
+            for conv in $convenience; do
+              deplibs="${deplibs%$conv*} ${deplibs#*$conv}"
+            done
+            eval cmds=\"$archive_cmds\"
+            deplibs="$save_deplibs"
 	  fi
 
 	  # Append the command to remove the reloadable object files
@@ -3632,6 +3653,14 @@
 	compile_deplibs=`$echo "X $compile_deplibs" | $Xsed -e 's/ -lc / -framework System /'`
 	finalize_deplibs=`$echo "X $finalize_deplibs" | $Xsed -e 's/ -lc / -framework System /'`
 	;;
+      esac
+
+      case $host in
+      *darwin*)
+        # Don't allow lazy linking, it breaks C++ global constructors
+        compile_command="$compile_command ${wl}-bind_at_load"
+        finalize_command="$finalize_command ${wl}-bind_at_load"
+        ;;
       esac
 
       compile_command="$compile_command $compile_deplibs"
Index: admin/missing
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/admin/missing,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- admin/missing	10 Jul 2002 02:47:39 -0000	1.1.1.2
+++ admin/missing	10 Jul 2002 02:50:11 -0000	1.3
@@ -106,7 +106,7 @@
     exit 1
     ;;
 
-  aclocal)
+  aclocal*)
     echo 1>&2 "\
 WARNING: \`$1' is missing on your system.  You should only need it if
          you modified \`acinclude.m4' or \`${configure_ac}'.  You might want
@@ -143,7 +143,7 @@
     touch $touch_files
     ;;
 
-  automake)
+  automake*)
     echo 1>&2 "\
 WARNING: \`$1' is missing on your system.  You should only need it if
          you modified \`Makefile.am', \`acinclude.m4' or \`${configure_ac}'.
Index: startkde
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/startkde,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- startkde	1 Oct 2002 02:32:40 -0000	1.1.1.4
+++ startkde	1 Oct 2002 03:01:44 -0000	1.5
@@ -30,6 +30,9 @@
 # people's heads. We use colours from the standard KDE palette for those with
 # palettised displays.
 
+# we have to unset this for Darwin since it will screw up KDE's dynamic-loading
+unset DYLD_FORCE_FLAT_NAMESPACE
+
 test "$XDM_MANAGED" || bkg="-solid #C0C0C0"
 xsetroot -cursor_name left_ptr $bkg
 
@@ -134,7 +137,11 @@
 fi
 
 # the splashscreen and progress indicator
-ksplash
+if [ -x "@PREFIX@/bin/ksplashml" ]; then
+	ksplashml
+else
+	ksplash
+fi
 
 # We set LD_BIND_NOW to increase the efficiency of kdeinit.
 # kdeinit unsets this variable before loading applications.
Index: debian/konsole.links
===================================================================
RCS file: debian/konsole.links
diff -N debian/konsole.links
Index: doc/kaddressbook/index.cache.bz2
===================================================================
RCS file: doc/kaddressbook/index.cache.bz2
diff -N doc/kaddressbook/index.cache.bz2
Binary files /dev/null and /tmp/cvs005595 differ
Index: kate/app/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kate/app/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.6
diff -u -u -r1.1.1.3 -r1.6
--- kate/app/Makefile.am	14 Aug 2002 14:26:29 -0000	1.1.1.3
+++ kate/app/Makefile.am	15 Aug 2002 15:26:45 -0000	1.6
@@ -7,17 +7,18 @@
 	kateviewmanager.cpp kateviewspace.cpp katemain.cpp \
 	kateIface.skel kategrepdialog.cpp katefiledialog.cpp katemailfilesdialog.cpp \
         kbookmarkhandler.cpp kactionselector.cpp katedockcontainer.cpp
-
-libkateinterfaces_la_LIBADD   = ../interfaces/libkateinterfacesprivate.la -lkscript ../lib/libkmultitabbar.la
+libkateinterfaces_la_LIBADD   = $(top_builddir)/kate/interfaces/libkateinterfacesprivate.la -lkscript $(top_builddir)/kate/lib/libkmultitabbar.la
 libkateinterfaces_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
 
 kate_la_SOURCES = dummy_kate_la.cpp
-kate_la_LIBADD = libkateinterfaces.la
-kate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version 
+kate_la_LIBADD   = libkateinterfaces.la -lkscript $(LIB_DCOP) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) \
+	$(LIB_KPARTS) $(LIB_KIO) $(top_builddir)/kate/lib/libkmultitabbar.la
+kate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version $(QT_LDFLAGS)
 
 kwrite_la_SOURCES = kwritemain.cpp katefiledialog.cpp kwritedialogs.cpp
-kwrite_la_LIBADD   = -lktexteditor
-kwrite_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+kwrite_la_LIBADD  = libkateinterfaces.la $(LIB_DCOP) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) \
+	$(LIB_KPARTS) $(LIB_KIO) -lktexteditor
+kwrite_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version $(QT_LDFLAGS)
 
 kate_SOURCES = dummy_kate.cpp
 kate_LDADD = kate.la
Index: kate/interfaces/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kate/interfaces/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.5
diff -u -u -r1.1.1.3 -r1.5
--- kate/interfaces/Makefile.am	14 Aug 2002 14:26:30 -0000	1.1.1.3
+++ kate/interfaces/Makefile.am	14 Aug 2002 15:35:40 -0000	1.5
@@ -2,11 +2,12 @@
 
 noinst_LTLIBRARIES = libkateinterfacesprivate.la
 
-libkateinterfacesprivate_la_SOURCES = application.cpp mainwindow.cpp documentmanager.cpp viewmanager.cpp toolviewmanager.cpp \
-                                                           pluginmanager.cpp plugin.cpp \
-                                                           pluginconfiginterface.cpp pluginconfiginterfaceextension.cpp
-libkateinterfacesprivate_la_LIBADD   = -lkatepartinterfaces
-libkateinterfacesprivate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+libkateinterfacesprivate_la_SOURCES = application.cpp mainwindow.cpp documentmanager.cpp viewmanager.cpp \
+	toolviewmanager.cpp pluginmanager.cpp plugin.cpp pluginconfiginterface.cpp \
+	pluginconfiginterfaceextension.cpp
+libkateinterfacesprivate_la_LIBADD   = -lkatepartinterfaces $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_QT) $(LIB_DCOP) $(LIB_KPARTS)
+
+libkateinterfacesprivate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(QT_LDFLAGS)
 
 kateinclude_HEADERS = application.h documentmanager.h mainwindow.h plugin.h viewmanager.h pluginconfiginterface.h pluginconfiginterfaceextension.h toolviewmanager.h pluginmanager.h
 kateincludedir = $(includedir)/kate
Index: kcontrol/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
Index: kcontrol/access/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/access/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/access/Makefile.am	1 Oct 2002 02:33:58 -0000	1.1.1.3
+++ kcontrol/access/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -12,12 +12,12 @@
 lib_LTLIBRARIES = kaccess.la
 
 kaccess_la_SOURCES = kaccess.cpp main.cpp
-kaccess_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kaccess_la_LIBADD = $(LIB_KDEUI)
+kaccess_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+kaccess_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 
 kcm_access_la_SOURCES = kcmaccess.cpp 
-kcm_access_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_access_la_LIBADD = $(LIB_KIO)
+kcm_access_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_access_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 noinst_HEADERS = kcmaccess.h
 
Index: kcontrol/arts/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/arts/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/arts/Makefile.am	1 Oct 2002 02:33:59 -0000	1.1.1.3
+++ kcontrol/arts/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -2,8 +2,8 @@
 
 kcm_arts_la_SOURCES = arts.cpp midi.cpp arts_general.ui arts_soundio.ui
 
-kcm_arts_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_arts_la_LIBADD = -lkio -lkmid
+kcm_arts_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_arts_la_LIBADD = -lkio -lkmid $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES = -I$(kde_includes)/arts  $(all_includes)
 
Index: kcontrol/background/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/background/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/background/Makefile.am	1 Oct 2002 02:34:00 -0000	1.1.1.3
+++ kcontrol/background/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -6,10 +6,11 @@
 
 kde_module_LTLIBRARIES = kcm_background.la
 
-kcm_background_la_SOURCES = bgdialogs.cpp backgnd.cpp main.cpp backgndbase.ui \
-                            bgadvanced.ui advancedDialog.cpp
-kcm_background_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined
-kcm_background_la_LIBADD = libbgnd.la $(LIB_KIO)
+kcm_background_la_SOURCES = backgnd.cpp bgdialogs.cpp main.cpp backgndbase.ui \
+			    bgadvanced.ui advancedDialog.cpp
+kcm_background_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_background_la_LIBADD = $(LIB_KIO) libbgnd.la $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) \
+	$(LIB_DCOP) $(LIB_KDEFX)
 
 METASOURCES = AUTO
 
Index: kcontrol/bell/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/bell/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/bell/Makefile.am	25 Jun 2002 02:03:44 -0000	1.1.1.1
+++ kcontrol/bell/Makefile.am	25 Jun 2002 02:06:13 -0000	1.2
@@ -3,7 +3,7 @@
 kcm_bell_la_SOURCES = bell.cpp
 
 kcm_bell_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_bell_la_LIBADD = -lkdeui
+kcm_bell_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/clock/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/clock/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/clock/Makefile.am	25 Jun 2002 02:03:44 -0000	1.1.1.1
+++ kcontrol/clock/Makefile.am	25 Jun 2002 02:06:13 -0000	1.2
@@ -2,8 +2,8 @@
 
 kcm_clock_la_SOURCES = dtime.cpp tzone.cpp main.cpp 
 
-kcm_clock_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_clock_la_LIBADD = -lkdeui
+kcm_clock_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_clock_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 
 INCLUDES= $(all_includes)
  
Index: kcontrol/colors/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/colors/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/colors/Makefile.am	14 Aug 2002 14:29:16 -0000	1.1.1.2
+++ kcontrol/colors/Makefile.am	14 Aug 2002 15:35:41 -0000	1.3
@@ -5,8 +5,9 @@
 kde_module_LTLIBRARIES = kcm_colors.la
 
 kcm_colors_la_SOURCES = colorscm.cpp widgetcanvas.cpp 
-kcm_colors_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined
-kcm_colors_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(top_builddir)/kcontrol/krdb/libkrdb.la
+kcm_colors_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_colors_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kcontrol/krdb/libkrdb.la $(LIB_X11) $(LIB_QT) \
+	$(LIB_KDECORE) $(LIB_KDEFX) $(LIB_KIO)
 kcm_colors_la_METASOURCES = colorscm.moc widgetcanvas.moc
 
 noinst_HEADERS = colorscm.h widgetcanvas.h
Index: kcontrol/crypto/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/crypto/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/crypto/Makefile.am	1 Oct 2002 02:34:03 -0000	1.1.1.3
+++ kcontrol/crypto/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -3,8 +3,8 @@
 
 kcm_crypto_la_SOURCES = crypto.cpp certexport.cpp kdatetimedlg.cpp
 
-kcm_crypto_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) $(SSL_LDFLAGS) -module -avoid-version -no-undefined
-kcm_crypto_la_LIBADD = -lkdeui $(LIB_KIO) $(LIBSSL)
+kcm_crypto_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) $(SSL_LDFLAGS) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_crypto_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBSSL) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 kcm_crypto_la_METASOURCES = AUTO
 
Index: kcontrol/css/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/css/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/css/Makefile.am	1 Oct 2002 02:34:03 -0000	1.1.1.3
+++ kcontrol/css/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -5,8 +5,8 @@
 
 kde_module_LTLIBRARIES = kcm_css.la
 kcm_css_la_SOURCES = template.cpp cssconfig.ui kcmcss.cpp preview.ui
-kcm_css_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_css_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_css_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_css_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 kcm_css_la_METASOURCES = AUTO
  
Index: kcontrol/ebrowsing/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/ebrowsing/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/ebrowsing/Makefile.am	1 Oct 2002 02:34:03 -0000	1.1.1.2
+++ kcontrol/ebrowsing/Makefile.am	1 Oct 2002 03:01:45 -0000	1.3
@@ -10,8 +10,8 @@
 
 kcm_kurifilt_la_SOURCES = filteropts.cpp main.cpp
 
-kcm_kurifilt_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kurifilt_la_LIBADD = $(LIB_KSYCOCA)
+kcm_kurifilt_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_kurifilt_la_LIBADD = $(LIB_KSYCOCA) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 # Don't link this lib to the plugins. They are dlopened and linking to them
 # results in crashes when closing kcmshell.
 # plugins/ikws/libkuriikwsfilter.la plugins/shorturi/libkshorturifilter.la
Index: kcontrol/ebrowsing/plugins/ikws/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/ebrowsing/plugins/ikws/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/ebrowsing/plugins/ikws/Makefile.am	10 Jul 2002 03:17:39 -0000	1.1.1.2
+++ kcontrol/ebrowsing/plugins/ikws/Makefile.am	10 Jul 2002 03:42:56 -0000	1.3
@@ -7,10 +7,10 @@
 kde_module_LTLIBRARIES = libkuriikwsfilter.la libkurisearchfilter.la
 
 libkuriikwsfilter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-libkuriikwsfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkuriikwsfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 libkurisearchfilter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-libkurisearchfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkurisearchfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 libkuriikwsfilter_la_SOURCES = kuriikwsfiltereng.cpp kuriikwsfilter.skel kuriikwsfilter.cpp searchprovider.cpp
 libkurisearchfilter_la_SOURCES = kurisearchfilter.cpp kurisearchfilter.skel kuriikwsfiltereng.cpp ikwsopts.cpp searchproviderdlg.cpp searchprovider.cpp
Index: kcontrol/ebrowsing/plugins/shorturi/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/ebrowsing/plugins/shorturi/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/ebrowsing/plugins/shorturi/Makefile.am	25 Jun 2002 02:03:44 -0000	1.1.1.1
+++ kcontrol/ebrowsing/plugins/shorturi/Makefile.am	25 Jun 2002 02:06:13 -0000	1.2
@@ -7,8 +7,8 @@
 
 kde_module_LTLIBRARIES = libkshorturifilter.la
 
-libkshorturifilter_la_LDFLAGS = -module $(KDE_PLUGIN)
-libkshorturifilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkshorturifilter_la_LDFLAGS = -module $(KDE_PLUGIN) $(QT_LDFLAGS)
+libkshorturifilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 libkshorturifilter_la_SOURCES = kshorturifilter.cpp kshorturifilter.skel
 
Index: kcontrol/email/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/email/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/email/Makefile.am	1 Oct 2002 02:34:05 -0000	1.1.1.3
+++ kcontrol/email/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -3,8 +3,8 @@
 kde_module_LTLIBRARIES = kcm_email.la
 
 kcm_email_la_SOURCES = emailbase.ui email.cpp
-kcm_email_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_email_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_email_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_email_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 INCLUDES= $(all_includes) 
 
 kcm_email_la_METASOURCES = AUTO
Index: kcontrol/energy/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/energy/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/energy/Makefile.am	1 Oct 2002 02:34:05 -0000	1.1.1.4
+++ kcontrol/energy/Makefile.am	1 Oct 2002 03:01:45 -0000	1.5
@@ -7,8 +7,8 @@
 kde_module_LTLIBRARIES = kcm_energy.la
 
 kcm_energy_la_SOURCES = energy.cpp
-kcm_energy_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_energy_la_LIBADD = $(DPMSLIB) $(LIB_KDEUI) $(LIB_KIO)
+kcm_energy_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_energy_la_LIBADD = $(DPMSLIB) $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 kcm_energy_la_METASOURCES = energy.moc
 
 noinst_HEADERS = energy.h
Index: kcontrol/filetypes/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/filetypes/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/filetypes/Makefile.am	1 Oct 2002 02:34:06 -0000	1.1.1.3
+++ kcontrol/filetypes/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -1,7 +1,7 @@
 INCLUDES= $(all_includes)
 
-kcm_filetypes_la_LIBADD	= libfiletypes.la $(LIB_KIO)
-kcm_filetypes_la_LDFLAGS = -module -avoid-version -no-undefined $(all_libraries)
+kcm_filetypes_la_LIBADD	= libfiletypes.la $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
+kcm_filetypes_la_LDFLAGS = -module -avoid-version -no-undefined $(all_libraries) $(QT_LDFLAGS)
 kcm_filetypes_la_METASOURCES = AUTO
 
 kde_module_LTLIBRARIES = kcm_filetypes.la
Index: kcontrol/fonts/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/fonts/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/fonts/Makefile.am	1 Oct 2002 02:34:06 -0000	1.1.1.3
+++ kcontrol/fonts/Makefile.am	1 Oct 2002 03:01:45 -0000	1.4
@@ -5,8 +5,8 @@
 kde_module_LTLIBRARIES = kcm_fonts.la
 
 kcm_fonts_la_SOURCES = fonts.cpp kxftconfig.cpp
-kcm_fonts_la_LDFLAGS = $(KDE_RPATH) $(LIBFONTCONFIG_RPATH) -module -avoid-version $(all_libraries) -no-undefined
-kcm_fonts_la_LIBADD = $(LIB_KDEUI) $(LIBFONTCONFIG_LIBS)
+kcm_fonts_la_LDFLAGS = $(KDE_RPATH) $(LIBFONTCONFIG_RPATH) -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_fonts_la_LIBADD = $(LIB_KDEUI) $(LIBFONTCONFIG_LIBS) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 kcm_fonts_la_METASOURCES = fonts.moc
 
 noinst_HEADERS = fonts.h kxftconfig.h
Index: kcontrol/icons/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/icons/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/icons/Makefile.am	14 Aug 2002 14:28:29 -0000	1.1.1.3
+++ kcontrol/icons/Makefile.am	14 Aug 2002 15:35:41 -0000	1.4
@@ -5,8 +5,8 @@
 kde_module_LTLIBRARIES = kcm_icons.la
 
 kcm_icons_la_SOURCES = iconthemes.cpp icons.cpp main.cpp
-kcm_icons_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_icons_la_LIBADD = $(LIB_KIO)
+kcm_icons_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_icons_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 kcm_icons_la_METASOURCES = icons.moc iconthemes.moc main.moc
 
 
Index: kcontrol/info/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/info/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/info/Makefile.am	25 Jun 2002 02:03:45 -0000	1.1.1.1
+++ kcontrol/info/Makefile.am	25 Jun 2002 02:06:13 -0000	1.2
@@ -2,8 +2,8 @@
 
 kcm_info_la_SOURCES = main.cpp memory.cpp
 
-kcm_info_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_info_la_LIBADD = $(LIBALIB) $(LIB_KDEUI) $(LIB_TRU64_MACH) $(LIBCFG) $(LIBODM) $(LIBKSTAT) $(LIBDEVINFO)
+kcm_info_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS) $(FRAMEWORK_COREAUDIO)
+kcm_info_la_LIBADD = $(LIBALIB) $(LIB_KDEUI) $(LIB_TRU64_MACH) $(LIBCFG) $(LIBODM) $(LIBKSTAT) $(LIBDEVINFO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
  
Index: kcontrol/info/info.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/info/info.cpp,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/info/info.cpp	10 Jul 2002 03:17:53 -0000	1.1.1.2
+++ kcontrol/info/info.cpp	10 Jul 2002 03:42:56 -0000	1.3
@@ -471,6 +471,8 @@
 #include "info_svr4.cpp"
 #elif _AIX
 #include "info_aix.cpp"
+#elif defined(__APPLE__)
+#include "info_osx.cpp"
 #else
 #include "info_generic.cpp"	/* Default for unsupportet systems.... */
 #endif
Index: kcontrol/info/info_osx.cpp
===================================================================
RCS file: kcontrol/info/info_osx.cpp
diff -N kcontrol/info/info_osx.cpp
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ kcontrol/info/info_osx.cpp	25 Jun 2002 02:06:13 -0000	1.1
@@ -0,0 +1,163 @@
+/*
+ * kdebase3-3.0.1-3.patch,v 1.2 2002/06/24 01:48:12 ranger Exp
+ *
+ * info_fbsd.cpp is part of the KDE program kcminfo.  This displays
+ * various information about the system (hopefully a FreeBSD system)
+ * it's running on.
+ */
+
+#define INFO_CPU_AVAILABLE
+//#define INFO_IRQ_AVAILABLE
+//#define INFO_DMA_AVAILABLE
+//#define INFO_PCI_AVAILABLE
+//#define INFO_IOPORTS_AVAILABLE
+#define INFO_SOUND_AVAILABLE
+#define INFO_DEVICES_AVAILABLE
+#define INFO_SCSI_AVAILABLE
+#define INFO_PARTITIONS_AVAILABLE
+#define INFO_XSERVER_AVAILABLE
+
+/*
+ * all following functions should return TRUE, when the Information
+ * was filled into the lBox-Widget. Returning FALSE indicates that
+ * information was not available.
+ */
+
+#include <sys/types.h>
+#include <sys/sysctl.h>
+
+#include <fstab.h>
+#include <stdio.h>
+#include <stdlib.h>
+
+#include <iostream.h>
+
+#include <qdict.h>
+#include <qfile.h>
+#include <qfontmetrics.h>
+#include <qptrlist.h>
+#include <qstring.h>
+#include <qtextstream.h>
+
+#include <kdebug.h>
+
+#include <mach/mach.h>
+#include <mach-o/arch.h>
+
+#ifdef HAVE_COREAUDIO
+#include <CoreAudio/CoreAudio.h>
+#endif
+
+#include <machine/limits.h>
+
+bool GetInfo_CPU (QListView *lBox)
+{
+
+	QString cpustring;
+
+        kern_return_t ret;
+        struct host_basic_info basic_info;
+        unsigned int count=HOST_BASIC_INFO_COUNT;
+
+        ret=host_info(mach_host_self(), HOST_BASIC_INFO, 
+                (host_info_t)&basic_info, &count);
+        if (ret != KERN_SUCCESS) {
+		kdDebug() << "unable to get host information from mach" << endl;
+		return false;
+        } else {
+		kdDebug() << "got Host Info: (" << basic_info.avail_cpus << ") CPUs available" << endl;
+        	const NXArchInfo *archinfo;
+        	archinfo=NXGetArchInfoFromCpuType(basic_info.cpu_type, basic_info.cpu_subtype);
+		new QListViewItem(lBox, i18n("Kernel is configured for %1 CPUs").arg(basic_info.max_cpus));
+		for (int i = 1; i <= basic_info.avail_cpus; i++) {
+			cpustring = i18n("CPU %1: %2").arg(i).arg(archinfo->description);
+			new QListViewItem(lBox, cpustring);
+		}
+		return true;
+	}
+	return false;
+}
+
+bool GetInfo_IRQ (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_DMA (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_PCI (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_IO_Ports (QListView *)
+{
+	return false;
+}
+
+bool GetInfo_Sound (QListView *lBox)
+{
+#ifdef HAVE_COREAUDIO
+#define kMaxStringSize 1024
+	OSStatus status;
+	AudioDeviceID gOutputDeviceID;
+	unsigned long propertySize;
+	char deviceName[kMaxStringSize];
+	char manufacturer[kMaxStringSize];
+	propertySize = sizeof(gOutputDeviceID);
+	status = AudioHardwareGetProperty(kAudioHardwarePropertyDefaultOutputDevice, &propertySize, &gOutputDeviceID);
+	if (status) {
+		kdDebug() << "get default output device failed, status = " << (int)status << endl;
+		return false;
+	}
+
+	if (gOutputDeviceID != kAudioDeviceUnknown) {
+
+		propertySize = kMaxStringSize;
+
+		/* Device Name */
+		status = AudioDeviceGetProperty(gOutputDeviceID, 1, 0, kAudioDevicePropertyDeviceName, &propertySize, deviceName);
+		if (status) {
+			kdDebug() << "get device name failed, status = " << (int)status << endl;
+			return false;
+		}
+		new QListViewItem(lBox, i18n("Device Name: %1").arg(deviceName));
+
+		/* Manufacturer */
+		status = AudioDeviceGetProperty(gOutputDeviceID, 1, 0, kAudioDevicePropertyDeviceManufacturer, &propertySize, manufacturer);
+		if (status) {
+			kdDebug() << "get manufacturer failed, status = " << (int)status << endl;
+			return false;
+		}
+		new QListViewItem(lBox, i18n("Manufacturer: %1").arg(manufacturer));
+		return true;
+	} else {
+		return false;
+	}
+#else
+	return false;
+#endif
+}
+
+bool GetInfo_SCSI (QListView *lbox)
+{
+	return false;
+}
+
+bool GetInfo_Partitions (QListView *lbox)
+{
+	return false;
+}
+
+bool GetInfo_XServer_and_Video (QListView *lBox)
+{
+	return GetInfo_XServer_Generic( lBox );
+}
+
+bool GetInfo_Devices (QListView *lbox)
+{
+	return false;
+}
Index: kcontrol/info/memory.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/info/memory.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/info/memory.cpp	1 Oct 2002 02:34:08 -0000	1.1.1.4
+++ kcontrol/info/memory.cpp	1 Oct 2002 03:01:46 -0000	1.5
@@ -431,6 +431,8 @@
 
 #ifdef __linux__
 #include "memory_linux.cpp"
+#elif defined(__APPLE__)
+#include "memory_osx.cpp"
 #elif sgi
 #include "memory_sgi.cpp"
 #elif defined(__svr4__) && defined(sun)
Index: kcontrol/info/memory_osx.cpp
===================================================================
RCS file: kcontrol/info/memory_osx.cpp
diff -N kcontrol/info/memory_osx.cpp
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ kcontrol/info/memory_osx.cpp	25 Jun 2002 02:06:13 -0000	1.1
@@ -0,0 +1,72 @@
+#include <unistd.h>
+#include <stdlib.h>
+#include <qfile.h>
+#include <mach/mach_init.h>
+#include <mach/mach_host.h>
+#include <mach/host_info.h>
+#include <sys/stat.h>
+#include <dirent.h>
+#include <kdebug.h>
+
+void KMemoryWidget::update()
+{
+
+	vm_statistics_data_t vm_info;
+	mach_msg_type_number_t info_count;
+	DIR *dirp;
+	struct dirent *dp;
+	off_t total;
+
+	info_count = HOST_VM_INFO_COUNT;
+	if (host_statistics(mach_host_self (), HOST_VM_INFO, (host_info_t)&vm_info, &info_count)) {
+		kdDebug() << "could not get memory statistics" << endl;
+		return;
+	}
+
+	Memory_Info[TOTAL_MEM]    = (vm_info.active_count + vm_info.inactive_count +
+		vm_info.free_count + vm_info.wire_count) * vm_page_size;
+	Memory_Info[FREE_MEM]     = vm_info.free_count * vm_page_size;
+	Memory_Info[SHARED_MEM]   = NO_MEMORY_INFO;
+	Memory_Info[BUFFER_MEM]   = NO_MEMORY_INFO;
+	Memory_Info[CACHED_MEM]   = NO_MEMORY_INFO;
+
+	dirp = opendir("/private/var/vm");
+	if (!dirp) {
+		kdDebug() << "unable to open /private/var/vm" << endl;
+		return;
+	}
+
+	total = 0;
+
+	while ((dp = readdir (dirp)) != NULL) {
+		struct stat sb;
+		char fname [MAXNAMLEN];
+
+		if (strncmp (dp->d_name, "swapfile", 8))
+			continue;
+
+		strcpy (fname, "/private/var/vm/");
+		strcat (fname, dp->d_name);
+		if (stat (fname, &sb) < 0)
+			continue;
+
+		total += sb.st_size;
+	}
+	closedir (dirp);
+
+	info_count = HOST_VM_INFO_COUNT;
+	if (host_statistics (mach_host_self (), HOST_VM_INFO,
+		(host_info_t) &vm_info, &info_count)) {
+			kdDebug() << "unable to get VM info" << endl;
+	}
+
+	Memory_Info[SWAP_MEM]     = total;
+	// off_t used = (vm_info.pageouts - vm_info.pageins) * vm_page_size;
+	Memory_Info[FREESWAP_MEM] = NO_MEMORY_INFO;
+
+	/* free = vm_info.free_count * vm_page_size;
+	   used = vm_info.active_count * vm_page_size;
+	   total = (vm_info.active_count + vm_info.inactive_count +
+		vm_info.free_count + vm_info.wire_count) * vm_page_size; */
+
+}
Index: kcontrol/input/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/input/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/input/Makefile.am	10 Jul 2002 03:17:57 -0000	1.1.1.2
+++ kcontrol/input/Makefile.am	10 Jul 2002 03:42:56 -0000	1.3
@@ -4,8 +4,8 @@
 
 kcm_input_la_SOURCES = main.cpp mouse.cpp kmousedlg.ui
 
-kcm_input_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_input_la_LIBADD = $(XTESTLIB) $(LIB_KIO) $(LIB_KDEUI)
+kcm_input_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_input_la_LIBADD = $(XTESTLIB) $(LIB_KIO) $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/ioslaveinfo/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/ioslaveinfo/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/ioslaveinfo/Makefile.am	10 Jul 2002 03:17:59 -0000	1.1.1.2
+++ kcontrol/ioslaveinfo/Makefile.am	10 Jul 2002 03:42:56 -0000	1.3
@@ -2,8 +2,8 @@
 
 kcm_ioslaveinfo_la_SOURCES = kcmioslaveinfo.cpp
 
-kcm_ioslaveinfo_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_ioslaveinfo_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_ioslaveinfo_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_ioslaveinfo_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/kcontrol/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kcontrol/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/kcontrol/Makefile.am	1 Oct 2002 02:34:11 -0000	1.1.1.4
+++ kcontrol/kcontrol/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -33,19 +33,19 @@
 	quickhelp.cpp moduletreeview.cpp moduleiconview.cpp \
 	kecdialog.cpp kcrootonly.cpp moduleIface.cpp moduleIface.skel
 
-kcontrol_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcontrol_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcontrol_la_LIBADD  = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEFX) $(LIB_DCOP)
+kcontrol_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
 
 kcmshell_la_SOURCES = kcmshell.cpp moduleinfo.cpp modloader.cpp kecdialog.cpp \
 			proxywidget.cpp kcdialog.cpp global.cpp \
 			kcdialog.skel
-kcmshell_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcmshell_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcmshell_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_DCOP) $(LIB_KDECORE) $(LIB_QT)
+kcmshell_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
 
 
 kcminit_la_SOURCES = kcminit.cpp global.cpp
-kcminit_la_LIBADD   = $(LIB_KDEUI) $(LIB_KSYCOCA)
-kcminit_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kcminit_la_LIBADD   = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
+kcminit_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
 
 kcontrol_SOURCES = dummy.cpp
 kcontrol_LDADD = kcontrol.la
Index: kcontrol/kdm/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kdm/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -u -r1.1.1.2 -r1.2
--- kcontrol/kdm/Makefile.am	14 Aug 2002 14:28:12 -0000	1.1.1.2
+++ kcontrol/kdm/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -4,8 +4,9 @@
 	kdropsite.cpp backgnd.cpp kdm-users.cpp kdm-conv.cpp \
 	klanguagebutton.cpp main.cpp bgdialogs.cpp
 
-kcm_kdm_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) -module -avoid-version -no-undefined
-kcm_kdm_la_LIBADD = $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_KIO)
+kcm_kdm_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_kdm_la_LIBADD = $(LIB_KIO) $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) \
+	$(LIB_KDEUI) $(LIB_KDEFX)
 
 INCLUDES= -I$(top_srcdir)/kcontrol/background -I$(top_srcdir)/kdesktop $(all_includes)
 
Index: kcontrol/keys/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/keys/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/keys/Makefile.am	1 Oct 2002 02:34:16 -0000	1.1.1.3
+++ kcontrol/keys/Makefile.am	1 Oct 2002 03:01:46 -0000	1.4
@@ -1,8 +1,8 @@
 kde_module_LTLIBRARIES = kcm_keys.la
 
 kcm_keys_la_SOURCES =  shortcuts.cpp modifiers.cpp main.cpp
-kcm_keys_la_LIBADD   = -lkdeui
-kcm_keys_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
+kcm_keys_la_LIBADD   = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
+kcm_keys_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/kfontinst/kfile-plugin/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kfontinst/kfile-plugin/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/kfontinst/kfile-plugin/Makefile.am	1 Oct 2002 02:34:17 -0000	1.1.1.2
+++ kcontrol/kfontinst/kfile-plugin/Makefile.am	1 Oct 2002 03:01:46 -0000	1.3
@@ -2,7 +2,7 @@
 
 kfile_font_la_SOURCES = kfile_font.cpp
 kfile_font_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LIBFREETYPE_RPATH) -module $(KDE_PLUGIN)
-kfile_font_la_LIBADD = $(LIB_KIO) $(LIBFREETYPE_LIBS)
+kfile_font_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KIO) $(LIBFREETYPE_LIBS)
 
 kdelnkdir = $(kde_servicesdir)
 kde_services_DATA = kfile_font.desktop
Index: kcontrol/kfontinst/kfontinst/FontEngine.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kfontinst/kfontinst/FontEngine.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/kfontinst/kfontinst/FontEngine.cpp	1 Oct 2002 02:34:18 -0000	1.1.1.4
+++ kcontrol/kfontinst/kfontinst/FontEngine.cpp	1 Oct 2002 03:01:46 -0000	1.5
@@ -26,6 +26,8 @@
 // (C) Craig Drummond, 2001
 ////////////////////////////////////////////////////////////////////////////////
 
+#include "config.h"
+
 #include "FontEngine.h"
 #if !defined KFI_THUMBNAIL && !defined KFI_METAINFO
 #include "KfiGlobal.h"
Index: kcontrol/kfontinst/kfontinst/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kfontinst/kfontinst/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
Index: kcontrol/kicker/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kicker/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/kicker/Makefile.am	1 Oct 2002 02:34:21 -0000	1.1.1.4
+++ kcontrol/kicker/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -5,8 +5,9 @@
 			menutab_impl.cpp extensionInfo.cpp main.cpp \
                         lookandfeeltab_kcm.cpp advancedOptions.ui advancedDialog.cpp
 
-kcm_kicker_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kicker_la_LIBADD =  ../background/libbgnd.la $(LIB_KIO)
+kcm_kicker_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_kicker_la_LIBADD = $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_KIO) $(LIB_KSYCOCA) \
+	$(LIB_KFILE) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
 INCLUDES= -I$(srcdir)/../background $(all_includes)
 
 kcm_kicker_la_METASOURCES = AUTO
Index: kcontrol/kio/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/kio/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/kio/Makefile.am	1 Oct 2002 02:34:23 -0000	1.1.1.4
+++ kcontrol/kio/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -14,8 +14,8 @@
       uagentproviderdlg.cpp netpref.cpp cache.cpp ksaveioconfig.cpp \
       socks.cpp socksbase.ui
 
-kcm_kio_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kio_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KIO)
+kcm_kio_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_kio_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/kcmkio.pot
Index: kcontrol/knotify/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/knotify/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/knotify/Makefile.am	1 Oct 2002 02:34:24 -0000	1.1.1.4
+++ kcontrol/knotify/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -4,8 +4,8 @@
 
 kcm_knotify_la_SOURCES = knotify.cpp
 
-kcm_knotify_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_knotify_la_LIBADD = $(LIB_KIO)
+kcm_knotify_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_knotify_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
 INCLUDES= $(all_includes)
  
 kcm_knotify_la_METASOURCES = AUTO
Index: kcontrol/konq/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/konq/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- kcontrol/konq/Makefile.am	1 Oct 2002 02:35:03 -0000	1.1.1.4
+++ kcontrol/konq/Makefile.am	1 Oct 2002 03:01:46 -0000	1.5
@@ -9,8 +9,8 @@
 		fontopts.cpp previews.cpp browser.cpp \
 		desktop.cpp uiserver.stub main.cpp
 
-kcm_konq_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konq_la_LIBADD = $(LIB_KIO) $(LIB_KDEUI) $(LIB_KSYCOCA)
+kcm_konq_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_konq_la_LIBADD = $(LIB_KIO) $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 
 kcm_konq_la_DATA = overlapping.png onlyone.png
 kcm_konq_ladir = $(kde_datadir)/kcontrol/pics
Index: kcontrol/konqhtml/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/konqhtml/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/konqhtml/Makefile.am	1 Oct 2002 02:35:05 -0000	1.1.1.3
+++ kcontrol/konqhtml/Makefile.am	1 Oct 2002 03:01:47 -0000	1.4
@@ -9,8 +9,8 @@
 			     javaopts.cpp pluginopts.cpp appearance.cpp \
 			     khttpoptdlg.cpp policydlg.cpp main.cpp nsconfigwidget.ui
 
-kcm_konqhtml_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konqhtml_la_LIBADD = -lkhtml -lkdeui
+kcm_konqhtml_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_konqhtml_la_LIBADD = $(LIB_KHTML) $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP) $(LIB_KIO)
 
 data_DATA = khtml_behavior.desktop khtml_java_js.desktop khtml_fonts.desktop khtml_plugins.desktop
 datadir = $(kde_appsdir)/Settings/Network/WebBrowsing
Index: kcontrol/konsole/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/konsole/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/konsole/Makefile.am	1 Oct 2002 02:35:06 -0000	1.1.1.3
+++ kcontrol/konsole/Makefile.am	1 Oct 2002 03:01:47 -0000	1.4
@@ -5,8 +5,8 @@
 kcm_konsole_la_SOURCES =  schemaeditor.cpp sessioneditor.cpp kcmkonsole.cpp \
 	schemadialog.ui sessiondialog.ui kcmkonsoledialog.ui
 
-kcm_konsole_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konsole_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_konsole_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP) $(LIB_KDEFX)
 INCLUDES= $(all_includes) 
 
 kcm_konsole_la_METASOURCES = AUTO
Index: kcontrol/krdb/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/krdb/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/krdb/Makefile.am	10 Jul 2002 03:19:14 -0000	1.1.1.2
+++ kcontrol/krdb/Makefile.am	10 Jul 2002 03:42:58 -0000	1.3
@@ -7,8 +7,8 @@
 
 noinst_LTLIBRARIES = libkrdb.la
 libkrdb_la_SOURCES = krdb.cpp
-libkrdb_la_LIBADD = $(LIB_KDECORE)
-libkrdb_la_LDFLAGS = -no-undefined $(all_libraries) 
+libkrdb_la_LIBADD = $(LIB_KDECORE) $(LIB_X11) $(LIB_QT)
+libkrdb_la_LDFLAGS = -no-undefined $(all_libraries) $(QT_LDFLAGS)
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/krdb.pot
Index: kcontrol/launch/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/launch/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/launch/Makefile.am	25 Jun 2002 02:03:47 -0000	1.1.1.1
+++ kcontrol/launch/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -2,8 +2,8 @@
 kde_module_LTLIBRARIES        = kcm_launch.la
 INCLUDES                      = $(all_includes) 
 kcm_launch_la_SOURCES      = kcmlaunch.cpp
-kcm_launch_la_LDFLAGS      = $(all_libraries) $(KDE_PLUGIN) -module
-kcm_launch_la_LIBADD       = $(LIB_KDEUI)
+kcm_launch_la_LDFLAGS      = $(all_libraries) $(KDE_PLUGIN) -module $(QT_LDFLAGS)
+kcm_launch_la_LIBADD       = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 kcm_launch_la_METASOURCES  = AUTO
 noinst_HEADERS                = kcmlaunch.h
 data_DATA                     = kcmlaunch.desktop
Index: kcontrol/locale/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/locale/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/locale/Makefile.am	1 Oct 2002 02:35:08 -0000	1.1.1.3
+++ kcontrol/locale/Makefile.am	1 Oct 2002 03:01:47 -0000	1.4
@@ -10,9 +10,9 @@
 METASOURCES = AUTO
 noinst_HEADERS = toplevel.h kcmlocale.h klanguagebutton.h klocalesample.h menuitem.h localenum.h localemon.h localetime.h localeother.h kmenubutton.h
 
-kcm_locale_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_locale_la_LIBADD = $(LIB_KDEUI)
-
+kcm_locale_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_locale_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
+ 
 messages:
 	$(XGETTEXT) $(kcm_locale_la_SOURCES) -o $(podir)/kcmlocale.pot
 
Index: kcontrol/nics/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/nics/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/nics/Makefile.am	14 Aug 2002 14:28:21 -0000	1.1.1.3
+++ kcontrol/nics/Makefile.am	14 Aug 2002 15:35:42 -0000	1.4
@@ -2,8 +2,8 @@
 
 kcm_nic_la_SOURCES = nic.cpp
 
-kcm_nic_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_nic_la_LIBADD = -lkdeui $(LIB_KIO) $(LIBSOCKET)
+kcm_nic_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_nic_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBSOCKET) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/passwords/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/passwords/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/passwords/Makefile.am	1 Oct 2002 02:35:09 -0000	1.1.1.2
+++ kcontrol/passwords/Makefile.am	1 Oct 2002 03:01:47 -0000	1.3
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kcm_passwords.la
 kcm_passwords_la_SOURCES = passwords.cpp
 kcm_passwords_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_passwords_la_LIBADD = $(LIB_KDEUI) -lkdesu
+kcm_passwords_la_LIBADD = $(LIB_KDEUI) $(LIB_KDESU) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 noinst_HEADERS = passwords.h
Index: kcontrol/samba/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/samba/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/samba/Makefile.am	14 Aug 2002 14:28:31 -0000	1.1.1.3
+++ kcontrol/samba/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -2,8 +2,8 @@
 
 kcm_samba_la_SOURCES = main.cpp ksmbstatus.cpp kcmsambaimports.cpp kcmsambalog.cpp kcmsambastatistics.cpp
 
-kcm_samba_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_samba_la_LIBADD = $(LIB_KIO)
+kcm_samba_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_samba_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/screensaver/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/screensaver/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/screensaver/Makefile.am	1 Oct 2002 02:35:15 -0000	1.1.1.2
+++ kcontrol/screensaver/Makefile.am	1 Oct 2002 03:01:47 -0000	1.3
@@ -7,8 +7,8 @@
 kde_module_LTLIBRARIES = kcm_screensaver.la
 
 kcm_screensaver_la_SOURCES = scrnsave.cpp
-kcm_screensaver_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_screensaver_la_LIBADD = $(LIB_KSYCOCA) $(DPMSLIB)
+kcm_screensaver_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined $(QT_LDFLAGS)
+kcm_screensaver_la_LIBADD = $(LIB_KSYCOCA) $(DPMSLIB) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
 kcm_screensaver_la_METASOURCES = scrnsave.moc
 
 noinst_HEADERS = scrnsave.h
Index: kcontrol/smartcard/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/smartcard/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/smartcard/Makefile.am	14 Aug 2002 14:29:18 -0000	1.1.1.3
+++ kcontrol/smartcard/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -3,9 +3,9 @@
 
 kcm_smartcard_la_SOURCES = smartcard.cpp smartcardbase.ui nosmartcardbase.ui smartcard.skel
 
-kcm_smartcard_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
+kcm_smartcard_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
 
-kcm_smartcard_la_LIBADD = -lkdeui -lksmartcard $(LIB_KIO)
+kcm_smartcard_la_LIBADD = $(LIB_KDEUI) -lksmartcard $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 kcm_smartcard_la_METASOURCES = AUTO
 
Index: kcontrol/smserver/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/smserver/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/smserver/Makefile.am	1 Oct 2002 02:35:16 -0000	1.1.1.2
+++ kcontrol/smserver/Makefile.am	1 Oct 2002 03:01:47 -0000	1.3
@@ -1,8 +1,8 @@
 kde_module_LTLIBRARIES = kcm_smserver.la
 
 kcm_smserver_la_SOURCES = kcmsmserver.cpp smserverconfigdlg.ui smserverconfigimpl.cpp
-kcm_smserver_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_smserver_la_LIBADD = -lkdeui
+kcm_smserver_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_smserver_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 INCLUDES= $(all_includes) 
 
 kcm_smserver_la_METASOURCES = AUTO
Index: kcontrol/spellchecking/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/spellchecking/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kcontrol/spellchecking/Makefile.am	1 Oct 2002 02:35:16 -0000	1.1.1.2
+++ kcontrol/spellchecking/Makefile.am	1 Oct 2002 03:01:47 -0000	1.3
@@ -2,8 +2,8 @@
 
 kcm_spellchecking_la_SOURCES = spellchecking.cpp
 
-kcm_spellchecking_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_spellchecking_la_LIBADD = -lkdeui -lkspell
+kcm_spellchecking_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_spellchecking_la_LIBADD = $(LIB_KDEUI) $(LIB_KSPELL) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes)
 
Index: kcontrol/taskbar/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/taskbar/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/taskbar/Makefile.am	1 Oct 2002 02:35:16 -0000	1.1.1.3
+++ kcontrol/taskbar/Makefile.am	1 Oct 2002 03:01:47 -0000	1.4
@@ -1,8 +1,8 @@
 kde_module_LTLIBRARIES = kcm_taskbar.la
 
 kcm_taskbar_la_SOURCES = kcmtaskbarui.ui kcmtaskbar.cpp
-kcm_taskbar_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_taskbar_la_LIBADD = -lkdeui
+kcm_taskbar_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_taskbar_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP)
 INCLUDES= $(all_includes) 
 
 kcm_taskbar_la_METASOURCES = AUTO
Index: kcontrol/thememgr/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/thememgr/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kcontrol/thememgr/Makefile.am	14 Aug 2002 14:29:26 -0000	1.1.1.3
+++ kcontrol/thememgr/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -13,8 +13,8 @@
 	options.h version.h groupdetails.h \
 	themecreator.h newthemedlg.h
 
-kcm_themes_la_LIBADD = $(LIB_KIO) 
-kcm_themes_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kcm_themes_la_LIBADD = $(LIB_KIO) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_DCOP)
+kcm_themes_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module $(QT_LDFLAGS)
 
 apps_DATA = kthememgr.desktop
 appsdir = $(kde_appsdir)/Settings/LookNFeel
Index: kcontrol/usbview/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kcontrol/usbview/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kcontrol/usbview/Makefile.am	25 Jun 2002 02:03:48 -0000	1.1.1.1
+++ kcontrol/usbview/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -2,8 +2,8 @@
 
 kcm_usb_la_SOURCES = kcmusb.cpp usbdevices.cpp usbdb.cpp
 
-kcm_usb_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_usb_la_LIBADD = $(LIB_KDEUI)
+kcm_usb_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined $(QT_LDFLAGS)
+kcm_usb_la_LIBADD = $(LIB_KDEUI) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes) 
 
Index: kdeprint/kjobviewer/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kdeprint/kjobviewer/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kdeprint/kjobviewer/Makefile.am	25 Jun 2002 02:03:49 -0000	1.1.1.1
+++ kdeprint/kjobviewer/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -9,8 +9,8 @@
 
 kjobviewer_la_SOURCES = kjobviewer.cpp main.cpp
 kjobviewer_la_METASOURCES = AUTO
-kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI)
-kjobviewer_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
+kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_KDEPRINT) $(LIB_DCOP)
+kjobviewer_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH) $(QT_LDFLAGS)
 
 noinst_HEADERS = kjobviewer.h
 
Index: kdeprint/kprinter/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kdeprint/kprinter/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -u -r1.1.1.2 -r1.2
--- kdeprint/kprinter/Makefile.am	10 Jul 2002 03:20:23 -0000	1.1.1.2
+++ kdeprint/kprinter/Makefile.am	11 Jul 2002 22:35:30 -0000	1.2
@@ -8,7 +8,7 @@
 kprinter_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
 kprinter_la_SOURCES = main.cpp printwrapper.cpp
-kprinter_la_LIBADD = -lkdeprint
+kprinter_la_LIBADD = -lkdeprint $(LIB_QT) $(LIB_KIO) $(LIB_KDEUI) $(LIB_KDECORE)
 kprinter_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
 kprinter_METASOURCES = AUTO
 
Index: kdialog/kdialog.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kdialog/kdialog.cpp,v
retrieving revision 1.1.1.1
retrieving revision 1.3
diff -u -u -r1.1.1.1 -r1.3
--- kdialog/kdialog.cpp	14 Aug 2002 14:27:19 -0000	1.1.1.1
+++ kdialog/kdialog.cpp	26 Aug 2002 19:38:08 -0000	1.3
@@ -20,8 +20,10 @@
 
 #include <fcntl.h>
 #include <unistd.h>
-#include <stream.h>
+#include <iostream>
 #include <stdlib.h>
+
+using namespace std;
 
 #include <qlist.h>
 #include <qfile.h>
Index: kdm/backend/dm.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kdm/backend/dm.h,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
--- kdm/backend/dm.h	1 Oct 2002 02:35:49 -0000	1.1.1.3
+++ kdm/backend/dm.h	1 Oct 2002 03:01:47 -0000	1.3
@@ -41,6 +41,10 @@
 #ifndef _DM_H_
 #define _DM_H_ 1
 
+#ifdef __APPLE__
+#define CSRG_BASED
+#endif
+
 #include "greet.h"
 
 #include <X11/Xos.h>
Index: khelpcenter/khelpcenter.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/khelpcenter/khelpcenter.desktop,v
retrieving revision 1.1.1.4
retrieving revision 1.4
diff -u -u -r1.1.1.4 -r1.4
Index: khotkeys/khotkeys/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/khotkeys/khotkeys/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- khotkeys/khotkeys/Makefile.am	25 Jun 2002 02:03:52 -0000	1.1.1.1
+++ khotkeys/khotkeys/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -4,7 +4,7 @@
 lib_LTLIBRARIES = khotkeys.la
 
 khotkeys_la_SOURCES = khotkeys.cpp main.cpp khotkeys.skel
-khotkeys_la_LIBADD   = ../shared/libshared.la $(LIB_KSYCOCA)
+khotkeys_la_LIBADD   = ../shared/libshared.la $(LIB_KSYCOCA) $(LIB_QT) $(LIB_X11) $(LIB_KDECORE) $(LIB_DCOP)
 khotkeys_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 khotkeys_SOURCES = dummy.cpp
Index: kicker/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kicker/Makefile.am	10 Jul 2002 03:21:29 -0000	1.1.1.2
+++ kicker/Makefile.am	10 Jul 2002 03:42:58 -0000	1.3
@@ -7,8 +7,10 @@
 
 CLEANFILES = dummy.cpp dummy_la.cpp
 
-kicker_la_LIBADD = core/libkicker_core.la  buttons/libkicker_buttons.la \
-	ui/libkicker_ui.la share/libkickermain.la $(LIB_KIO) 
+kicker_la_LIBADD = $(top_builddir)/kicker/core/libkicker_core.la \
+	$(top_builddir)/kicker/buttons/libkicker_buttons.la \
+	$(top_builddir)/kicker/ui/libkicker_ui.la \
+	$(top_builddir)/kicker/share/libkickermain.la $(LIB_KIO) 
 
 kicker_la_SOURCES = dummy.cpp
 kicker_la_LDFLAGS = $(KDE_PLUGIN) -no-undefined -module $(all_libraries)
Index: kicker/menuext/kdeprint/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/menuext/kdeprint/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kicker/menuext/kdeprint/Makefile.am	25 Jun 2002 02:03:52 -0000	1.1.1.1
+++ kicker/menuext/kdeprint/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -4,7 +4,7 @@
 
 kickermenu_kdeprint_la_SOURCES = print_mnu.cpp
 kickermenu_kdeprint_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_kdeprint_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) -lkdeprint
+kickermenu_kdeprint_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDEPRINT) $(LIB_KDECORE) $(LIB_QT)
 
 kickermenu_kdeprint_la_METASOURCES = AUTO
 
Index: kicker/menuext/konsole/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/menuext/konsole/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kicker/menuext/konsole/Makefile.am	14 Aug 2002 14:30:12 -0000	1.1.1.1
+++ kicker/menuext/konsole/Makefile.am	15 Aug 2002 15:26:45 -0000	1.2
@@ -3,8 +3,8 @@
 kde_module_LTLIBRARIES = kickermenu_konsole.la
 
 kickermenu_konsole_la_SOURCES = konsole_mnu.cpp konsolebookmarkhandler.cpp konsolebookmarkmenu.cpp
-kickermenu_konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
+kickermenu_konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+kickermenu_konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDECORE) $(LIB_QT)
 
 kickermenu_konsole_la_METASOURCES = AUTO
 
Index: kicker/menuext/prefmenu/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/menuext/prefmenu/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kicker/menuext/prefmenu/Makefile.am	10 Jul 2002 03:22:41 -0000	1.1.1.1
+++ kicker/menuext/prefmenu/Makefile.am	11 Jul 2002 22:35:30 -0000	1.2
@@ -4,7 +4,8 @@
 
 kickermenu_prefmenu_la_SOURCES = prefmenu.cpp
 kickermenu_prefmenu_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_prefmenu_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la
+kickermenu_prefmenu_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la \
+	$(top_builddir)/kicker/kicker.la
 
 kickermenu_prefmenu_la_METASOURCES = AUTO
 
Index: kicker/menuext/recentdocs/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kicker/menuext/recentdocs/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kicker/menuext/recentdocs/Makefile.am	10 Jul 2002 03:22:42 -0000	1.1.1.1
+++ kicker/menuext/recentdocs/Makefile.am	11 Jul 2002 22:35:30 -0000	1.2
@@ -4,7 +4,8 @@
 
 kickermenu_recentdocs_la_SOURCES = recentdocsmenu.cpp
 kickermenu_recentdocs_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kickermenu_recentdocs_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la
+kickermenu_recentdocs_la_LIBADD = $(LIB_KDEUI) $(top_builddir)/kicker/ui/libkicker_ui.la \
+	$(top_builddir)/kicker/kicker.la
 
 kickermenu_recentdocs_la_METASOURCES = AUTO
 
Index: kioslave/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.5
diff -u -u -r1.1.1.3 -r1.5
--- kioslave/Makefile.am	14 Aug 2002 14:27:55 -0000	1.1.1.3
+++ kioslave/Makefile.am	14 Aug 2002 15:35:43 -0000	1.5
@@ -8,10 +8,14 @@
 SMB_SUBDIR=smb
 endif
 
+if include_kioslave_nfs
+NFS_SUBDIR=nfs
+endif
+
 if include_devicesdir
 DEVICES_SUBDIR=devices
 endif
 
-
-SUBDIRS = cgi floppy filter fish info mac man nfs nntp pop3 imap4 smtp \
-  smbro sftp tar zip finger thumbnail $(LDAP_SUBDIR) $(SMB_SUBDIR) $(DEVICES_SUBDIR)
+SUBDIRS = cgi floppy filter fish info mac man nntp pop3 imap4 smtp \
+	smbro sftp tar zip finger thumbnail $(LDAP_SUBDIR) $(SMB_SUBDIR) \
+	$(NFS_SUBDIR) $(DEVICES_SUBDIR)
Index: kioslave/devices/kdedmodule/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/devices/kdedmodule/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- kioslave/devices/kdedmodule/Makefile.am	10 Jul 2002 03:22:56 -0000	1.1.1.1
+++ kioslave/devices/kdedmodule/Makefile.am	11 Jul 2002 22:35:30 -0000	1.2
@@ -3,8 +3,8 @@
 INCLUDES = $(all_includes)
 LDFLAGS =$(all_libraries)
 kded_mountwatcher_la_SOURCES = mountwatcher.cpp mountwatcher.skel disklist.cpp disks.cpp
-kded_mountwatcher_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_mountwatcher_la_LIBADD = $(LIB_KSYCOCA)
+kded_mountwatcher_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+kded_mountwatcher_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_DCOP) $(LIB_KDECORE) $(LIB_KDED)
 
 METASOURCES = AUTO
 
Index: kioslave/ldap/configure.in.in
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/ldap/configure.in.in,v
retrieving revision 1.1.1.2
diff -u -u -r1.1.1.2 configure.in.in
--- kioslave/ldap/configure.in.in	10 Jul 2002 03:23:08 -0000	1.1.1.2
+++ kioslave/ldap/configure.in.in	17 Oct 2002 04:34:38 -0000
@@ -19,7 +19,7 @@
   fi
   if test $with_ldap = FOUND ; then
     with_ldap=NOTFOUND
-    for ext in la so sl a ; do
+    for ext in la dylib so sl a ; do
       AC_FIND_FILE(libldap.$ext, $kde_libraries /usr/lib /usr/local/lib,
         ldap_libdir)
       if test -r $ldap_libdir/libldap.$ext ; then
@@ -27,7 +27,7 @@
           LDAP_LIBS="-L$ldap_libdir "
           test "$USE_RPATH" = yes && LDAP_RPATH="-R $ldap_libdir"
         fi
-        LDAP_LIBS="${LDAP_LIBS}-lldap -llber -lresolv"
+        LDAP_LIBS="${LDAP_LIBS}-framework LDAP"
         with_ldap=FOUND
         break
       fi
@@ -51,7 +51,7 @@
         LDAP_RPATH="-R ${LDAP_ROOT}/lib"
       fi
     fi
-    LDAP_LIBS="${LDAP_LIBS}-lldap -llber -lresolv"
+    LDAP_LIBS="${LDAP_LIBS}-framework LDAP"
   fi
   kde_safe_LIBS="$LIBS"
   kde_safe_CFLAGS="$CFLAGS"
Index: kioslave/nfs/.cvsignore
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/nfs/.cvsignore,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -u -r1.1.1.3 -r1.2
Index: kioslave/nfs/README
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/nfs/README,v
retrieving revision 1.1.1.1
retrieving revision 1.4
diff -u -u -r1.1.1.1 -r1.4
--- kioslave/nfs/README	25 Jun 2002 02:03:52 -0000	1.1.1.1
+++ kioslave/nfs/README	16 Sep 2002 14:52:42 -0000	1.4
@@ -1,3 +1,29 @@
 this is an ioslave for KDE 2 for NFS, version 2.
 
 Alex
+
+Darwin notes --
+
+It looks like there are C++ type issues with the Darwin headers
+(try building, you'll see the "too many arguments to function" stuff)
+
+The problem seems to be <rpc/clnt.h> having definitions that don't
+play nice with C++.  The client rpc handle does a bunch of void stuff
+in the struct which is fine in C but makes an empty arg list in C++.
+
+typedef struct {
+        AUTH    *cl_auth;                       /* authenticator */
+        struct clnt_ops {
+                enum clnt_stat  (*cl_call)();   /* call remote procedure */
+                void            (*cl_abort)();  /* abort a call */
+                void            (*cl_geterr)(); /* get specific error code */
+                bool_t          (*cl_freeres)(); /* frees results */
+                void            (*cl_destroy)();/* destroy this structure */
+                bool_t          (*cl_control)();/* the ioctl() of rpc */
+        } *cl_ops;
+        caddr_t                 cl_private;     /* private stuff */
+} CLIENT;
+
+
+The only solution is to probably reimplement clnt.h locally to fix
+these (wrapping the "#include <rpc/rpc.h>" in an extern "C" isn't enough).
Index: kioslave/nfs/configure.in.in
===================================================================
RCS file: kioslave/nfs/configure.in.in
diff -N kioslave/nfs/configure.in.in
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ kioslave/nfs/configure.in.in	12 Jul 2002 02:04:22 -0000	1.2
@@ -0,0 +1,7 @@
+AC_MSG_CHECKING(whether to compile NFS support)
+AC_ARG_WITH(nfs,
+[  --without-nfs           Disable NFS kioslave [default=no]],
+	with_nfs=$withval, with_nfs=yes
+)dnl
+AC_MSG_RESULT($withval)
+AM_CONDITIONAL(include_kioslave_nfs, test "$with_nfs" = "yes")
Index: kioslave/nfs/kio_nfs.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/nfs/kio_nfs.cpp,v
retrieving revision 1.1.1.1
retrieving revision 1.3
diff -u -u -r1.1.1.1 -r1.3
--- kioslave/nfs/kio_nfs.cpp	1 Oct 2002 02:36:16 -0000	1.1.1.1
+++ kioslave/nfs/kio_nfs.cpp	16 Sep 2002 14:51:29 -0000	1.3
@@ -1,6 +1,6 @@
 /*  This file is part of the KDE project
 
-    $Id$
+    $Id$
 
     Copyright (C) 2000 Alexander Neundorf <neundorf@kde.org>
 
@@ -47,6 +47,8 @@
 #include <time.h>
 #include <unistd.h>
 
+#include <iostream.h>
+
 #include <qfile.h>
 #include <qdir.h>
 
@@ -200,7 +202,6 @@
    return (time(0)-m_detectTime);
 };
 
-/*
 ostream& operator<< (ostream& s, const NFSFileHandle& x)
 {
    for (int i =0; i<NFS_FHSIZE; i++)
@@ -208,7 +209,6 @@
    s<<dec;
    return s;
 }
-*/
 
 NFSProtocol::NFSProtocol (const QCString &pool, const QCString &app )
 :SlaveBase( "nfs", pool, app )
Index: kioslave/nfs/kio_nfs.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kioslave/nfs/kio_nfs.h,v
retrieving revision 1.1.1.1
retrieving revision 1.3
diff -u -u -r1.1.1.1 -r1.3
--- kioslave/nfs/kio_nfs.h	1 Oct 2002 02:36:16 -0000	1.1.1.1
+++ kioslave/nfs/kio_nfs.h	16 Sep 2002 14:51:29 -0000	1.3
@@ -35,6 +35,8 @@
 #include <netinet/in.h>
 #include <sys/time.h>
 
+#include <iostream.h>
+
 class NFSFileHandle
 {
    public:
@@ -53,7 +55,7 @@
       time_t m_detectTime;
 };
 
-//ostream& operator<<(ostream&, const NFSFileHandle&);
+ostream& operator<<(ostream&, const NFSFileHandle&);
 
 typedef QMap<QString,NFSFileHandle> NFSFileHandleMap;
 
Index: klipper/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/klipper/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.4
diff -u -u -r1.1.1.2 -r1.4
--- klipper/Makefile.am	10 Jul 2002 03:23:37 -0000	1.1.1.2
+++ klipper/Makefile.am	3 Oct 2002 22:02:42 -0000	1.4
@@ -6,19 +6,19 @@
 
 CLEANFILES = dummy.cpp
 
-klipper_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) 
+klipper_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE) $(LIB_X11) $(LIB_DCOP)
 klipper_la_SOURCES = main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp \
     toplevel.skel
 
 klipper_la_METASOURCES = AUTO
-klipper_la_LDFLAGS = $(all_libraries) -module -avoid-version
+klipper_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
 
 klipper_LDADD = klipper.la $(LIB_KSYCOCA)
 klipper_SOURCES = dummy.cpp
 klipper_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
 klipper_panelapplet_la_LIBADD = klipper.la
-klipper_panelapplet_la_SOURCES = applet.cpp
+klipper_panelapplet_la_SOURCES = applet.cpp applet.skel
 klipper_panelapplet_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 
Index: kmenuedit/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kmenuedit/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- kmenuedit/Makefile.am	14 Aug 2002 14:27:55 -0000	1.1.1.3
+++ kmenuedit/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -7,8 +7,8 @@
 
 kmenuedit_la_SOURCES = basictab.cpp treeview.cpp desktopfileeditor.cpp menueditview.cpp kmenuedit.cpp main.cpp khotkeys.cpp
 
-kmenuedit_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
-kmenuedit_la_LDFLAGS = $(all_libraries) -module -avoid-version
+kmenuedit_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
+kmenuedit_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
 
 kmenuedit_SOURCES = dummy.cpp
 kmenuedit_LDADD   = kmenuedit.la
Index: konqueror/client/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konqueror/client/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.4
diff -u -u -r1.1.1.2 -r1.4
--- konqueror/client/Makefile.am	14 Aug 2002 14:30:59 -0000	1.1.1.2
+++ konqueror/client/Makefile.am	14 Aug 2002 15:35:43 -0000	1.4
@@ -4,8 +4,8 @@
 lib_LTLIBRARIES = kfmclient.la
 
 INCLUDES= -I.. $(all_includes)
-kfmclient_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kfmclient_la_LIBADD =  $(LIB_KIO)
+kfmclient_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
+kfmclient_la_LIBADD =  $(LIB_KIO) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP) $(LIB_KDEUI)
 kfmclient_la_SOURCES = kfmclient.cc KonquerorIface.stub KDesktopIface.stub
 
 noinst_HEADERS = kfmclient.h
Index: konqueror/keditbookmarks/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konqueror/keditbookmarks/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -u -r1.1.1.2 -r1.2
--- konqueror/keditbookmarks/Makefile.am	10 Jul 2002 03:24:04 -0000	1.1.1.2
+++ konqueror/keditbookmarks/Makefile.am	12 Jul 2002 02:04:22 -0000	1.2
@@ -7,7 +7,7 @@
 keditbookmarks_la_SOURCES = main.cpp items.cpp toplevel.cpp toplevel.skel commands.cpp
 kbookmarklistener_DIR = $(top_srcdir)/libkonq
 
-keditbookmarks_la_LIBADD  = $(top_builddir)/libkonq/libkonq.la
+keditbookmarks_la_LIBADD  = $(top_builddir)/libkonq/libkonq.la $(LIB_KHTML)
 keditbookmarks_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 bin_PROGRAMS = keditbookmarks
Index: konqueror/sidebar/trees/history_module/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konqueror/sidebar/trees/history_module/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -u -r1.1.1.3 -r1.4
--- konqueror/sidebar/trees/history_module/Makefile.am	1 Oct 2002 02:36:50 -0000	1.1.1.3
+++ konqueror/sidebar/trees/history_module/Makefile.am	1 Oct 2002 03:01:48 -0000	1.4
@@ -6,7 +6,7 @@
 
 konq_sidebartree_history_la_SOURCES = history_module.cpp history_item.cpp \
 	history_settings.cpp history_settings.skel
-konq_sidebartree_history_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
+konq_sidebartree_history_la_LDFLAGS = $(all_libraries) -no-undefined -module $(KDE_PLUGIN)
 konq_sidebartree_history_la_LIBADD =  ../../libkonqsidebarplugin.la ../libkonq_sidebar_tree.la
 
 kcm_history_la_SOURCES = kcmhistory.cpp history_dlg.ui history_settings.cpp history_settings.skel
Index: konqueror/sidebar/trees/history_module/history_module.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konqueror/sidebar/trees/history_module/history_module.h,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- konqueror/sidebar/trees/history_module/history_module.h	14 Aug 2002 14:30:58 -0000	1.1.1.2
+++ konqueror/sidebar/trees/history_module/history_module.h	14 Aug 2002 15:35:44 -0000	1.3
@@ -53,8 +53,7 @@
     bool sortsByName() const { return m_sortsByName; }
 
     static QString groupForURL( const KURL& url ) {
-	static const QString& misc = KGlobal::staticQString(i18n("Miscellaneous"));
-	return url.host().isEmpty() ? misc : url.host();
+	return url.host().isEmpty() ? KGlobal::staticQString(i18n("Miscellaneous")) : url.host();
     }
 
 public slots:
Index: konsole/kcmkonsole.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/kcmkonsole.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/kcmkonsole.desktop	1 Oct 2002 02:36:51 -0000	1.1.1.5
+++ konsole/kcmkonsole.desktop	16 Oct 2002 21:58:59 -0000	1.2
@@ -24,7 +24,6 @@
 Name[es]=Consola
 Name[et]=Konsool
 Name[eu]=Konsola
-Name[fa]=کنسول
 Name[fi]=Konsoli
 Name[gl]=Consola
 Name[he]=מסוף
@@ -59,7 +58,6 @@
 Name[zu]=I Khonsole
 
 GenericName=All Konsole Settings
-GenericName[af]=alle konsole instellings
 GenericName[ar]=كل اعدادات Konsole
 GenericName[az]=Bütün Konsol Qurğuları
 GenericName[be]=Усе настройкі кансолі
@@ -75,7 +73,6 @@
 GenericName[es]=Opciones de Konsole
 GenericName[et]=Konsooli seadistused
 GenericName[eu]=Konsolaren Konfigurazioa
-GenericName[fa]=تمام تنظیمات ک‌نسول
 GenericName[fi]=Kaikki konsolin asetukset
 GenericName[fr]=Configuration de Konsole
 GenericName[gl]=Propiedades da Konsole
@@ -130,7 +127,6 @@
 Keywords[eo]=konzolo,pupitro,terminalo
 Keywords[es]=konsole,consola,terminal
 Keywords[et]=konsool,terminal
-Keywords[fa]=konsole,console,terminal,کنسول,ترمینال,ک‌نسول
 Keywords[fi]=konsole,konsoli,pääte-emulaattori
 Keywords[gl]=konsole,consola,terminal
 Keywords[he]=Konsole,Console,מסוף,טרמינל
Index: konsole/konsole.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/konsole.desktop	1 Oct 2002 02:36:51 -0000	1.1.1.5
+++ konsole/konsole.desktop	16 Oct 2002 21:58:59 -0000	1.2
@@ -18,7 +18,6 @@
 Name[eo]=Konzolo
 Name[et]=Konsool
 Name[eu]=Konsola
-Name[fa]=ک‌نسول
 Name[fi]=Pääte-emulaattori
 Name[he]=מסוף
 Name[hr]=Konzola
@@ -39,7 +38,6 @@
 Name[zu]=iKonsole
 
 GenericName=Terminal Program
-GenericName[af]=terminaal program
 GenericName[ar]=برنامج تيرمينال
 GenericName[be]=Тэрмінал
 GenericName[bg]=Терминална програма
@@ -47,12 +45,11 @@
 GenericName[cs]=Terminálový program
 GenericName[da]=Terminalprogram
 GenericName[de]=Terminal-Programm
-GenericName[el]=Πρόγραμμα τερματικού
+GenericName[el]=Πρόγραμμα Τερματικού
 GenericName[eo]=Terminalimitaĵo
 GenericName[es]=Programa de terminal
 GenericName[et]=Terminali emulaator
 GenericName[eu]=Terminala Programa
-GenericName[fa]=برنامه‌ی ترمینال
 GenericName[fi]=Terminaaliohjelma
 GenericName[fr]=Terminal
 GenericName[he]=תוכנית מסוף
@@ -63,7 +60,6 @@
 GenericName[lt]=Terminalo programa
 GenericName[lv]=Termināla Programma
 GenericName[mt]=Programm ta' terminal
-GenericName[nb]=Terminalprogram
 GenericName[nl]=terminalprogramma
 GenericName[nn]=Terminalprogram
 GenericName[pl]=Program terminala
Index: konsole/konsolehere.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsolehere.desktop,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -u -r1.1.1.2 -r1.2
--- konsole/konsolehere.desktop	1 Oct 2002 02:36:51 -0000	1.1.1.2
+++ konsole/konsolehere.desktop	16 Oct 2002 21:58:59 -0000	1.2
@@ -9,23 +9,12 @@
 Name[bs]=Otvori terminal ovdje
 Name[cs]=Otevřít terminál zde
 Name[da]=Åbn terminal her
-Name[de]=Terminal öffnen
-Name[el]=Άνοιγμα τερματικού εδώ
 Name[es]=Abrir terminal aquí
-Name[fa]=ترمینال را اینجا باز کن
-Name[fi]=Avaa terminaali tähän
-Name[fr]=Ouvrir un terminal ici
 Name[he]=פתח מסוף כאן
 Name[hu]=Parancsértelmező megnyitása itt
 Name[ja]=ここでターミナルを開く
 Name[mt]=Iftaħ terminal hawn
-Name[nb]=Åpne terminal her
-Name[nl]=Terminal openen
-Name[pt]=Abrir um Terminal Aqui
 Name[pt_BR]=Abrir Terminal aqui
-Name[sk]=Tu otvoriť terminál
 Name[sv]=Öppna terminal här
-Name[xh]=Vula Isiphelo Sendlela Apha
-Name[zh_TW]=在這裡開啟終端機
 Icon=konsole
 Exec=konsole --workdir %U
Index: konsole/konsolepart.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsolepart.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/konsolepart.desktop	1 Oct 2002 02:36:51 -0000	1.1.1.5
+++ konsole/konsolepart.desktop	16 Oct 2002 21:58:59 -0000	1.2
@@ -22,15 +22,13 @@
 Name[cs]=Emulátor terminálu
 Name[da]=terminalemulator
 Name[de]=Terminal-Emulator
-Name[el]=Εξομοίωση τερματικού
+Name[el]=Εξομοίωση Τερματικού
 Name[eo]=Terminalimitaĵo
 Name[es]=Emulador de terminal
 Name[et]=Terminali emulaator
 Name[eu]=Terminal Imitazioa
-Name[fa]=شبیه‌ساز ترمینال
 Name[fi]=Pääte-emulaattori
-Name[fo]=Útstøðshermari
-Name[fr]=Émulateur de terminal
+Name[fr]=Terminal
 Name[gl]=Emulador de Terminal
 Name[he]=הדמיית מסוף
 Name[hr]=Emulator Terminala
Index: konsole/konsolesu.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsolesu.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/konsolesu.desktop	1 Oct 2002 02:36:51 -0000	1.1.1.5
+++ konsole/konsolesu.desktop	16 Oct 2002 21:58:59 -0000	1.2
@@ -16,12 +16,11 @@
 Name[cs]=Konsole - superuživatelský režim
 Name[da]=Konsole (superbruger-tilstand)
 Name[de]=Konsole (Systemverwaltungs-Modus)
-Name[el]=Κονσόλα - Λειτουργία ως root
+Name[el]=Κονσόλα - Λειτουργία Υπερ Χρήστη
 Name[eo]=Konzolo (kiel sistemestro)
 Name[es]=Konsole - modo superusuario
 Name[et]=Konsole (administraator)
 Name[eu]=Konsole (root era)
-Name[fa]=ک‌نسول - حالت کاربر برتر
 Name[fi]=Pääteikkuna - pääkäyttäjätila
 Name[fr]=Konsole (mode superutilisateur)
 Name[he]=מסוף - מצב משתמש-על
@@ -32,7 +31,6 @@
 Name[lt]=Konsole – super vartotojo režimas
 Name[lv]=Konsole - Super Lietotāja Režīms
 Name[mt]=Konsole (modalità Super User)
-Name[nb]=Terminal (Superbrukermodus)
 Name[nl]=Konsole (in systeembeheermodus)
 Name[nn]=Konsole - Superbrukarmodus
 Name[pl]=Terminal  - tryb administratora
@@ -51,11 +49,10 @@
 Name[xh]=Isiphelo Sendlela Indlela Sephezulu Yomsebenzisi
 Name[xx]=xx
 Name[zh_CN]=Konsole - 超级用户模式
-Name[zh_TW]=Konsole - 超級使用者模式
+Name[zh_TW]=終端機 - 超級使用者模式
 Name[zu]=Konsole - Imodi Ephezulu Yomsebenzisi
 
 GenericName=Terminal Program
-GenericName[af]=terminaal program
 GenericName[ar]=برنامج تيرمينال
 GenericName[be]=Тэрмінал
 GenericName[bg]=Терминална програма
@@ -63,12 +60,11 @@
 GenericName[cs]=Terminálový program
 GenericName[da]=Terminalprogram
 GenericName[de]=Terminal-Programm
-GenericName[el]=Πρόγραμμα τερματικού
+GenericName[el]=Πρόγραμμα Τερματικού
 GenericName[eo]=Terminalimitaĵo
 GenericName[es]=Programa de terminal
 GenericName[et]=Terminali emulaator
 GenericName[eu]=Terminala Programa
-GenericName[fa]=برنامه‌ی ترمینال
 GenericName[fi]=Terminaaliohjelma
 GenericName[fr]=Terminal
 GenericName[he]=תוכנית מסוף
@@ -79,7 +75,6 @@
 GenericName[lt]=Terminalo programa
 GenericName[lv]=Termināla Programma
 GenericName[mt]=Programm ta' terminal
-GenericName[nb]=Terminalprogram
 GenericName[nl]=terminalprogramma
 GenericName[nn]=Terminalprogram
 GenericName[pl]=Program terminala
Index: konsole/kwrited.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/kwrited.desktop,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/kwrited.desktop	1 Oct 2002 02:36:51 -0000	1.1.1.4
+++ konsole/kwrited.desktop	16 Oct 2002 21:58:59 -0000	1.2
@@ -12,7 +12,6 @@
 Name[eo]=Diskskrib-demono
 Name[es]=Demonio de escritura de KDE
 Name[et]=KDE write deemon
-Name[fa]=سرویس نوشتن ک‌د‌ای
 Name[fi]=KDE kirjoituspalvelin
 Name[fr]=Démon de commande Write de KDE
 Name[he]=תהליך השירות Write של KDE
@@ -42,7 +41,7 @@
 Name[xh]=KDE iDaemon yokuBhala
 Name[xx]=xx
 Name[zh_CN]=KDE 书写器守护进程
-Name[zh_TW]=KDE Write 伺服程式
+Name[zh_TW]=KDE Write 服務程式
 Name[zu]=KDE i Daemon yokuBhala
 Type=Service
 X-KDE-StartupNotify=false
Index: konsole/konsole/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
--- konsole/konsole/Makefile.am	14 Aug 2002 14:27:36 -0000	1.1.1.3
+++ konsole/konsole/Makefile.am	14 Aug 2002 15:35:44 -0000	1.3
@@ -47,8 +47,8 @@
 konsole_la_SOURCES = TEPty.cpp BlockArray.cpp main.cpp konsole.cpp schema.cpp session.cpp TEWidget.cpp TEmuVt102.cpp \
      TEScreen.cpp TEmulation.cpp TEHistory.cpp keytrans.cpp konsoleiface.skel sessioniface.skel \
      konsole_wcwidth.cpp konsolebookmarkhandler.cpp konsolebookmarkmenu.cpp konsole_child.cpp
-konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version
-konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBUTIL) $(XTESTLIB)
+konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIBUTIL) $(XTESTLIB) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 # konsole executable
 konsole_SOURCES = dummy.cpp
Index: konsole/konsole/TEPty.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEPty.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.6
diff -u -u -r1.1.1.4 -r1.6
--- konsole/konsole/TEPty.cpp	1 Oct 2002 02:37:00 -0000	1.1.1.4
+++ konsole/konsole/TEPty.cpp	16 Oct 2002 21:58:59 -0000	1.6
@@ -158,7 +158,6 @@
 #define TTY_GROUP "tty"
 
 #include <kstandarddirs.h>
-#include <klocale.h>
 #include <kdebug.h>
 
 #ifndef HERE
@@ -246,10 +245,10 @@
 void TEPty::setSize(int lines, int columns)
 {
   //kdDebug(1211)<<"TEPty::setSize()"<<endl;
-  m_WSize.ws_row = (unsigned short)lines;
-  m_WSize.ws_col = (unsigned short)columns;
-  if(m_MasterFd < 0) return;
-  ioctl(m_MasterFd, TIOCSWINSZ,(char *)&m_WSize);
+  wsize.ws_row = (unsigned short)lines;
+  wsize.ws_col = (unsigned short)columns;
+  if(fd < 0) return;
+  ioctl(fd,TIOCSWINSZ,(char *)&wsize);
   //kdDebug(1211)<<"TEPty::setSize() done"<<endl;
 }
 
@@ -258,7 +257,7 @@
 #ifdef HAVE_UTEMPTER
   {
      KUtmpProcess utmp;
-     utmp.cmdFd = m_MasterFd;
+     utmp.cmdFd = fd;
      utmp << "/usr/sbin/utempter" << "-d" << ttynam;
      utmp.start(KProcess::Block);
   }
@@ -271,7 +270,7 @@
         logout(tty_name);
   }
 #endif
-  if (m_bNeedGrantPty) chownpty(m_MasterFd, false);
+  if (needGrantPty) chownpty(fd, false);
  
   KProcess::commClose();
 }
@@ -304,19 +303,11 @@
   term = _term;
   konsole_dcop = _konsole_dcop;
   konsole_dcop_session = _konsole_dcop_session;
-  m_bAddUtmp = _addutmp;
-  if (m_MasterFd < 0)
-     return -1;
+  addutmp = _addutmp;
 
   if (!start(NotifyOnExit, (Communication) (Stdout | NoRead)))
      return -1;
 
-  if (m_SlaveFd >= 0)
-  {
-     close(m_SlaveFd);
-     m_SlaveFd = -1;
-  }
-
   resume(); // Start...
   return 0;
 
@@ -332,9 +323,9 @@
     chmod(deviceName(), sbuf.st_mode & ~(S_IWGRP|S_IWOTH));
 }
 
-void TEPty::openPty()
-{ 
-  m_bNeedGrantPty = true;
+int TEPty::openPty()
+{ int ptyfd = -1;
+  needGrantPty = true;
 
 #include <kdeversion.h>
 #if KDE_VERSION <305
@@ -348,11 +339,10 @@
 
   // We try, as we know them, one by one.
 #if defined(HAVE_OPENPTY) //FIXME: some work needed.
-  if (m_MasterFd < 0) {
+  if (ptyfd < 0) {
     int master_fd, slave_fd;
     if (openpty(&master_fd, &slave_fd, NULL, NULL, NULL) == 0) {
-      m_MasterFd = master_fd;
-      m_SlaveFd = slave_fd;
+      ptyfd = master_fd;
 #ifdef HAVE_PTSNAME
       strncpy(ptynam, ptsname(master_fd), 50);
 #else
@@ -361,7 +351,7 @@
 #endif
       strncpy(ttynam, ttyname(slave_fd), 50);
 
-      m_bNeedGrantPty = false;
+      needGrantPty = false;
        
       /* Get the group ID of the special `tty' group.  */
       struct group* p = getgrnam(TTY_GROUP);    /* posix */
@@ -369,13 +359,13 @@
 
       if (fchown(slave_fd, (uid_t) -1, gid) < 0)
       {
-         m_bNeedGrantPty = true;
+         needGrantPty = true;
          fprintf(stderr,"konsole: cannot chown %s.\n",ttynam); 
          perror("Reason");
       }
       else if (chmod(ttynam, S_IRUSR|S_IWUSR|S_IWGRP) < 0)
       {
-         m_bNeedGrantPty = true;
+         needGrantPty = true;
          fprintf(stderr,"konsole: cannot chmod %s.\n",ttynam); 
          perror("Reason");
       }
@@ -385,65 +375,64 @@
 
 //#if defined(__sgi__) || defined(__osf__) || defined(__svr4__)
 #if defined(HAVE_GRANTPT) && defined(HAVE_PTSNAME)
-  if (m_MasterFd < 0)
+  if (ptyfd < 0)
   {
 #ifdef _AIX
-    m_MasterFd = open("/dev/ptc",O_RDWR);
+    ptyfd = open("/dev/ptc",O_RDWR);
 #else
-    m_MasterFd = open("/dev/ptmx",O_RDWR);
+    ptyfd = open("/dev/ptmx",O_RDWR);
 #endif
-    if (m_MasterFd >= 0)
+    if (ptyfd >= 0)
     {
-      char *ptsn = ptsname(m_MasterFd);
+      char *ptsn = ptsname(ptyfd);
       if (ptsn) {
-          strncpy(ttynam, ptsname(m_MasterFd), 50);
-          grantpt(m_MasterFd);
-          m_bNeedGrantPty = false;
+          strncpy(ttynam, ptsname(ptyfd), 50);
+          grantpt(ptyfd);
+          needGrantPty = false;
       } else {
       	  perror("ptsname");
-	  close(m_MasterFd);
-	  m_MasterFd = -1;
+	  close(ptyfd);
+	  ptyfd = -1;
       }
     }
   }
 #endif
 
 #if defined(_SCO_DS) || defined(__USLC__) // SCO OSr5 and UnixWare, might be obsolete
-  if (m_MasterFd < 0)
+  if (ptyfd < 0)
   { for (int idx = 0; idx < 256; idx++)
     { sprintf(ptynam, "/dev/ptyp%d", idx);
       sprintf(ttynam, "/dev/ttyp%d", idx);
       if (access(ttynam, F_OK) < 0) { idx = 256; break; }
-      if ((m_MasterFd = open (ptynam, O_RDWR)) >= 0)
+      if ((ptyfd = open (ptynam, O_RDWR)) >= 0)
       { if (access (ttynam, R_OK|W_OK) == 0) break;
-        close(m_MasterFd); m_MasterFd = -1;
+        close(ptyfd); ptyfd = -1;
       }
     }
   }
 #endif
 
-  if (m_MasterFd < 0) // Linux device names, FIXME: Trouble on other systems?
+  if (ptyfd < 0) // Linux device names, FIXME: Trouble on other systems?
   { for (const char* s3 = "pqrstuvwxyzabcdefghijklmno"; *s3 != 0; s3++)
     { for (const char* s4 = "0123456789abcdefghijklmnopqrstuvwxyz"; *s4 != 0; s4++)
       { sprintf(ptynam,"/dev/pty%c%c",*s3,*s4);
         sprintf(ttynam,"/dev/tty%c%c",*s3,*s4);
-        if ((m_MasterFd = open(ptynam,O_RDWR)) >= 0)
+        if ((ptyfd = open(ptynam,O_RDWR)) >= 0)
         { if (geteuid() == 0 || access(ttynam,R_OK|W_OK) == 0) break;
-          close(m_MasterFd); m_MasterFd = -1;
+          close(ptyfd); ptyfd = -1;
         }
       }
-      if (m_MasterFd >= 0) break;
+      if (ptyfd >= 0) break;
     }
   }
 
-  if (m_MasterFd < 0)
+  if (ptyfd < 0)
   {
-    fprintf(stderr,"Can't open a pseudo teletype\n"); 
-    m_strError = i18n("Unable to open a suitable terminal device.");
-    return;
+    //FIXME: handle more gracefully.
+    fprintf(stderr,"Can't open a pseudo teletype\n"); exit(1);
   }
 
-  if (m_bNeedGrantPty && !chownpty(m_MasterFd, true))
+  if (needGrantPty && !chownpty(ptyfd, true))
   {
     fprintf(stderr,"konsole: chownpty failed for device %s::%s.\n",ptynam,ttynam);
     fprintf(stderr,"       : This means the session can be eavesdroped.\n");
@@ -453,12 +442,14 @@
                                              "konsole").local8Bit().data());
   }
 
-  fcntl(m_MasterFd,F_SETFL,O_NDELAY);
+  fcntl(ptyfd,F_SETFL,O_NDELAY);
+
+  return ptyfd;
 }
 
 int TEPty::makePty(bool _addutmp)
 {
-  if (m_MasterFd < 0) // no master pty could be opened
+  if (fd < 0) // no master pty could be opened
   {
   //FIXME:
     fprintf(stderr,"opening master pty failed.\n");
@@ -466,18 +457,15 @@
   }
 
 #ifdef HAVE_UNLOCKPT
-  unlockpt(m_MasterFd);
+  unlockpt(fd);
 #endif
 
 #if defined(TIOCSPTLCK) && 0 //FIXME: obsolete, to removed if no one complains
-  int flag = 0; ioctl(m_MasterFd,TIOCSPTLCK,&flag); // unlock pty
+  int flag = 0; ioctl(fd,TIOCSPTLCK,&flag); // unlock pty
 #endif
 
   // open and set all standard files to slave tty
-  int tt = m_SlaveFd; // Already opened?
-
-  if (tt < 0)
-    tt = open(ttynam, O_RDWR); 
+  int tt = open(ttynam, O_RDWR);
 
   if (tt < 0) // the slave pty could be opened
   {
@@ -497,7 +485,7 @@
   if (_addutmp)
   {
      KUtmpProcess utmp;
-     utmp.cmdFd = m_MasterFd;
+     utmp.cmdFd = fd;
      utmp << "/usr/sbin/utempter" << "-a" << ttynam << "";
      utmp.start(KProcess::Block);
   }
@@ -537,7 +525,7 @@
 void TEPty::startPgm(const char* pgm, QValueList<QCString> & args, const char* term)
 { 
   int sig;
-  int tt = makePty(m_bAddUtmp);
+  int tt = makePty(addutmp);
 
   //reset signal handlers for child process
   for (sig = 1; sig < NSIG; sig++)
@@ -551,7 +539,7 @@
   // We need to close all remaining fd's.
   // Especially the one used by KProcess::start to see if we are running ok.
   for (int i = 0; i < (int)rlp.rlim_cur; i++)
-    if (i != tt && i != m_MasterFd) close(i); //FIXME: (result of merge) Check if not closing fd is OK)
+    if (i != tt && i != fd) close(i); //FIXME: (result of merge) Check if not closing fd is OK)
 
   dup2(tt,fileno(stdin));
   dup2(tt,fileno(stdout));
@@ -606,8 +594,7 @@
       ioctl(0,TCGETS,(char *)&ttmode);
 #   endif
 #endif
-      if (!m_bXonXoff)
-         ttmode.c_iflag &= ~(IXOFF | IXON);
+      ttmode.c_iflag &= ~(IXOFF | IXON);
       ttmode.c_cc[VINTR] = CTRL('C');
       ttmode.c_cc[VQUIT] = CTRL('\\');
       ttmode.c_cc[VERASE] = 0177;
@@ -621,7 +608,7 @@
 #   endif
 #endif
 
-  close(m_MasterFd);
+  close(fd);
 
   // drop privileges
   setgid(getgid()); setuid(getuid()); 
@@ -631,20 +618,41 @@
   if (konsole_dcop && konsole_dcop[0]) setenv("KONSOLE_DCOP",konsole_dcop,1);
   if (konsole_dcop_session && konsole_dcop_session[0]) setenv("KONSOLE_DCOP_SESSION",konsole_dcop_session,1);
 
+//  kdDebug() << "In TEPty.  args.count() is  " << args.count() << endl;
+//  kdDebug() << "In TEPty.  i is " << i << endl;
+//  kdDebug() << "In TEPty.  pgm  is " << pgm << endl;
+
+//  for (int k=1; k < 500000 ; k++) {
+//    for (int j=1; j < 5000 ; j++) {}
+//    }
+
   // convert QStrList into char*[]
   unsigned int i;
   char **argv = (char**)malloc(sizeof(char*)*(args.count()+1));
+//  char **argv = (char**)malloc(sizeof(char*)*(args.count()+0));
   for (i = 0; i<args.count(); i++) {
      argv[i] = strdup(args[i]);
+//      kdDebug() << "argv[" << i << "]=" << argv[i] << endl;
      }
+//  for (i = 1; i<args.count(); i++) argv[i-1] = strdup(args.at(i));
+//   kdDebug() << "pgm WAS = " << pgm << endl;
+   //pgm = strdup(args.at(0));
+//  kdDebug() << "pgm WAS CHANGED TO = " << pgm << endl;
+//  kdDebug() << "In TEPty.  first arg is " << argv[0] << endl;
+//  kdDebug() << "In TEPty.  i is " << i << endl;
+//  kdDebug() << "In TEPty.  pgm  is " << pgm << endl;
+//   for (int k=1; k < 500000 ; k++) {
+//     for (int j=1; j < 8000 ; j++) {}
+//   }
 
   argv[i] = 0L;
 
-  ioctl(0,TIOCSWINSZ,(char *)&m_WSize);  // set screen size
+  ioctl(0,TIOCSWINSZ,(char *)&wsize);  // set screen size
 
   // finally, pass to the new program
   //  kdDebug(1211) << "We are ready to run the program " << pgm << endl;
   execvp(pgm, argv);
+  //execvp("/bin/bash", argv);
   perror("exec failed");
   exit(1);                             // control should never come here.
 }
@@ -654,11 +662,8 @@
 */
 TEPty::TEPty() : pSendJobTimer(NULL)
 { 
-  m_bXonXoff = false;
-  memset(&m_WSize, 0, sizeof(struct winsize));
-  m_SlaveFd = -1;
-  m_MasterFd = -1;
-  openPty();
+  memset(&wsize, 0, sizeof(struct winsize));
+  fd = openPty();
   connect(this, SIGNAL(receivedStdout(int, int &)), 
 	  this, SLOT(DataReceived(int, int&)));
   connect(this, SIGNAL(processExited(KProcess *)),
@@ -676,8 +681,8 @@
 
 int TEPty::setupCommunication(Communication comm)
 {
-   if (m_MasterFd <= 0) return 0;
-   out[0] = m_MasterFd;
+   if (fd <= 0) return 0;
+   out[0] = fd;
    out[1] = dup(2); // Dummy
    communication = comm;
    return 1;
@@ -707,7 +712,7 @@
   int written;
   while(!pendingSendJobs.isEmpty()) {
     SendJob& job = pendingSendJobs.first();
-    written = write(m_MasterFd, job.buffer.data() + job.start, job.length);
+    written = write(fd, job.buffer.data() + job.start, job.length);
     if (written==-1) {
       if ( errno!=EAGAIN && errno!=EINTR )
         pendingSendJobs.remove(pendingSendJobs.begin());
@@ -736,14 +741,12 @@
 /*! sends len bytes through the line */
 void TEPty::send_bytes(const char* s, int len)
 {
-  if (m_MasterFd < 0)
-    return;
   if (!pendingSendJobs.isEmpty()) {
     appendSendJob(s,len);
   }else {
     int written;
     do {
-      written = write(m_MasterFd,s,len);
+      written = write(fd,s,len);
       if (written==-1) {
         if ( errno==EAGAIN || errno==EINTR )
           appendSendJob(s,len);
@@ -759,7 +762,7 @@
 void TEPty::DataReceived(int,int &len)
 { 
   char buf[4096];
-  len = read(m_MasterFd, buf, 4096);
+  len = read(fd, buf, 4096);
   if (len < 0)
      return;
 
@@ -779,4 +782,3 @@
   else
     resume();
 }
-
Index: konsole/konsole/TEPty.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEPty.h,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/TEPty.h	1 Oct 2002 02:37:00 -0000	1.1.1.4
+++ konsole/konsole/TEPty.h	16 Oct 2002 21:58:59 -0000	1.2
@@ -44,13 +44,11 @@
      * the necessary connections to the signals and slots of the
      * instance before starting the execution of the client.
      */
-    int run( const char* pgm, QStrList & args, const char* term, bool _addutmp,
+    int run( const char* pgm, QStrList & args, const char* term, bool addutmp,
              const char* konsole_dcop = "", const char* konsole_dcop_session = "" );
     void setWriteable(bool writeable);
-    void setXonXoff(bool _xonxoff) { m_bXonXoff = _xonxoff; }
     int makePty(bool _addutmp);
-    int masterFd() { return m_MasterFd; }
-    QString error() { return m_strError; }
+    int masterFd() { return fd; }
 
   public slots:
     void lockPty(bool lock);
@@ -92,7 +90,7 @@
       
   private:
     void startPgm(const char* pgm, QValueList<QCString> & args, const char* term);
-    void openPty();
+    int  openPty();
     void appendSendJob(const char* s, int len);
 
   private slots:
@@ -100,16 +98,13 @@
 
   private:
 
-    struct winsize m_WSize;
-    int m_MasterFd;
-    int m_SlaveFd;
-    bool             m_bNeedGrantPty;
-    bool             m_bXonXoff;
-    bool             m_bAddUtmp;
+    struct winsize wsize;
+    int fd;
+    bool             needGrantPty;
     char ptynam[50]; // "/dev/ptyxx" | "/dev/ptmx"
     char ttynam[50]; // "/dev/ttyxx" | "/dev/pts/########..."
     const char *pgm;
-    QString m_strError;
+    bool addutmp;
 
     // environment variables
     const char *term;
Index: konsole/konsole/TEScreen.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEScreen.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -u -r1.1.1.3 -r1.2
--- konsole/konsole/TEScreen.cpp	1 Oct 2002 02:37:00 -0000	1.1.1.3
+++ konsole/konsole/TEScreen.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -218,7 +218,7 @@
 {
   if (cuY == bmargin)
   {
-    if (tmargin == 0) addHistLine(); // hist.history
+    if (tmargin == 0 && bmargin == lines-1) addHistLine(); // hist.history
     scrollUp(tmargin,1);
   }
   else if (cuY < lines-1)
@@ -650,31 +650,15 @@
 /*!
 */
 
-void TEScreen::Tabulate(int n)
+void TEScreen::Tabulate()
 {
   // note that TAB is a format effector (does not write ' ');
-  if (n == 0) n = 1;
-  while((n > 0) && (cuX < columns-1))
-  {
-    cursorRight(1); while((cuX < columns-1) && !tabstops[cuX]) cursorRight(1);
-    n--;
-  }
-}
-
-void TEScreen::backTabulate(int n)
-{
-  // note that TAB is a format effector (does not write ' ');
-  if (n == 0) n = 1;
-  while((n > 0) && (cuX > 0))
-  {
-     cursorLeft(1); while((cuX > 0) && !tabstops[cuX]) cursorLeft(1);
-     n--;
-  }
+  cursorRight(1); while(cuX < columns-1 && !tabstops[cuX]) cursorRight(1);
 }
 
 void TEScreen::clearTabStops()
 {
-  for (int i = 0; i < columns; i++) tabstops[i] = false;
+  for (int i = 0; i < columns; i++) tabstops[i-1] = false;
 }
 
 void TEScreen::changeTabStop(bool set)
@@ -736,11 +720,11 @@
      return;
 
   if (cuX+w > columns) {
-    if (getMode(MODE_Wrap)) {
+    if (getMode(MODE_Wrap)) { 
       line_wrapped[cuY]=true;
       NextLine();
-    }
-    else
+    } 
+    else 
       cuX = columns-w;
   }
 
@@ -756,7 +740,7 @@
   image[i].r = ef_re;
 
   cuX += w--;
-
+  
   while(w)
   {
      i++;
@@ -917,7 +901,7 @@
   if (sel_begin != -1)
   {
      // Adjust selection to follow scroll.
-     bool beginIsTL = (sel_begin == sel_TL);
+     bool beginIsTL = (sel_begin == sel_TL);     
      int diff = dst - loca; // Scroll by this amount
      int scr_TL=loc(0,hist->getLines());
      int srca = loca+scr_TL; // Translate index from screen to global
@@ -939,7 +923,7 @@
      {
         clearSelection();
      }
-     else
+     else 
      {
         if (sel_TL < 0)
            sel_TL = 0;
@@ -1286,7 +1270,7 @@
     {
       // Strip trailing spaces
       j = last_space;
-    }
+    }  
 
   QString res(qc, j);
 
@@ -1349,7 +1333,7 @@
           sel_BR += columns;
        }
     }
-
+   
     // Scroll up if user is looking at the history and we can scroll up
     if ((histCursor > 0) &&  // We can scroll up and...
         ((histCursor != newHistLines) || // User is looking at history...
@@ -1373,7 +1357,7 @@
        {
           clearSelection();
        }
-       else
+       else 
        {
           if (sel_TL < 0)
              sel_TL = 0;
Index: konsole/konsole/TEScreen.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEScreen.h,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -u -r1.1.1.3 -r1.2
--- konsole/konsole/TEScreen.h	1 Oct 2002 02:37:00 -0000	1.1.1.3
+++ konsole/konsole/TEScreen.h	16 Oct 2002 21:58:59 -0000	1.2
@@ -65,8 +65,7 @@
     //
     void Return      ();
     void BackSpace   ();
-    void Tabulate    (int n = 1);
-    void backTabulate(int n);
+    void Tabulate    ();
     //
     // Editing
     //
Index: konsole/konsole/TEWidget.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEWidget.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/TEWidget.cpp	1 Oct 2002 02:37:01 -0000	1.1.1.4
+++ konsole/konsole/TEWidget.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -309,7 +309,6 @@
 ,hasBlinkingCursor(false)
 ,ctrldrag(false)
 ,cuttobeginningofline(false)
-,isBlinkEvent(false)
 ,m_drop(0)
 ,possibleTripleClick(false)
 ,mResizeWidget(0)
@@ -373,64 +372,58 @@
 void TEWidget::drawAttrStr(QPainter &paint, QRect rect,
                            QString& str, ca attr, bool pm, bool clear)
 {
-  int a = font_a + m_lineSpacing / 2;
-  QColor fColor = color_table[attr.f].color;
+  QColor fColor=(((attr.r & RE_CURSOR) && hasFocus() && (!hasBlinkingCursor || !cursorBlinking)) ? color_table[attr.b].color : color_table[attr.f].color);
+  QColor bColor=(((attr.r & RE_CURSOR) && hasFocus() && (!hasBlinkingCursor || !cursorBlinking)) ? color_table[attr.f].color : color_table[attr.b].color);
 
   if (attr.r & RE_CURSOR)
     cursorRect = rect;
 
-  // Paint background
-  if (color_table[attr.b].transparent)
+  if (pm && color_table[attr.b].transparent && (!(attr.r & RE_CURSOR) || cursorBlinking))
   {
-    if (pm)
-       paint.setBackgroundMode( TransparentMode );
-    if (clear || (blinking && (attr.r & RE_BLINK))) 
-       erase(rect);
+    paint.setBackgroundMode( TransparentMode );
+    if (clear) erase(rect);
   }
   else
   {
-    paint.fillRect(rect, color_table[attr.b].color);
-  }
-
-  // Paint cursor
-  if ((attr.r & RE_CURSOR)) {
-    paint.setBackgroundMode( TransparentMode );
-    int h = font_h - m_lineSpacing;
-    QRect r(rect.x(),rect.y()+m_lineSpacing/2,rect.width(),h);
-    if (hasFocus())
-    {
-       if (!cursorBlinking)
-       {
-          paint.fillRect(r, color_table[attr.f].color);
-          fColor = color_table[attr.b].color;
-       }
-    }
+    if (blinking)
+      paint.fillRect(rect, bColor);
     else
     {
-       paint.setPen(fColor);
-       paint.drawRect(r);
+      paint.setBackgroundMode( OpaqueMode );
+      paint.setBackgroundColor( bColor );
     }
   }
-
-  // Paint text
   if (!(blinking && (attr.r & RE_BLINK)))
   {
+    if ((attr.r && RE_CURSOR) && cursorBlinking)
+      erase(rect);
     paint.setPen(fColor);
-    paint.drawText(rect.x(),rect.y()+a, str, -1, QPainter::LTR);
+    paint.drawText(rect.x(),rect.y()+font_a, str, -1, QPainter::LTR);
     if ((attr.r & RE_UNDERLINE) || color_table[attr.f].bold)
     {
       paint.setClipRect(rect);
       if (color_table[attr.f].bold)
       {
         paint.setBackgroundMode( TransparentMode );
-        paint.drawText(rect.x()+1,rect.y()+a, str, -1, QPainter::LTR); // second stroke
+        paint.drawText(rect.x()+1,rect.y()+font_a, str, -1, QPainter::LTR); // second stroke
       }
       if (attr.r & RE_UNDERLINE)
-        paint.drawLine(rect.left(), rect.y()+a+1,
-                       rect.right(),rect.y()+a+1 );
+        paint.drawLine(rect.left(), rect.y()+font_a+1,
+                       rect.right(),rect.y()+font_a+1 );
       paint.setClipping(false);
     }
   }
+  if ((attr.r & RE_CURSOR) && !hasFocus()) {
+    if (pm && color_table[attr.b].transparent)
+    {
+      erase(rect);
+      paint.setBackgroundMode( TransparentMode );
+      paint.drawText(rect.x(),rect.y()+font_a, str, -1, QPainter::LTR);
+    }
+    paint.setClipRect(rect);
+    paint.drawRect(rect.x(),rect.y(),rect.width(),rect.height()-m_lineSpacing);
+    paint.setClipping(false);
+  }
 }
 
 /*!
@@ -535,8 +528,8 @@
      if (!mResizeWidget)
      {
         mResizeWidget = new QFrame(this);
-        QFont f = KGlobalSettings::generalFont();
-        f.setPointSize((f.pointSize()*3)/2);
+        QFont f = mResizeWidget->font();
+        f.setPointSize(f.pointSize()*2);
         f.setBold(true);
         mResizeWidget->setFont(f);
         mResizeWidget->setFrameShape((QFrame::Shape) (QFrame::Box|QFrame::Raised));
@@ -582,6 +575,8 @@
 
 void TEWidget::paintEvent( QPaintEvent* pe )
 {
+
+//{ static int cnt = 0; printf("paint %d\n",cnt++); }
   const QPixmap* pm = backgroundPixmap();
   QPainter paint;
   setUpdatesEnabled(false);
@@ -606,6 +601,10 @@
   int rlx = QMIN(columns-1, QMAX(0,(rect.right()  - tLx - bX ) / font_w));
   int rly = QMIN(lines-1,   QMAX(0,(rect.bottom() - tLy - bY  ) / font_h));
 
+  //  if (pm != NULL && color_table[image->b].transparent)
+  //  erase(rect);
+  // BL: I have no idea why we need this, and it breaks the refresh.
+
   QChar *disstrU = new QChar[columns];
   for (int y = luy; y <= rly; y++)
   {
@@ -636,13 +635,10 @@
       if ((x+len < columns) && (!image[loc(x+len,y)].c))
         len++; // Adjust for trailing part of multi-column char
 
-      if (!isBlinkEvent || (cr & RE_BLINK))
-      {
-         QString unistr(disstrU,p);
-         drawAttrStr(paint,
+      QString unistr(disstrU,p);
+      drawAttrStr(paint,
                 QRect(bX+tLx+font_w*x,bY+tLy+font_h*y,font_w*len,font_h),
                 unistr, image[loc(x,y)], pm != NULL, false);
-      }
       x += len - 1;
     }
   }
@@ -655,15 +651,13 @@
 void TEWidget::blinkEvent()
 {
   blinking = !blinking;
-  isBlinkEvent = true;
   repaint(false);
-  isBlinkEvent = false;
 }
 
 void TEWidget::blinkCursorEvent()
 {
   cursorBlinking = !cursorBlinking;
-  repaint(cursorRect, true);
+  repaint(cursorRect, false);
 }
 
 /* ------------------------------------------------------------------------- */
@@ -1145,18 +1139,6 @@
   QTimer::singleShot(QApplication::doubleClickInterval(),this,SLOT(tripleClickTimeout()));
 }
 
-void TEWidget::wheelEvent( QWheelEvent* ev )
-{
-  if (!mouse_marks)
-  {
-    QPoint tL  = contentsRect().topLeft();
-    int    tLx = tL.x();
-    int    tLy = tL.y();
-    QPoint pos = QPoint((ev->x()-tLx-bX)/font_w,(ev->y()-tLy-bY)/font_h);
-    emit mouseSignal( ev->delta() > 0 ? 4 : 5, pos.x() + 1, pos.y() + 1 );
-  }
-}
-
 void TEWidget::tripleClickTimeout()
 {
   possibleTripleClick=false;
@@ -1209,7 +1191,7 @@
 
 void TEWidget::focusOutEvent( QFocusEvent * )
 {
-  repaint(cursorRect, true);  // don't erase area
+  repaint(cursorRect, false);  // don't erase area
 }
 
 bool TEWidget::focusNextPrevChild( bool next )
@@ -1659,7 +1641,7 @@
       setActiveWindow();
       break;
    case 1: // cd ...
-     emit sendStringToEmu("\001\013cd ");
+     emit sendStringToEmu("cd ");
       struct stat statbuf;
       if ( ::stat( QFile::encodeName( dropText ), &statbuf ) == 0 )
       {
@@ -1676,13 +1658,13 @@
       setActiveWindow();
       break;
    case 2: // copy
-     emit sendStringToEmu("\001\013cp -i ");
+     emit sendStringToEmu("cp -i ");
      break;
    case 3: // link
-     emit sendStringToEmu("\001\013ln -s ");
+     emit sendStringToEmu("ln -s ");
      break;
    case 4: // move
-     emit sendStringToEmu("\001\013mv -i ");
+     emit sendStringToEmu("mv -i ");
      break;
    }
    if (item>1 && item<5) {
Index: konsole/konsole/TEWidget.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEWidget.h,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/TEWidget.h	1 Oct 2002 02:37:01 -0000	1.1.1.4
+++ konsole/konsole/TEWidget.h	16 Oct 2002 21:58:59 -0000	1.2
@@ -143,7 +143,6 @@
     void mousePressEvent( QMouseEvent* );
     void mouseReleaseEvent( QMouseEvent* );
     void mouseMoveEvent( QMouseEvent* );
-    void wheelEvent( QWheelEvent* );
 
     void focusInEvent( QFocusEvent * );
     void focusOutEvent( QFocusEvent * );
@@ -217,7 +216,6 @@
     bool hasBlinkingCursor;  // has blinking cursor enabled
     bool ctrldrag;           // require Ctrl key for drag
     bool cuttobeginningofline; // triple click only selects forward
-    bool isBlinkEvent; // paintEvent due to blinking.
     QTimer* blinkT;  // active when hasBlinker
     QTimer* blinkCursorT;  // active when hasBlinkingCursor
     
Index: konsole/konsole/TEmuVt102.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEmuVt102.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/TEmuVt102.cpp	1 Oct 2002 02:37:00 -0000	1.1.1.4
+++ konsole/konsole/TEmuVt102.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -183,7 +183,6 @@
    - CSI_PN     - Escape codes of the form <ESC>'['     {Pn} ';' {Pn} C
    - CSI_PS     - Escape codes of the form <ESC>'['     {Pn} ';' ...  C
    - CSI_PR     - Escape codes of the form <ESC>'[' '?' {Pn} ';' ...  C
-   - CSI_PE     - Escape codes of the form <ESC>'[' '!' {Pn} ';' ...  C
    - VT52       - VT52 escape codes
                   - <ESC><Chr>
                   - <ESC>'Y'{Pc}{Pc}
@@ -213,8 +212,6 @@
 
 #define TY_CSI_PG(A  )  TY_CONSTR(9,A,0)
 
-#define TY_CSI_PE(A  )  TY_CONSTR(10,A,0)
-
 // Tokenizer --------------------------------------------------------------- --
 
 /* The tokenizers state
@@ -257,13 +254,13 @@
 
 void TEmuVt102::initTokenizer()
 { int i; UINT8* s;
-  for(i =  0;                      i < 256; i++) tbl[ i]  = 0;
-  for(i =  0;                      i <  32; i++) tbl[ i] |= CTL;
-  for(i = 32;                      i < 256; i++) tbl[ i] |= CHR;
-  for(s = (UINT8*)"@ABCDGHILMPXZcdfry"; *s; s++) tbl[*s] |= CPN;
-  for(s = (UINT8*)"0123456789"        ; *s; s++) tbl[*s] |= DIG;
-  for(s = (UINT8*)"()+*%"             ; *s; s++) tbl[*s] |= SCS;
-  for(s = (UINT8*)"()+*#[]%"          ; *s; s++) tbl[*s] |= GRP;
+  for(i =  0;                    i < 256; i++) tbl[ i]  = 0;
+  for(i =  0;                    i <  32; i++) tbl[ i] |= CTL;
+  for(i = 32;                    i < 256; i++) tbl[ i] |= CHR;
+  for(s = (UINT8*)"@ABCDGHLMPXcdfry"; *s; s++) tbl[*s] |= CPN;
+  for(s = (UINT8*)"0123456789"      ; *s; s++) tbl[*s] |= DIG;
+  for(s = (UINT8*)"()+*%"           ; *s; s++) tbl[*s] |= SCS;
+  for(s = (UINT8*)"()+*#[]%"        ; *s; s++) tbl[*s] |= GRP;
   resetToken();
 }
 
@@ -287,9 +284,8 @@
 #define les(P,L,C) (p == (P) && s[L] < 256  && (tbl[s[(L)]] & (C)) == (C))
 #define eec(C)     (p >=  3  &&        cc                          == (C))
 #define ees(C)     (p >=  3  && cc < 256 &&    (tbl[  cc  ] & (C)) == (C))
-#define eps(C)     (p >=  3  && s[2] != '?' && s[2] != '!' && s[2] != '>' && cc < 256 && (tbl[  cc  ] & (C)) == (C))
+#define eps(C)     (p >=  3  && s[2] != '?' && s[2] != '>' && cc < 256 && (tbl[  cc  ] & (C)) == (C))
 #define epp( )     (p >=  3  && s[2] == '?'                              )
-#define epe( )     (p >=  3  && s[2] == '!'                              )
 #define egt(     ) (p >=  3  && s[2] == '>'                              )
 #define Xpe        (ppos>=2  && pbuf[1] == ']'                           )
 #define Xte        (Xpe                        &&     cc           ==  7 )
@@ -321,19 +317,16 @@
   if (getMode(MODE_Ansi)) // decide on proper action
   {
     if (lec(1,0,ESC)) {                                                       return; }
-    if (lec(1,0,ESC+128)) { s[0] = ESC; onRcvChar('[');                       return; }
     if (les(2,1,GRP)) {                                                       return; }
     if (Xte         ) { XtermHack();                            resetToken(); return; }
     if (Xpe         ) {                                                       return; }
     if (lec(3,2,'?')) {                                                       return; }
     if (lec(3,2,'>')) {                                                       return; }
-    if (lec(3,2,'!')) {                                                       return; }
     if (lun(       )) { tau( TY_CHR___(), applyCharset(cc), 0); resetToken(); return; }
     if (lec(2,0,ESC)) { tau( TY_ESC___(s[1]),    0,   0);       resetToken(); return; }
     if (les(3,1,SCS)) { tau( TY_ESC_CS(s[1],s[2]),    0,   0);  resetToken(); return; }
     if (lec(3,1,'#')) { tau( TY_ESC_DE(s[2]),    0,   0);       resetToken(); return; }
     if (eps(    CPN)) { tau( TY_CSI_PN(cc), argv[0],argv[1]);   resetToken(); return; }
-    if (epe(       )) { tau( TY_CSI_PE(cc),      0,   0);       resetToken(); return; }
     if (ees(    DIG)) { addDigit(cc-'0');                                     return; }
     if (eec(    ';')) { addArgument();                                        return; }
     for (i=0;i<=argc;i++)
@@ -560,12 +553,10 @@
     case TY_CSI_PN('D'      ) : scr->cursorLeft           (p         ); break; //VT100
     case TY_CSI_PN('G'      ) : scr->setCursorX           (p         ); break; //LINUX
     case TY_CSI_PN('H'      ) : scr->setCursorYX          (p,       q); break; //VT100
-    case TY_CSI_PN('I'      ) : scr->Tabulate             (p         ); break;
     case TY_CSI_PN('L'      ) : scr->insertLines          (p         ); break;
     case TY_CSI_PN('M'      ) : scr->deleteLines          (p         ); break;
     case TY_CSI_PN('P'      ) : scr->deleteChars          (p         ); break;
     case TY_CSI_PN('X'      ) : scr->eraseChars           (p         ); break;
-    case TY_CSI_PN('Z'      ) : scr->backTabulate         (p         ); break;
     case TY_CSI_PN('c'      ) :      reportTerminalType   (          ); break; //VT100
     case TY_CSI_PN('d'      ) : scr->setCursorY           (p         ); break; //LINUX
     case TY_CSI_PN('f'      ) : scr->setCursorYX          (p,       q); break; //VT100
@@ -579,8 +570,8 @@
 
     case TY_CSI_PR('l',    2) :        resetMode      (MODE_Ansi     ); break; //VT100
 
-    case TY_CSI_PR('h',    3) : /* IGNORED:  setColumns (       132) */ break; //VT100
-    case TY_CSI_PR('l',    3) : /* IGNORED:  setColumns (        80) */ break; //VT100
+    case TY_CSI_PR('h',    3) :      setColumns           (       132); break; //VT100
+    case TY_CSI_PR('l',    3) :      setColumns           (        80); break; //VT100
 
     case TY_CSI_PR('h',    4) : /* IGNORED: soft scrolling           */ break; //VT100
     case TY_CSI_PR('l',    4) : /* IGNORED: soft scrolling           */ break; //VT100
@@ -617,11 +608,6 @@
     case TY_CSI_PR('s',   47) :         saveMode      (MODE_AppScreen); break; //XTERM
     case TY_CSI_PR('r',   47) :      restoreMode      (MODE_AppScreen); break; //XTERM
 
-    case TY_CSI_PR('h',   67) : /* IGNORED: DECBKM                   */ break; //XTERM
-    case TY_CSI_PR('l',   67) : /* IGNORED: DECBKM                   */ break; //XTERM
-    case TY_CSI_PR('s',   67) : /* IGNORED: DECBKM                   */ break; //XTERM
-    case TY_CSI_PR('r',   67) : /* IGNORED: DECBKM                   */ break; //XTERM
-
     // XTerm defines the following modes:
     // SET_VT200_MOUSE             1000
     // SET_VT200_HIGHLIGHT_MOUSE   1001
@@ -667,9 +653,6 @@
     case TY_CSI_PR('h', 1049) : saveCursor(); screen[1]->clearEntireScreen(); setMode(MODE_AppScreen); break; //XTERM
     case TY_CSI_PR('l', 1049) : resetMode(MODE_AppScreen); restoreCursor(); break; //XTERM
 
-    //FIXME: weird DEC reset sequence
-    case TY_CSI_PE('p'      ) : /* IGNORED: reset         (        ) */ break;
-
     //FIXME: when changing between vt52 and ansi mode evtl do some resetting.
     case TY_VT52__('A'      ) : scr->cursorUp             (         1); break; //VT52
     case TY_VT52__('B'      ) : scr->cursorDown           (         1); break; //VT52
@@ -803,9 +786,6 @@
 void TEmuVt102::onMouse( int cb, int cx, int cy )
 { char tmp[20];
   if (!connected) return;
-  // normal buttons are passed as 0x20 + button,
-  // mouse wheel (buttons 4,5) as 0x60 + button
-  if (cb >= 4) cb += 0x40;
   sprintf(tmp,"\033[M%c%c%c",cb+040,cx+040,cy+040);
   sendString(tmp);
 }
Index: konsole/konsole/TEmulation.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/TEmulation.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/TEmulation.cpp	1 Oct 2002 02:37:00 -0000	1.1.1.4
+++ konsole/konsole/TEmulation.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -420,7 +420,7 @@
 
 // Refreshing -------------------------------------------------------------- --
 
-#define BULK_TIMEOUT 10
+#define BULK_TIMEOUT 20
 
 /*!
    called when \n comes in. Evtl. triggers showBulk at endBulk
@@ -475,8 +475,14 @@
   if ( connected)
   {
     //kdDebug(1211)<<"TEmulation::setConnect() onImageSize..."<<endl;
-    onImageSizeChange(gui->Lines(), gui->Columns());  // calls showBulk();
+    onImageSizeChange(gui->Lines(), gui->Columns());
+    //kdDebug(1211)<<"TEmulation::setConnect() showBulk()"<<endl;
+    showBulk();
     //kdDebug(1211)<<"TEmulation::setConnect() done"<<endl;
+  }
+  else
+  {
+    scr->clearSelection();
   }
 }
 
Index: konsole/konsole/konsole.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/konsole.cpp	1 Oct 2002 02:36:58 -0000	1.1.1.4
+++ konsole/konsole/konsole.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -235,7 +235,6 @@
 ,b_warnQuit(false)
 ,b_allowResize(true)
 ,b_addToUtmp(true)
-,b_xonXoff(false)
 ,b_fullScripting(false)
 ,m_histSize(DEFAULT_HISTORY_SIZE)
 {
@@ -321,7 +320,6 @@
   kapp->dcopClient()->setDefaultObject( "konsole" );
 }
 
-
 Konsole::~Konsole()
 {
     while (detached.count()) {
@@ -333,7 +331,7 @@
     sessions.first();
     while(sessions.current())
     {
-      sessions.current()->closeSession();
+      sessions.current()->sendSignal(SIGHUP);
       sessions.next();
     }
 
@@ -364,12 +362,6 @@
    connect( kWinModule,SIGNAL(currentDesktopChanged(int)), this,SLOT(currentDesktopChanged(int)) );
 }
 
-void Konsole::setAutoClose(bool on)
-{
-    if (sessions.first())
-       sessions.first()->setAutoClose(on);
-}
-
 void Konsole::showTip()
 {
    KTipDialog::showTip(this,QString::null,true);
@@ -394,8 +386,7 @@
 {
    if (m_menuCreated) return;
    //not longer needed
-   if (m_toolbarSessionsCommands)
-      disconnect(m_toolbarSessionsCommands,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
+   disconnect(m_toolbarSessionsCommands,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
    disconnect(m_session,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
    disconnect(m_options,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
    disconnect(m_help,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
@@ -405,15 +396,14 @@
    disconnect(m_bookmarks,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
    disconnect(m_bookmarksSession,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
    //KONSOLEDEBUG<<"Konsole::makeGUI()"<<endl;
-   if (m_toolbarSessionsCommands)
-      connect(m_toolbarSessionsCommands,SIGNAL(aboutToShow()),this,SLOT(loadScreenSessions()));
+   connect(m_toolbarSessionsCommands,SIGNAL(aboutToShow()),this,SLOT(loadScreenSessions()));
    connect(m_session,SIGNAL(aboutToShow()),this,SLOT(loadScreenSessions()));
    m_menuCreated=true;
 
    // Remove the empty separator Qt inserts if the menu is empty on popup,
    // not sure if this will be "fixed" in Qt, for now use this hack (malte)
    if(!(isRestored)) {
-     if (sender() && sender()->inherits("QPopupMenu") &&
+     if (sender()->inherits("QPopupMenu") &&
        static_cast<const QPopupMenu *>(sender())->count() == 1)
        const_cast<QPopupMenu *>(static_cast<const QPopupMenu *>(sender()))->removeItemAt(0);
        }
@@ -593,8 +583,15 @@
    m_help->insertItem(SmallIcon( "idea" ), i18n("&Tip of the Day..."), 
             this, SLOT(showTip()), 0, -1, 2);
 
-   //the different session menus
-   buildSessionMenus();
+   //the different session types
+   loadSessionCommands();
+   loadScreenSessions();
+
+   m_session->insertSeparator();
+   m_closeSession->plug(m_session);
+
+   m_session->insertSeparator();
+   m_quit->plug(m_session);
 
    connect(m_session, SIGNAL(activated(int)), SLOT(newSession(int)));
 
@@ -607,8 +604,7 @@
    m_rightButton->insertItem(i18n("&Send Signal"), m_signals);
 
    m_rightButton->insertSeparator();
-   if (m_toolbarSessionsCommands)
-       m_rightButton->insertItem( i18n("New Sess&ion"), m_toolbarSessionsCommands );
+   m_rightButton->insertItem( i18n("New Sess&ion"), m_toolbarSessionsCommands );
    m_detachSession->plug(m_rightButton);
    m_renameSession->plug(m_rightButton);
 
@@ -681,15 +677,12 @@
 void Konsole::makeBasicGUI()
 {
   //KONSOLEDEBUG<<"Konsole::makeBasicGUI()"<<endl;
-  if (kapp->authorize("shell_access"))
-  {
-     KToolBarPopupAction *newsession = new KToolBarPopupAction(i18n("&New"), "filenew",
+  KToolBarPopupAction *newsession = new KToolBarPopupAction(i18n("&New"), "filenew",
                 0 , this, SLOT(newSession()),this, KStdAction::stdName(KStdAction::New));
-    newsession->plug(toolBar());
-    toolBar()->insertLineSeparator();
-    m_toolbarSessionsCommands = newsession->popupMenu();
-    connect(m_toolbarSessionsCommands, SIGNAL(activated(int)), SLOT(newSessionToolbar(int)));
-  }
+  newsession->plug(toolBar());
+  toolBar()->insertLineSeparator();
+  m_toolbarSessionsCommands = newsession->popupMenu();
+  connect(m_toolbarSessionsCommands, SIGNAL(activated(int)), SLOT(newSessionToolbar(int)));
 
   toolBar()->setFullSize( true );
 
@@ -715,8 +708,7 @@
   // activating shortcuts here means deactivating them in the other
   // programs.
 
-  if (m_toolbarSessionsCommands)
-     connect(m_toolbarSessionsCommands,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
+  connect(m_toolbarSessionsCommands,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
   connect(m_session,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
   connect(m_options,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
   connect(m_help,SIGNAL(aboutToShow()),this,SLOT(makeGUI()));
@@ -794,7 +786,7 @@
   //help menu
   m_help->setAccel(QKeySequence(),m_help->idAt(0));
 
-  m_closeSession = new KAction(i18n("C&lose Session"), "fileclose", 0, this,
+  m_closeSession = new KAction(i18n("&Close Session"), "fileclose", 0, this,
                                SLOT(closeCurrentSession()), m_shortcuts, "close_session");
   m_quit = new KAction(i18n("&Quit"), "exit", 0, this, SLOT( close() ), m_shortcuts, "quit");
 
@@ -856,13 +848,24 @@
     // WABA: Don't close if there are any sessions left.
     // Tell them to go away.
     sessions.first();
+    bool allOK=true;
     while(sessions.current())
     {
-      sessions.current()->closeSession();
+      if (!sessions.current()->sendSignal(SIGHUP))
+        allOK=false;
       sessions.next();
     }
 
-    m_closeTimeout.start(1500, true);
+    if (!allOK)
+    {
+      KMessageBox::information( this, i18n("Not all sessions could be closed. "
+                                           "Please end all sessions running under other user IDs. "
+                                           "In most cases typing 'exit' at the prompt will end them.") );
+    }
+    else
+    {
+      m_closeTimeout.start(1500, true);
+    }
     return false;
 }
 
@@ -877,7 +880,7 @@
     {
         while(sessions.first())
         {
-            doneSession(sessions.current());
+            doneSession(sessions.current(), 0);
         }
     }
 }
@@ -1037,21 +1040,19 @@
      s_word_seps= config->readEntry("wordseps",":@-./_~");
      te->setWordCharacters(s_word_seps);
 
-     te->setTerminalSizeHint( config->readBoolEntry("TerminalSizeHint",true) );
-     
      b_framevis = config->readBoolEntry("has frame",true);
      te->setFrameStyle( b_framevis?(QFrame::WinPanel|QFrame::Sunken):QFrame::NoFrame );
 
      te->setBlinkingCursor(config->readBoolEntry("BlinkingCursor",false));
      te->setCtrlDrag(config->readBoolEntry("CtrlDrag",false));
-     te->setCutToBeginningOfLine(config->readBoolEntry("CutToBeginningOfLine",false));     
+     te->setCutToBeginningOfLine(config->readBoolEntry("CutToBeginningOfLine",false));
+     te->setTerminalSizeHint( config->readBoolEntry("TerminalSizeHint",true) );
      te->setLineSpacing( config->readUnsignedNumEntry( "LineSpacing", 0 ) );
 
      monitorSilenceSeconds=config->readUnsignedNumEntry("SilenceSeconds", 10);
      for (TESession *ses = sessions.first(); ses; ses = sessions.next())
        ses->setMonitorSilenceSeconds(monitorSilenceSeconds);
        
-     b_xonXoff = config->readBoolEntry("XonXoff",false);
      config->setGroup("UTMP");
      b_addToUtmp = config->readBoolEntry("AddToUtmp",true);
      config->setDesktopGroup();
@@ -1091,6 +1092,7 @@
          //KONSOLEDEBUG << "Setting up transparency" << endl;
          rootxpm->setFadeEffect(sch->tr_x(), QColor(sch->tr_r(), sch->tr_g(), sch->tr_b()));
          rootxpm->start();
+         rootxpm->repaint(true);
       }
       else
       {
@@ -1374,7 +1376,6 @@
 {
   KGlobal::config()->reparseConfiguration();
   readProperties(KGlobal::config(), QString::null, true);
-  buildSessionMenus();
 }
 
 // --| color selection |-------------------------------------------------------
@@ -1537,7 +1538,7 @@
   if (URL.startsWith("file:")) {
     newtext=URL.mid(5);
     KRun::shellQuote(newtext);
-    te->emitText("\001\013cd "+newtext+"\r");
+    te->emitText("cd "+newtext+"\r");
   }
   else if (URL.contains("://", true)) {
     i = URL.find("://", 0);
@@ -1915,8 +1916,8 @@
   s->setMonitorSilenceSeconds(monitorSilenceSeconds);
   s->enableFullScripting(b_fullScripting);
   // If you add any new signal-slot connection below, think about doing it in konsolePart too
-  connect( s,SIGNAL(done(TESession*)),
-           this,SLOT(doneSession(TESession*)) );
+  connect( s,SIGNAL(done(TESession*,int)),
+           this,SLOT(doneSession(TESession*,int)) );
   connect( te, SIGNAL(configureRequest(TEWidget*, int, int, int)),
            this, SLOT(configureRequest(TEWidget*,int,int,int)) );
   connect( s, SIGNAL( updateTitle() ),
@@ -1943,7 +1944,6 @@
   s->setTitle(txt);
   s->setIconName(icon);
   s->setAddToUtmp(b_addToUtmp);
-  s->setXonXoff(b_xonXoff);
 
   if (b_histEnabled && m_histSize)
     s->setHistory(HistoryTypeBuffer(m_histSize));
@@ -1996,7 +1996,7 @@
 
 void Konsole::closeCurrentSession()
 {
-  se->closeSession();
+  se->sendSignal(SIGHUP);
 }
 
 void Konsole::doneChild(KonsoleChild* child, TESession* session)
@@ -2010,7 +2010,7 @@
 //       this routine might be called before
 //       session swap is completed.
 
-void Konsole::doneSession(TESession* s)
+void Konsole::doneSession(TESession* s, int)
 {
 // qWarning("Konsole::doneSession(): Exited:%d ExitStatus:%d\n", WIFEXITED(status),WEXITSTATUS(status));
 #if 0 // die silently
@@ -2239,28 +2239,6 @@
   }
 }
 
-void Konsole::buildSessionMenus()
-{
-   m_session->clear();
-   m_toolbarSessionsCommands->clear();
-
-   no2command.clear();
-   no2tempFile.clear();
-   no2filename.clear();
-
-   cmd_serial = 0;
-   cmd_first_screen = -1;
-
-   loadSessionCommands();
-   loadScreenSessions();
-
-   m_session->insertSeparator();
-   m_closeSession->plug(m_session);
-
-   m_session->insertSeparator();
-   m_quit->plug(m_session);
-}
-
 void Konsole::addSessionCommand(const QString &path)
 {
   KSimpleConfig* co;
@@ -2294,11 +2272,8 @@
   no2filename.insert(cmd_serial,new QString(filename));
 }
 
-
 void Konsole::loadSessionCommands()
 {
-  if (!kapp->authorize("shell_access"))
-     return;
   addSessionCommand(QString::null);
   m_session->insertSeparator();
   m_toolbarSessionsCommands->insertSeparator();
@@ -2338,8 +2313,6 @@
 
 void Konsole::loadScreenSessions()
 {
-  if (!kapp->authorize("shell_access"))
-     return;
   QCString screenDir = getenv("SCREENDIR");
   if (screenDir.isEmpty())
     screenDir = QFile::encodeName(QDir::homeDirPath()) + "/.screen/";
@@ -2380,8 +2353,7 @@
     for (int i = cmd_first_screen; i <= cmd_serial; ++i)
     {
       m_session->removeItem(i);
-      if (m_toolbarSessionsCommands)
-         m_toolbarSessionsCommands->removeItem(i);
+      m_toolbarSessionsCommands->removeItem(i);
       no2command.remove(i);
       no2tempFile.remove(i);
       no2filename.remove(i);
@@ -2448,6 +2420,7 @@
 //        KONSOLEDEBUG << "Setting up transparency" << endl;
     rootxpm->setFadeEffect(s->tr_x(), QColor(s->tr_r(), s->tr_g(), s->tr_b()));
     rootxpm->start();
+    rootxpm->repaint(true);
   } else {
 //        KONSOLEDEBUG << "Stopping transparency" << endl;
     rootxpm->stop();
@@ -2469,8 +2442,8 @@
   sessions.remove(se);
   delete ra;
 
-  disconnect( se,SIGNAL(done(TESession*)),
-              this,SLOT(doneSession(TESession*)) );
+  disconnect( se,SIGNAL(done(TESession*,int)),
+              this,SLOT(doneSession(TESession*,int)) );
 
   disconnect( se->getEmulation(),SIGNAL(ImageSizeChanged(int,int)), this,SLOT(notifySize(int,int)));
   disconnect( se->getEmulation(),SIGNAL(changeColumns(int)), this,SLOT(changeColumns(int)) );
@@ -2531,8 +2504,8 @@
   connect(ktb,SIGNAL(doubleClicked(int)), this,SLOT(slotRenameSession(int)));
   session2button.insert(session,ktb);
 
-  connect( session,SIGNAL(done(TESession*)),
-           this,SLOT(doneSession(TESession*)) );
+  connect( session,SIGNAL(done(TESession*,int)),
+           this,SLOT(doneSession(TESession*,int)) );
 
   connect( session,SIGNAL(updateTitle()), this,SLOT(updateTitle()) );
   connect( session,SIGNAL(notifySessionState(TESession*,int)), this,SLOT(notifySessionState(TESession*,int)) );
Index: konsole/konsole/konsole.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole.h,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/konsole/konsole.h	1 Oct 2002 02:36:58 -0000	1.1.1.5
+++ konsole/konsole/konsole.h	16 Oct 2002 21:58:59 -0000	1.2
@@ -44,7 +44,7 @@
 #undef PACKAGE
 #undef VERSION
 #define PACKAGE "konsole"
-#define VERSION "1.2 Beta2"
+#define VERSION "1.2 Beta"
 
 class KRootPixmap;
 class QCheckBox;
@@ -66,7 +66,6 @@
   ~Konsole();
   void setColLin(int columns, int lines);
   void setFullScreen(bool on);
-  void setAutoClose(bool on);
   void initFullScreen();
   void initSessionFont(int fontNo);
   void initSessionTitle(const QString &_title);
@@ -121,7 +120,7 @@
   void activateSession(TESession*);
   void closeCurrentSession();
   void doneChild(KonsoleChild*, TESession*);
-  void doneSession(TESession*);
+  void doneSession(TESession*,int);
   void slotCouldNotClose();
   void slotToggleFullscreen();
   void schema_menu_activated(int item);
@@ -218,7 +217,6 @@
   void setFont(int fontno);
 
   void clearSessionHistory(TESession & session);
-  void buildSessionMenus();
   void addSessionCommand(const QString & path);
   void loadSessionCommands();
   void addScreenSession(const QString & socket);
@@ -337,7 +335,6 @@
   bool        isRestored:1;
   bool        b_allowResize:1;
   bool        b_addToUtmp:1;
-  bool        b_xonXoff:1;
 
   bool        b_histEnabled:1;
   bool        b_fullScripting:1;
Index: konsole/konsole/konsole_child.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_child.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -u -r1.1.1.3 -r1.2
--- konsole/konsole/konsole_child.cpp	1 Oct 2002 02:36:58 -0000	1.1.1.3
+++ konsole/konsole/konsole_child.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -59,6 +59,7 @@
     if (schema->useTransparency()) {
       rootxpm->setFadeEffect(schema->tr_x(), QColor(schema->tr_r(), schema->tr_g(), schema->tr_b()));
       rootxpm->start();
+      rootxpm->repaint(true);
       session_transparent=true;
     } else {
       rootxpm->stop();
@@ -69,8 +70,8 @@
 
   updateTitle();
 
-  connect( se,SIGNAL(done(TESession*)),
-           this,SLOT(doneSession(TESession*)) );
+  connect( se,SIGNAL(done(TESession*,int)),
+           this,SLOT(doneSession(TESession*,int)) );
   connect( te, SIGNAL(configureRequest(TEWidget*, int, int, int)),
            this, SLOT(configureRequest(TEWidget*, int, int, int)) );
 
@@ -114,7 +115,7 @@
   renameSession->plug(m_rightButton);
 
   m_rightButton->insertSeparator();
-  KAction *closeSession = new KAction(i18n("C&lose Session"), "fileclose", 0, this,
+  KAction *closeSession = new KAction(i18n("&Close Session"), "fileclose", 0, this,
                                       SLOT(closeSession()), actions);
   closeSession->plug(m_rightButton );
   if (KGlobalSettings::insertTearOffHandle())
@@ -181,7 +182,7 @@
   m_rightButton->popup(te->mapToGlobal(QPoint(x,y)));
 }
 
-void KonsoleChild::doneSession(TESession*)
+void KonsoleChild::doneSession(TESession*,int)
 {
   se->setConnect(false);
   session_terminated=true;
@@ -210,7 +211,7 @@
 
 void KonsoleChild::closeSession()
 {
-  se->closeSession();
+  se->sendSignal(SIGHUP);
 }
 
 void KonsoleChild::pixmap_menu_activated(int item,QString pmPath)
Index: konsole/konsole/konsole_child.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_child.h,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -u -r1.1.1.2 -r1.2
--- konsole/konsole/konsole_child.h	1 Oct 2002 02:36:58 -0000	1.1.1.2
+++ konsole/konsole/konsole_child.h	16 Oct 2002 21:58:59 -0000	1.2
@@ -44,7 +44,7 @@
 
 private slots:
   void configureRequest(TEWidget*,int,int,int);
-  void doneSession(TESession*);
+  void doneSession(TESession*,int);
   void updateTitle();
   void slotRenameSession(TESession* ses, const QString &name);
   void restoreAllListenToKeyPress();
Index: konsole/konsole/konsole_grantpty.c
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_grantpty.c,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -u -r1.1.1.3 -r1.2
--- konsole/konsole/konsole_grantpty.c	1 Oct 2002 02:36:59 -0000	1.1.1.3
+++ konsole/konsole/konsole_grantpty.c	16 Oct 2002 21:58:59 -0000	1.2
@@ -175,12 +175,5 @@
     return 1; /* FAIL */
   }
 
-  if (revoke(tty) < 0)
-  {
-    fprintf(stderr,"%s: cannot revoke %s.\n",argv[0],tty); perror("Reason");
-    return 1; /* FAIL */
-  }
-
-
   return 0; /* OK */
 }
Index: konsole/konsole/konsole_part.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_part.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/konsole_part.cpp	1 Oct 2002 02:36:59 -0000	1.1.1.4
+++ konsole/konsole/konsole_part.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -166,8 +166,8 @@
 
   setWidget(te);
   se = new TESession(te,shell,eargs,"xterm");
-  connect( se,SIGNAL(done(TESession*)),
-           this,SLOT(doneSession(TESession*)) );
+  connect( se,SIGNAL(done(TESession*,int)),
+           this,SLOT(doneSession(TESession*,int)) );
   connect( se,SIGNAL(openURLRequest(const QString &)),
            this,SLOT(emitOpenURLRequest(const QString &)) );
   connect( te,SIGNAL(configureRequest(TEWidget*,int,int,int)),
@@ -222,14 +222,14 @@
   connect( se, SIGNAL( destroyed() ), this, SLOT( sessionDestroyed() ) );
 }
 
-void konsolePart::doneSession(TESession*)
+void konsolePart::doneSession(TESession*,int)
 {
   // see doneSession in konsole.cpp
   if (se)
   {
     kdDebug(1211) << "doneSession - disconnecting done" << endl;;
-    disconnect( se,SIGNAL(done(TESession*)),
-                this,SLOT(doneSession(TESession*)) );
+    disconnect( se,SIGNAL(done(TESession*,int)),
+                this,SLOT(doneSession(TESession*,int)) );
     se->setConnect(false);
     //QTimer::singleShot(100,se,SLOT(terminate()));
     kdDebug(1211) << "se->terminate()" << endl;;
@@ -285,7 +285,7 @@
       stat( QFile::encodeName( url.path() ), &buff );
       QString text = ( S_ISDIR( buff.st_mode ) ? url.path() : url.directory() );
       KRun::shellQuote(text);
-      text = QString::fromLatin1("\001\013cd ") + text + '\n';
+      text = QString::fromLatin1("cd ") + text + '\n';
       te->emitText( text );
   }
 
@@ -498,6 +498,7 @@
     //KONSOLEDEBUG << "Setting up transparency" << endl;
     rootxpm->setFadeEffect(sch->tr_x(), QColor(sch->tr_r(), sch->tr_g(), sch->tr_b()));
     rootxpm->start();
+    rootxpm->repaint(true);
   }
   else {
     rootxpm->stop();
@@ -558,7 +559,7 @@
 
 void konsolePart::closeCurrentSession()
 {
-  se->closeSession();
+  sendSignal(SIGHUP);
 }
 
 void konsolePart::slotToggleFrame()
@@ -695,6 +696,7 @@
   if (s->useTransparency()) {
     rootxpm->setFadeEffect(s->tr_x(), QColor(s->tr_r(), s->tr_g(), s->tr_b()));
     rootxpm->start();
+    rootxpm->repaint(true);
   }
   else {
     rootxpm->stop();
Index: konsole/konsole/konsole_part.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/konsole_part.h,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/konsole_part.h	1 Oct 2002 02:36:59 -0000	1.1.1.4
+++ konsole/konsole/konsole_part.h	16 Oct 2002 21:58:59 -0000	1.2
@@ -77,7 +77,7 @@
     virtual void guiActivateEvent( KParts::GUIActivateEvent * event );
 
  protected slots:
-    void doneSession(TESession*);
+    void doneSession(TESession*,int);
     void sessionDestroyed();
     void configureRequest(TEWidget*,int,int x,int y);
     void updateTitle();
Index: konsole/konsole/main.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/main.cpp,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/konsole/main.cpp	1 Oct 2002 02:36:59 -0000	1.1.1.5
+++ konsole/konsole/main.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -42,7 +42,6 @@
    { "T <title>",       I18N_NOOP("Set the window title"), 0 },
    { "tn <terminal>",   I18N_NOOP("Specify terminal type as set in the TERM\nenvironment variable"), "xterm" },
    { "xwin",            I18N_NOOP("ignored"), 0 },
-   { "noclose",         I18N_NOOP("Do not close Konsole when command exits"), 0 },
    { "nohist",          I18N_NOOP("Do not save lines in history"), 0 },
    { "nomenubar",       I18N_NOOP("Do not display menubar"), 0 },
    { "notoolbar",       I18N_NOOP("Do not display toolbar"), 0 },
@@ -65,7 +64,6 @@
 static bool has_noxft = false;
 static bool login_shell = false;
 static bool full_script = false;
-static bool auto_close = true;
 
 const char *konsole_shell(QStrList &args)
 {
@@ -114,8 +112,6 @@
             restartCommand.append("--ls");
         if (full_script) 
             restartCommand.append("--script");
-        if (!auto_close) 
-            restartCommand.append("--noclose");
         sm.setRestartCommand(restartCommand);
         return true;
     }
@@ -206,8 +202,10 @@
   has_noxft = !args->isSet("xft");
   TEWidget::setAntialias( !has_noxft );
 
+
   KApplication a;
   KImageIO::registerFormats(); // add io for additional image formats
+  a.dcopClient()->setQtBridgeEnabled(false);
   //2.1 secs
 
   QString title;
@@ -252,10 +250,6 @@
   scrollbaron = args->isSet("scrollbar");
   wname = qtargs->getOption("name");
   full_script = args->isSet("script");
-  auto_close = args->isSet("close");
-
-  if (!full_script)
-	a.dcopClient()->setQtBridgeEnabled(false);
 
   QCString type = "";
 
@@ -385,25 +379,21 @@
           m->initMonitorSilence(sessionconfig->readBoolEntry(key,false));
           key = QString("MasterMode%1").arg(counter);
           m->initMasterMode(sessionconfig->readBoolEntry(key,false));
-                  counter++;
+          counter++;
         }
+        m->activateSession( sessionconfig->readNumEntry("ActiveSession",0)+1 );
         m->setDefaultSession( sessionconfig->readEntry("DefaultSession","shell.desktop") );
 
         ksm->konsole = m;
-        ksm->konsole->initFullScreen();
         if ( !profile.isEmpty() ) {
           ksm->konsole->setName( "konsole-mainwindow#1" );
           ksm->konsole->applyMainWindowSettings(sessionconfig);
           profile = "";
-          // Hack to work-around sessions initialized with minimum size
-          for (int i=1;i<=counter;i++)
-            m->activateSession( i );
         }
+	ksm->konsole->initFullScreen();
 	// works only for the first one, but there won't be more.
         n++;
-        m->activateSession( sessionconfig->readNumEntry("ActiveSession",0)+1 );
-        m->run();
-        m->setAutoClose(auto_close);
+	m->run();
     }
   }
   else
@@ -429,11 +419,10 @@
     m->show();
     m->run();
     m->showTipOnStart();
-    m->setAutoClose(auto_close);
   }
 
   int ret = a.exec();
-
+  
  //// Temporary code, waiting for Qt to do this properly
 
   // Delete all toplevel widgets that have WDestructiveClose
@@ -444,7 +433,7 @@
      ++it;
      if ( w->testWFlags( Qt::WDestructiveClose ) )
           delete w;
-  }
+  }  
 
-  return ret;
+  return ret;  
 }
Index: konsole/konsole/session.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/session.cpp,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/session.cpp	1 Oct 2002 02:36:59 -0000	1.1.1.4
+++ konsole/konsole/session.cpp	16 Oct 2002 21:58:59 -0000	1.2
@@ -1,8 +1,6 @@
 #include "session.h"
 #include <kdebug.h>
 #include <dcopclient.h>
-#include <kmessagebox.h>
-#include <klocale.h>
 
 #include <stdlib.h>
 #include <qfile.h>
@@ -23,17 +21,15 @@
     of the abilities of the framework - multible sessions.
 */
 
-TESession::TESession(TEWidget* _te, const QString &_pgm, const QStrList & _args, const QString &_term,const QString &_sessionId, const QString &_initial_cwd)
+TESession::TESession(TEWidget* _te, const QString &_pgm, QStrList & _args, const QString &_term,const QString &_sessionId, const QString &_initial_cwd)
    : DCOPObject( _sessionId.latin1() )
    , monitorActivity(false)
    , monitorSilence(false)
    , masterMode(false)
-   , autoClose(true)
    , schema_no(0)
    , font_no(3)
    , silence_seconds(10)
    , add_to_utmp(true)
-   , xon_xoff(false)
    , pgm(_pgm)
    , args(_args)
    , sessionId(_sessionId)
@@ -67,16 +63,8 @@
   monitorTimer = new QTimer(this);
   connect(monitorTimer, SIGNAL(timeout()), this, SLOT(monitorTimerDone()));
 
-  connect( sh,SIGNAL(done(int)), this,SLOT(done()) );
+  connect( sh,SIGNAL(done(int)), this,SLOT(done(int)) );
   //kdDebug(1211)<<"TESession ctor() done"<<endl;
-  if (!sh->error().isEmpty())
-     QTimer::singleShot(0, this, SLOT(ptyError()));
-}
-
-void TESession::ptyError()
-{
-  KMessageBox::error(te->topLevelWidget(), sh->error());
-  emit done(this);
 }
 
 void TESession::changeWidget(TEWidget* w)
@@ -94,7 +82,6 @@
   QString cwd_save = QDir::currentDirPath();
   if (!initial_cwd.isEmpty())
      QDir::setCurrent(initial_cwd);
-  sh->setXonXoff(xon_xoff);
   sh->run(QFile::encodeName(pgm),args,term.latin1(), add_to_utmp,
           ("DCOPRef("+appId+",konsole)").latin1(),
           ("DCOPRef("+appId+","+sessionId+")").latin1());
@@ -158,13 +145,7 @@
 
 bool TESession::closeSession()
 {
-  autoClose = true;
-  if (!sh->isRunning() || !sendSignal(SIGHUP))
-  {
-     // Forced close.
-     QTimer::singleShot(0, this, SLOT(done()));
-  }
-  return true;
+  return sendSignal(SIGHUP);
 }
 
 void TESession::feedSession(const QString &text)
@@ -192,8 +173,8 @@
 TESession::~TESession()
 {
  //kdDebug(1211) << "disconnnecting..." << endl;
-  QObject::disconnect( sh, SIGNAL( done(int) ),
-                       this, SLOT( done() ) );
+ QObject::disconnect( sh, SIGNAL( done( int ) ),
+		      this, SLOT( done( int ) ) );
   delete em;
   delete sh;
 }
@@ -209,15 +190,9 @@
   em->setListenToKeyPress(l);
 }
 
-void TESession::done()
+void TESession::done(int status)
 {
-  if (!autoClose)
-  {
-    userTitle = i18n("<Finished>");
-    emit updateTitle();
-    return;
-  }
-  emit done(this);
+  emit done(this,status);
 }
 
 void TESession::terminate()
@@ -392,11 +367,6 @@
   add_to_utmp = set;
 }
 
-void TESession::setXonXoff(bool set)
-{
-  xon_xoff = set;
-}
-
 bool TESession::processDynamic(const QCString &fun, const QByteArray &data, QCString& replyType, QByteArray &replyData)
 {
     if (fullScripting)
@@ -406,7 +376,7 @@
         QString arg0;
         QDataStream arg( data, IO_ReadOnly );
         arg >> arg0;
-        feedSession(arg0);
+        feedSession(arg0);         
         replyType = "void";
         return true;
       }
@@ -415,7 +385,7 @@
         QString arg0;
         QDataStream arg( data, IO_ReadOnly );
         arg >> arg0;
-        sendSession(arg0);
+        sendSession(arg0);         
         replyType = "void";
         return true;
       }
Index: konsole/konsole/session.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/session.h,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- konsole/konsole/session.h	1 Oct 2002 02:36:59 -0000	1.1.1.4
+++ konsole/konsole/session.h	16 Oct 2002 21:58:59 -0000	1.2
@@ -29,7 +29,7 @@
 public:
 
   TESession(TEWidget* w,
-            const QString &pgm, const QStrList & _args,
+            const QString &pgm, QStrList & _args,
 	    const QString &term, const QString &sessionId="session-1",
 	    const QString &initial_cwd = QString::null);
   void changeWidget(TEWidget* w);
@@ -73,12 +73,9 @@
   void setIconName(const QString& _iconName);
   void setIconText(const QString& _iconText);
   void setAddToUtmp(bool);
-  void setXonXoff(bool);
   bool testAndSetStateIconName (const QString& newname);
   bool sendSignal(int signal);
 
-  void setAutoClose(bool b) { autoClose = b; }
-
   // Additional functions for DCOP
   bool closeSession();
   void feedSession(const QString &text);
@@ -92,14 +89,13 @@
 public slots:
 
   void run();
-  void done();
+  void done(int status);
   void terminate();
   void setUserTitle( int, const QString &caption );
-  void ptyError();
 
 signals:
 
-  void done(TESession*);
+  void done(TESession*, int);
   void updateTitle();
   void notifySessionState(TESession* session, int state);
 
@@ -122,7 +118,6 @@
   bool           monitorActivity;
   bool           monitorSilence;
   bool           masterMode;
-  bool           autoClose;
   QTimer*        monitorTimer;
 
   //FIXME: using the indices here
@@ -137,7 +132,6 @@
   QString        iconName;
   QString        iconText; // as set by: echo -en '\033]1;IconText\007
   bool           add_to_utmp;
-  bool           xon_xoff;
   bool           fullScripting;
 
   QString	 stateIconName;
Index: konsole/konsole/x-konsole.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/konsole/x-konsole.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/konsole/x-konsole.desktop	1 Oct 2002 02:37:01 -0000	1.1.1.5
+++ konsole/konsole/x-konsole.desktop	16 Oct 2002 21:58:59 -0000	1.2
@@ -6,7 +6,7 @@
 Icon=konsole
 Patterns=*.shell;
 Comment=File to open a shell
-Comment[af]=lêer na open 'n tolk
+Comment[af]=lêer aan open 'n tolk
 Comment[ar]=ملف لفتح سطر الأوامر
 Comment[az]=Qabığı açacaq fayl
 Comment[bg]=Файл за shell
@@ -58,5 +58,5 @@
 Comment[xh]=Ifayile yokuvula iqokobhe
 Comment[xx]=xx
 Comment[zh_CN]=要打开 shell 的文件
-Comment[zh_TW]=要打開 shell 的檔案
+Comment[zh_TW]=要打開 shell 的文件
 Comment[zu]=Ifayile yokuvula igobolodo
Index: konsole/other/linux.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/linux.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/other/linux.desktop	1 Oct 2002 02:37:01 -0000	1.1.1.5
+++ konsole/other/linux.desktop	16 Oct 2002 21:59:00 -0000	1.2
@@ -16,7 +16,6 @@
 Name[es]=Consola de Linux
 Name[et]=Linuxi konsool
 Name[eu]=Linux Konsola
-Name[fa]=کنسول لینوکس
 Name[fi]=Linux-konsoli
 Name[fr]=Console Linux
 Name[he]=מסוף לינוקס
@@ -27,7 +26,6 @@
 Name[lt]=Linux konsolė
 Name[lv]=Linux Konsole
 Name[mt]=Konsol tal-Linux
-Name[nb]=Linux-konsoll
 Name[nn]=Linux-konsoll
 Name[pl]=Konsola linuksowa
 Name[pt]=Consola do Linux
@@ -59,7 +57,6 @@
 Comment[es]=Nueva consola de Linux
 Comment[et]=Uus Linuxi konsool
 Comment[eu]=Linux Konsola Berria
-Comment[fa]=کنسول لینوکس جدید
 Comment[fi]=Uusi Linux-konsoli
 Comment[fr]=Nouvelle console Linux
 Comment[he]=מסוף לינוקס חדש
@@ -70,7 +67,6 @@
 Comment[lt]=Nauja Linux konsolė
 Comment[lv]=Jauna Linux Konsole
 Comment[mt]=Konsol ġdid tal-Linux
-Comment[nb]=Ny Linux-konsoll
 Comment[nl]=Nieuwe linuxconsole
 Comment[nn]=Ny Linux-konsoll
 Comment[pl]=Konsola linuksowa (nowa)
Index: konsole/other/mc.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/mc.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/other/mc.desktop	1 Oct 2002 02:37:01 -0000	1.1.1.5
+++ konsole/other/mc.desktop	16 Oct 2002 21:59:00 -0000	1.2
@@ -35,7 +35,6 @@
 Comment[lt]=Naujas Midnight Commander
 Comment[lv]=Jauns Pusnakts Komandieris
 Comment[mt]=Midnight Commander ġdid
-Comment[nb]=Ny Midnight Commander
 Comment[nl]=nieuwe Midnight Commander
 Comment[nn]=Ny Midnight Commander
 Comment[pl]=Midnight Commander
Index: konsole/other/screen.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/screen.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/other/screen.desktop	1 Oct 2002 02:37:01 -0000	1.1.1.5
+++ konsole/other/screen.desktop	16 Oct 2002 21:59:00 -0000	1.2
@@ -10,7 +10,7 @@
 Name[cs]=Sezení
 Name[da]=Skærmsession
 Name[de]=Screen-Sitzung
-Name[el]=Σύνοδος screen
+Name[el]=Σύνοδος Οθόνης
 Name[eo]=Seanco de komandinterpretilo "Screen"
 Name[et]=Screen'i seanss
 Name[eu]=Pantaila Sesioa
@@ -24,7 +24,6 @@
 Name[lt]=Screen sesija
 Name[lv]=Ekrāna Sesija
 Name[mt]=Sessjoni ta' skrin
-Name[nb]=Skjermsesjon
 Name[nl]=Screen sessie
 Name[nn]=Skjermøkt
 Name[pl]=Sesja screena
@@ -52,7 +51,7 @@
 Comment[cs]=Nové sezení
 Comment[da]=Ny skærmsession
 Comment[de]=Neue Sitzung des Terminal-Programms Screen
-Comment[el]=Νέα σύνοδος screen
+Comment[el]=Νέα Σύνοδος Οθόνης
 Comment[eo]=Nova seanco de programo "Screen"
 Comment[es]=Nueva sesión de pantalla
 Comment[et]=Uus screen'i seanss
@@ -67,7 +66,6 @@
 Comment[lt]=Nauja Screen sesija
 Comment[lv]=Jauna Ekrāna Sesija
 Comment[mt]=Sessjoni ġdida ta' skrin
-Comment[nb]=Ny skjermsesjon
 Comment[nl]=nieuwe screen sessie
 Comment[nn]=Ny skjermøkt
 Comment[pl]=Nowa sesja programu "screen"
Index: konsole/other/shell.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/shell.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/other/shell.desktop	1 Oct 2002 02:37:01 -0000	1.1.1.5
+++ konsole/other/shell.desktop	16 Oct 2002 21:59:00 -0000	1.2
@@ -9,8 +9,7 @@
 Name[da]=Skal
 Name[de]=Befehlsfenster
 Name[el]=Κέλυφος
-Name[es]=Terminal
-Name[fa]=پوسته
+Name[es]=Intérprete de comandos
 Name[fi]=Komentotulkki
 Name[fr]=Terminal
 Name[he]=מעטפת
@@ -50,7 +49,6 @@
 Comment[es]=Nuevo intérprete
 Comment[et]=Uus shell
 Comment[eu]=Shell Berria
-Comment[fa]=پوسته‌ی جدید
 Comment[fi]=Uusi komentotulkki
 Comment[fr]=Nouveau shell
 Comment[he]=מעטפת חדשה
@@ -61,7 +59,6 @@
 Comment[lt]=Naujas apvalkalas
 Comment[lv]=Jauna Čaula
 Comment[mt]=Shell ġdid
-Comment[nb]=Nytt skall
 Comment[nl]=Nieuwe shell
 Comment[nn]=Nytt skal
 Comment[pl]=Powłoka
Index: konsole/other/su.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/su.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/other/su.desktop	1 Oct 2002 02:37:01 -0000	1.1.1.5
+++ konsole/other/su.desktop	16 Oct 2002 21:59:00 -0000	1.2
@@ -14,7 +14,6 @@
 Name[es]=Consola de root
 Name[et]=Administraatori konsool
 Name[eu]=Root Konsola
-Name[fa]=کنسول ریشه
 Name[fi]=Pääkäyttäjän konsoli
 Name[fr]=Console superutilisateur
 Name[he]=מסוף Root
@@ -25,11 +24,10 @@
 Name[lt]=Root konsolė
 Name[lv]=Root Konsole
 Name[mt]=Konsol tar-root
-Name[nb]=Root-konsoll
 Name[nn]=Rotkonsoll
 Name[pl]=Konsola administratora
 Name[pt]=Consola como Root
-Name[pt_BR]=Console - Root
+Name[pt_BR]=Console raiz
 Name[ro]=Consolă "root"
 Name[ru]=Root-консоль
 Name[sk]=Root konzola
@@ -52,12 +50,11 @@
 Comment[cs]=Nová konzole superuživatele
 Comment[da]=Ny root-konsol
 Comment[de]=Neue Konsole für Benutzer root
-Comment[el]=Νέα κονσόλα Root
+Comment[el]=Νέα Κονσόλα Root
 Comment[eo]=Nova sistemestro-konzolo
 Comment[es]=Nueva consola de root
 Comment[et]=Uus administraatori konsool
 Comment[eu]=Root Konsola Berria
-Comment[fa]=کنسول ریشه‌ی جدید
 Comment[fi]=Uusi pääkäyttäjän konsoli
 Comment[fr]=Nouvelle console superutilisateur
 Comment[he]=מסוף Root חדש
@@ -68,12 +65,11 @@
 Comment[lt]=Nauja Root konsolė
 Comment[lv]=Jauna Superlietotāja Konsole
 Comment[mt]=Konsol ġdid root
-Comment[nb]=Ny Root-konsoll
 Comment[nl]=Nieuwe rootconsole
 Comment[nn]=Ny rotkonsoll
 Comment[pl]=Nowa konsola administratora
 Comment[pt]=Nova Consola como Root
-Comment[pt_BR]=Novo Console - Root
+Comment[pt_BR]=Novo Console Raiz
 Comment[ro]=Consolă "root" nouă
 Comment[ru]=Новая root-консоль
 Comment[sk]=Nová rootovská konzola
Index: konsole/other/su.kdelnk
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/su.kdelnk,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/other/su.kdelnk	1 Oct 2002 02:37:01 -0000	1.1.1.5
+++ konsole/other/su.kdelnk	16 Oct 2002 21:59:00 -0000	1.2
@@ -16,7 +16,6 @@
 Name[es]=Administrador
 Name[et]=Administraator
 Name[eu]=Arduraduna
-Name[fa]=گرداننده
 Name[fi]=Pääkäyttäjä
 Name[fr]=Super-utilisateur
 Name[gl]=Administrador
@@ -64,7 +63,6 @@
 Comment[es]=Consola del superusuario
 Comment[et]=Administraatori konsool
 Comment[eu]=Root Konsola
-Comment[fa]=کنسول ریشه
 Comment[fi]=Pääkäyttäjän konsoli
 Comment[fr]=Console superutilisateur
 Comment[gl]=Consola de Root
@@ -86,7 +84,7 @@
 Comment[oc]=Consola arrel
 Comment[pl]=Konsola administratora
 Comment[pt]=Consola como root
-Comment[pt_BR]=Console - Root
+Comment[pt_BR]=Console Raiz
 Comment[ro]=Consolă "root"
 Comment[ru]=Root-консоль
 Comment[sk]=Rootovská konzola
Index: konsole/other/sumc.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/konsole/other/sumc.desktop,v
retrieving revision 1.1.1.5
retrieving revision 1.2
diff -u -u -r1.1.1.5 -r1.2
--- konsole/other/sumc.desktop	1 Oct 2002 02:37:01 -0000	1.1.1.5
+++ konsole/other/sumc.desktop	16 Oct 2002 21:59:00 -0000	1.2
@@ -21,7 +21,7 @@
 Name[nn]=Midnight Commander for root
 Name[pl]=Midnight Commander  - tryb administratora
 Name[pt]=Midnight Commander como Root
-Name[pt_BR]=Midnight Commander - Root
+Name[pt_BR]=Midnight Commander - raiz
 Name[ro]=Midnight Commander "root"
 Name[ru]=Root MC
 Name[sl]=Midnight Commander za root
@@ -56,12 +56,11 @@
 Comment[lt]=Naujas Root Midnight Commander
 Comment[lv]=Jauns Root Pusnakts Komandieris
 Comment[mt]=Midnight Commander ġdid bħala root
-Comment[nb]=Ny Root Midnight Commander
 Comment[nl]=Nieuwe root Midnight Commander
 Comment[nn]=Ny Midnight Commander for root
 Comment[pl]=Midnight Commander - tryb administratora
 Comment[pt]=Novo Midnight Commander como Root
-Comment[pt_BR]=Nova Janela do Midnight Commander- Root
+Comment[pt_BR]=Nova Janela Raiz para o Midnight Commander
 Comment[ro]=Midnight Commander "root" nouă
 Comment[ru]=Новое окно root MC
 Comment[sk]=Nový root Midnight Commander
Index: kscreensaver/configure.in.in
===================================================================
RCS file: kscreensaver/configure.in.in
diff -N kscreensaver/configure.in.in
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ kscreensaver/configure.in.in	7 Oct 2002 02:30:18 -0000	1.1
@@ -0,0 +1 @@
+DO_NOT_COMPILE="$DO_NOT_COMPILE kscreensaver"
Index: ksmserver/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksmserver/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- ksmserver/Makefile.am	10 Jul 2002 03:24:29 -0000	1.1.1.2
+++ ksmserver/Makefile.am	10 Jul 2002 03:42:59 -0000	1.3
@@ -28,9 +28,9 @@
 ksmserver_la_SOURCES = main.cpp server.cpp shutdown.cpp KSMServerInterface.skel
 ksmserver_SOURCES = dummy.cpp
 
-ksmserver_la_LDFLAGS = $(all_libraries) -avoid-version -module
+ksmserver_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -avoid-version -module
 ksmserver_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-ksmserver_la_LIBADD = $(LIB_KDEUI)
+ksmserver_la_LIBADD = $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP) $(LIBSM)
 ksmserver_LDADD = ksmserver.la
 
 picsdir = $(kde_datadir)/ksmserver/pics
Index: ksysguard/CContLib/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksysguard/CContLib/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -u -r1.1.1.2 -r1.2
--- ksysguard/CContLib/Makefile.am	10 Jul 2002 03:24:36 -0000	1.1.1.2
+++ ksysguard/CContLib/Makefile.am	16 Sep 2002 14:31:34 -0000	1.2
@@ -4,5 +4,3 @@
 include_HEADERS = ccont.h
 
 libccont_a_SOURCES = ccont.c
-
-AM_CFLAGS = -ggdb
Index: ksysguard/gui/SensorDisplayLib/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksysguard/gui/SensorDisplayLib/Makefile.am,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -u -r1.1.1.3 -r1.2
--- ksysguard/gui/SensorDisplayLib/Makefile.am	14 Aug 2002 14:27:16 -0000	1.1.1.3
+++ ksysguard/gui/SensorDisplayLib/Makefile.am	16 Sep 2002 14:31:34 -0000	1.2
@@ -4,8 +4,9 @@
  
 lib_LTLIBRARIES = libsensordisplays.la
 
-libsensordisplays_la_LDFLAGS = $(all_libraries)
-libsensordisplays_la_LIBADD = $(LIB_KDEUI)
+libsensordisplays_la_LDFLAGS = $(all_libraries) -fno-common
+libsensordisplays_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) \
+	$(top_builddir)/ksysguard/gui/ksgrd/libksgrd.la
 
 # Which sources should be compiled for the sensor display lib.
 libsensordisplays_la_SOURCES = \
Index: ksysguard/gui/SensorDisplayLib/SensorDisplay.cc
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksysguard/gui/SensorDisplayLib/SensorDisplay.cc,v
retrieving revision 1.1.1.4
retrieving revision 1.3
diff -u -u -r1.1.1.4 -r1.3
--- ksysguard/gui/SensorDisplayLib/SensorDisplay.cc	1 Oct 2002 02:37:23 -0000	1.1.1.4
+++ ksysguard/gui/SensorDisplayLib/SensorDisplay.cc	1 Oct 2002 03:01:48 -0000	1.3
@@ -62,7 +62,6 @@
 	pausedWhileHidden = false;
 
 	timerOn();
-	QWhatsThis::add(this, "dummy");
 
 	frame = new QGroupBox(2, Qt::Vertical, "", this, "displayFrame"); 
 	Q_CHECK_PTR(frame);
Index: ksysguard/gui/ksgrd/StyleEngine.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/ksysguard/gui/ksgrd/StyleEngine.h,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- ksysguard/gui/ksgrd/StyleEngine.h	25 Jun 2002 02:03:54 -0000	1.1.1.1
+++ ksysguard/gui/ksgrd/StyleEngine.h	16 Sep 2002 14:31:34 -0000	1.2
@@ -68,11 +68,12 @@
 	}
 	const QColor& getSensorColor(uint i)
 	{
-		static QColor dummy;
-		if (i < sensorColors.count())
+		if (i < sensorColors.count()) {
 			return *(sensorColors.at(i));
-		else
+		} else {
+			QColor dummy;
 			return dummy;
+		}
 	}
 	uint getSensorColorCount() const
 	{
Index: kwin/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kwin/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- kwin/Makefile.am	10 Jul 2002 03:24:51 -0000	1.1.1.2
+++ kwin/Makefile.am	10 Jul 2002 03:42:59 -0000	1.3
@@ -9,7 +9,7 @@
 kwin_la_SOURCES = workspace.cpp placement.cpp atoms.cpp  client.cpp main.cpp \
 	popupinfo.cpp tabbox.cpp options.cpp plugins.cpp events.cpp KWinInterface.skel \
 	killwindow.cpp kwinbutton.cpp
-kwin_la_LIBADD = $(LIB_KDEUI) $(LIBXINERAMA)
+kwin_la_LIBADD = $(LIB_KDEUI) $(LIBXINERAMA) $(LIB_KDECORE) $(LIB_X11) $(LIB_XEXT) $(LIB_DCOP) $(LIB_QT)
 kwin_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 include_HEADERS = KWinInterface.h
Index: kwin/kcmkwin/kwinoptions/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kwin/kcmkwin/kwinoptions/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -u -r1.1.1.4 -r1.2
--- kwin/kcmkwin/kwinoptions/Makefile.am	1 Oct 2002 02:37:36 -0000	1.1.1.4
+++ kwin/kcmkwin/kwinoptions/Makefile.am	1 Oct 2002 12:06:42 -0000	1.2
@@ -10,7 +10,7 @@
 kcm_kwinoptions_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
 kcm_kwinoptions_la_LIBADD = $(LIB_KDEUI)
 
-noinst_HEADERS = windows.h mouse.h 
+noinst_HEADERS = windows.h mouse.h main.h
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/kcmkwm.pot
Index: kwin/kcmkwin/kwinoptions/kwinoptions.desktop
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kwin/kcmkwin/kwinoptions/kwinoptions.desktop,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -u -r1.1.1.3 -r1.3
Index: kwin/kcmkwin/kwinoptions/main.h
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kwin/kcmkwin/kwinoptions/main.h,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
Index: kxkb/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/kxkb/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.6
diff -u -u -r1.1.1.4 -r1.6
--- kxkb/Makefile.am	1 Oct 2002 02:37:38 -0000	1.1.1.4
+++ kxkb/Makefile.am	1 Oct 2002 03:01:48 -0000	1.6
@@ -19,8 +19,8 @@
 kcm_keyboard_la_LIBADD = $(XTESTLIB) $(LIB_KIO) -lxkbfile
 
 kxkb_la_SOURCES = kxkb.cpp rules.cpp extension.cpp pixmap.cpp
-kxkb_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kxkb_la_LIBADD = -lX11 -lXext $(LIB_KDEUI) -lxkbfile
+kxkb_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
+kxkb_la_LIBADD = -lX11 -lXext -lxkbfile $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) $(LIB_DCOP)
 
 data_DATA = keyboard.desktop
 datadir = $(kde_appsdir)/Settings/Peripherals
Index: legacyimport/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/legacyimport/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- legacyimport/Makefile.am	14 Aug 2002 14:27:42 -0000	1.1.1.2
+++ legacyimport/Makefile.am	14 Aug 2002 15:35:44 -0000	1.3
@@ -4,8 +4,8 @@
 lib_LTLIBRARIES = klegacyimport.la
 
 klegacyimport_la_SOURCES = legacyimport.cpp
-klegacyimport_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
-klegacyimport_la_LDFLAGS = $(all_libraries) -module -avoid-version
+klegacyimport_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KFILE) $(LIB_KDECORE) $(LIB_QT)
+klegacyimport_la_LDFLAGS = $(all_libraries) $(QT_LDFLAGS) -module -avoid-version
 
 klegacyimport_SOURCES = dummy.cpp
 klegacyimport_LDADD   = klegacyimport.la
Index: libkonq/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/libkonq/Makefile.am,v
retrieving revision 1.1.1.4
retrieving revision 1.5
diff -u -u -r1.1.1.4 -r1.5
--- libkonq/Makefile.am	1 Oct 2002 02:37:43 -0000	1.1.1.4
+++ libkonq/Makefile.am	1 Oct 2002 03:01:48 -0000	1.5
@@ -20,8 +20,8 @@
 SUBDIRS = pics favicons
 
 lib_LTLIBRARIES = libkonq.la
-libkonq_la_LDFLAGS = $(all_libraries) -version-info 5:0:1 -no-undefined
-libkonq_la_LIBADD = $(LIB_KPARTS)
+libkonq_la_LDFLAGS = $(all_libraries) -version-info 5:0:1 -no-undefined $(QT_LDFLAGS)
+libkonq_la_LIBADD = $(LIB_KPARTS) $(LIB_KDECORE) $(LIB_QT) $(LIB_MCOP) $(LIB_KDEUI) $(LIB_KIO) $(LIB_DCOP) $(LIB_KDEFX)
 
 libkonq_la_SOURCES = konq_popupmenu.cc knewmenu.cc \
    konq_xmlguiclient.cc\
@@ -59,7 +59,7 @@
 kde_module_LTLIBRARIES = konq_sound.la
 konq_sound_la_SOURCES = konq_sound.cc
 konq_sound_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-konq_sound_la_LIBADD = -lsoundserver_idl -lartskde
+konq_sound_la_LIBADD = -lsoundserver_idl -lartskde $(LIB_KDECORE) $(LIB_QT) $(LIB_MCOP)
 
 noinst_HEADERS = konq_sound.h
 
Index: libkonq/favicons/Makefile.am
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/libkonq/favicons/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -u -r1.1.1.1 -r1.2
--- libkonq/favicons/Makefile.am	25 Jun 2002 02:03:55 -0000	1.1.1.1
+++ libkonq/favicons/Makefile.am	25 Jun 2002 02:06:14 -0000	1.2
@@ -2,8 +2,8 @@
 
 INCLUDES = $(all_includes)
 kded_favicons_la_SOURCES = favicons.cpp favicons.skel
-kded_favicons_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kded_favicons_la_LIBADD = $(LIB_KSYCOCA)
+kded_favicons_la_LDFLAGS = $(all_libraries) -module -avoid-version $(QT_LDFLAGS)
+kded_favicons_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE) $(LIB_DCOP) $(LIB_KDED)
 
 METASOURCES = AUTO
 
Index: nsplugins/pluginscan.cpp
===================================================================
RCS file: /Volumes/src/cvs/od/proj/KDE-Darwin/kdebase/nsplugins/pluginscan.cpp,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -u -r1.1.1.2 -r1.3
--- nsplugins/pluginscan.cpp	14 Aug 2002 14:27:53 -0000	1.1.1.2
+++ nsplugins/pluginscan.cpp	14 Aug 2002 15:35:44 -0000	1.3
@@ -442,6 +442,7 @@
         paths.append("/usr/lib/netscape/plugins");
         paths.append("/usr/lib/netscape/plugins-libc5");
         paths.append("/usr/lib/netscape/plugins-libc6");
+        paths.append("@PREFIX@/lib/mozilla/plugins");
         paths.append("/usr/lib/mozilla/plugins");
         paths.append("$MOZILLA_HOME/plugins");
         config->writeEntry( "scanPaths", paths );
