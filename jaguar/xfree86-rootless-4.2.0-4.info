Package: xfree86-rootless
Version: 4.2.0
Revision: 4
Depends: xfree86-base (>= 4.2.0-4)
Pre-Depends: xfree86-base (>= 4.2.0-4)
Provides: libgl
Conflicts: xfree86-server, xfree86, libgl
Source: mirror:sourceforge:fink/X420src-1.tgz
SourceDirectory: xc
Patch: %f.patch
PatchScript: <<
 echo '#define BuildServersOnly YES' >config/cf/host.def
 echo '#define BuildGLXLibrary YES' >>config/cf/host.def
 echo '#define BuildGLULibrary YES' >>config/cf/host.def
 echo '#define EtcX11Directory ProjectRoot/etc' >>config/cf/host.def
 echo '#define HasPosixThreads       YES' >>config/cf/host.def
 echo '#define ThreadedX             YES' >>config/cf/host.def
 echo '#define HasThreadSafeAPI      YES' >>config/cf/host.def
 echo '#define SystemMTDefines	-D_REENTRANT' >>config/cf/host.def
 echo '#define MTSafeAPIDefines	-DXUSE_MTSAFE_API -DXNO_MTSAFE_PWDAPI' >>config/cf/host.def
 sed -e 's;@prefix@;%p;g' -e 's;-fno-common;-fno-common -mno-dynamic-no-pic;g' < config/cf/darwin.cf > config/cf/darwin-tmp
 mv config/cf/darwin-tmp config/cf/darwin.cf
<<
CompileScript: <<
 make MAKE=/usr/bin/gnumake World WORLDOPTS=-S
<<
InstallScript: <<
 make MAKE=/usr/bin/gnumake install WORLDOPTS=-S DESTDIR=%d
 rm -rf %d/etc %d/usr/X11R6/etc
 rm -rf %d/usr/X11R6/include/X11
 (cd %d/usr/X11R6/lib/; rm -rf X11; rm -f lib[A-FH-Za-fh-z]*)
 (cd %d/usr/X11R6/bin/; rm -f [abce-wyz]* xmkmf Xnest Xprt Xvfb)
 cd programs/Xserver/hw/darwin && make MAKE=/usr/bin/gnumake install.man DESTDIR=%d
<<
#
PreInstScript: <<
case "$1" in
  install)
    if [ -e /Applications/XDarwin.app -o -e /usr/X11R6/bin/XDarwin -o \
	 -e /usr/X11R6/bin/X -o -L /usr/X11R6/bin/X -o \
	 -e /usr/X11R6/lib/libGL.dylib ]; then
      echo
      echo "You have an existing X server installation in /usr/X11R6 and /Applications."
      echo "This package refuses to overwrite these. Remove them, then tell Fink to"
      echo "install xfree86-rootless again."
      echo
      echo "Press Return to continue."
      read
      exit 1
    fi
    ;;
esac
<<
#
Description: MacOS X/Darwin XFree86 display server.
DescDetail: <<
XFree86 is a free X11 distribution that supports Darwin and Mac OS
X. This will let you run X11 applications and desktop environments.

This is the server from the standard, stable XFree86 4.2.0 release. It
supports both full-screen and rootless operation, and has OpenGL support.
<<
DescPackaging: <<
This package contains the XDarwin and XDarwin.app servers. The
libraries, headers and general infrastructure (except openGL stuff)
are provided by the xfree86-base package.
(Note: Actually the X11 build system still
builds various binaries and libraries. This can't be easily
avoided. All files but the servers, openGL stuff, and dumpkeymap utils are
deleted after the make install.)

WARNING: This package will not honor the prefix you installed Fink
in. It will always install into /usr/X11R6 and /Applications. This is
by design. The preinst script checks to make sure it doesn't
overwrite existing files.

Previous versions by Christoph Pfisterer.
<<
DescPort: <<
Natively supports Darwin and Mac OS X. This package will only build on
Mac OS X because it uses Quartz and Cocoa.

MIT-SHM support is disabled in the server since it is crippled by a
kernel bug.

Patched to use pthreads.
<<
License: BSD
Homepage: http://www.xfree86.org/
Maintainer: Jeffrey Whitaker <jsw@cdc.noaa.gov>
