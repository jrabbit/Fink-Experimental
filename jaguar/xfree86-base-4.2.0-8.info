Package: xfree86-base
Version: 4.2.0
Revision: 8
BuildDepends: gdbm
Depends: gdbm-shlibs, dlcompat
Provides: x11, rman
Conflicts: x11
Replaces: x11
Suggests: xfree86-rootless (>=4.2.0-3)
Source: mirror:sourceforge:fink/X420src-1.tgz
Source2: mirror:sourceforge:fink/X420src-2.tgz
Source3: mirror:sourceforge:fink/X420src-3.tgz
SourceDirectory: xc
Patch: %f.patch
PatchScript: <<
 echo '#define EtcX11Directory ProjectRoot/etc' >config/cf/host.def
 echo '#define BuildGLXLibrary YES' >>config/cf/host.def
 echo '#define BuildGLULibrary YES' >>config/cf/host.def
 echo '#define HasPosixThreads       YES' >>config/cf/host.def
 echo '#define ThreadedX             YES' >>config/cf/host.def
 echo '#define HasThreadSafeAPI      YES' >>config/cf/host.def
 echo '#define SystemMTDefines	-D_REENTRANT -D_PTHREADS' >>config/cf/host.def
 echo '#define MTSafeAPIDefines	-DXUSE_MTSAFE_API -DXNO_MTSAFE_PWDAPI' >>config/cf/host.def
 echo '#define TclLibDir              /usr/lib' >> config/cf/host.def
 echo '#define TclIncDir              /usr/include' >>config/cf/host.def
 echo '#define TclLibName             tcl8.3' >>config/cf/host.def
 echo '#define HasDlopen		YES' >>config/cf/host.def
 echo '#define DlLibrary		-L%p/lib -ldl' >>config/cf/host.def
 echo '#define HasNCurses		YES' >>config/cf/host.def
 echo '#define PositionIndependentCFlags -dynamic -fno-common -fPIC -mno-dynamic-no-pic' >>config/cf/host.def
 sed -e 's;@prefix@;%p;g' < config/cf/darwin.cf > config/cf/darwin-tmp
 mv config/cf/darwin-tmp config/cf/darwin.cf
<<
CompileScript: <<
 make MAKE=/usr/bin/gnumake World WORLDOPTS=-S
<<
SplitOff: <<
 Package: xfree86-rootless
 Depends: xfree86-base  (= 4.2.0-8)
 Provides: libgl
 Files: <<
 ../Applications/XDarwin.app 
 ../usr/X11R6/include/GL
 ../usr/X11R6/lib/libGL.1.2.dylib
 ../usr/X11R6/lib/libGL.1.dylib
 ../usr/X11R6/lib/libGL.a
 ../usr/X11R6/lib/libGL.dylib
 ../usr/X11R6/lib/libGLU.1.3.dylib
 ../usr/X11R6/lib/libGLU.1.dylib
 ../usr/X11R6/lib/libGLU.a
 ../usr/X11R6/lib/libGLU.dylib
 ../usr/X11R6/lib/libGLw.a 
 ../usr/X11R6/man/man1/XDarwin.1
 ../usr/X11R6/man/man1/XFree86.1
 ../usr/X11R6/man/man1/dumpkeymap.1
 ../usr/X11R6/lib/X11/doc/html/XDarwin.1.html
 ../usr/X11R6/lib/X11/doc/html/XFree86.1.html
 ../usr/X11R6/lib/X11/doc/html/dumpkeymap.1.html
 ../usr/X11R6/bin/X
 ../usr/X11R6/bin/XDarwin
 ../usr/X11R6/bin/XDarwinQuartz
 ../usr/X11R6/bin/XDarwinStartup
 ../usr/X11R6/bin/dumpkeymap
 <<
<<
InstallScript: <<
 make MAKE=/usr/bin/gnumake install install.man WORLDOPTS=-S DESTDIR=%d
<<
#
PreInstScript: <<
case "$1" in
  install)
    if [ -e /usr/X11R6/bin/xterm -o -e /usr/X11R6/bin/xrdb -o \
	 -e /etc/X11 -o -L /etc/X11 ]; then
      echo
      echo "You have an existing X11 installation in /usr/X11R6 and /etc/X11."
      echo "This package refuses to overwrite these. Remove them, then tell Fink to"
      echo "install xfree86-base again. (The package won't be recompiled.) If you want"
      echo "to keep your X11 installation, install system-xfree86 resp. system-xtools"
      echo "instead to make this known to Fink's package system."
      echo
      echo "Press Return to continue."
      read
      exit 1
    fi
    ;;
  upgrade)
    # deal with a file that changed in case only
    rm -f /usr/X11R6/man/man3/XtAddTime?ut.3
    rm -f /usr/X11R6/lib/X11/doc/html/XtAddTime?ut.3.html

    # deal with font listings (we no longer use xfont-base, font
    #  packages install their fonts in the Fink directories)
    for dir in 100dpi 75dpi CID cyrillic local misc Speedo Type1 ; do
      rm -f /usr/X11R6/lib/X11/fonts/$dir/fonts.dir /usr/X11R6/lib/X11/fonts/$dir/fonts.scale /usr/X11R6/lib/X11/fonts/$dir/fonts.scale.bak
    done
    ;;
esac
<<
PostInstScript: <<
if [ -L /etc/X11 ]; then
  rm -f /etc/X11
else
  if [ -e /etc/X11 ]; then
    echo "ERROR: /etc/X11 exists, but is not a symlink to /usr/X11R6/etc."
    exit 1
  fi
fi
ln -s /usr/X11R6/etc /etc/X11
<<
PreRmScript: <<
case "$1" in
  remove|purge)
    if [ -L /etc/X11 ]; then
      rm -f /etc/X11
    fi
    ;;
esac
<<
#
Description: XFree86 libraries, utilities, clients and data.
DescDetail: <<
XFree86 is a free X11 implementation that supports Darwin and Mac OS X.
This will let you run X11 applications and desktop environments.
<<
DescPackaging: <<
This package builds the libraries, common clients (e.g. xterm), fonts
and other data, but not the X server. The server is in a separate
package (xfree86-rootless). You can install a server manually if you prefer.

WARNING: This package will not honor the prefix you installed Fink
in. It will always install into /usr/X11R6. This is by design. The
preinst script checks to make sure it doesn't overwrite existing
files.

Previous versions by Christoph Pfisterer.
<<
DescPort: <<
OpenGL stuff is disabled. "libgl" is provided by the xfree86-rootless package
in order to preserve an upgrade path from the xfree86 v4.1 packages.

Patched to use pthreads.
<<
License: BSD
Homepage: http://www.xfree86.org/
Maintainer: Jeffrey Whitaker <jsw@cdc.noaa.gov>
