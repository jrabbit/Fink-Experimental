Info2: <<
Package: ptex%type_pkg[-nox]-base
Type: -nox (boolean)
Version: 3.1.10
Revision: 1003test1
GCC: 4.0
Description: ASCII publishing TeX
BuildDepends: <<
 libkpathsea4 (>= 3.5.7-0), t1lib5-nox, libpng3 (>= 1:1.2.8-1), libwww, libncurses5 (>= 5.4-20041023-1006), fink (>= 0.24.12),
 libjpeg, libiconv-dev,
 lzma, freetype219 (>= 2.2.1-4),
 ptexenc (>= 0.999-0),
 (%type_raw[-nox] = .)  t1lib5-x11, 
 (%type_raw[-nox] = .)  gd2 (>= 2.0.35-2), 
 (%type_raw[-nox] = .) fontconfig2-dev,
 (%type_raw[-nox] = .) x11, 
 (%type_raw[-nox] = .) xmkmf (>= 1.0.2-3),
 (%type_raw[-nox] = .) openmotif3
<<
Source: mirror:ctan:systems/texlive/Source/texlive-20080816-source.tar.lzma
Source-MD5: 554287c3e458da776edd684506048d45
Source2: http://tutimura.ath.cx/~nob/tex/ptexlive/ptexlive-20080715.tar.gz
Source2-MD5: d834b89d20604b1072325ccef2f8b227
Tar2FilesRename: ptexlive-20080715:ptexlive
# Taken from ftp://ring.riken.jp/pub/text/TeX/ptex-win32/utils/, vers. 20090509
Source3: http://fink.sodan.ecc.u-tokyo.ac.jp/pkgdists/dvipsk-5.97-p1.7b-tl.tar.gz
Source3-MD5: 72359ed39d3854489db9413b1b34c8ef
NoSourceDirectory: true
PatchFile: ptex-base.patch
PatchFile-MD5: 68d959707f453fadbfdf97e636e59dee
PatchScript: <<
 lzma -dc texlive-20080816-source.tar.lzma | tar xf -
 mv       texlive-20080816-source                texlive

 tar zcf ptexlive/archive/dvipsk-5.97-p1.7b-tl.tar.gz \
  README-tl.txt dvipsk-5.97-p1.7b-tl.diff *.jpatch 

 ####################   Let's apply ptexlive patches   ####################

 # avoid patch conflicts
 gzcat     ptexlive/archive/xdvik-20080715-texlive2007.diff.gz  | \
  sed -n  -e '1,5706p'    \
          -e '7213,7241p' \
          -e '7792,8149p' \
          -e '8209,8244p' \
          -e '8559,$p'    > xdvik-20080715-texlive2007.diff.sed
 perl -pi -e "s/^ (echo \$ac_n)/\n \1/"                             \
                            xdvik-20080715-texlive2007.diff.sed
 perl -pi -e "s/(Ryumin-Light\t\t)ipam.ttf/\1HiraMinPro-W3.otf/"    \
                            xdvik-20080715-texlive2007.diff.sed
 perl -pi -e "s/(GothicBBB-Medium\t)ipag.ttf/\1HiraKakuPro-W3.otf/" \
                            xdvik-20080715-texlive2007.diff.sed
 sed      -e "s/ac_include/kpse_include/"              \
          -e "s/or --disable-magick //"                \
          -e "s/,9 \+6242,361/,6 \+6242,358/"          \
          -e "s/AC_DEFINE(A4))/[AC_DEFINE([A4], 1)])/" \
          -e "s/magick,/[magick],/"                    \
                          < xdvik-20080715-texlive2007.diff.sed | \
  gzip   > ptexlive/archive/xdvik-20090509-texlive2008.diff.gz

 sed -e '1,16d' < ptexlive/archive/omegaware-texlive2007.patch \
                > ptexlive/archive/omegaware-texlive2008.patch

 sed -i.bak -e 's|\(root_check\)|#\1|'                                \
            -e "/freetype-2.3.5/d"                                    \
            -e "/xdvik-22.84.14/d"                                    \
            -e "/makej.patch/d"                                       \
            -e "/dvipdfm.patch/d"                                     \
            -e 's|tetex/epstopdf|texlive/linked_scripts/epstopdf.pl|' \
            -e "/nostop.patch/d"                                      \
            -e 's|texmf.in|texmf.cnf|g'                               \
            -e 's|texmf.in|texmf.cnf|'                                \
            -e 's|selfautofix|dummy|'                                 \
            -e 's|texlive2007\.|texlive2008.|'                        \
            -e "/4b.diff/d"                                           \
            -e 's|data/config|data|'                                  \
            -e 's|5.96-p1.7b|5.97-p1.7b|'                             \
            -e "/compile freetype2/,/^EOF/d"                          \
            -e "/kdegraphics/d"                                       \
            -e "/2007-0650/d"                                         \
            -e '/## check/,$d'                                        \
          ptexlive/2extract-src.sh
 touch texlive/dummy

 # set option
 echo "TEXSRC_EXTRACTED=`pwd`/texlive" >> ptexlive.cfg
 echo "TEXMFDIST=%p/share/texmf-dist"  >> ptexlive.cfg
 echo "JAPANESE=international"         >> ptexlive.cfg

 # add mendexk and makejvf entry
 sed -i.bak -e 's|dvipsk|mendexk|g' \
            -e 's|xdvik|makejvf|g'  \
            -e 's|\(with_makejvf=\)no|\1yes|'    texlive/texk/configure

 # extract pTeX src and apply patches of ptexlive
 (cd ptexlive && ./2extract-src.sh) || exit
 patch -d texlive/texk/makejvf -p1 \
  < texlive/texk/ptexenc/patches/makejvf-1.1a-ptexenc.patch
 patch -d texlive/texk/mendexk -p1 \
  < texlive/texk/ptexenc/patches/mendexk2.6e-ptexenc.patch

 # apply texlive.patch and jbibtex patch
 sed 's|@PREFIX@|%p|g' < %{PatchFile} | patch -d texlive -p1
 sed -i.bak -e '1,31d'               texlive/texk/web2c/ptexdir/jbibextra.c
 sed -i.bak -e 's|pbibtex|jbibtex|g' \
            -e 's|PBIBTEX|JBIBTEX|g' texlive/texk/web2c/ptexdir/ptexhelp.h

 # add ac_subst_vars entry
 perl -pi.bak -e "s/(PS_DEF\n)/\1FREETYPE2CPPFLAGS\nLDFREETYPE2\nFREETYPE2DEP\nZLIBCPPFLAGS\nLDZLIB\nZLIBDEP\n/" \
                                                 texlive/texk/pxdvik/configure

 # the same patches in ptexenc.info
 perl -pi.bak1 -e 's,\*\.obj\),*.obj | *.dSYM),' texlive/texk/ptexenc/configure
 sed -i.bak2 's|\(nonopt=\)"$ac_option"|\1NONE|' texlive/texk/ptexenc/configure
 sed -i.bak  's|\(0:0 $(objects)\)|\1 $(kpathsea) $(LIBS)|' \
                                                 texlive/texk/ptexenc/Makefile.in

 # patches for makejvf
 sed -i.bak2 's|\(nonopt=\)"$ac_option"|\1NONE|' texlive/texk/makejvf/configure
 perl -pi.bak1 -e 's|(post-dist-\$\(distname\):)|\1\n\$\(top_srcdir\)/stamp-configure|' \
                                                 texlive/texk/makejvf/Makefile.in
 perl -pi.bak2 -e 's|(\$\(top_srcdir\)/stamp-configure)|\1:\n\ttouch \1|' \
                                                 texlive/texk/makejvf/Makefile.in

 # copy ptexlive's docs
 cp     ptexlive/README    ptexlive-README
 cp     ptexlive/README.en ptexlive-README.en
 cp     ptexlive/LICENSE   ptexlive-LICENSE.src
<<
SetCPPFLAGS:-I%p/lib/freetype219/include/freetype2 -I%p/lib/freetype219/include
SetLDFLAGS: -L%p/lib/freetype219/lib
NoSetMAKEFLAGS: true
SetMAKEFLAGS: -j1
ConfigureParams: <<
 --without-texi2html --without-texinfo --enable-shared \
 --datadir='${prefix}/share' --infodir='${prefix}/share/info' \
 --mandir='${prefix}/share/man' --disable-multiplatform --with-system-ncurses \
 --with-system-pnglib --with-system-t1lib --with-system-wwwlib \
 --with-system-zlib \
 --without-psutils --without-dialog --without-tex4htk --without-t1utils \
 --without-detex --without-dvipdfmx --without-luatex --without-lcdf-typetools \
 --without-xindy --without-xdv2pdf --without-xetex --without-xdvipdfmx \
 --without-lacheck --without-ttf2pk \
 --without-mf-nowin --without-pdfopen --with-system-freetype2 \
 --with-freetype2-libdir=%p/lib/freetype219/lib \
 --with-freetype2-include=%p/lib/freetype219/include \
 --enable-kanji-iconv --with-ptexenc=UTF8 \
 --without-afm2pl --without-bibtex8 --without-cjkutils --without-devnag \
 --without-dtl --without-dvi2tty --without-dvidvi --without-dviljk \
 --without-dvipdfm --without-dvipng --without-dvipos --without-gsftopk \
 --without-musixflx --without-ps2pkm --without-ps2eps --without-seetexk \
 --without-sam2p --without-tth \
 --without-mendexk \
 (%type_raw[-nox] = .) --with-system-gd 
 (%type_raw[-nox] = .) --x-includes=/usr/X11R6/include
 (%type_raw[-nox] = .) --x-libraries=/usr/X11R6/lib
 (%type_raw[-nox] = -nox) --without-x 
 (%type_raw[-nox] = -nox) --without-xdvik
 (%type_raw[-nox] = -nox) --without-pxdvik
<<
CompileScript: <<
#!/bin/bash -ev
 export PATH=%p/lib/xmkmf/bin:%p/lib/freetype219/bin:$PATH 
 export IMAKEINCLUDE=-I%p/lib/X11/config
 cd texlive && ./configure %c && make
<<
InstallScript: <<
#!/bin/bash -ev
 export PATH=%p/lib/xmkmf/bin:$PATH 
 export IMAKEINCLUDE=-I%p/lib/X11/config
 export PROGRAMS="web2c makejvf pdvipsk"
if [ "%type_raw[-nox]" == "." ]; then
 export PROGRAMS="$PROGRAMS pxdvik"
fi
 for dir in $PROGRAMS
 do
   pushd texlive/texk/$dir
   make install prefix=%i texmf=%i/share/texmf run_texlinks=true run_mktexlsr=true
   popd
 done

echo "Setting up symlinks ..."
 ln -s ptex %i/bin/platex

echo "Moving files that belong to the texlive* package ..."
 install -m 755 -d                           %i/lib/omegaware
 mv %i/bin/{ofm2opl,opl2ofm,ovf2ovp,ovp2ovf} %i/lib/omegaware

echo "Removing files that are supplied in the texlive* package ..."
 rm -R %i/share/info
 rm -R %i/share/man
 rm -R %i/share/texmf/dvips
 rm -f %i/share/texmf/xdvi/XDvi
 
 for file in `cat texlive/bin.duplex`
 do
   rm -f %i/bin/${file}
 done

# make font dirs and make links for apple's fonts
install -m 755 -d                %i/share/texmf/fonts/{opentype,truetype}
if [ "%type_raw[-nox]" == "." ]; then
 ln -s %p/lib/X11/fonts/appleotf %i/share/texmf/fonts/opentype
 ln -s %p/lib/X11/fonts/applettf %i/share/texmf/fonts/truetype
fi
<<
Depends: <<
  t1lib5-nox-shlibs, libpng3-shlibs (>= 1:1.2.8-1), 
  libwww-bin, libncurses5-shlibs (>= 5.4-20041023-1006), ncurses (>= 5.4-20041023-1006),
  (%type_raw[-nox] = -nox) texlive-nox-base,
  (%type_raw[-nox] = .) texlive-base,
  fink (>= 0.12.0-1), ptexenc-shlibs (>= 0.999-0), ptex-texmf (>= 2.5-0), nkf,
  freetype219-shlibs (>= 2.2.1-4),
  (%type_raw[-nox] = .) applesystemfonts,
  (%type_raw[-nox] = .) appleotffonts,
  (%type_raw[-nox] = .) t1lib5-x11-shlibs,
  (%type_raw[-nox] = -nox) ghostscript-nox, 
  (%type_raw[-nox] = .) ghostscript, 
  (%type_raw[-nox] = .) gd2-shlibs (>= 2.0.35-2), 
  (%type_raw[-nox] = .) x11, 
  (%type_raw[-nox] = .) x11-shlibs,
  (%type_raw[-nox] = .) openmotif3-shlibs
<<
Conflicts: <<
  ptex-base (>= 0), ptex-nox-base,
  ptex (<= 3.1.9-1055), ptex-nox (<= 3.1.9-1055), ptex-dev (<= 3.1.3-8), ptex-shlibs (<= 3.1.3-8),
  mendexk (<= 2.5-1),
  (%type_raw[-nox] = .) xdvik (<= 22.40y1-7)
 <<
Replaces: <<
  ptex-base (>= 0), ptex-nox-base,
  ptex (<= 3.1.9-1055), ptex-nox (<= 3.1.9-1055), ptex-dev (<= 3.1.3-8), ptex-shlibs (<= 3.1.3-8),
  mendexk (<= 2.5-1),
  (%type_raw[-nox] = .) xdvi (<=  22.70-1), 
  (%type_raw[-nox] = .) xdvik (<= 22.40y1-7)
 <<
Provides: ptex3-base, mendexk
DocFiles: <<
 texlive/texk/web2c/ptexdir/COPYRIGHT*
 texlive/texk/web2c/ptexdir/{Changes,INSTALL,README}.txt
 ptexlive-README ptexlive-README.en ptexlive-LICENSE.src
<<
PostInstScript: <<
  mktexlsr %p/share/texmf

  formats="ptex platex"
  for f in ${formats}
  do
    PATH=%p/bin:${PATH} fmtutil-sys --enablefmt ${f}
    PATH=%p/bin:${PATH} fmtutil-sys --byfmt     ${f}
  done

 if [ -x %p/bin/texhash ]; then %p/bin/texhash; fi
<<
PreRmScript: <<
  if [ "$1" != "upgrade" ]; then
    formats="ptex platex"
    for f in ${formats}
    do
      fmt=`%p/bin/kpsewhich -engine ptex ${f}.fmt`
      if [ "x${fmt}" != "x" ]; then rm ${fmt}; fi
      PATH=%p/bin:${PATH} fmtutil-sys --disablefmt ${f} || true
    done
  fi
<<
PostRmScript: if [ -x %p/bin/texhash ]; then %p/bin/texhash; fi
DescDetail: <<
 pTeX is the ASCII publishing TeX distribution. This package can handle
 Japanese TeX file and also takes account of vertical writing.
<<
License: Restrictive/Distributable
Maintainer: Todai Fink Team <fink@sodan.ecc.u-tokyo.ac.jp>
Homepage: http://www.ascii.co.jp/pb/ptex/
<<
