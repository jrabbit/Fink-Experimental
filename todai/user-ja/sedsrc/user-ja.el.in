;; Language environment settings
;; $Id$

;; Setup Japanese UTF-8 environment.
;; Recent Emacs 22 (22.0.50.cvs20060118) is enough clever for us
;; to accept most of its default configurations.
;; We don't need even set-language-environment!
(when (eq emacs-major-version 22)
  (if (require 'utf-8m nil t)
      (set-file-name-coding-system 'utf-8m))
  (custom-set-variables
    '(utf-translate-cjk-unicode-range '((#x80 . #xd7a3) (#xff00 . #xffef))))
  (cond ((and (eq window-system 'mac)
              (fboundp 'mac-setup-inline-input-method))
         (mac-setup-inline-input-method))
        ((eq current-language-environment "Japanese")
         (custom-set-variables '(default-input-method "japanese-yc")))))
;; For Todai Fink Team's obsolete emacs21-carbon package.
;; As we moved utf-8m.el into emacs22-carbon, utf-8m is not available
;; on emacs21-carbon now.
(when (eq emacs-major-version 21)
  (set-language-environment "Japanese")
  (setq utf-decode-to-japanese-symbol t) ;; obsolete
  (utf-translate-cjk-mode t)
  (custom-set-variables
    '(utf-fragment-on-decoding nil)
    '(utf-translate-cjk-unicode-range '((#x80 . #xd7a3) (#xff00 . #xffef)))
    '(default-input-method "japanese-yc")
    )
  (set-default-coding-systems 'utf-8)
  (set-buffer-file-coding-system 'utf-8)
  (unless (and (boundp 'mac-access-clipboard-in-unicode)
               mac-access-clipboard-in-unicode)
    (set-clipboard-coding-system 'sjis-mac))
  (set-terminal-coding-system 'utf-8)
  (set-keyboard-coding-system
   (if (eq window-system 'mac) 'sjis-mac 'utf-8))
  (set-file-name-coding-system 'utf-8)
  ;; Workaround a bug of emacs21-20041117
  (if (and (fboundp 'utf-translate-cjk-load-tables)
           (eq fink-emacs-flavor 'emacs21))
      (utf-translate-cjk-load-tables)))

;; Set up the keyboard so the delete key on both the regular keyboard
;; and the keypad delete the character under the cursor and to the right
;; under X, instead of the default, backspace behavior.
(global-set-key [delete] 'delete-char)
(global-set-key [kp-delete] 'delete-char)

;; Visual feedback on selections
(setq-default transient-mark-mode t)

;; Turn on font-lock mode for Emacs
(require 'font-lock)
(global-font-lock-mode t)
(setq font-lock-support-mode 'jit-lock-mode)
(setq font-lock-maximum-decoration t)

;; Highlight matching parenthesis
(when (fboundp 'show-paren-mode)
  (show-paren-mode t))

;; Enable wheelmouse support by default
;; for only wheelmouse scroll
(defun up-slightly () (interactive) (scroll-up 5))
(defun down-slightly () (interactive) (scroll-down 5))
(global-set-key [mouse-4] 'down-slightly)
(global-set-key [mouse-5] 'up-slightly)
;; for Shift + wheelmouse scroll, but not work?
(defun up-oneline () (interactive) (scroll-up 1))
(defun down-oneline () (interactive) (scroll-down 1))
(global-set-key [S-mouse-4] 'down-oneline)
(global-set-key [S-mouse-5] 'up-oneline)
;; for Control + wheelmouse scroll
(defun up-half () (interactive) (scroll-up (/ (window-height) 2)))
(defun down-half () (interactive) (scroll-down (/ (window-height) 2)))
(global-set-key [C-mouse-4] 'down-half)
(global-set-key [C-mouse-5] 'up-half)

;; Enable to edit gz file
(auto-compression-mode t)

;; Cursor type (in order to avoid cursor-garbase.)
(setq default-cursor-type 'bar)

;; Meta = Option when Carbon Emacs
(when (eq window-system 'mac)
  (setq mac-command-key-is-meta nil))

;; carbon-font or appleotffonts-ja
(when (eq window-system 'mac)
  (cond ((require 'carbon-font nil t)
         (cond ((memq "-*-*-medium-r-normal--12-*-*-*-*-*-fontset-hiraginokaku" (fontset-list))
                ;; for emacs22-carbon >= 22.0.50.cvs20060118
                (set-default-font "hiraginokaku"))
               ((memq "-*-fixed-medium-r-normal-*-12-*-*-*-*-*-fontset-hiraginokaku12" (fontset-list))
                ;; for emacs21-carbon >= 20041229
                (set-default-font "fontset-hiraginokaku12"))))
        ((require 'appleotffonts-ja nil t)
         ;; for emacs21-carbon < 20041229
         (set-default-font "fontset-hirakakugo14"))))
